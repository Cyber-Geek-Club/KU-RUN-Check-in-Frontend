<script lang="ts">
    // --- GLOBAL: Convert Bangkok time (input) to UTC ISO string for backend ---
    function createUTCISOFromBangkok(dateStr: string, timeStr: string): string {
      try {
        const [yearStr, monthStr, dayStr] = dateStr.split('-');
        const year = parseInt(yearStr, 10);
        const month = parseInt(monthStr, 10);
        const day = parseInt(dayStr, 10);
        const timeParts = timeStr.trim().split(':');
        const hour = parseInt(timeParts[0].trim(), 10);
        const minute = parseInt(timeParts[1].trim(), 10);
        
        // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á Date object ‡πÅ‡∏ö‡∏ö UTC ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏ö 7 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡πÄ‡∏õ‡πá‡∏ô UTC
        // ‡πÉ‡∏ä‡πâ Date.UTC() ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ timezone ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
        const bangkokTimestamp = Date.UTC(year, month - 1, day, hour, minute, 0, 0);
        
        // ‡∏•‡∏ö 7 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (Bangkok = UTC+7)
        const bangkokOffsetMs = 7 * 60 * 60 * 1000;
        const utcTimestamp = bangkokTimestamp - bangkokOffsetMs;
        
        return new Date(utcTimestamp).toISOString();
      } catch (err: any) {
        console.error("‚ùå Error in createUTCISOFromBangkok:", err.message);
        throw err;
      }
    }
  import { onMount, onDestroy, tick } from "svelte";
  import Swal from "sweetalert2";
  import jsQR from "jsqr";
  import { page } from "$app/stores";
  import { goto, invalidateAll } from "$app/navigation";
  import { base } from "$app/paths";
  import axios, { type AxiosError, type AxiosRequestConfig } from "axios";

  const API_BASE_URL = (import.meta.env.VITE_API_BASE_URL || "").replace(
    /\/$/,
    ""
  );

  // ==========================================
  // üîß AXIOS INSTANCE CONFIGURATION
  // ==========================================
  const api = axios.create({
    baseURL: API_BASE_URL,
    timeout: 30000,
    headers: {
      "Content-Type": "application/json",
    },
  });

  // Retry configuration
  const MAX_RETRIES = 3;
  const RETRY_DELAY = 1000; // 1 second

  // Helper function for delay
  const delay = (ms: number) =>
    new Promise((resolve) => setTimeout(resolve, ms));

  // Helper: decode JWT payload safely (supports URL-safe base64)
  function decodeJwtPayload(token: string): any | null {
    try {
      const parts = token.split(".");
      if (parts.length < 2) return null;
      let payload = parts[1].replace(/-/g, "+").replace(/_/g, "/");
      const pad = payload.length % 4;
      if (pad) payload += "=".repeat(4 - pad);
      const json = atob(payload);
      return JSON.parse(json);
    } catch (e) {
      return null;
    }
  }

  // Request interceptor - ‡πÄ‡∏û‡∏¥‡πà‡∏° token ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
  api.interceptors.request.use(
    (config) => {
      const token = localStorage.getItem("access_token");
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      // Add retry count to config
      (config as any).__retryCount = (config as any).__retryCount || 0;
      return config;
    },
    (error) => {
      return Promise.reject(error);
    }
  );

  // Response interceptor - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error, 401, ‡πÅ‡∏•‡∏∞ retry ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 502
  api.interceptors.response.use(
    (response) => response,
    async (error: AxiosError) => {
      const config = error.config as any;

      // ‚úÖ Handle error status - ‡πÅ‡∏¢‡∏Å‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó
      if (error.response?.status) {
        const status = error.response.status;
        
        // üîí 401/403 = Authentication/Authorization error - Force logout
        if (status === 401 || status === 403) {
          console.error(`‚ùå API Error ${status} - Force logout and redirect`);
          
          // Clear ALL storage and cookies
          if (typeof localStorage !== 'undefined') {
            localStorage.clear();
          }
          if (typeof sessionStorage !== 'undefined') {
            sessionStorage.clear();
          }
          if (typeof document !== 'undefined') {
            document.cookie.split(";").forEach((c) => {
              document.cookie = c
                .replace(/^ +/, "")
                .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
            });
          }
          
          // Force redirect to login
          if (typeof window !== 'undefined') {
            window.location.href = '/auth/login';
          }
          
          return Promise.reject(error);
        }
        
        // ‚ö†Ô∏è 400, 404, 500, etc. = Business logic error - ‡πÑ‡∏°‡πà logout, ‡∏™‡πà‡∏á error ‡πÉ‡∏´‡πâ caller ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
        console.warn(`‚ö†Ô∏è API Error ${status}: ${error.response?.statusText || 'Unknown'}`);
        return Promise.reject(error);
      }

      // Handle network errors with retry
      const isNetworkError = !error.response && error.code === "ECONNABORTED";

      if (isNetworkError && config && config.__retryCount < MAX_RETRIES) {
        config.__retryCount += 1;
        console.warn(
          `üîÑ Retry attempt ${config.__retryCount}/${MAX_RETRIES} for ${config.url} (network error)`
        );

        // Wait before retry with exponential backoff
        await delay(RETRY_DELAY * config.__retryCount);

        return api(config);
      }

      // Network error without response - log but don't force logout
      // Let the caller handle the error appropriately
      console.error('‚ùå Network error:', error.message || 'Unknown network error');
      return Promise.reject(error);
    }
  );

  // ===== PERFORMANCE OPTIMIZATION =====
  // Disable excessive console.log in production
  const isDev = import.meta.env.DEV;

  // Filter cache for memoization
  const filterCache = new Map<string, { result: any; timestamp: number }>();
  const CACHE_TTL = 3000; // 3 seconds

  // Temporary holder for created event id so logs can reference it from catch blocks
  let __createdEventId: number | undefined = undefined;

  function getCachedOrCompute<T>(cacheKey: string, computeFn: () => T): T {
    const cached = filterCache.get(cacheKey);
    const now = Date.now();

    if (cached && now - cached.timestamp < CACHE_TTL) {
      return cached.result as T;
    }

    const result = computeFn();
    filterCache.set(cacheKey, { result, timestamp: now });

    // Cleanup old entries (keep max 30)
    if (filterCache.size > 30) {
      const iterator = filterCache.keys();
      const oldest = iterator.next().value;
      if (oldest) filterCache.delete(oldest);
    }

    return result;
  }

  // ================================
  // Logging helper - logs to console in development
  // Backend logging endpoints are not yet implemented, so we only log locally
  async function sendEventLog(
    eventId: number | undefined,
    userId: number | undefined,
    logPayload: any
  ) {
    // Only log to console in development - don't call API endpoints that don't exist
    if (isDev) {
      console.debug("[Event Log]", {
        timestamp: new Date().toISOString(),
        event_id: eventId,
        user_id: userId,
        type: logPayload?.type,
        data: logPayload,
      });
    }

    // Return resolved promise to maintain compatibility with existing .catch() calls
    return Promise.resolve(null);
  }

  // Optimized filter function
  function filterEventsOptimized(
    events: AppEvent[],
    query: string,
    month: string,
    year: string
  ): AppEvent[] {
    if (!events || events.length === 0) return [];

    const lowerQuery = query.toLowerCase().trim();

    return events.filter((event) => {
      // Early returns for better performance
      if (year !== "All" && event.year !== year) return false;
      if (month !== "All" && event.month !== month) return false;
      if (!lowerQuery) return true;

      return (
        event.title.toLowerCase().includes(lowerQuery) ||
        event.location.toLowerCase().includes(lowerQuery)
      );
    });
  }

  // Pre-computed tier order cache
  let cachedTierOrder = new Map<string, number>();

  // Tab visibility tracking for performance monitor
  let isTabVisible = true;

  if (typeof document !== "undefined") {
    document.addEventListener("visibilitychange", () => {
      isTabVisible = !document.hidden;
    });
  }
  // ===== END PERFORMANCE OPTIMIZATION =====

  if (isDev) console.log("üîç API_BASE_URL:", API_BASE_URL);

  // ==========================================
  // üåê INTERNATIONALIZATION (i18n) SYSTEM
  // ==========================================
  type Language = "th" | "en";
  let currentLang: Language = "th";

  // Load saved language preference - default to 'th' if not set
  if (typeof localStorage !== "undefined") {
    const savedLang = localStorage.getItem("app_language");
    if (savedLang === "th" || savedLang === "en") {
      currentLang = savedLang;
    } else {
      // Set default to Thai if no preference saved
      localStorage.setItem("app_language", "th");
    }
  }

  function toggleLanguage() {
    currentLang = currentLang === "th" ? "en" : "th";
    if (typeof localStorage !== "undefined") {
      localStorage.setItem("app_language", currentLang);
    }
  }

  // Translation object
  const translations = {
    th: {
        // Modal - Approve/Reject Submission
        approveSubmission: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
        approveSubmissionDesc: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ô‡∏µ‡πâ?",
        approve: "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
        cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
        statusChangesTo: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô",
        completed: "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô",
        distance: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á",
        systemAutoAssigns: "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
        yesApprove: "‡πÉ‡∏ä‡πà, ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥",
        rejectSubmission: "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
        rejectSubmissionDesc: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:",
        unclearImage: "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô",
        unclearImageDesc: "‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ö‡∏•‡∏≠ ‡∏°‡∏∑‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ",
        incorrectData: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
        incorrectDataDesc: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç",
        duplicate: "‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô",
        duplicateDesc: "‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß",
        otherReason: "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏≠‡∏∑‡πà‡∏ô",
        otherReasonDesc: "‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°",
        confirmReject: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò",
      // Navigation & Header
      organizer: "‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô",
      events: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      createEvent: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      verifyProof: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
      activityLogs: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      rewards: "‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      settings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤",
      logout: "‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö",
      navigation: "‡πÄ‡∏°‡∏ô‡∏π",

      // Event List
      eventList: "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      searchEvents: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°...",
      allMonths: "‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
      allYears: "‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ",
      noEventsFound: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      participants: "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
      slots: "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á",
      active: "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
      inactive: "‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
      published: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà‡πÅ‡∏•‡πâ‡∏ß",
      draft: "‡∏â‡∏ö‡∏±‡∏ö‡∏£‡πà‡∏≤‡∏á",
      closed: "‡∏õ‡∏¥‡∏î‡πÅ‡∏•‡πâ‡∏ß",
      edit: "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç",
      delete: "‡∏•‡∏ö",
      view: "‡∏î‡∏π",
      noDescription: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î",
      holidaysOff: "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î",
      noResults: "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå",
      viewDetails: "‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î",

      // Create/Edit Event
      createNewEvent: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÉ‡∏´‡∏°‡πà",
      editEvent: "‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      eventName: "‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      description: "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î",
      location: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà",
      startDate: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°",
      endDate: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      startTime: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°",
      endTime: "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      capacity: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á",
      // distance: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á", // duplicate, remove
      day: "‡∏ß‡∏±‡∏ô",
      month: "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
      year: "‡∏õ‡∏µ",
      holidays: "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î",
      excludeWeekends: "‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå-‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
      specificDates: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞",
      noHolidays: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î",
      save: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å",
      // cancel: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å", // duplicate, remove
      update: "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó",
      create: "‡∏™‡∏£‡πâ‡∏≤‡∏á",
      uploadImage: "‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û",
      removeImage: "‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û",
      isPublic: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà",
      isActive: "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
      required: "‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô",
      publish: "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà",

      // Event Type
      eventTypeTitle: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      singleDay: "‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß",
      multiDay: "‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô",
      singleDayDesc: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
      multiDayDesc: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
      maxCheckinsPerUser: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ï‡πà‡∏≠‡∏Ñ‡∏ô",
      allowDailyCheckin: "‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô",
      checkinTimes: "‡∏Ñ‡∏£‡∏±‡πâ‡∏á",

      // Rewards
      rewardTiers: "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      addTier: "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö",
      tierName: "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏∞‡∏î‡∏±‡∏ö",
      quota: "‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤",
      requirement: "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç",
      rounds: "‡∏£‡∏≠‡∏ö",

      // Verify Proof
      proofSubmissions: "‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤",
      // approve: "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥", // duplicate, remove
      reject: "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò",
      pending: "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
      approved: "‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß",
      rejected: "‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß",
      verifyCode: "‡∏ï‡∏£‡∏ß‡∏à‡∏£‡∏´‡∏±‡∏™",
      unlock: "‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ",
      enterCode: "‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™",
      scanQR: "‡∏™‡πÅ‡∏Å‡∏ô QR",
      verifyBtn: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",
      clearBtn: "‡∏•‡πâ‡∏≤‡∏á",
      autoCheckIn: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
      cameraAccess: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á",
      startCamera: "‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á",
      stopCamera: "‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á",
      scanning: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πÅ‡∏Å‡∏ô...",

      // Logs
      logs: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥",
      action: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥",
      status: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞",
      timestamp: "‡πÄ‡∏ß‡∏•‡∏≤",
      user: "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
      viewLogs: "‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥",
      activityHistory: "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      noLogs: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥",
      exportLogs: "‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥",
      filterByAction: "‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥",
      filterByStatus: "‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞",
      // Logs - Action Labels
      actionJoined: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",
      actionCheckedIn: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô",
      actionCompleted: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
      actionCancelled: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
      actionRejected: "‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò",
      // Logs - Field Labels
      joinCode: "‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
      joinedAt: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      checkedInAt: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      completedAt: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      cancelledAt: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      proofSubmittedAt: "‡∏™‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      lastUpdated: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
      viewProofImage: "‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
      cancellationReason: "‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",

      // Rewards
      viewRewards: "‡∏î‡∏π‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      rewardManagement: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      noRewards: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      rewardStatus: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      claimed: "‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß",
      unclaimed: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏±‡∏ö",
      totalRewards: "‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
      sendNotification: "‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô",
      notificationSent: "‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",

      // Verify Code Page
      participantCheckIn: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
      participantCheckOut: "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
      verifyParticipantCode: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô",
      verifyParticipantCodeOut:
        "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏´‡∏•‡∏±‡∏á‡∏à‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      pinCode: "‡∏£‡∏´‡∏±‡∏™ PIN",
      checkIn: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô",
      checkOut: "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå",
      enterDigitCode: "‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 5 ‡∏´‡∏•‡∏±‡∏Å",
      autoCheckInEnabled: "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
      autoCheckOutEnabled: "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
      pressCheckIn: "‡∏Å‡∏î ‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
      pressCheckOut: "‡∏Å‡∏î ‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
      checkOutSuccess: "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
      autoProcess: "‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",

      // Unlock Page
      unlockAccount: "‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ",
      enterEmailToRestore: "‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á",
      userEmailAddress: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
      enterEmailPlaceholder: "‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•",

      // Verify Proof Page
      verifyProofTitle: "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
      apply: "‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
      reset: "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï",
      // completed: "‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô", // duplicate, remove
      inProgress: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£",
      notStarted: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°",
      progress: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤",

      // Reward Page
      globalRank: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°",
      tierRank: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÉ‡∏ô Tier",
      progressTo: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÑ‡∏õ",
      times: "‡∏Ñ‡∏£‡∏±‡πâ‡∏á",
      nextTier: "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
      more: "‡∏≠‡∏µ‡∏Å",
      showing: "‡πÅ‡∏™‡∏î‡∏á",
      of: "‡∏à‡∏≤‡∏Å",
      users: "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ",
      allTiers: "‡∏ó‡∏∏‡∏Å Tier",
      sortBy: "‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°",
      globalBestFirst: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      globalLowestFirst: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏£‡∏ß‡∏°‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      tierBestFirst: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö Tier ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      tierLowestFirst: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö Tier ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      bestFirst: "‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Üí ‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      lowestFirst: "‡∏ï‡πà‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‚Üí ‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
      sendMessage: "‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°",

      // Common
      loading: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...",
      error: "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î",
      success: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
      confirm: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô",
      close: "‡∏õ‡∏¥‡∏î",
      search: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤",
      filter: "‡∏Å‡∏£‡∏≠‡∏á",
      export: "‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å",
      refresh: "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä",
      back: "‡∏Å‡∏•‡∏±‡∏ö",
      next: "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ",
      previous: "‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤",
      total: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
      select: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
      all: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
      backToEvents: "‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      selectEvent: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      searchByName: "‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ‡∏≠‡∏µ‡πÄ‡∏°‡∏• ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï...",
      batch: "‡∏£‡∏∏‡πà‡∏ô",
      stdId: "‡∏£‡∏´‡∏±‡∏™",
      fromDate: "‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà",
      toDate: "‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà",
      dateTime: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤",
      basicInfo: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô",
      schedule: "‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Å‡∏≤‡∏£",
      eventSettings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",

      // Messages
      eventCreated: "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
      eventUpdated: "‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
      eventDeleted: "‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
      fillAllFields: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô",
      invalidDateRange: "‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
      confirmDelete: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?",
      cannotUndo: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ",
      deleteEventTitle: "‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°?",
      deleteEventText: "‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ?",
      yesDelete: "‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢",
      deleted: "‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß!",
      eventDeletedSuccess: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",

      // Profile/Settings
      profile: "‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå",
      accountSettings: "‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ",
      manageProfile: "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤",
      personalInfo: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß",
      academicInfo: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤",
      departmentInfo: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å",
      title: "‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤",
      firstName: "‡∏ä‡∏∑‡πà‡∏≠",
      lastName: "‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•",
      email: "‡∏≠‡∏µ‡πÄ‡∏°‡∏•",
      emailAddress: "‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏≠‡∏µ‡πÄ‡∏°‡∏•",
      studentId: "‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï",
      faculty: "‡∏Ñ‡∏ì‡∏∞",
      major: "‡∏™‡∏≤‡∏Ç‡∏≤",
      department: "‡πÅ‡∏ú‡∏ô‡∏Å",
      saveChanges: "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á",
      selectTitle: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤",
      selectFaculty: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ì‡∏∞",
      selectMajor: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤",
      selectDepartment: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å",
      enterFirstName: "‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠",
      enterLastName: "‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•",
      enterEmail: "‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•",
      settingsUpdated: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",

      // Language
      language: "‡∏†‡∏≤‡∏©‡∏≤",
      thai: "‡πÑ‡∏ó‡∏¢",
      english: "English",
      switchToEnglish: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô English",
      switchToThai: "Switch to ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢",

      // Security
      security: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢",
      password: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô",
      changePassword: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô",

      // Create Event Form - Date & Time
      dateAndTime: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤",
      startDateLabel: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
      endDateLabel: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      startTimeLabel: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°",
      endTimeLabel: "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      capacityLabel: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö",
      distanceLabel: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á",
      dayPlaceholder: "‡∏ß‡∏±‡∏ô",
      monthPlaceholder: "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô",
      yearPlaceholder: "‡∏õ‡∏µ",
      selectTime: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤",
      invalidDateRangeMsg: "‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏•‡∏±‡∏á‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      dateRangeValid: "‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",

      // Create Event Form - Holidays
      holidaysAndExclusions: "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô",
      noHolidaysOption: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î",
      excludeWeekendsOption: "‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå-‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
      specificDatesOption: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏â‡∏û‡∏≤‡∏∞",
      selectHolidayOption: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î",
      holidaysSelected: "‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å",
      clickToSelect: "‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",

      // Create Event Form - Rewards
      rewardsDistribution: "‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      allocated: "‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÅ‡∏•‡πâ‡∏ß",
      remainingSlots: "‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠",
      exceededBy: "‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ",
      tierLabel: "‡∏£‡∏∞‡∏î‡∏±‡∏ö",
      quotaLabel: "‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤",
      requirementLabel: "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç (‡∏£‡∏≠‡∏ö)",
      rewardNameLabel: "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      addTierBtn: "+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏î‡∏±‡∏ö",
      removeTier: "‡∏•‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö",
      enterQuota: "‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô",
      enterRounds: "‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö",
      enterRewardName: "‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      unlockRewards: "‡∏Å‡∏£‡∏≠‡∏Å ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•",
      rankRange: "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö",

      // Create Event Form - Event Status
      eventStatusTitle: "‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°",
      publicVisibility: "‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏ú‡∏¢‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞",
      activeOpen: "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
      statusLive: "‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°",
      statusLiveDesc: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏∞",
      statusDraftLabel: "‡∏â‡∏ö‡∏±‡∏ö‡∏£‡πà‡∏≤‡∏á",
      statusDraftDesc: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",

      // Verify Proof
      proofInfo: "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô",
      submittedAt: "‡∏™‡πà‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠",
      stravaLink: "‡∏•‡∏¥‡∏á‡∏Å‡πå Strava",
      actualDistance: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏à‡∏£‡∏¥‡∏á",
      noStravaLink: "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡∏á‡∏Å‡πå",
      pendingSubmissions: "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö",

      // Logs
      totalActions: "‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏ó‡∏≥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",
      todayActions: "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ",
      recentActivity: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î",
    },
    en: {
        // Modal - Approve/Reject Submission
        approveSubmission: "Approve Submission",
        approveSubmissionDesc: "Are you sure you want to verify this proof?",
        approve: "Approve",
        cancel: "Cancel",
        statusChangesTo: "Status changes to",
        completed: "COMPLETED",
        // distance: "Distance", // duplicate, remove
        systemAutoAssigns: "System auto-assigns rewards",
        yesApprove: "Yes, Approve",
        rejectSubmission: "Reject Submission",
        rejectSubmissionDesc: "Please select a reason for rejection:",
        unclearImage: "Unclear Image",
        unclearImageDesc: "Photo is blurry, dark, or data is unreadable.",
        incorrectData: "Incorrect Data",
        incorrectDataDesc: "Distance or time does not match requirements.",
        duplicate: "Duplicate",
        duplicateDesc: "This proof has already been submitted.",
        otherReason: "Other Reason",
        otherReasonDesc: "Specify a custom reason below.",
        confirmReject: "Confirm Reject",
      // Navigation & Header
      organizer: "ORGANIZER",
      events: "Events",
      createEvent: "Create Event",
      verifyProof: "Verify Proof",
      activityLogs: "Activity Logs",
      rewards: "Rewards",
      settings: "Settings",
      logout: "Logout",
      navigation: "NAVIGATION",

      // Event List
      eventList: "Event List",
      searchEvents: "Search events...",
      allMonths: "All Months",
      allYears: "All Years",
      noEventsFound: "No events found",
      participants: "Participants",
      slots: "Slots",
      active: "Active",
      inactive: "Inactive",
      published: "Published",
      draft: "Draft",
      closed: "Closed",
      edit: "Edit",
      delete: "Delete",
      view: "View",
      noDescription: "No description",
      holidaysOff: "Days off",
      noResults: "No results found",
      viewDetails: "View Details",

      // Create/Edit Event
      createNewEvent: "Create New Event",
      editEvent: "Edit Event",
      eventName: "Event Name",
      description: "Description",
      location: "Location",
      startDate: "Start Date",
      endDate: "‡∏ß‡∏±‡∏ô‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      startTime: "‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô",
      endTime: "‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î",
      capacity: "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö",
      distance: "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á (‡∏Å‡∏°.)",
      day: "Day",
      month: "Month",
      year: "Year",
      holidays: "Holidays",
      excludeWeekends: "Exclude Weekends",
      specificDates: "Specific Dates",
      noHolidays: "No Holidays",
      save: "Save",
      // cancel: "Cancel", // duplicate, remove
      update: "Update",
      create: "Create",
      uploadImage: "Upload Image",
      removeImage: "Remove Image",
      isPublic: "Published",
      isActive: "Active",
      required: "Required",
      publish: "Publish",

      // Event Type
      eventTypeTitle: "Event Type",
      singleDay: "Single Day",
      multiDay: "Multi Day",
      singleDayDesc: "One-day event with single check-in",
      multiDayDesc: "Multi-day event with multiple check-ins allowed",
      maxCheckinsPerUser: "Max Check-ins Per User",
      allowDailyCheckin: "Allow Daily Check-in",
      checkinTimes: "times",

      // Rewards
      rewardTiers: "Reward Tiers",
      addTier: "Add Tier",
      tierName: "Tier Name",
      quota: "Quota",
      requirement: "Requirement",
      rounds: "rounds",

      // Verify Proof
      proofSubmissions: "Proof Submissions",
      // approve: "Approve", // duplicate, remove
      reject: "Reject",
      pending: "Pending",
      approved: "Approved",
      rejected: "Rejected",
      verifyCode: "Verify Code",
      unlock: "Unlock",
      enterCode: "Enter Code",
      scanQR: "Scan QR",
      verifyBtn: "Verify",
      clearBtn: "Clear",
      autoCheckIn: "Auto Check-in",
      cameraAccess: "Camera Access",
      startCamera: "Start Camera",
      stopCamera: "Stop Camera",
      scanning: "Scanning...",

      // Logs
      logs: "Logs",
      action: "Action",
      status: "Status",
      timestamp: "Timestamp",
      user: "User",
      viewLogs: "View Logs",
      activityHistory: "Activity History",
      noLogs: "No logs",
      exportLogs: "Export Logs",
      filterByAction: "Filter by Action",
      filterByStatus: "Filter by Status",
      // Logs - Action Labels
      actionJoined: "Joined",
      actionCheckedIn: "Checked In",
      actionCompleted: "Completed",
      actionCancelled: "Cancelled",
      actionRejected: "Rejected",
      // Logs - Field Labels
      joinCode: "Join Code",
      joinedAt: "Joined",
      checkedInAt: "Checked In",
      completedAt: "Completed",
      cancelledAt: "Cancelled",
      proofSubmittedAt: "Proof Submitted",
      lastUpdated: "Last updated",
      viewProofImage: "View Proof Image",
      cancellationReason: "Cancellation Reason",

      // Rewards
      viewRewards: "View Rewards",
      rewardManagement: "Reward Management",
      noRewards: "No rewards",
      rewardStatus: "Reward Status",
      claimed: "Claimed",
      unclaimed: "Unclaimed",
      totalRewards: "Total Rewards",
      sendNotification: "Send Notification",
      notificationSent: "Notification sent successfully",

      // Verify Code Page
      participantCheckIn: "Participant Check-in",
      participantCheckOut: "Participant Check-out",
      verifyParticipantCode: "Verify participant's code to complete check-in",
      verifyParticipantCodeOut:
        "Verify participant's code to complete check-out after event",
      pinCode: "PIN Code",
      checkIn: "CHECK IN",
      checkOut: "CHECK OUT",
      enterDigitCode: "Enter 5-digit code",
      autoCheckInEnabled: "Auto check-in enabled",
      autoCheckOutEnabled: "Auto check-out enabled",
      pressCheckIn: "Press CHECK IN to verify",
      pressCheckOut: "Press CHECK OUT to verify",
      checkOutSuccess: "Check-out Successful",
      autoProcess: "Auto",

      // Unlock Page
      unlockAccount: "Unlock Account",
      enterEmailToRestore:
        "Enter the user's email address to restore their access",
      userEmailAddress: "User Email Address",
      enterEmailPlaceholder: "Enter email address",

      // Verify Proof Page
      verifyProofTitle: "Verify Proof",
      apply: "Apply",
      reset: "Reset",
      // completed: "Completed", // duplicate, remove
      inProgress: "In Progress",
      notStarted: "Not Started",
      progress: "Progress",

      // Reward Page
      globalRank: "Global Rank",
      tierRank: "Tier Rank",
      progressTo: "Progress to",
      times: "times",
      nextTier: "Next",
      more: "more",
      showing: "Showing",
      of: "of",
      users: "users",
      allTiers: "All Tiers",
      sortBy: "Sort by",
      globalBestFirst: "Global Best First",
      globalLowestFirst: "Global Lowest First",
      tierBestFirst: "Tier Best First",
      tierLowestFirst: "Tier Lowest First",
      bestFirst: "Best ‚Üí Lowest",
      lowestFirst: "Lowest ‚Üí Best",
      sendMessage: "Send Message",

      // Common
      loading: "Loading...",
      error: "Error",
      success: "Success",
      confirm: "Confirm",
      close: "Close",
      search: "Search",
      filter: "Filter",
      export: "Export",
      refresh: "Refresh",
      back: "Back",
      next: "Next",
      previous: "Previous",
      total: "Total",
      select: "Select",
      all: "All",
      backToEvents: "Back to Events",
      selectEvent: "Select Event",
      searchByName: "Search by name, email, or Nisit ID...",
      batch: "Batch",
      stdId: "Std ID",
      fromDate: "From Date",
      toDate: "To Date",
      dateTime: "Date & Time",
      basicInfo: "Basic Information",
      schedule: "Schedule",
      eventSettings: "Event Settings",

      // Messages
      eventCreated: "Event created successfully!",
      eventUpdated: "Event updated successfully!",
      eventDeleted: "Event deleted successfully!",
      fillAllFields: "Please fill in all required fields",
      invalidDateRange: "Invalid date range",
      confirmDelete: "Confirm delete?",
      cannotUndo: "This action cannot be undone",
      deleteEventTitle: "Delete Event?",
      deleteEventText: "Are you sure you want to delete this event?",
      yesDelete: "Yes, Delete",
      deleted: "Deleted!",
      eventDeletedSuccess: "Event has been deleted successfully",

      // Profile/Settings
      profile: "Profile",
      accountSettings: "Account Settings",
      manageProfile: "Manage your profile information and preferences",
      personalInfo: "Personal Information",
      academicInfo: "Academic Information",
      departmentInfo: "Department Information",
      title: "Title",
      firstName: "First Name",
      lastName: "Last Name",
      email: "Email",
      emailAddress: "Email Address",
      studentId: "Student ID",
      faculty: "Faculty",
      major: "Major",
      department: "Department",
      saveChanges: "Save Changes",
      selectTitle: "Select Title",
      selectFaculty: "Select Faculty",
      selectMajor: "Select Major",
      selectDepartment: "Select Department",
      enterFirstName: "Enter first name",
      enterLastName: "Enter last name",
      enterEmail: "Enter email",
      settingsUpdated: "Settings updated successfully!",

      // Language
      language: "Language",
      thai: "‡πÑ‡∏ó‡∏¢",
      english: "English",
      switchToEnglish: "Switch to English",
      switchToThai: "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢",

      // Security
      security: "Security",
      password: "Password",
      changePassword: "Change Password",

      // Create Event Form - Date & Time
      dateAndTime: "Date & Time",
      startDateLabel: "Start Date",
      endDateLabel: "End Date",
      startTimeLabel: "Start Time",
      endTimeLabel: "End Time",
      capacityLabel: "Capacity",
      distanceLabel: "Distance (km)",
      dayPlaceholder: "Day",
      monthPlaceholder: "Month",
      yearPlaceholder: "Year",
      selectTime: "Select time",
      invalidDateRangeMsg: "Start date must not be later than end date",
      dateRangeValid: "Date range is valid",

      // Create Event Form - Holidays
      holidaysAndExclusions: "Holidays & Exclusions",
      noHolidaysOption: "No Holidays",
      excludeWeekendsOption: "Exclude Weekends",
      specificDatesOption: "Specific Dates",
      selectHolidayOption: "Please select a holiday option",
      holidaysSelected: "Holidays Selected",
      clickToSelect: "Click dates to select/deselect",

      // Create Event Form - Rewards
      rewardsDistribution: "Rewards Distribution",
      allocated: "Allocated",
      remainingSlots: "remaining",
      exceededBy: "Exceeded by",
      tierLabel: "Tier",
      quotaLabel: "Quota",
      requirementLabel: "Requirement (rounds)",
      rewardNameLabel: "Reward Name",
      addTierBtn: "+ Add Tier",
      removeTier: "Remove Tier",
      enterQuota: "Enter quota",
      enterRounds: "Enter rounds",
      enterRewardName: "Enter reward name",
      unlockRewards: "Enter Capacity first to unlock rewards",
      rankRange: "Rank",

      // Create Event Form - Event Status
      eventStatusTitle: "Event Status",
      publicVisibility: "Public Visibility",
      activeOpen: "Active (Open)",
      statusLive: "Ready for Participants",
      statusLiveDesc: "Event is open for registration and visible to public",
      statusDraftLabel: "Draft",
      statusDraftDesc: "Event is not yet open for registration",

      // Verify Proof
      proofInfo: "Proof Information",
      submittedAt: "Submitted at",
      stravaLink: "Strava Link",
      actualDistance: "Actual Distance",
      noStravaLink: "No link",
      pendingSubmissions: "Pending",

      // Logs
      totalActions: "Total Actions",
      todayActions: "Today",
      recentActivity: "Recent Activity",
    },
  };

  // Helper function to get translation
  $: t = (key: keyof typeof translations.th) => {
    return translations[currentLang][key] || translations.en[key] || key;
  };

  // Helper function to translate event status
  function translateStatus(status: string): string {
    switch (status) {
      case "Active":
        return lang.active;
      case "Draft":
        return lang.draft;
      case "Closed":
        return lang.closed;
      default:
        return status;
    }
  }

  // Reactive translation helper
  $: lang = translations[currentLang];
  // ===== END i18n SYSTEM =====

  interface LeaderboardEntry {
    user_id: string;
    user_name: string;
    total_completions: number;
    qualified_at: string | null;
    rank?: number;
    reward_tier?: number;
    reward_name?: string;
  }

  let leaderboardEntries: LeaderboardEntry[] = [];
  let leaderboardConfig: any = null;
  let isLoadingLeaderboard = false;

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Leaderboard
  function isEventFinalized(event: any): boolean {
    return (event && event.finalized_at) || rewardData.leaderboardFinalized;
  }

  // Track finalized state for UI
  $: rewardData.leaderboardFinalized = false;
  $: if (rewardData.selectedEvent) {
    rewardData.leaderboardFinalized = !!rewardData.selectedEvent.finalized_at;
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏∂‡∏á ID ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ Possibly null)
  function getSelectedEventId(): number | null {
    return rewardData.selectedEvent ? rewardData.selectedEvent.id : null;
  }

  // =========================================================
  // üèÜ Leaderboard Logic (‡∏â‡∏ö‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏° API Documentation)
  // =========================================================

  // ‚úÖ NEW: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Unique Users (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Multi-Day Events
  // API: GET /api/reward-leaderboards/events/{eventId}/users
  async function fetchUniqueParticipants(eventId: number): Promise<UniqueUsersResponse | null> {
    try {
      const res = await api.get(`/api/reward-leaderboards/events/${eventId}/users`, {
        params: { skip: 0, limit: 1000 }
      });
      
      const data = res.data;
      if (isDev) {
        console.log(`[UniqueParticipants] Loaded ${data.total_users} unique users for event ${eventId}`);
      }
      return data;
    } catch (error: any) {
      if (error.response?.status === 404) {
        if (isDev) console.log(`[UniqueParticipants] No users found for event ${eventId}`);
      } else {
        console.error("[UniqueParticipants] Fetch Error:", error.message);
      }
      return null;
    }
  }

  // ‚úÖ FIX: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Leaderboard Config ‡πÅ‡∏•‡∏∞ Unique Users
  async function fetchLeaderboard(eventId: number) {
    if (!eventId) return;
    
    try {
      rewardData.loading = true;
      
      // STEP 1: ‡∏î‡∏∂‡∏á Config ‡∏Ç‡∏≠‡∏á Event
      // API: GET /api/reward-leaderboards/configs/event/{eventId}
      let configData: any = null;
      let configId: number | undefined = undefined;
      
      try {
        const configRes = await api.get(`/api/reward-leaderboards/configs/event/${eventId}`);
        configData = configRes.data;
        
        if (configData && configData.id) {
          configId = configData.id;
          rewardData.currentConfigId = configId;
          
          // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó selectedEvent.rewardConfigId
          if (rewardData.selectedEvent) {
            rewardData.selectedEvent = {
              ...rewardData.selectedEvent,
              rewardConfigId: configId,
              finalized_at: configData.finalized_at
            };
          }
          
          // Check finalized state
          rewardData.leaderboardFinalized = configData.is_finalized || !!configData.finalized_at;
        }
      } catch (configError: any) {
        if (configError.response?.status !== 404) {
          console.warn("[Leaderboard] Config fetch error:", configError.message);
        }
        rewardData.currentConfigId = undefined;
        rewardData.leaderboardFinalized = false;
      }
      
      // STEP 2: ‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ Unique Users
      // ‚úÖ ‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡∏°‡πà: GET /api/reward-leaderboards/events/{eventId}/users
      // ‡∏ñ‡πâ‡∏≤ API ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏à‡∏∞ fallback ‡πÑ‡∏õ‡πÉ‡∏ä‡πâ entries API
      let uniqueUsersData = await fetchUniqueParticipants(eventId);
      
      // üîÑ Fallback: ‡∏ñ‡πâ‡∏≤ API ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ users ‡πÅ‡∏•‡∏∞‡∏°‡∏µ configId ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ entries API ‡πÅ‡∏ó‡∏ô
      if ((!uniqueUsersData || !uniqueUsersData.users || uniqueUsersData.users.length === 0) && configId) {
        if (isDev) console.log(`[Leaderboard] Fallback to entries API for config ${configId}`);
        
        try {
          const entriesRes = await api.get(`/api/reward-leaderboards/configs/${configId}/entries`, {
            params: { qualified_only: false, limit: 1000 }
          });
          
          const entriesData = Array.isArray(entriesRes.data) ? entriesRes.data : (entriesRes.data?.data || []);
          
          if (entriesData.length > 0) {
            // ‚úÖ Deduplicate: Group by user_id ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            const userMap = new Map<number, any>();
            
            entriesData.forEach((entry: any) => {
              const userId = entry.user_id;
              if (!userMap.has(userId)) {
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á record ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö user ‡∏ô‡∏µ‡πâ
                userMap.set(userId, {
                  user_id: userId,
                  user_full_name: entry.user_full_name || 'Unknown',
                  user_email: entry.user_email || '',
                  event_id: eventId,
                  event_name: rewardData.selectedEvent?.title || '',
                  total_participations: 1,
                  completed_participations: entry.qualified_at ? 1 : 0,
                  checked_in_count: 1,
                  proof_submitted_count: 1,
                  rejected_count: 0,
                  cancelled_count: 0,
                  total_distance_km: null,
                  first_participation_at: entry.qualified_at || null,
                  last_participation_at: entry.qualified_at || null,
                  leaderboard_config_id: configId,
                  leaderboard_rank: entry.rank || null,
                  leaderboard_qualified: !!entry.qualified_at,
                  leaderboard_reward_name: entry.reward_name || null,
                  tier_progress: null,
                  total_completions: entry.total_completions || 0
                });
              } else {
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó record ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà - ‡∏£‡∏ß‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô participation
                const existing = userMap.get(userId)!;
                existing.total_participations += 1;
                if (entry.qualified_at) {
                  existing.completed_participations += 1;
                }
                // ‡πÄ‡∏Å‡πá‡∏ö rank ‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                if (entry.rank && (!existing.leaderboard_rank || entry.rank < existing.leaderboard_rank)) {
                  existing.leaderboard_rank = entry.rank;
                  existing.leaderboard_reward_name = entry.reward_name;
                }
                // ‡πÄ‡∏Å‡πá‡∏ö total_completions ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                if ((entry.total_completions || 0) > existing.total_completions) {
                  existing.total_completions = entry.total_completions;
                }
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó qualified status
                if (entry.qualified_at) {
                  existing.leaderboard_qualified = true;
                }
              }
            });
            
            // Convert Map to array
            const uniqueUsers = Array.from(userMap.values());
            
            // Convert entries to unique users format
            uniqueUsersData = {
              total_users: uniqueUsers.length,
              event_id: eventId,
              event_name: rewardData.selectedEvent?.title || '',
              users: uniqueUsers
            };
            
            if (isDev) console.log(`[Leaderboard] Loaded ${uniqueUsers.length} unique users from entries API (deduplicated from ${entriesData.length} entries)`);
          }
        } catch (entriesError: any) {
          if (isDev) console.warn(`[Leaderboard] Entries fallback failed:`, entriesError.message);
        }
      }
      
      if (uniqueUsersData && uniqueUsersData.users && uniqueUsersData.users.length > 0) {
        // Get tier colors
        const tierColorsList = [
          "#FFD700", "#C0C0C0", "#CD7F32", "#8B5CF6", "#3B82F6",
          "#10B981", "#F59E0B", "#EC4899", "#06B6D4", "#84CC16"
        ];
        
        // Map unique users ‡πÄ‡∏õ‡πá‡∏ô RewardUser format
        rewardData.users = uniqueUsersData.users.map((user: UserEventStatus, index: number) => {
          // Determine status based on leaderboard_qualified
          let status: "completed" | "in_progress" | "no_tier" = "no_tier";
          if (user.leaderboard_qualified) {
            status = "completed";
          } else if (user.completed_participations > 0) {
            status = "in_progress";
          }
          
          // Get tier color based on rank
          const tierColor = user.leaderboard_rank 
            ? tierColorsList[(user.leaderboard_rank - 1) % tierColorsList.length]
            : "#64748b";
          
          return {
            id: `user_${user.user_id}`,
            odySd: user.user_id?.toString() || "",
            name: user.user_full_name || "Unknown",
            email: user.user_email || "",
            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${user.user_id}`,
            globalRank: user.leaderboard_rank || index + 1,
            tierRank: user.leaderboard_rank || index + 1,
            tier: user.leaderboard_reward_name || "No Tier",
            tierColor,
            completedCount: user.completed_participations || 0,
            totalParticipations: user.total_participations || 0,
            completedParticipations: user.completed_participations || 0,
            requiredCount: configData?.required_completions || 1,
            nextTierCount: configData?.required_completions || 1,
            completedAt: user.last_participation_at || "",
            joinCode: "",
            status,
            userId: user.user_id,
            totalDistanceKm: user.total_distance_km || undefined,
            leaderboardQualified: user.leaderboard_qualified,
            rewardName: user.leaderboard_reward_name || undefined,
            firstParticipationAt: user.first_participation_at || undefined,
            lastParticipationAt: user.last_participation_at || undefined
          };
        });
        
        // Sort by rank (qualified first, then by completions)
        rewardData.users.sort((a, b) => {
          // Qualified users first
          if (a.leaderboardQualified && !b.leaderboardQualified) return -1;
          if (!a.leaderboardQualified && b.leaderboardQualified) return 1;
          // Then by rank
          if (a.globalRank !== b.globalRank) return a.globalRank - b.globalRank;
          // Then by completions (descending)
          return (b.completedCount || 0) - (a.completedCount || 0);
        });
        
        if (isDev) {
          console.log(`[Leaderboard] Total unique users: ${uniqueUsersData.total_users}`);
          console.log(`[Leaderboard] Loaded ${rewardData.users.length} users (no duplicates)`);
          console.log(`[Leaderboard] Config ID: ${configId}`);
          console.log(`[Leaderboard] Finalized: ${rewardData.leaderboardFinalized}`);
        }
      } else {
        // Fallback: ‡πÑ‡∏°‡πà‡∏°‡∏µ unique users data
        rewardData.users = [];
        if (isDev) console.log(`[Leaderboard] No users found for event ${eventId}`);
      }
      
    } catch (error: any) {
      console.error("[Leaderboard] Fetch Error:", error.message);
      rewardData.users = [];
      rewardData.leaderboardFinalized = false;
    } finally {
      rewardData.loading = false;
    }
  }
  // =========================================================
  // üéØ Leaderboard Status Helper (‡∏ï‡∏≤‡∏° Flow ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)
  // =========================================================
  interface LeaderboardStatus {
    status: 'no_event' | 'no_config' | 'active' | 'ready_to_finalize' | 'finalized';
    message: string;
    messageEn: string;
    color: string;
    icon: string;
    canCalculate: boolean;
    canFinalize: boolean;
  }

  function getLeaderboardStatus(): LeaderboardStatus {
    // ‡πÑ‡∏°‡πà‡∏°‡∏µ Event ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    if (!rewardData.selectedEvent) {
      return {
        status: 'no_event',
        message: 'üìã ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Event',
        messageEn: 'Please select an event',
        color: '#6b7280',
        icon: 'info',
        canCalculate: false,
        canFinalize: false
      };
    }

    // Finalized ‡πÅ‡∏•‡πâ‡∏ß
    if (rewardData.leaderboardFinalized) {
      return {
        status: 'finalized',
        message: 'üèÜ ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ú‡∏•‡πÅ‡∏•‡πâ‡∏ß',
        messageEn: 'Results Announced',
        color: '#10b981',
        icon: 'check',
        canCalculate: false,
        canFinalize: false
      };
    }

    // ‡πÑ‡∏°‡πà‡∏°‡∏µ Config ID = ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Leaderboard
    if (!rewardData.currentConfigId) {
      return {
        status: 'no_config',
        message: '‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Reward Config',
        messageEn: 'No Reward Config',
        color: '#f59e0b',
        icon: 'warning',
        canCalculate: false,
        canFinalize: false
      };
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    const now = new Date();
    
    // Handle endDate - ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô {day, month, year} ‡∏´‡∏£‡∏∑‡∏≠ string/Date
    let endsAt: Date | null = null;
    const ed = rewardData.selectedEvent.endDate;
    if (ed) {
      if (typeof ed === 'string') {
        endsAt = new Date(ed);
      } else if (ed instanceof Date) {
        endsAt = ed;
      } else if (typeof ed === 'object' && 'year' in ed && 'month' in ed && 'day' in ed) {
        // Format: {day: "15", month: "01", year: "2026"}
        endsAt = new Date(`${ed.year}-${ed.month}-${ed.day}`);
      }
    }

    // ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö = Active
    if (endsAt && now < endsAt) {
      return {
        status: 'active',
        message: '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£',
        messageEn: 'In Progress',
        color: '#3b82f6',
        icon: 'clock',
        canCalculate: true, // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ calculate ‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ
        canFinalize: false  // ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ finalize ‡πÑ‡∏î‡πâ
      };
    }

    // ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß = ‡∏û‡∏£‡πâ‡∏≠‡∏° Finalize
    return {
      status: 'ready_to_finalize',
      message: '‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏° Finalize',
      messageEn: 'Ready to Finalize',
      color: '#f59e0b',
      icon: 'warning',
      canCalculate: true,  // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ calculate ‡πÑ‡∏î‡πâ
      canFinalize: true    // ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ finalize ‡πÑ‡∏î‡πâ
    };
  }

  // Reactive leaderboard status
  $: leaderboardStatus = getLeaderboardStatus();

  // UI helper: should show finalize button
  // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà finalize + ‡∏°‡∏µ users + ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß (ready_to_finalize)
  $: showFinalizeButton = leaderboardStatus.canFinalize && rewardData.users && rewardData.users.length > 0;

  // UI helper: should show calculate ranks button
  // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ‡∏°‡∏µ Event + ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà finalize (‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠)
  $: showCalculateRanksButton = leaderboardStatus.canCalculate;

  // ‚úÖ FIX: Function to calculate ranks - ‡∏ï‡∏≤‡∏° API Documentation
  // API: POST /api/reward-leaderboards/configs/{configId}/calculate-ranks
  async function handleCalculateRanks() {
    // ‚úÖ FIX: ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô + fallback
    const configId = rewardData.currentConfigId || rewardData.selectedEvent?.rewardConfigId;
    
    if (!configId) {
      Swal.fire({
        icon: "error",
        title: "‡πÑ‡∏°‡πà‡∏û‡∏ö Config ID",
        text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Event ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à",
        background: "#1e293b",
        color: "#fff"
      });
      return;
    }
    
    rewardData.loading = true;
    
    try {
      // ‚úÖ API ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ñ‡πà POST ‡πÑ‡∏°‡πà‡∏°‡∏µ body
      const response = await api.post(`/api/reward-leaderboards/configs/${configId}/calculate-ranks`);
      
      // ‚úÖ FIX: Check ranked_count ‡∏à‡∏≤‡∏Å response
      const result = response.data;
      
      if (result.ranked_count === 0) {
        await Swal.fire({
          icon: 'warning',
          title: '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥',
          text: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î',
          background: "#1e293b",
          color: "#fff"
        });
        return;
      }
      
      await Swal.fire({
        icon: 'success',
        title: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!',
        text: `‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${result.ranked_count} ‡∏Ñ‡∏ô`,
        timer: 2000,
        background: "#1e293b",
        color: "#fff"
      });
      
      // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• leaderboard
      if (rewardData.selectedEvent && typeof rewardData.selectedEvent.id === 'number') {
        await fetchLeaderboard(rewardData.selectedEvent.id);
      }
      
    } catch (err) {
      const error = err as any;
      console.error("üî• Calculate Ranks Error:", error);
      
      let errorMsg = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î';
      if (error.response?.status === 400) {
        errorMsg = error.response?.data?.detail || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥';
      } else if (error.response?.status === 404) {
        errorMsg = '‡πÑ‡∏°‡πà‡∏û‡∏ö Config ID';
      }
      
      Swal.fire({
        icon: 'error',
        title: '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',
        text: errorMsg,
        background: "#1e293b",
        color: "#fff"
      });
    } finally {
      rewardData.loading = false;
    }
  }

  // UI helper: show message if no users
  $: showNoUsersMsg = rewardData.users && rewardData.users.length === 0 && !rewardData.loading;

  // ‚úÖ FIX: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" (Finalize) - ‡∏ï‡∏≤‡∏° API Documentation
  // API: POST /api/reward-leaderboards/configs/{configId}/finalize
  async function handleFinalizeRewards() {
    // ‚úÖ FIX: ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô + fallback
    const configId = rewardData.currentConfigId || rewardData.selectedEvent?.rewardConfigId;
    
    if (!configId) {
      Swal.fire({
        icon: "error",
        title: "‡πÑ‡∏°‡πà‡∏û‡∏ö Config ID",
        text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Event ‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏≠‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à",
        background: "#1e293b",
        color: "#fff"
      });
      return;
    }

    const result = await Swal.fire({
      title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•?',
      html: `
        <div style="text-align: left; color: #94a3b8;">
          <p>‚ö†Ô∏è ‡∏Å‡∏≤‡∏£ Finalize ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ!</p>
          <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞:</p>
          <ul style="margin-left: 20px;">
            <li>‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£</li>
            <li>‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ï‡∏≤‡∏° Tier ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î</li>
          </ul>
          <p style="color: #f59e0b; margin-top: 10px;">
            ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏Ñ‡∏ô
          </p>
        </div>
      `,
      icon: 'warning',
      showCancelButton: true,
      confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á, Finalize',
      cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
      confirmButtonColor: '#10b981',
      cancelButtonColor: '#6b7280',
      background: "#1e293b",
      color: "#fff"
    });

    if (!result.isConfirmed) return;

    rewardData.loading = true;

    try {
      // ‚úÖ FIX: API ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ body ‡∏°‡∏µ confirm: true ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
      const response = await api.post(
        `/api/reward-leaderboards/configs/${configId}/finalize`,
        { confirm: true }
      );
      
      await Swal.fire({ 
        icon: 'success', 
        title: '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 
        text: '‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',
        background: "#1e293b",
        color: "#fff",
        timer: 2000 
      });
      
      // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• leaderboard ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ reload ‡∏´‡∏ô‡πâ‡∏≤
      if (rewardData.selectedEvent && typeof rewardData.selectedEvent.id === 'number') {
        await fetchLeaderboard(rewardData.selectedEvent.id);
      }

    } catch (err: any) {
      console.error("üî• Finalize Error:", err);
      
      let displayMsg = "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á";
      const serverMsg = err.response?.data?.detail || err.response?.data?.message;

      if (err.response?.status === 400) {
        displayMsg = typeof serverMsg === 'string' 
          ? serverMsg 
          : "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥";
      } else if (err.response?.status === 401) {
        displayMsg = "‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡πà‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà";
      } else if (err.response?.status === 403) {
        displayMsg = "‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ";
      } else if (err.response?.status === 404) {
        displayMsg = `‡πÑ‡∏°‡πà‡∏û‡∏ö Config ID: ${configId}`;
      }

      Swal.fire({
        icon: 'error',
        title: `‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (${err.response?.status || 'Error'})`,
        text: displayMsg,
        background: "#1e293b",
        color: "#fff"
      });
    } finally {
      rewardData.loading = false;
    }
  }



  let currentUserId: string = "";
  let authToken: string = "";
  let userRole: string = "";

  let userTitle: string = "";
  let userFirstName: string = "";
  let userLastName: string = "";
  let userEmail: string = "";

  let studentIdNumber: string = "";
  let userFaculty: string = "";
  let userMajor: string = "";
  let userDepartment: string = "";

  let showTitleDropdown = false;
  let showFacultyDropdown = false;
  let showMajorDropdown = false;
  let showDepartmentDropdown = false;

  let dataIsLoading: boolean = true;
  let savingChanges: boolean = false;
  
  // ===== OPTIMIZATION: Initial loading states =====
  let isInitializing: boolean = true; // Main app initialization
  let eventsLoading: boolean = true; // Events list loading
  let configsLoading: boolean = true; // Reward configs loading

  let initialProfileData: any = {};
  let hasUnsavedChanges: boolean = false;

  let feedbackMessage: string = "";
  let feedbackType: "error" | "success" = "error";
  let messageTimer: any;
  let errorAnimationTimer: any;

  let fieldValidationErrors = {
    title: false,
    firstName: false,
    lastName: false,
    faculty: false,
    major: false,
    department: false,
  };
  type ErrorKey = keyof typeof fieldValidationErrors;

  const nameTitles = ["Mr.", "Ms.", "Mrs.", "Dr.", "Prof."];
  const staffDepartments = [
    { id: "Academic Affairs", name: "Academic Affairs" },
    { id: "Student Affairs", name: "Student Affairs" },
    { id: "Registrar Office", name: "Registrar Office" },
    { id: "Finance Department", name: "Finance Department" },
    { id: "IT Support Center", name: "IT Support Center" },
    { id: "Human Resources", name: "Human Resources" },
  ];
  const universityFaculties = [
    { id: "management", name: "Management Sciences" },
    { id: "engineering", name: "Engineering at Sriracha" },
    { id: "science", name: "Science at Sriracha" },
    { id: "economics", name: "Economics at Sriracha" },
    { id: "maritime", name: "International Maritime Studies" },
  ];

  type Major = { id: string; name: string };
  const facultyMajors: Record<string, Major[]> = {
    management: [
      { id: "mgt", name: "Management" },
      { id: "fin", name: "Finance and Investment" },
      { id: "ib", name: "International Business" },
      { id: "lm", name: "Logistics Management" },
      { id: "hh", name: "Hospitality - Hotel" },
      { id: "ht", name: "Hospitality - Tourism" },
      { id: "acc", name: "Accounting" },
      { id: "amb", name: "Digital Marketing" },
    ],
    engineering: [
      { id: "med", name: "Mechanical Engineering" },
      { id: "mme", name: "Mechanical & Mfg Systems" },
      { id: "eee", name: "Electrical & Electronics" },
      { id: "ise", name: "Industrial Systems" },
      { id: "cie", name: "Computer Engineering" },
      { id: "ce", name: "Civil Engineering" },
      { id: "ee", name: "Electrical Engineering" },
      { id: "rae", name: "Robotics Engineering" },
      { id: "die", name: "Digital Electronics" },
      { id: "dms", name: "Digital Mfg Systems" },
      { id: "ae", name: "Automotive Engineering" },
    ],
    science: [
      { id: "cs", name: "Computer Science" },
      { id: "it", name: "Information Technology" },
      { id: "ps", name: "Physics" },
      { id: "est", name: "Environmental Science" },
      { id: "dst", name: "Digital Science" },
      { id: "daa", name: "Data Analytics" },
      { id: "act", name: "Applied Chemistry" },
    ],
    economics: [{ id: "econ", name: "Economics" }],
    maritime: [
      { id: "nao", name: "Naval Architecture" },
      { id: "ns", name: "Nautical Science" },
      { id: "mt", name: "Maritime Transportation" },
      { id: "me", name: "Marine Engineering" },
    ],
  };

  let availableMajorsForFaculty: Major[] = [];
  $: {
    if (userFaculty && facultyMajors[userFaculty]) {
      availableMajorsForFaculty = facultyMajors[userFaculty];
    } else {
      availableMajorsForFaculty = [];
    }
  }

  function retrieveFacultyName(id: string) {
    const f = universityFaculties.find((x) => x.id === id);
    return f ? f.name : "Select Faculty";
  }
  function retrieveMajorName(id: string) {
    const m = availableMajorsForFaculty.find((x) => x.id === id);
    return m ? m.name : "Select Major";
  }
  function retrieveDepartmentName(id: string) {
    const d = staffDepartments.find((x) => x.id === id || x.name === id);
    return d ? d.name : id || "Select Department";
  }

  function hideAllDropdowns() {
    showTitleDropdown = false;
    showFacultyDropdown = false;
    showMajorDropdown = false;
    showDepartmentDropdown = false;
  }

  function toggleDropdownVisibility(
    type: "title" | "faculty" | "major" | "dept",
    e: Event
  ) {
    e.stopPropagation();
    const wasOpen =
      (type === "title" && showTitleDropdown) ||
      (type === "faculty" && showFacultyDropdown) ||
      (type === "major" && showMajorDropdown) ||
      (type === "dept" && showDepartmentDropdown);
    hideAllDropdowns();
    if (!wasOpen) {
      if (type === "title") showTitleDropdown = true;
      if (type === "faculty") showFacultyDropdown = true;
      if (type === "major") showMajorDropdown = true;
      if (type === "dept") showDepartmentDropdown = true;
    }
  }

  function chooseTitle(t: string) {
    userTitle = t;
    showTitleDropdown = false;
    dismissAlert();
  }
  function chooseFaculty(id: string) {
    userFaculty = id;
    userMajor = "";
    showFacultyDropdown = false;
    dismissAlert();
  }
  function chooseMajor(id: string) {
    userMajor = id;
    showMajorDropdown = false;
    dismissAlert();
  }
  function chooseDepartment(id: string) {
    userDepartment = id;
    showDepartmentDropdown = false;
    dismissAlert();
  }

  // Debounce function for search inputs
  function debounce<T extends (...args: any[]) => any>(fn: T, delay: number) {
    let timeoutId: ReturnType<typeof setTimeout>;
    return (...args: Parameters<T>) => {
      clearTimeout(timeoutId);
      timeoutId = setTimeout(() => fn(...args), delay);
    };
  }

  let debouncedRewardSearch = "";
  const debouncedUpdateRewardSearch = debounce((q: string) => {
    debouncedRewardSearch = q;
  }, 250);

  let debouncedSearchQuery = "";
  const debouncedUpdateSearch = debounce((q: string) => {
    debouncedSearchQuery = q;
  }, 250);

  function displayFeedback(msg: string, type: "error" | "success" = "error") {
    if (messageTimer) clearTimeout(messageTimer);
    feedbackMessage = msg;
    feedbackType = type;
    messageTimer = setTimeout(() => {
      feedbackMessage = "";
    }, 5000);
  }

  function dismissAlert() {
    if (feedbackMessage) {
      feedbackMessage = "";
      if (messageTimer) clearTimeout(messageTimer);
    }
  }

  function animateErrorFields() {
    if (errorAnimationTimer) clearTimeout(errorAnimationTimer);
    errorAnimationTimer = setTimeout(() => {
      Object.keys(fieldValidationErrors).forEach(
        (k) => (fieldValidationErrors[k as ErrorKey] = false)
      );
    }, 3000);
  }

  // ===== OPTIMIZED: Unified initialization with parallel loading =====
  async function initializeUserProfile(): Promise<void> {
    dataIsLoading = true;
    try {
      authToken = localStorage.getItem("access_token") || "";
      const userInfoStr = localStorage.getItem("user_info");

      if (userInfoStr) {
        try {
          const userInfo = JSON.parse(userInfoStr);
          currentUserId = userInfo.nisit_id || userInfo.id;
        } catch (e) {
          console.error("Error parsing user_info", e);
        }
      }

      if (!authToken || !currentUserId)
        throw new Error("User not authenticated");

      const response = await api.get(`/api/users/${currentUserId}`);
      const data = response.data;

      if (data.role) userRole = data.role.toLowerCase();
      else userRole = data.nisit_id || data.nisitId ? "student" : "officer";

      userTitle = data.title || "";
      userFirstName = data.first_name || data.firstName || "";
      userLastName = data.last_name || data.lastName || "";
      userEmail = data.email || "";

      if (userRole === "student") {
        studentIdNumber = data.nisit_id || data.nisitId || "";
        userFaculty = (data.faculty || "").toLowerCase();
        userMajor = (data.major || "").toLowerCase();
      } else {
        userDepartment = data.department || "";
      }

      initialProfileData = {
        userTitle,
        userFirstName,
        userLastName,
        userFaculty,
        userMajor,
        userDepartment,
      };
    } catch (err: any) {
      if (err.response?.status === 401) {
        goto(`/ku-run/auth/login`);
        return;
      }
      throw new Error("Failed to fetch user data");
    } finally {
      dataIsLoading = false;
    }
  }
  
  // First onMount - load user profile (happens first for auth check)
  onMount(async () => {
    try {
      await initializeUserProfile();
    } catch (error) {
      console.error(error);
      displayFeedback("Could not load profile info.", "error");
    }
  });

  $: {
    const basicChanged =
      userTitle !== initialProfileData.userTitle ||
      userFirstName !== initialProfileData.userFirstName ||
      userLastName !== initialProfileData.userLastName;

    let roleChanged = false;
    if (userRole === "student") {
      roleChanged =
        userFaculty !== initialProfileData.userFaculty ||
        userMajor !== initialProfileData.userMajor;
    } else {
      roleChanged = userDepartment !== initialProfileData.userDepartment;
    }

    hasUnsavedChanges = basicChanged || roleChanged;
  }

  async function submitProfileUpdate() {
    dismissAlert();
    let isValid = true;

    // --- 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Validation) ---
    Object.keys(fieldValidationErrors).forEach(
      (k) => (fieldValidationErrors[k as ErrorKey] = false)
    );

    if (!userTitle) {
      fieldValidationErrors.title = true;
      isValid = false;
    }
    if (!userFirstName.trim()) {
      fieldValidationErrors.firstName = true;
      isValid = false;
    }
    if (!userLastName.trim()) {
      fieldValidationErrors.lastName = true;
      isValid = false;
    }

    if (userRole === "student") {
      if (!userFaculty) {
        fieldValidationErrors.faculty = true;
        isValid = false;
      }
      if (!userMajor) {
        fieldValidationErrors.major = true;
        isValid = false;
      }
    } else {
      if (!userDepartment) {
        fieldValidationErrors.department = true;
        isValid = false;
      }
    }

    if (!isValid) {
      animateErrorFields();
      if (!feedbackMessage)
        displayFeedback("Please fill in all required fields.");
      return;
    }

    // --- 2. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ---
    savingChanges = true;

    try {
      const updateData = {
        title: userTitle,
        first_name: userFirstName,
        last_name: userLastName,
        major: userMajor,
        faculty: userFaculty,
        department: userDepartment,
      };

      // ‚úÖ 2.1 ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞ "‡∏£‡∏≠" ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Server
      const response = await api.put(`/api/users/${currentUserId}`, updateData);

      // 2.2 ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
      displayFeedback(lang.settingsUpdated, "success");

      // ‚úÖ 2.3 ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï localStorage ‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Server (Response)
      // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ userTitle ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÄ‡∏≠‡∏á ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà Database ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏£‡∏¥‡∏á ‡πÜ
      try {
        const oldUserInfo = JSON.parse(
          localStorage.getItem("user_info") || "{}"
        );

        // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å server (response.data) ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ updateData ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ
        const serverData = response.data || {};

        const newUserInfo = {
          ...oldUserInfo,
          // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏±‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
          title: serverData.title || userTitle,
          first_name:
            serverData.first_name || serverData.firstName || userFirstName,
          last_name:
            serverData.last_name || serverData.lastName || userLastName,
          faculty: serverData.faculty || userFaculty,
          major: serverData.major || userMajor,
          department: serverData.department || userDepartment,
        };

        localStorage.setItem("user_info", JSON.stringify(newUserInfo));
      } catch (e) {
        console.error("Local storage update failed", e);
      }

      // ‚úÖ 2.4 ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ (Auto Reload)
      // ‡πÉ‡∏ä‡πâ setTimeout ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏°‡∏±‡πà‡∏ô‡πÉ‡∏à‡∏ß‡πà‡∏≤ localStorage ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏£‡∏¥‡∏á‡πÜ
      setTimeout(() => {
        window.location.reload();
      }, 500);
    } catch (error: any) {
      console.error(error);
      const errMsg =
        error.response?.data?.message || error.message || "Failed to update";
      displayFeedback(errMsg, "error");
    } finally {
      savingChanges = false;
    }
  }

  export let apiBaseUrl: string;
  export let token: string;
  export let organizerId: number | null;

  // State
  let email = "";
  let isLoading = false;
  let notificationMessage = "";
  let notificationType: "error" | "success" = "error";
  let notificationTimeout: any = null;
  let errorField: string | null = null;

  function validateEmail(value: string): boolean {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
  }

  function clearNotification() {
    errorField = null;
    if (notificationMessage) {
      notificationMessage = "";
      if (notificationTimeout) clearTimeout(notificationTimeout);
    }
  }

  function showNotification(
    message: string,
    type: "error" | "success" = "error",
    field: string | null = null
  ) {
    if (notificationTimeout) clearTimeout(notificationTimeout);
    notificationMessage = message;
    notificationType = type;
    errorField = field;

    notificationTimeout = setTimeout(() => {
      notificationMessage = "";
      errorField = null;
    }, 3000);
  }

  async function findUserIdByEmail(
    targetEmail: string
  ): Promise<string | null> {
    try {
      const res = await fetch(`${apiBaseUrl}/api/users/`, {
        method: "GET",
        headers: {
          Authorization: `Bearer ${token}`,
          "Content-Type": "application/json",
        },
      });
      if (!res.ok) return null;
      const data = await res.json();
      let usersList: any[] = [];
      if (Array.isArray(data)) {
        usersList = data;
      } else if (data.data && Array.isArray(data.data)) {
        usersList = data.data;
      } else if (data.users && Array.isArray(data.users)) {
        usersList = data.users;
      }
      const foundUser = usersList.find(
        (u: any) =>
          u.email && u.email.toLowerCase() === targetEmail.toLowerCase()
      );
      return foundUser ? foundUser.id : null;
    } catch (error) {
      console.error("Error finding user:", error);
      return null;
    }
  }

  async function unlockUserApi(userId: string) {
    if (!organizerId) {
      throw new Error("Organizer ID missing. Please login again.");
    }
    const url = `${apiBaseUrl}/api/users/${userId}/unlock?organizer_id=${organizerId}`;
    const res = await fetch(url, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({}),
    });

    if (!res.ok) {
      const errorData = await res.json().catch(() => ({}));
      throw new Error(errorData.message || "Failed to unlock user.");
    }
    return await res.json();
  }

  async function handleUnlock() {
    clearNotification();

    if (!token) {
      showNotification("Authentication failed. Please login again.", "error");
      return;
    }
    if (!organizerId) {
      showNotification("Organizer info missing. Please login again.", "error");
      return;
    }
    if (!email || !validateEmail(email)) {
      showNotification("Please enter a valid email address.", "error", "email");
      return;
    }

    isLoading = true;

    try {
      const targetUserId = await findUserIdByEmail(email);

      if (!targetUserId) {
        showNotification("User with this email not found.", "error", "email");
        isLoading = false;
        return;
      }

      isLoading = false;
      Swal.fire({
        title: "Unlock Account?",
        text: `Confirm unlock for ${email}?`,
        icon: "question",
        showCancelButton: true,
        confirmButtonColor: "#10B981",
        iconColor: "#10B981",
        cancelButtonColor: "#6B7280",
        confirmButtonText: "Yes, Unlock",
        width: "320px",
        background: "#1f2937",
        color: "#ffffff",
        customClass: { popup: "my-swal-popup" },
      }).then(async (result) => {
        if (result.isConfirmed) {
          isLoading = true;
          try {
            await unlockUserApi(targetUserId);
            Swal.fire({
              title: "Unlocked!",
              text: "User account has been successfully unlocked.",
              icon: "success",
              iconColor: "#10B981",
              showConfirmButton: false,
              timer: 1500,
              width: "320px",
              background: "#1f2937",
              color: "#ffffff",
              customClass: { popup: "swal-dark-popup" },
            });

            email = "";
          } catch (err: any) {
            Swal.fire({
              title: "Error",
              text: err.message || "Something went wrong.",
              icon: "error",
              iconColor: "#EF4444",
              showConfirmButton: false,
              timer: 2000,
              width: "320px",
              background: "#1f2937",
              color: "#ffffff",
              customClass: { popup: "swal-dark-popup" },
            });
          } finally {
            isLoading = false;
          }
        }
      });
    } catch (error) {
      console.error(error);
      showNotification("System error occurred.", "error");
      isLoading = false;
    }
  }

  // ===== VERIFY PROOF DATA =====
  interface ProofSubmission {
    id: number;
    odySd: string;
    runnerName: string;
    email: string;
    runnerImage: string | null;
    submitTime: string;
    proofImage: string | null;
    rank?: number;
    stravaLink?: string | null;
    actualDistance?: number | null;
  }

  interface VerifyProofData {
    selectedEvent: AppEvent | null;
    submissions: ProofSubmission[];
    loading: boolean;
    error: string;
  }

  // MOCK DATA - ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
  const MOCK_SUBMISSIONS: ProofSubmission[] = [
    {
      id: 1,
      rank: 1,
      odySd: "6610501001",
      runnerName: "Somchai Jaidee",
      email: "somchai@email.com",
      runnerImage: null,
      submitTime: "2024-12-28T10:15:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/f59e0b?text=Running+Proof+1",
    },
    {
      id: 2,
      rank: 2,
      odySd: "6610501002",
      runnerName: "Somying Rakwing",
      email: "somying@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=5",
      submitTime: "2024-12-28T11:30:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/10b981?text=Running+Proof+2",
    },
    {
      id: 3,
      rank: 3,
      odySd: "6710502003",
      runnerName: "Wingrew Tanjai",
      email: "wingrew@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=12",
      submitTime: "2024-12-28T12:45:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/3b82f6?text=Running+Proof+3",
    },
    {
      id: 4,
      rank: 4,
      odySd: "6710502004",
      runnerName: "Nakwing Saifa",
      email: "nakwing@email.com",
      runnerImage: null,
      submitTime: "2024-12-28T13:20:00",
      proofImage: null,
    },
    {
      id: 5,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 6,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 7,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 8,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 9,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 10,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
    {
      id: 11,
      rank: 5,
      odySd: "6610503005",
      runnerName: "Marathon Champ",
      email: "marathon@email.com",
      runnerImage: "https://i.pravatar.cc/150?img=8",
      submitTime: "2024-12-28T14:00:00",
      proofImage:
        "https://placehold.co/400x600/1e293b/ef4444?text=Running+Proof+5",
    },
  ];

  let verifyProofData: VerifyProofData = {
    selectedEvent: null,
    submissions: [],
    loading: false,
    error: "",
  };

  let verifyProofEventsPage = 1;
  let verifyProofEventsPerPage = 8;
  let showVerifyProofEventsPageDropdown = false;
  let showDateFilterDropdown = false;
  let verifyProofSearchQuery = "";
  let verifyProofBatchFilter = "";
  let verifyProofStdIdFilter = "";
  let verifyProofAutoRefreshEnabled = true;
  let verifyProofIsConnected = true;
  let newVerifyProofCount = 0;

  let verifyProofStatusFilter = "All";
  let verifyProofFromDate = "";
  let verifyProofToDate = "";
  let showVerifyStatusDropdown = false;
  let showVerifyFromDateDropdown = false;
  let showVerifyToDateDropdown = false;

  let filteredVerifyProofSubmissions: ProofSubmission[] = [];
  let sortedVerifyProofSubmissions: ProofSubmission[] = [];

  let verifyProofSubmissionsPage = 1;
  let verifyProofSubmissionsPerPage = 8;
  let showVerifyProofSubmissionsPageDropdown = false;

  interface RewardUser {
    id: string;
    odySd: string;
    nisitId?: string;
    visitId?: string;
    name: string;
    email: string;
    avatar: string;
    globalRank: number; // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    tierRank: number; // ‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏ô Tier (0 ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ tier)
    tier: string; // ‡∏ä‡∏∑‡πà‡∏≠ Tier ‡∏´‡∏£‡∏∑‡∏≠ "No Tier" ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á
    tierColor: string;
    completedCount: number; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏î‡πâ (total_participations ‡∏´‡∏£‡∏∑‡∏≠ completed_participations)
    totalParticipations?: number; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    completedParticipations?: number; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    requiredCount: number; // ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á Tier ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (‡∏´‡∏£‡∏∑‡∏≠ Tier ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ)
    nextTierCount: number; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô Tier ‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
    completedAt: string; // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (ISO string, ‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ñ‡∏∂‡∏á millisecond)
    rewardedAt?: string; // ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    joinCode: string;
    status: "completed" | "in_progress" | "no_tier";
    userId?: number; // user_id ‡∏à‡∏≤‡∏Å API
    participationId?: number; // participation id (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á proof/image
    stravaLink?: string;
    distance?: number;
    totalDistanceKm?: number; // ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏ß‡∏°
    proofImage?: string | null;
    rewardId?: number; // reward_id ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö
    rewardTier?: number; // tier number
    rewardName?: string; // ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    rewardDescription?: string; // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    leaderboardQualified?: boolean; // ‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ö‡∏±‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
    firstParticipationAt?: string; // ‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
    lastParticipationAt?: string; // ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°
  }

  // ‚úÖ Interface ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö API Response: GET /api/reward-leaderboards/events/{eventId}/users
  interface UserEventStatus {
    user_id: number;
    user_full_name: string;
    user_email: string;
    event_id: number;
    event_name: string;
    total_participations: number;
    completed_participations: number;
    checked_in_count: number;
    proof_submitted_count: number;
    rejected_count: number;
    cancelled_count: number;
    total_distance_km: number | null;
    first_participation_at: string | null;
    last_participation_at: string | null;
    leaderboard_config_id: number | null;
    leaderboard_rank: number | null;
    leaderboard_qualified: boolean;
    leaderboard_reward_name: string | null;
    tier_progress: any[] | null;
  }

  interface UniqueUsersResponse {
    total_users: number;
    event_id: number;
    event_name: string;
    users: UserEventStatus[];
  }

  interface RewardData {
    selectedEvent: AppEvent | null;
    users: RewardUser[];
    currentConfigId?: number;
    loading: boolean;
    error: string;
    searchQuery: string;
    selectedTier: string;
    currentPage: number;
    itemsPerPage: number;
    leaderboardFinalized?: boolean;
  }

  let rewardData: RewardData = {
    selectedEvent: null,
    users: [],
    loading: false,
    error: "",
    searchQuery: "",
    selectedTier: "All",
    currentPage: 1,
    itemsPerPage: 8,
    leaderboardFinalized: false,
  };

  let showRewardExportMenu = false;
  let isRewardExporting = false;
  $: availableYears = [...new Set(events.map((e: any) => e.year))].sort();
  // Auto refresh for rewards
  let newRewardUsersCount = 0;
  let rewardAutoRefreshEnabled = true;
  let rewardIsConnected = true;
  let timeLeft = 0;

  let verifyMode: "pin" | "qr" = "pin";
  let verifyActionMode: "checkin" | "checkout" = "checkin"; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏´‡∏°‡∏î Check-in/Check-out
  let pins = ["", "", "", "", ""];
  let pinInputRefs: HTMLInputElement[] = [];
  let verifyErrorMessage = "";
  let isVerifying = false;
  let verifyErrorTimeout: any;
  let verifyErrorIndex: number | null = null;
  let autoCheckIn = false;
  let lastVerifySuccess = false;
  let lastParticipantName = "";
  let lastCheckOutSuccess = false; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Check-out success

  // QR Mode
  let videoRef: HTMLVideoElement | undefined;
  let canvasRef: HTMLCanvasElement | undefined;
  let cameraStream: MediaStream | null = null;
  let scanning = false;
  let scanInterval: any;
  let cameraError = "";
  let lastScannedCode = "";
  let qrSuccessShow = false; // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á success ‡πÉ‡∏ô QR mode
  let qrSuccessTimeout: any;

  // ===== VERIFY PROOF DATA =====
  interface ProofSubmission {
    id: number;
    odySd: string; // Nisit ID ‡πÄ‡∏ä‡πà‡∏ô "6830200073"
    runnerName: string;
    email: string; // ‡πÄ‡∏û‡∏¥‡πà‡∏° email
    runnerImage: string | null;
    submitTime: string;
    proofImage: string | null;
    rank?: number; // ‡∏•‡∏≥‡∏î‡∏±‡∏ö
  }
  interface VerifyProofData {
    selectedEvent: AppEvent | null;
    submissions: ProofSubmission[];
    loading: boolean;
    error: string;
  }

  // let verifyProofData: VerifyProofData = {
  //   selectedEvent: null,
  //   submissions: [],
  //   loading: false,
  //   error: "",
  // };

  let verifyProofDateFilter = "";

  let totalVerifyProofSubmissions = 0;

  // Paginated submissions
  $: totalVerifyProofSubmissions = filteredVerifyProofSubmissions.length;
  $: totalVerifyProofSubmissionsPages = Math.ceil(
    totalVerifyProofSubmissions / itemsPerPage
  );

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡πà‡∏á‡∏´‡∏ô‡πâ‡∏≤ (paginated)
  $: paginatedVerifyProofSubmissions = filteredVerifyProofSubmissions.slice(
    (verifyProofSubmissionsPage - 1) * itemsPerPage,
    verifyProofSubmissionsPage * itemsPerPage
  );

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
  function prevVerifyProofSubmissionsPage() {
    if (verifyProofSubmissionsPage > 1) verifyProofSubmissionsPage--;
  }

  function nextVerifyProofSubmissionsPage() {
    if (verifyProofSubmissionsPage < totalVerifyProofSubmissionsPages)
      verifyProofSubmissionsPage++;
  }

  let cachedVerifyProofDates: { value: string; display: string }[] = [];
  let lastVerifyProofEventId: number | null = null;

  $: {
    const eventId = verifyProofData.selectedEvent?.id ?? null;
    if (eventId !== lastVerifyProofEventId) {
      lastVerifyProofEventId = eventId;

      if (!verifyProofData.selectedEvent) {
        cachedVerifyProofDates = [];
      } else {
        const event = verifyProofData.selectedEvent;
        const startDate = new Date(
          parseInt(event.year),
          getMonthIdx(event.month),
          1
        );
        const endDate = new Date(
          parseInt(event.year),
          getMonthIdx(event.month) + 1,
          0
        );

        const dates: { value: string; display: string }[] = [];
        const current = new Date(startDate);
        const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

        while (current <= endDate) {
          dates.push({
            value: current.toISOString().split("T")[0],
            display: `${dayNames[current.getDay()]}, ${current.getDate()} ${event.month} ${event.year}`,
          });
          current.setDate(current.getDate() + 1);
        }

        cachedVerifyProofDates = dates;
      }
    }
  }

  $: availableVerifyProofDates = cachedVerifyProofDates;

  $: paginatedEventsForVerifyProof = filteredEvents.slice(
    (verifyProofEventsPage - 1) * verifyProofEventsPerPage,
    verifyProofEventsPage * verifyProofEventsPerPage
  );

  $: totalVerifyProofEventsPages = Math.ceil(
    filteredEvents.length / verifyProofEventsPerPage
  );

  let debouncedVerifyProofSearch = "";
  const debouncedUpdateVerifyProofSearch = debounce((q: string) => {
    debouncedVerifyProofSearch = q;
  }, 250);

  $: debouncedUpdateVerifyProofSearch(verifyProofSearchQuery);

  // OPTIMIZED: filteredVerifyProofSubmissions with memoization
  function getFilteredVerifyProofSubmissions(): ProofSubmission[] {
    const subs = verifyProofData.submissions;
    if (!subs || subs.length === 0) return [];

    const query = debouncedVerifyProofSearch.toLowerCase().trim();
    const batchFilter = verifyProofBatchFilter.trim();
    const stdIdFilter = verifyProofStdIdFilter.trim();

    return subs.filter((sub) => {
      // Search filter
      if (query) {
        const matchName = sub.runnerName.toLowerCase().includes(query);
        const matchEmail = sub.email?.toLowerCase().includes(query);
        const matchId = sub.odySd?.includes(query);
        if (!matchName && !matchEmail && !matchId) return false;
      }

      // Batch filter
      if (batchFilter && !sub.odySd?.startsWith(batchFilter)) return false;

      // Std ID filter
      if (stdIdFilter) {
        const stdPart = sub.odySd?.substring(2) || "";
        if (!stdPart.includes(stdIdFilter)) return false;
      }

      return true;
    });
  }

  let lastVerifyProofKey = "";
  let cachedFilteredVerifyProofSubmissions: ProofSubmission[] = [];

  $: {
    const cacheKey = `vProof_${verifyProofData.submissions.length}_${debouncedVerifyProofSearch}_${verifyProofBatchFilter}_${verifyProofStdIdFilter}`;
    if (cacheKey !== lastVerifyProofKey) {
      lastVerifyProofKey = cacheKey;
      cachedFilteredVerifyProofSubmissions =
        getFilteredVerifyProofSubmissions();
    }
  }

  $: filteredVerifyProofSubmissions = cachedFilteredVerifyProofSubmissions;

  $: sortedVerifyProofSubmissions = [...filteredVerifyProofSubmissions].sort(
    (a, b) => {
      return (
        new Date(a.submitTime).getTime() - new Date(b.submitTime).getTime()
      );
    }
  );

  function selectEventForVerifyProof(event: AppEvent) {
    verifyProofData.selectedEvent = event;
    verifyProofData.loading = true;
    verifyProofData.error = "";
    fetchPendingSubmissions(event.id);
  }

  function backToVerifyProofEventsList() {
    verifyProofData.selectedEvent = null;
    verifyProofData.submissions = [];
    verifyProofSearchQuery = "";
    // Force rebuild cache
    lastFilteredEventsKey = "";
  }

  function toggleVerifyProofAutoRefresh() {
    verifyProofAutoRefreshEnabled = !verifyProofAutoRefreshEnabled;
  }

  function refreshVerifyProofSubmissions() {
    if (verifyProofData.selectedEvent) {
      fetchPendingSubmissions(verifyProofData.selectedEvent.id);
    }
    newVerifyProofCount = 0;
  }

  async function fetchPendingSubmissions(eventId: number) {
    try {
      console.log("=== START fetchPendingSubmissions ===");
      console.log("Event ID:", eventId);
      console.log("API_BASE_URL:", API_BASE_URL);

      const token = localStorage.getItem("access_token");
      const headers: HeadersInit = { "Content-Type": "application/json" };
      if (token) headers["Authorization"] = `Bearer ${token}`;

      let allParticipations: any[] = [];


      // ========================================
      // ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ó‡∏µ‡πà 1: ‡∏•‡∏≠‡∏á Export CSV
      // ========================================
      console.log("\nüîç Method 1: Export CSV");
      let csvSuccess = false;
      try {
        const csvUrl = `${API_BASE_URL}/api/participations/event/${eventId}/export-csv`;
        console.log("Fetching CSV from:", csvUrl);

        const csvRes = await fetch(csvUrl, { headers });

        if (csvRes.ok) {
          const csvText = await csvRes.text();
          console.log("‚úì CSV fetched, length:", csvText.length);

          if (csvText.length > 0) {
            const lines = csvText.trim().split("\n");

            if (lines.length > 1) {
              const csvHeaders = lines[0]
                .split(",")
                .map((h) => h.trim().replace(/"/g, ""));
              console.log("CSV Headers:", csvHeaders);

              const idIndex = csvHeaders.findIndex(
                (h) =>
                  h.toLowerCase() === "id" ||
                  h.toLowerCase() === "participation_id"
              );

              if (idIndex !== -1) {
                console.log("Found ID column at index:", idIndex);

                // ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å ID
                for (let i = 1; i < lines.length; i++) {
                  const line = lines[i].trim();
                  if (!line) continue;

                  const cols =
                    line
                      .match(/(".*?"|[^,]+)(?=\s*,|\s*$)/g)
                      ?.map((col) => col.trim().replace(/^"|"$/g, "")) || [];

                  const id = parseInt(cols[idIndex]);
                  if (id) {
                    console.log(`Found participation ID from CSV: ${id}`);

                    // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ï‡πá‡∏°
                    try {
                      const pUrl = `${API_BASE_URL}/api/participations/${id}`;
                      const pRes = await fetch(pUrl, { headers });

                      if (pRes.ok) {
                        const pData = await pRes.json();
                        const p = pData.data || pData;
                        allParticipations.push(p);
                        console.log(`‚úì Fetched participation ${id}:`, {
                          status: p.status,
                          hasProof: !!p.proof_image_url,
                          proofUrl: p.proof_image_url,
                        });
                      }
                    } catch (e) {
                      console.warn(`Failed to fetch participation ${id}:`, e);
                    }
                  }
                }
                csvSuccess = true;
              }
            }
          }
        } else {
          console.log("‚úó CSV failed:", csvRes.status);
        }
      } catch (e) {
        console.log("‚úó CSV method failed:", e);
      }

      // Fallback: ‡∏ñ‡πâ‡∏≤ CSV ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÉ‡∏´‡πâ‡∏î‡∏∂‡∏á‡πÅ‡∏ö‡∏ö JSON
      if (!csvSuccess) {
        try {
          console.log("üîÑ Fallback: Fetching participations as JSON");
          const jsonUrl = `${API_BASE_URL}/api/participations/event/${eventId}`;
          const jsonRes = await fetch(jsonUrl, { headers });
          if (jsonRes.ok) {
            const jsonData = await jsonRes.json();
            if (Array.isArray(jsonData.data)) {
              allParticipations = jsonData.data;
              console.log(`‚úì JSON participations fetched: ${allParticipations.length}`);
            } else {
              console.warn("No data array in JSON response");
            }
          } else {
            console.error(`‚ùå JSON fallback failed: ${jsonRes.status}`);
          }
        } catch (e) {
          console.error("‚ùå JSON fallback error:", e);
        }
      }

      console.log("\nüìä Total participations found:", allParticipations.length);

      if (allParticipations.length === 0) {
        console.error("‚ùå No participations found");
        verifyProofData.submissions = [];
        return;
      }

      // ========================================
      // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ proof_image_url ‡πÅ‡∏•‡∏∞ status = proof_submitted
      // ========================================
      console.log("\nüîç Filtering for pending submissions...");

      const pendingSubs = allParticipations.filter((p: any) => {
        const status = p.status || "";
        const hasProof = !!p.proof_image_url;

        console.log(`Participation ${p.id}:`, {
          status,
          hasProof,
          proof_url: p.proof_image_url,
        });

        return status === "proof_submitted" && hasProof;
      });

      console.log("Pending submissions found:", pendingSubs.length);

      if (pendingSubs.length === 0) {
        console.warn("‚ö† No pending submissions with proofs");
        console.log("All statuses:", [
          ...new Set(allParticipations.map((p) => p.status)),
        ]);
        console.log(
          "With proof_image_url:",
          allParticipations.filter((p) => !!p.proof_image_url).length
        );
        verifyProofData.submissions = [];
        return;
      }

      // ========================================
      // Map ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
      // ========================================
      console.log("\nüîç Mapping submissions with user data...");

      const mappedSubs = await Promise.all(
        pendingSubs.map(async (s: any) => {
          console.log("--- Processing participation:", s.id, "---");

          // ========================================
          // ‡πÅ‡∏õ‡∏•‡∏á URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
          // ========================================
          let proofUrl = s.proof_image_url;
          console.log("Original proof_image_url:", proofUrl);

          if (proofUrl && typeof proofUrl === "string") {
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô full URL ‡πÅ‡∏•‡πâ‡∏ß
            if (
              proofUrl.startsWith("http://") ||
              proofUrl.startsWith("https://")
            ) {
              console.log("‚úì Already full URL");
            }
            // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ /api/uploads/ (‡∏°‡∏≤‡∏à‡∏≤‡∏Å backend ‡πÅ‡∏•‡πâ‡∏ß)
            else if (proofUrl.startsWith("/api/uploads/")) {
              proofUrl = `${API_BASE_URL}${proofUrl}`;
              console.log("‚úì Converted /api/uploads/ to:", proofUrl);
            }
            // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ /uploads/
            else if (proofUrl.startsWith("/uploads/")) {
              proofUrl = `${API_BASE_URL}/api${proofUrl}`;
              console.log("‚úì Converted /uploads/ to:", proofUrl);
            }
            // ‡∏ñ‡πâ‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ / ‡∏≠‡∏∑‡πà‡∏ô‡πÜ
            else if (proofUrl.startsWith("/")) {
              proofUrl = `${API_BASE_URL}${proofUrl}`;
              console.log("‚úì Converted / to:", proofUrl);
            }
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô relative path ‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤
            else {
              proofUrl = `${API_BASE_URL}/api/uploads/${proofUrl}`;
              console.log("‚úì Added full path:", proofUrl);
            }
          } else {
            console.warn("‚ö† No proof URL");
          }

          // ========================================
          // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• User
          // ========================================
          const userId = s.user_id;
          console.log("User ID:", userId);

          let fullName = `User ${userId}`;
          let userEmail = "";
          let userNisitId = "";
          let userProfileUrl = null;

          if (userId) {
            try {
              // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏ä‡πâ /api/users/{userId} ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà /ku-run/api/users/
              const userUrl = `${API_BASE_URL}/api/users/${userId}`;
              console.log("Fetching user from:", userUrl);

              const userRes = await fetch(userUrl, { headers });

              if (userRes.ok) {
                const userData = await userRes.json();
                console.log("User response:", userData);

                // userData ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô array ‡∏´‡∏£‡∏∑‡∏≠ object
                const user = Array.isArray(userData)
                  ? userData[0]
                  : userData.data || userData;
                console.log("User object:", user);

                // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠
                const fname = user.first_name || "";
                const lname = user.last_name || "";

                if (fname || lname) {
                  fullName = `${fname} ${lname}`.trim();
                } else if (user.username) {
                  fullName = user.username;
                }

                // ‡∏î‡∏∂‡∏á email ‡πÅ‡∏•‡∏∞ nisit_id
                userEmail = user.email || "";
                userNisitId = user.nisit_id || "";

                console.log("‚úì User info extracted:", {
                  fullName,
                  userEmail,
                  userNisitId,
                });

                // ‡πÅ‡∏õ‡∏•‡∏á URL ‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
                if (user.profile_image_url) {
                  userProfileUrl = user.profile_image_url;
                  console.log("Original profile_image_url:", userProfileUrl);

                  if (
                    userProfileUrl.startsWith("http://") ||
                    userProfileUrl.startsWith("https://")
                  ) {
                    console.log("‚úì Profile already full URL");
                  } else if (userProfileUrl.startsWith("/api/uploads/")) {
                    userProfileUrl = `${API_BASE_URL}${userProfileUrl}`;
                    console.log("‚úì Converted profile to:", userProfileUrl);
                  } else if (userProfileUrl.startsWith("/uploads/")) {
                    userProfileUrl = `${API_BASE_URL}/api${userProfileUrl}`;
                    console.log("‚úì Converted profile to:", userProfileUrl);
                  } else if (userProfileUrl.startsWith("/")) {
                    userProfileUrl = `${API_BASE_URL}${userProfileUrl}`;
                    console.log("‚úì Converted profile to:", userProfileUrl);
                  } else {
                    userProfileUrl = `${API_BASE_URL}/api/uploads/${userProfileUrl}`;
                    console.log(
                      "‚úì Added full path to profile:",
                      userProfileUrl
                    );
                  }
                }
              } else {
                console.warn(`‚úó Failed to fetch user: ${userRes.status}`);
              }
            } catch (e) {
              console.warn("‚úó Error fetching user:", e);
            }
          }

          const mapped = {
            id: s.id,
            participationId: s.id,
            odySd: userNisitId, // ‚úÖ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á nisit_id ‡πÅ‡∏ó‡∏ô User ID
            runnerName: fullName, // ‚úÖ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á
            email: userEmail,
            runnerImage: userProfileUrl,
            submitTime: s.proof_submitted_at || s.created_at,
            proofImage: proofUrl, // ‚úÖ URL ‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß
            stravaLink: s.strava_link || null,
            actualDistance: s.actual_distance_km || null,
          };

          console.log("‚úì Mapped submission:", mapped);
          return mapped;
        })
      );

      console.log("\n=== FINAL RESULT ===");
      console.log("‚úÖ Total submissions:", mappedSubs.length);
      console.log("Data:", mappedSubs);

      verifyProofData.submissions = mappedSubs;
    } catch (error) {
      console.error("‚ùå Error:", error);
      verifyProofData.error = "Failed to load submissions";
      verifyProofData.submissions = [];
    } finally {
      verifyProofData.loading = false;
      console.log("=== END ===");
    }
  }

  function onProofImageClick(proofImage: string | null) {
    if (proofImage) {
      Swal.fire({
        imageUrl: proofImage,
        imageAlt: "Proof",
        showConfirmButton: false,
        showCloseButton: false,
        allowOutsideClick: true,
        backdrop: `rgba(0,0,0,0.9)`,
        background: "transparent",
        padding: 0,
        customClass: {
          popup: "swal-clean-popup",
          image: "swal-full-image",
        },
      });
    }
  }

  function onApproveSubmission(sub: ProofSubmission) {
    const stravaInfo = sub.stravaLink
      ? `<div class="info-row"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg><span>Strava: <a href="${sub.stravaLink}" target="_blank" style="color: #f97316;">${sub.stravaLink}</a></span></div>`
      : "";
    const distanceInfo = sub.actualDistance
      ? `<div class="info-row"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"></path></svg><span>Distance: <b style="color: #10b981;">${sub.actualDistance} km</b></span></div>`
      : "";

    const htmlContent = `<div class="reject-container"><p class="helper-text">Are you sure you want to verify this proof?</p><div class="approve-card"><div class="ac-avatar"><span class="ac-placeholder">${sub.runnerName.charAt(0).toUpperCase()}</span></div><div class="card-content"><span class="rj-title">${sub.runnerName}</span><span class="rj-desc">Submitted: ${new Date(sub.submitTime).toLocaleString(currentLang === "th" ? "th-TH" : "en-GB", { timeZone: "Asia/Bangkok" })}</span></div></div><div class="approve-info"><div class="info-row"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>Status changes to <b>COMPLETED</b></span></div>${stravaInfo}${distanceInfo}<div class="info-row"><svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="flex-shrink: 0;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>System auto-assigns rewards</span></div></div></div>`;

    const styleContent =
      "<style>.reject-container { padding: 10px 0; text-align: left; }.helper-text { color: #94a3b8; font-size: 14px; margin-bottom: 20px; text-align: center; }.approve-card { display: flex; align-items: center; gap: 16px; background: rgba(16, 185, 129, 0.08); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 20px; }.ac-avatar { width: 56px; height: 56px; border-radius: 50%; overflow: hidden; flex-shrink: 0; background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3)); display: flex; align-items: center; justify-content: center; border: 2px solid rgba(16, 185, 129, 0.4); }.ac-placeholder { color: #10b981; font-size: 24px; font-weight: 700; text-transform: uppercase; }.card-content { flex: 1; display: flex; flex-direction: column; gap: 6px; }.rj-title { font-size: 16px; font-weight: 600; color: #f8fafc; }.rj-desc { font-size: 13px; color: #94a3b8; }.approve-info { background: rgba(30, 41, 59, 0.6); border: 2px solid rgba(71, 85, 105, 0.3); border-radius: 12px; padding: 16px; }.info-row { display: flex; align-items: center; gap: 10px; padding: 8px 0; color: #cbd5e1; font-size: 14px; }.info-row svg { color: #10b981; }.info-row:not(:last-child) { border-bottom: 1px solid rgba(71, 85, 105, 0.2); }.info-row b { color: #10b981; font-weight: 600; }.swal-clean-popup-reject { background: #1e293b !important; border: 1px solid rgba(71, 85, 105, 0.3) !important; border-radius: 16px !important; padding: 24px !important; }.swal2-html-container { margin: 0 !important; }.swal2-validation-message { background: rgba(239, 68, 68, 0.1) !important; border: 2px solid rgba(239, 68, 68, 0.4) !important; border-radius: 12px !important; color: #fca5a5 !important; font-size: 14px !important; font-weight: 500 !important; padding: 12px 16px !important; margin: 16px 0 0 0 !important; display: none !important; align-items: center !important; gap: 8px !important; }@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }@keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-10px); } }.swal2-validation-message.show { display: flex !important; animation: slideDown 0.3s ease !important; }.swal2-validation-message.hide { animation: fadeOut 0.3s ease !important; }.swal2-validation-message::before { content: \"\"; display: inline-block; width: 20px; height: 20px; background: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%23fca5a5'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z'/%3E%3C/svg%3E\") no-repeat center; background-size: contain; flex-shrink: 0; }</style>";

    Swal.fire({
      title:
        '<span style="color: #10b981; font-size: 22px; font-weight: 600;">Approve Submission</span>',
      html: htmlContent + styleContent,
      showCancelButton: true,
      confirmButtonColor: "#10b981",
      cancelButtonColor: "#475569",
      confirmButtonText: '<span style="font-weight: 600;">Yes, Approve</span>',
      cancelButtonText: "Cancel",
      customClass: {
        popup: "swal-clean-popup-reject",
        confirmButton: "swal-btn-approve",
        cancelButton: "swal-btn-cancel",
      },
      width: "540px",
      preConfirm: async () => {
        try {
          const result = await verifyParticipationAPI(sub.id, true);
          return result;
        } catch (e: any) {
          const errorMessage = e.message || "Verification failed";
          Swal.showValidationMessage(errorMessage);

          const validationMsg = document.querySelector(
            ".swal2-validation-message"
          ) as HTMLElement;
          if (validationMsg) {
            validationMsg.classList.add("show");

            setTimeout(() => {
              validationMsg.classList.remove("show");
              validationMsg.classList.add("hide");
              setTimeout(() => {
                validationMsg.style.display = "none";
                validationMsg.classList.remove("hide");
              }, 300);
            }, 3000);
          }

          return false;
        }
      },
    }).then((res) => {
      if (res.isConfirmed) {
        verifyProofData.submissions = verifyProofData.submissions.filter(
          (s) => s.id !== sub.id
        );
        Swal.fire({
          title:
            '<span style="color: #10b981; font-weight: 600;">Verified!</span>',
          html: '<p style="color: #94a3b8; font-size: 14px;">Participation has been approved successfully.</p>',
          icon: "success",
          timer: 2000,
          showConfirmButton: false,
          customClass: { popup: "swal-clean-popup-reject" },
          background: "#1e293b",
          iconColor: "#10b981",
        });
      }
    });
  }
  // test.ts
  async function onRejectSubmission(sub: ProofSubmission) {
    const htmlContent =
      '<div class="reject-container"><p class="helper-text">Please select a reason for rejection:</p><label class="reject-card"><input type="radio" name="rj_reason" value="Unclear image / Unreadable" checked><div class="card-content"><div class="icon-wrapper unclear"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></div><div class="text-wrapper"><span class="rj-title">Unclear Image</span><span class="rj-desc">Photo is blurry, dark, or data is unreadable.</span></div></div></label><label class="reject-card"><input type="radio" name="rj_reason" value="Incorrect distance or duration"><div class="card-content"><div class="icon-wrapper incorrect"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div class="text-wrapper"><span class="rj-title">Incorrect Data</span><span class="rj-desc">Distance or time does not match requirements.</span></div></div></label><label class="reject-card"><input type="radio" name="rj_reason" value="Duplicate submission"><div class="card-content"><div class="icon-wrapper duplicate"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></div><div class="text-wrapper"><span class="rj-title">Duplicate</span><span class="rj-desc">This proof has already been submitted.</span></div></div></label><label class="reject-card"><input type="radio" name="rj_reason" value="other"><div class="card-content"><div class="icon-wrapper other"><svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></div><div class="text-wrapper"><span class="rj-title">Other Reason</span><span class="rj-desc">Specify a custom reason below.</span></div></div></label><div id="other-input-container" class="other-box"><textarea id="other-reason-text" class="custom-textarea" placeholder="Please type the reason here..." rows="4"></textarea></div></div>';

    const styleContent =
      '<style>.reject-container { padding: 10px 0; text-align: left; }.helper-text { color: #94a3b8; font-size: 14px; margin-bottom: 16px; text-align: center; }.reject-card { display: block; background: rgba(30, 41, 59, 0.6); border: 2px solid rgba(71, 85, 105, 0.3); border-radius: 12px; padding: 14px 16px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s ease; position: relative; }.reject-card:hover { background: rgba(30, 41, 59, 0.8); border-color: rgba(239, 68, 68, 0.4); transform: translateX(4px); }.reject-card input[type="radio"] { position: absolute; opacity: 0; width: 0; height: 0; }.reject-card input[type="radio"]:checked ~ .card-content { opacity: 1; }.reject-card input[type="radio"]:checked ~ .card-content .icon-wrapper { background: rgba(239, 68, 68, 0.15); border-color: #ef4444; }.reject-card input[type="radio"]:checked ~ .card-content .rj-title { color: #f87171; }.reject-card:has(input[type="radio"]:checked) { background: rgba(239, 68, 68, 0.08); border-color: #ef4444; }.card-content { display: flex; align-items: center; gap: 14px; opacity: 0.7; transition: opacity 0.2s; }.icon-wrapper { width: 42px; height: 42px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 2px solid transparent; transition: all 0.2s; }.icon-wrapper.unclear { background: rgba(251, 191, 36, 0.1); color: #fbbf24; }.icon-wrapper.incorrect { background: rgba(239, 68, 68, 0.1); color: #ef4444; }.icon-wrapper.duplicate { background: rgba(168, 85, 247, 0.1); color: #a855f7; }.icon-wrapper.other { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }.text-wrapper { flex: 1; display: flex; flex-direction: column; gap: 4px; }.rj-title { font-size: 15px; font-weight: 600; color: #f8fafc; transition: color 0.2s; }.rj-desc { font-size: 13px; color: #94a3b8; line-height: 1.4; }.other-box { max-height: 0; overflow: hidden; opacity: 0; transition: all 0.3s ease; margin-top: 0; width: 100%; box-sizing: border-box; }.other-box.visible { max-height: 200px; opacity: 1; margin-top: 12px; }.custom-textarea { width: 100%; box-sizing: border-box; background: rgba(15, 23, 42, 0.8); border: 2px solid rgba(71, 85, 105, 0.4); border-radius: 12px; padding: 12px 14px; color: #f8fafc; font-size: 14px; font-family: inherit; resize: vertical; min-height: 100px; transition: all 0.2s; }.custom-textarea:focus { outline: none; border-color: #ef4444; background: rgba(15, 23, 42, 0.95); }.custom-textarea::placeholder { color: #64748b; }.swal-clean-popup-reject { background: #1e293b !important; border: 1px solid rgba(71, 85, 105, 0.3) !important; border-radius: 16px !important; padding: 24px !important; }.swal2-html-container { margin: 0 !important; }</style>';

    const result = await Swal.fire({
      title:
        '<span style="color: #f87171; font-size: 22px; font-weight: 600;">Reject Submission</span>',
      html: htmlContent + styleContent,
      showCancelButton: true,
      confirmButtonColor: "#ef4444",
      cancelButtonColor: "#475569",
      confirmButtonText:
        '<span style="font-weight: 600;">Confirm Reject</span>',
      cancelButtonText: "Cancel",
      customClass: {
        popup: "swal-clean-popup-reject",
        confirmButton: "swal-btn-reject",
        cancelButton: "swal-btn-cancel",
      },
      width: "540px",
      didOpen: () => {
        const radios = document.querySelectorAll('input[name="rj_reason"]');
        const otherContainer = document.getElementById("other-input-container");
        const textArea = document.getElementById(
          "other-reason-text"
        ) as HTMLTextAreaElement;

        radios.forEach((radio) => {
          radio.addEventListener("change", (e: any) => {
            if (e.target.value === "other") {
              otherContainer!.classList.add("visible");
              setTimeout(() => textArea?.focus(), 100);
            } else {
              otherContainer!.classList.remove("visible");
              textArea.value = "";
            }
          });
        });
      },
      preConfirm: () => {
        const selected = document.querySelector(
          'input[name="rj_reason"]:checked'
        ) as HTMLInputElement;
        if (!selected)
          return Swal.showValidationMessage("Please select a reason");

        let finalReason = selected.value;
        if (finalReason === "other") {
          const textVal = (
            document.getElementById("other-reason-text") as HTMLTextAreaElement
          ).value.trim();
          if (!textVal)
            return Swal.showValidationMessage("Please specify the reason.");
          finalReason = textVal;
        }

        return verifyParticipationAPI(sub.id, false, finalReason).catch(
          (error) => {
            Swal.showValidationMessage(`Error: ${error.message}`);
          }
        );
      },
    });

    if (result.value) {
      verifyProofData.submissions = verifyProofData.submissions.filter(
        (s) => s.id !== sub.id
      );
      Swal.fire({
        title:
          '<span style="color: #f87171; font-weight: 600;">Rejected!</span>',
        html: '<p style="color: #94a3b8; font-size: 14px;">The submission has been rejected successfully.</p>',
        icon: "success",
        timer: 2000,
        showConfirmButton: false,
        customClass: { popup: "swal-clean-popup-reject" },
        background: "#1e293b",
        iconColor: "#ef4444",
      });
    }
  }

  async function verifyParticipationAPI(
    pid: number,
    approved: boolean,
    reason: string = ""
  ) {
    const payload: any = { participation_id: pid, approved };
    if (!approved) payload.rejection_reason = reason;

    try {
      console.log("üöÄ Sending Payload:", payload); // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ id ‡∏ñ‡∏π‡∏Å‡πÑ‡∏´‡∏°
      const res = await api.post("/api/participations/verify", payload);
      return res.data;
    } catch (err: any) {
      throw new Error(err.response?.data?.message || "Verification failed");
    }
  }

  function prevVerifyProofEventsPage() {
    if (verifyProofEventsPage > 1) verifyProofEventsPage--;
  }

  function nextVerifyProofEventsPage() {
    if (verifyProofEventsPage < totalVerifyProofEventsPages)
      verifyProofEventsPage++;
  }

  // Sort & Filter
  // ===== PERFORMANCE MONITOR =====
  interface PerfDataPoint {
    time: number;
    latency: number;
    status: "good" | "warning" | "bad";
  }

  let perfHistory: PerfDataPoint[] = [];
  let currentLatency = 0;
  let avgLatency = 0;
  let connectionStatus: "connected" | "slow" | "disconnected" = "connected";
  let perfInterval: any;
  let showPerfTooltip = false;
  const MAX_PERF_POINTS = 30;

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ (Reset Value)
  function clearPins() {
    // 1. ‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤ PIN ‡∏ó‡∏±‡πâ‡∏á 5 ‡∏´‡∏•‡∏±‡∏Å ‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤
    pins = ["", "", "", "", ""];

    // 2. ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error (‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÑ‡∏ß‡πâ)
    if (typeof verifyErrorMessage !== "undefined") {
      verifyErrorMessage = "";
    }

    // 3. ‡∏•‡πâ‡∏≤‡∏á Index ‡∏ó‡∏µ‡πà Error (‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á)
    if (typeof verifyErrorIndex !== "undefined") {
      verifyErrorIndex = null;
    }

    // 4. ‡∏•‡πâ‡∏≤‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Success (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
    if (typeof lastVerifySuccess !== "undefined") {
      lastVerifySuccess = false;
    }

    // 5. ‡∏™‡∏±‡πà‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡πÑ‡∏õ Focus ‡∏ä‡πà‡∏≠‡∏á‡πÅ‡∏£‡∏Å (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î PIN)
    if (verifyMode === "pin" && pinInputRefs && pinInputRefs[0]) {
      setTimeout(() => {
        pinInputRefs[0]?.focus();
      }, 50);
    }
  }
  // ===== VERIFY CODE FUNCTIONS =====
  function handlePinFocus(index: number) {
    const firstEmptyIndex = pins.findIndex((p) => p === "");
    if (firstEmptyIndex !== -1 && index > firstEmptyIndex) {
      pinInputRefs[firstEmptyIndex]?.focus();
    }
  }

  function handlePinInput(index: number, event: Event) {
    if (verifyErrorMessage) verifyErrorMessage = "";
    lastVerifySuccess = false;
    lastCheckOutSuccess = false;

    const input = event.target as HTMLInputElement;
    let value = input.value.replace(/\D/g, "");
    pins[index] = value;
    input.value = value;

    if (value !== "" && verifyErrorIndex === index) {
      verifyErrorIndex = null;
    }

    if (value.length === 1) {
      const nextEmptyIndex = pins.findIndex((p, i) => i > index && p === "");
      if (nextEmptyIndex !== -1) {
        pinInputRefs[nextEmptyIndex]?.focus();
      } else if (index < 4) {
        pinInputRefs[index + 1]?.focus();
      }
    }

    if (pins.every((p) => p !== "")) {
      verifyErrorIndex = null;
      if (autoCheckIn) {
        handleVerifyPin();
      }
    }
  }

  function handlePinKeydown(index: number, event: KeyboardEvent) {
    if (verifyErrorMessage) verifyErrorMessage = "";
    if (event.key === "Backspace") {
      if (pins[index]) {
        pins[index] = "";
        verifyErrorIndex = index;
      } else if (index > 0) {
        verifyErrorIndex = index - 1;
        pinInputRefs[index - 1]?.focus();
      }
    }
    if (event.key === "Enter" && pins.every((p) => p !== "")) {
      handleVerifyPin();
    }
  }

  function triggerVerifyErrorTimeout() {
    if (verifyErrorTimeout) clearTimeout(verifyErrorTimeout);
    verifyErrorTimeout = setTimeout(() => {
      verifyErrorMessage = "";
      verifyErrorIndex = null;
    }, 3000);
  }

  async function verifyCode(code: string) {
    if (code.length !== 5) {
      verifyErrorMessage = "Please enter full 5-digit code";
      if (verifyMode === "pin") {
        const firstEmpty = pins.findIndex((p) => p === "");
        verifyErrorIndex = firstEmpty !== -1 ? firstEmpty : 4;
        pinInputRefs[verifyErrorIndex]?.focus();
      }
      triggerVerifyErrorTimeout();
      return;
    }

    isVerifying = true;
    verifyErrorMessage = "";
    verifyErrorIndex = null;
    lastVerifySuccess = false;
    qrSuccessShow = false;

    try {
      const token = localStorage.getItem("access_token");
      if (!token) throw new Error("Please login again");

      const res = await api.post("/api/participations/check-in", {
        join_code: code,
      });
      const data = res.data;

      lastParticipantName =
        data.participant?.user?.first_name ||
        data.participant_name ||
        "Participants";

      if (verifyMode === "qr") {
        // QR mode: ‡πÅ‡∏™‡∏î‡∏á success overlay ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
        qrSuccessShow = true;
        if (qrSuccessTimeout) clearTimeout(qrSuccessTimeout);
        qrSuccessTimeout = setTimeout(() => {
          qrSuccessShow = false;
          lastScannedCode = ""; // reset ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
        }, 1500);
      } else {
        // PIN mode
        lastVerifySuccess = true;
        pins = ["", "", "", "", ""];
        setTimeout(() => {
          pinInputRefs[0]?.focus();
          lastVerifySuccess = false;
        }, 2000);
      }

      lastScannedCode = "";
    } catch (err: any) {
      verifyErrorMessage =
        err.response?.data?.message ||
        err.response?.data?.detail ||
        err.message ||
        "Invalid code or check-in failed";
      if (verifyMode === "pin") {
        verifyErrorIndex = 0;
        pins = ["", "", "", "", ""];
        pinInputRefs[0]?.focus();
      }
      // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö QR mode ‡πÉ‡∏´‡πâ reset lastScannedCode ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
      if (verifyMode === "qr") {
        setTimeout(() => {
          lastScannedCode = "";
        }, 2000);
      }
      triggerVerifyErrorTimeout();
    } finally {
      isVerifying = false;
    }
  }

  async function handleVerifyPin() {
    if (verifyActionMode === "checkout") {
      await checkOutCode(pins.join(""));
    } else {
      await verifyCode(pins.join(""));
    }
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Check-out (‡πÉ‡∏ä‡πâ API verify)
  async function checkOutCode(code: string) {
    // 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏£‡∏´‡∏±‡∏™
    if (code.length !== 5) {
        verifyErrorMessage = currentLang === "th" ? "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™ 5 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö" : "Please enter full 5-digit code";
        if (verifyMode === "pin") {
            const firstEmpty = pins.findIndex((p) => p === "");
            verifyErrorIndex = firstEmpty !== -1 ? firstEmpty : 4;
            pinInputRefs[verifyErrorIndex]?.focus();
        }
        triggerVerifyErrorTimeout();
        return;
    }

    // Reset ‡∏Ñ‡πà‡∏≤
    isVerifying = true;
    verifyErrorMessage = "";
    verifyErrorIndex = null;
    lastCheckOutSuccess = false;
    qrSuccessShow = false;

    try {
        const token = localStorage.getItem("access_token");
        if (!token) throw new Error("No Token");

        let participantData: any = null;
        let isAlreadyCheckedOut = false; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏Ñ‡∏¢‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á

        // =========================================================
        // STEP 1: ‡∏•‡∏≠‡∏á‡∏¢‡∏¥‡∏á API Check-out
        // =========================================================
        try {
            const checkOutRes = await api.post("/api/participations/check-out", {
                join_code: code,
            });
            if (checkOutRes.data) {
                participantData = checkOutRes.data;
            }
        } catch (e: any) {
            const status = e.response?.status;
            
            // ‡∏Å‡∏£‡∏ì‡∏µ 400: ‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤ Check-out ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡∏£‡∏∑‡∏≠ Bad Request)
            if (status === 400) {
                console.warn("User might be already checked out.");
                isAlreadyCheckedOut = true; 
                // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ 400 ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏ú‡πà‡∏≤‡∏ô (‡πÅ‡∏ï‡πà‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô) ‡πÉ‡∏´‡πâ‡πÑ‡∏õ‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡πà Lookup
            } 
            // ‡∏Å‡∏£‡∏ì‡∏µ 404: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏µ‡πâ‡πÄ‡∏•‡∏¢ -> ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ participantData ‡πÄ‡∏õ‡πá‡∏ô null ‡∏ï‡πà‡∏≠‡πÑ‡∏õ
            else if (status === 404) {
                console.warn("Code not found in Check-out endpoint");
            }
            else {
                // Error ‡∏≠‡∏∑‡πà‡∏ô‡πÜ (Server 500) -> ‡πÇ‡∏¢‡∏ô Error ‡∏≠‡∏≠‡∏Å‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
                throw e;
            }
        }

        // =========================================================
        // STEP 2: ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÄ‡∏Ñ‡∏¢ Check-out ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß ‡∏´‡∏£‡∏∑‡∏≠ Error 400)
        // ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á Lookup ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        // =========================================================
        if (!participantData) {
            try {
                const lookupRes = await api.get(`/api/participations/lookup-by-code/${code}`);
                if (lookupRes.data) {
                    participantData = lookupRes.data;
                }
            } catch (e) {
                // ‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÑ‡∏ß‡πâ: ‡∏ñ‡πâ‡∏≤ Lookup ‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠‡∏≠‡∏µ‡∏Å ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î‡∏à‡∏£‡∏¥‡∏á‡πÜ
            }
        }

        // =========================================================
        // ‚ùå STEP 3 (‡πÄ‡∏î‡∏¥‡∏°): ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏•‡∏≠‡∏°‡∏ó‡∏¥‡πâ‡∏á! 
        // ‡∏ñ‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß participantData ‡∏¢‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô null ‡πÅ‡∏õ‡∏•‡∏ß‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î
        // =========================================================
        if (!participantData) {
            // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ß‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
            verifyErrorMessage = currentLang === "th" ? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°" : "Invalid Code";
            triggerVerifyErrorTimeout();
            return; // ‚õî ‡∏à‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÑ‡∏°‡πà‡πÑ‡∏õ‡∏ï‡πà‡∏≠ Success UI
        }

        // =========================================================
        // üü¢ STEP 4: ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (Success UI)
        // =========================================================
        
        // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        lastParticipantName =
            participantData?.participant?.user?.first_name ||
            participantData?.user?.first_name ||
            participantData?.participant_name ||
            participantData?.name ||
            "Unknown User";

        // (Option) ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏ã‡πâ‡∏≥
        if (isAlreadyCheckedOut) {
             // ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡πÅ‡∏ó‡∏ô
             // ‡πÅ‡∏ï‡πà‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ Flow ‡πÄ‡∏õ‡πá‡∏ô Success ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ
        }

        if (verifyMode === "qr") {
            qrSuccessShow = true;
            if (qrSuccessTimeout) clearTimeout(qrSuccessTimeout);
            qrSuccessTimeout = setTimeout(() => {
                qrSuccessShow = false;
                lastScannedCode = "";
            }, 1500);
        } else {
            lastCheckOutSuccess = true;
            pins = ["", "", "", "", ""];
            setTimeout(() => {
                pinInputRefs[0]?.focus();
                lastCheckOutSuccess = false;
            }, 2000);
        }

        lastScannedCode = "";

    } catch (err: any) {
        console.error("Critical System Error:", err);
        verifyErrorMessage = currentLang === "th" ? "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î" : "System Error";
        triggerVerifyErrorTimeout();
    } finally {
        isVerifying = false;
    }
}

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î Check-in/Check-out
  function switchActionMode(mode: "checkin" | "checkout") {
    if (verifyActionMode === mode) return;
    verifyActionMode = mode;
    clearPins();
    lastVerifySuccess = false;
    lastCheckOutSuccess = false;
    verifyErrorMessage = "";
    verifyErrorIndex = null;
  }

  async function startCamera() {
    cameraError = "";
    try {
      cameraStream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" },
      });

      if (videoRef) {
        videoRef.srcObject = cameraStream;
        await videoRef.play();
        scanning = true;
        startQRScanning();
      }
    } catch (err: any) {
      cameraError = "Unable to access camera. Please check permissions.";
    }
  }

  function stopCamera() {
    scanning = false;
    if (scanInterval) {
      clearInterval(scanInterval);
      scanInterval = null;
    }
    if (cameraStream) {
      cameraStream.getTracks().forEach((track) => track.stop());
      cameraStream = null;
    }
  }

  function startQRScanning() {
    if (!canvasRef || !videoRef) return;

    const canvas = canvasRef;
    const video = videoRef; // Capture reference before setInterval
    const ctx = canvas.getContext("2d");
    if (!ctx) return;

    scanInterval = setInterval(async () => {
      if (!scanning || isVerifying || qrSuccessShow) return;

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0);

      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

      // @ts-ignore

      // @ts-ignore
      const code = jsQR(imageData.data, imageData.width, imageData.height);
      if (code && code.data && code.data !== lastScannedCode) {
        lastScannedCode = code.data;
        const cleanCode = code.data.replace(/\D/g, "").slice(0, 5);
        if (cleanCode.length === 5) {
          // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏≤‡∏° action mode
          if (verifyActionMode === "checkout") {
            await checkOutCode(cleanCode);
          } else {
            await verifyCode(cleanCode);
          }
        }
      }
    }, 150); // ‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å 300ms ‡πÄ‡∏õ‡πá‡∏ô 150ms
  }

  function switchVerifyMode(newMode: "pin" | "qr") {
    if (verifyMode === newMode) return;

    if (verifyMode === "qr") {
      stopCamera();
    }

    verifyMode = newMode;

    if (newMode === "qr") {
      setTimeout(() => startCamera(), 100);
    } else {
      setTimeout(() => pinInputRefs[0]?.focus(), 100);
    }
    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î
    clearPins();
  }

  // OPTIMIZED: filteredEventsForReward with memoization
  let lastRewardEventsKey = "";
  let cachedFilteredEventsForReward: AppEvent[] = [];

  $: {
    // Only rebuild cache when in reward view and no event is selected
    if (currentView === "reward" && !rewardData.selectedEvent) {
      const cacheKey = `reward_${events.length}_${searchQueryReward}_${selectedMonthReward}_${selectedYearReward}`;
      if (cacheKey !== lastRewardEventsKey) {
        lastRewardEventsKey = cacheKey;
        cachedFilteredEventsForReward = filterEventsOptimized(
          events,
          searchQueryReward,
          selectedMonthReward,
          selectedYearReward
        );
      }
    }
  }

  $: filteredEventsForReward = cachedFilteredEventsForReward;

  $: totalRewardEventsPages = Math.ceil(
    filteredEventsForReward.length / rewardEventsPerPage
  );

  $: paginatedEventsForReward = filteredEventsForReward.slice(
    (rewardEventsPage - 1) * rewardEventsPerPage,
    rewardEventsPage * rewardEventsPerPage
  );

  $: debouncedUpdateRewardSearch(rewardData.searchQuery);

  // OPTIMIZED: Pre-compute tier order when event changes
  // Only set ce_formData.rewardTiers when entering edit mode, not on every reactive change
  let lastEditEventId: number | null = null;
  $: if (rewardData.selectedEvent && currentView === "edit") {
    if (rewardData.selectedEvent.id !== lastEditEventId) {
      cachedTierOrder.clear();
      cachedTierOrder.set("No Tier", 999);
      const tiers = Array.isArray(rewardData.selectedEvent.rewards) ? rewardData.selectedEvent.rewards : [];
      tiers.forEach((t, i) => cachedTierOrder.set(t.name, i));
      if (ce_formData && ce_formData.rewardTiers !== undefined) {
        ce_formData.rewardTiers = tiers.map(t => ({ ...t }));
      }
      lastEditEventId = rewardData.selectedEvent.id;
    }
  } else if (currentView !== "edit") {
    lastEditEventId = null;
  }

  // OPTIMIZED: filteredRewardUsers with memoization
  function getFilteredRewardUsersOptimized(): RewardUser[] {
    const users = rewardData.users;
    if (!users || users.length === 0) return [];

    const query = debouncedRewardSearch.toLowerCase().trim();

    // Filter step with early returns
    const filtered = users.filter((user) => {
      // ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ safeNisitId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô undefined
      const safeNisitId = user.nisitId || "";

      // Search filter
      if (query) {
        const matchBasic =
          user.name.toLowerCase().includes(query) ||
          user.email.toLowerCase().includes(query) ||
          safeNisitId.includes(query); // ‚úÖ ‡πÉ‡∏ä‡πâ safeNisitId

        const matchYearPrefix =
          query.length === 2 &&
          /^\d{2}$/.test(query) &&
          safeNisitId.startsWith(query); // ‚úÖ ‡πÉ‡∏ä‡πâ safeNisitId

        const matchPersonalId =
          query.length >= 4 &&
          /^\d+$/.test(query) &&
          safeNisitId.slice(-6).includes(query); // ‚úÖ ‡πÉ‡∏ä‡πâ safeNisitId

        if (!matchBasic && !matchYearPrefix && !matchPersonalId) return false;
      }

      // Nisit filters
      if (nisitYearFilter && !safeNisitId.startsWith(nisitYearFilter))
        // ‚úÖ ‡πÉ‡∏ä‡πâ safeNisitId
        return false;
      if (nisitIdFilter && !safeNisitId.slice(-6).includes(nisitIdFilter))
        // ‚úÖ ‡πÉ‡∏ä‡πâ safeNisitId
        return false;

      // Tier filter
      if (rewardData.selectedTier !== "All") {
        if (rewardData.selectedTier === "No Tier" && user.tier !== "No Tier")
          return false;
        if (
          rewardData.selectedTier === "In Progress" &&
          user.status !== "in_progress"
        )
          return false;
        if (
          rewardData.selectedTier !== "No Tier" &&
          rewardData.selectedTier !== "In Progress" &&
          user.tier !== rewardData.selectedTier
        )
          return false;
      }

      // Tier rank filter
      if (
        (rewardSortBy === "tier_best" || rewardSortBy === "tier_lowest") &&
        rewardTierFilter !== "all"
      ) {
        if (rewardTierFilter === "No Tier" && user.tier !== "No Tier")
          return false;
        if (rewardTierFilter !== "No Tier" && user.tier !== rewardTierFilter)
          return false;
      }

      return true;
    });

    // Sort step - skip if not needed
    if (rewardSortBy === "all") return filtered;

    return filtered.sort((a, b) => {
      switch (rewardSortBy) {
        case "global_best":
          return a.globalRank - b.globalRank;
        case "global_lowest":
          return b.globalRank - a.globalRank;
        case "tier_best": {
          const diff =
            (cachedTierOrder.get(a.tier) ?? 998) -
            (cachedTierOrder.get(b.tier) ?? 998);
          return diff !== 0 ? diff : a.tierRank - b.tierRank;
        }
        case "tier_lowest": {
          const diff =
            (cachedTierOrder.get(b.tier) ?? 998) -
            (cachedTierOrder.get(a.tier) ?? 998);
          return diff !== 0 ? diff : b.tierRank - a.tierRank;
        }
        default:
          return 0;
      }
    });
  }

  let lastRewardUsersKey = "";
  let cachedFilteredRewardUsers: RewardUser[] = [];

  $: {
    const cacheKey = `rUsers_${rewardData.users.length}_${debouncedRewardSearch}_${rewardData.selectedTier}_${rewardSortBy}_${rewardTierFilter}_${nisitYearFilter}_${nisitIdFilter}`;
    if (cacheKey !== lastRewardUsersKey) {
      lastRewardUsersKey = cacheKey;
      cachedFilteredRewardUsers = getFilteredRewardUsersOptimized();
    }
  }

  $: filteredRewardUsers = cachedFilteredRewardUsers;

  $: totalRewardUsersPages = Math.ceil(
    filteredRewardUsers.length / rewardUsersPerPage
  );

  $: paginatedRewardUsers = filteredRewardUsers.slice(
    (rewardUsersPage - 1) * rewardUsersPerPage,
    rewardUsersPage * rewardUsersPerPage
  );

  function selectEventForReward(event: AppEvent) {
    rewardData.selectedEvent = event;
    rewardData.loading = true;
    rewardData.error = "";
    rewardData.searchQuery = "";
    rewardData.selectedTier = "All";
    rewardUsersPage = 1;

    // ‡πÄ‡∏£‡∏¥‡πà‡∏° auto refresh ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    rewardAutoRefreshEnabled = true;
    rewardIsConnected = true;
    newRewardUsersCount = 0;

    fetchLeaderboard(event.id);
  }

  async function fetchRewardUsers(eventId: number) {
    try {
      const token = localStorage.getItem("access_token");
      const headers: HeadersInit = { "Content-Type": "application/json" };
      if (token) headers["Authorization"] = `Bearer ${token}`;

      // ‚úÖ ‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡∏°‡πà: ‡∏î‡∏∂‡∏á config ID ‡∏à‡∏≤‡∏Å event
      const configId = rewardData.selectedEvent?.rewardConfigId;

      if (!configId) {
        console.warn(
          "No reward config found for this event, using fallback API"
        );
        // Fallback to old API if no reward config
        const res = await fetch(
          `${API_BASE_URL}/api/participations/event/${eventId}/report`,
          { headers }
        );

        if (res.status === 404) {
          console.warn("API returned 404: No participations found.");
          rewardData.users = [];
          return;
        }

        if (!res.ok) throw new Error("Failed to fetch participations");

        const participations = await res.json();
        const subs = Array.isArray(participations)
          ? participations
          : participations.data || [];

        // Simple mapping for fallback
        const users: RewardUser[] = subs.map((p: any, index: number) => ({
          id: `participation_${p.id}`,
          odySd: p.join_code || "",
          visitId: p.nisit_id || "",
          name: p.user_name || `User ${p.user_id}`,
          email: p.user_email || "",
          avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${p.user_id}`,
          globalRank: index + 1,
          tierRank: index + 1,
          tier: "No Tier",
          tierColor: "#64748b",
          completedCount: p.total_completions || 1,
          requiredCount: 1,
          nextTierCount: 1,
          completedAt: p.completed_at || "",
          joinCode: p.join_code || "",
          status: "completed" as const,
        }));

        rewardData.users = users;
        return;
      }

      // ‚úÖ ‡πÉ‡∏ä‡πâ API ‡πÉ‡∏´‡∏°‡πà: GET /api/reward-leaderboards/configs/{config_id}/entries
      const res = await fetch(
        `${API_BASE_URL}/api/reward-leaderboards/configs/${configId}/entries?limit=365`,
        { headers }
      );

      if (res.status === 404) {
        console.warn("API returned 404: No entries found.");
        rewardData.users = [];
        return;
      }

      if (!res.ok) throw new Error("Failed to fetch leaderboard entries");

      const entries = await res.json();
      const entriesArray = Array.isArray(entries)
        ? entries
        : entries.data || [];

      // Get tiers from event for color mapping
      const tiers = rewardData.selectedEvent?.rewards || [];
      const tierColorsList = [
        "#FFD700",
        "#C0C0C0",
        "#CD7F32",
        "#8B5CF6",
        "#3B82F6",
        "#10B981",
        "#F59E0B",
        "#EC4899",
        "#06B6D4",
        "#84CC16",
      ];

      // Map entries to RewardUser format
      const users: RewardUser[] = entriesArray.map(
        (entry: any, index: number) => {
          // Find tier info
          const tierNum = entry.reward_tier || 0;
          const tierInfo = tiers.find((t: any) => t.tier === tierNum);
          const tierName =
            entry.reward_name ||
            tierInfo?.name ||
            (tierNum > 0 ? `Tier ${tierNum}` : "No Tier");
          const tierColor =
            tierNum > 0
              ? tierColorsList[(tierNum - 1) % tierColorsList.length]
              : "#64748b";

          // Determine status
          let status: "completed" | "in_progress" | "no_tier" = "no_tier";
          if (entry.qualified_at) {
            status = "completed";
          } else if (entry.total_completions > 0) {
            status = "in_progress";
          }

          // Get required completions from config
          const requiredCount = rewardData.selectedEvent?.rewardConfigId
            ? allRewardConfigs.find((c: any) => c.id === configId)
                ?.required_completions || 1
            : 1;

          return {
            id: `entry_${entry.id}`,
            odySd: "",
            visitId: "",
            nisitId: "",
            name: entry.user_full_name || `User ${entry.user_id}`,
            email: entry.user_email || "",
            avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${entry.user_id}`,
            globalRank: entry.rank || index + 1,
            tierRank: entry.rank || index + 1,
            tier: tierName,
            tierColor,
            completedCount: entry.total_completions || 0,
            requiredCount,
            nextTierCount: requiredCount,
            completedAt: entry.qualified_at || "",
            rewardedAt: entry.rewarded_at || "",
            joinCode: "",
            status,
            userId: entry.user_id,
            rewardId: entry.reward_id,
            rewardTier: entry.reward_tier,
            rewardDescription: entry.reward_description || "",
          };
        }
      );

      // Sort by rank
      users.sort((a, b) => a.globalRank - b.globalRank);

      rewardData.users = users;
      console.log(`‚úÖ Loaded ${users.length} reward entries from new API`);
    } catch (error) {
      console.error("Error fetching reward users:", error);
      rewardData.error = "Failed to load participants";
    } finally {
      rewardData.loading = false;
    }
  }

  function decodeJWT(token: string): { exp?: number; iat?: number } | null {
    try {
      const parts = token.split(".");
      if (parts.length !== 3) return null;

      // Decode payload (‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2 ‡∏Ç‡∏≠‡∏á JWT)
      const payload = parts[1];
      // ‡πÅ‡∏õ‡∏•‡∏á base64url ‡πÄ‡∏õ‡πá‡∏ô base64 ‡∏õ‡∏Å‡∏ï‡∏¥
      const base64 = payload.replace(/-/g, "+").replace(/_/g, "/");
      const jsonPayload = decodeURIComponent(
        atob(base64)
          .split("")
          .map((c) => "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2))
          .join("")
      );
      return JSON.parse(jsonPayload);
    } catch (e) {
      console.error("Failed to decode JWT:", e);
      return null;
    }
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏à‡∏≤‡∏Å token
  function getTokenTimeLeft(): number {
    const token = localStorage.getItem("access_token");
    if (!token) return 0;

    const decoded = decodeJWT(token);
    if (!decoded || !decoded.exp) {
      console.warn("Token does not have exp claim, using default 1 hour");
      return 3600; // fallback 1 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á
    }

    const now = Math.floor(Date.now() / 1000); // ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô seconds
    const timeRemaining = decoded.exp - now;

    console.log(
      "üïê Token expiry:",
      new Date(decoded.exp * 1000).toLocaleString()
    );
    console.log("üïê Time remaining:", timeRemaining, "seconds");

    return Math.max(0, timeRemaining);
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô initialize timer ‡∏à‡∏≤‡∏Å token ‡∏à‡∏£‡∏¥‡∏á
  function initializeTokenTimer() {
    const remaining = getTokenTimeLeft();
    if (remaining <= 0) {
      // Token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß - redirect ‡πÑ‡∏õ login
      handleAutoLogout();
      return;
    }
    timeLeft = remaining;
    startTimer();
  }
  function generateMockRewardUsers(event: AppEvent): RewardUser[] {
    const tiers = event?.rewards || [];
    if (tiers.length === 0) return [];

    // Sort tiers by max_rank DESC (Tier ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
    const tiersSortedByReqDesc = [...tiers].sort((a, b) => {
      const reqA = a.rangeEnd || a.quota || 0;
      const reqB = b.rangeEnd || b.quota || 0;
      return reqB - reqA;
    });

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á tierColors ‡∏ï‡∏≤‡∏° index
    const tierColorsList = [
      "#FFD700",
      "#C0C0C0",
      "#CD7F32",
      "#8B5CF6",
      "#3B82F6",
      "#10B981",
      "#F59E0B",
      "#EC4899",
      "#06B6D4",
      "#84CC16",
      "#EF4444",
      "#A855F7",
      "#14B8A6",
      "#F97316",
      "#6366F1",
      "#22D3EE",
      "#FB7185",
      "#A3E635",
      "#FBBF24",
      "#818CF8",
    ];

    const mockNames = [
      { name: "Somchai Jaidee", email: "somchai@email.com" },
      { name: "Somsri Rakdee", email: "somsri@email.com" },
      { name: "Wichai Suksant", email: "wichai@email.com" },
      { name: "Malee Ruenrom", email: "malee@email.com" },
      { name: "Prasit Deejai", email: "prasit@email.com" },
      { name: "Napat Tongdee", email: "napat@email.com" },
      { name: "Kanya Srisuk", email: "kanya@email.com" },
      { name: "Thanawat Chaiyasit", email: "thanawat@email.com" },
      { name: "Pornpan Yodkwan", email: "pornpan@email.com" },
      { name: "Surapong Raksa", email: "surapong@email.com" },
      { name: "Jintana Meesuk", email: "jintana@email.com" },
      { name: "Anong Saengthong", email: "anong@email.com" },
      { name: "Somying Sombat", email: "somying@email.com" },
      { name: "Preecha Pongpan", email: "preecha@email.com" },
      { name: "Duangjai Duangdee", email: "duangjai@email.com" },
      { name: "Narong Nakorn", email: "narong@email.com" },
      { name: "Wandee Wongsa", email: "wandee@email.com" },
      { name: "Kittichai Kittikul", email: "kittichai@email.com" },
      { name: "Orathai Ongard", email: "orathai@email.com" },
      { name: "Prayoon Pradit", email: "prayoon@email.com" },
    ];

    const lowestTierReq =
      tiersSortedByReqDesc[tiersSortedByReqDesc.length - 1]?.requirement ||
      tiersSortedByReqDesc[tiersSortedByReqDesc.length - 1]?.rangeEnd ||
      10;
    const highestTierReq =
      tiersSortedByReqDesc[0]?.requirement ||
      tiersSortedByReqDesc[0]?.rangeEnd ||
      50;

    const totalUsers = 20;
    let tempUsers: {
      name: string;
      email: string;
      completedCount: number;
      completedAt: string;
    }[] = [];

    for (let i = 0; i < totalUsers; i++) {
      const mockUser = mockNames[i % mockNames.length];
      const maxCount = highestTierReq + 20;
      const completedCount = Math.floor(Math.random() * maxCount);

      const completedAt =
        completedCount >= lowestTierReq
          ? new Date(
              Date.now() -
                Math.random() * 14 * 24 * 60 * 60 * 1000 +
                Math.random() * 1000
            ).toISOString()
          : "";

      tempUsers.push({
        name: mockUser.name,
        email: mockUser.email,
        completedCount,
        completedAt,
      });
    }

    // Sort: completedCount ‡∏°‡∏≤‡∏Å‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô
    tempUsers.sort((a, b) => {
      if (b.completedCount !== a.completedCount) {
        return b.completedCount - a.completedCount;
      }
      if (a.completedAt && b.completedAt) {
        return (
          new Date(a.completedAt).getTime() - new Date(b.completedAt).getTime()
        );
      }
      if (a.completedAt) return -1;
      if (b.completedAt) return 1;
      return 0;
    });

    // ‡∏à‡∏±‡∏î Tier slots
    const tierSlots: { [tierName: string]: number } = {};
    const tierRanks: { [tierName: string]: number } = {};

    tiersSortedByReqDesc.forEach((tier) => {
      tierSlots[tier.name] = tier.quota || 10;
      tierRanks[tier.name] = 0;
    });

    const users: RewardUser[] = tempUsers.map((tempUser, index) => {
      const globalRank = index + 1;
      let assignedTier = "No Tier";
      let tierColor = "#64748b";
      let tierRank = 0;
      let requiredCount = lowestTierReq;
      let nextTierCount = lowestTierReq;
      let status: "completed" | "in_progress" | "no_tier" = "no_tier";

      // ‡∏´‡∏≤ Tier (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å Tier ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
      for (let i = 0; i < tiersSortedByReqDesc.length; i++) {
        const tier = tiersSortedByReqDesc[i];
        const tierReq = tier.requirement || tier.rangeEnd || 10;

        if (tempUser.completedCount >= tierReq && tierSlots[tier.name] > 0) {
          assignedTier = tier.name;
          // ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡∏ï‡∏≤‡∏° index (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢ Tier)
          tierColor = tierColorsList[i % tierColorsList.length];
          tierSlots[tier.name]--;
          tierRanks[tier.name]++;
          tierRank = tierRanks[tier.name];
          requiredCount = tierReq;
          status = "completed";

          if (i > 0) {
            nextTierCount =
              tiersSortedByReqDesc[i - 1].requirement ||
              tiersSortedByReqDesc[i - 1].rangeEnd ||
              tierReq;
          } else {
            nextTierCount = tierReq;
          }
          break;
        }
      }

      if (assignedTier === "No Tier" && tempUser.completedCount > 0) {
        status = "in_progress";
      }

      const yearPrefix = 67 + (globalRank % 4); // 67, 68, 69, 70
      const facultyCode = "30"; // ‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå
      const personalId = String(
        200000 + globalRank * 17 + Math.floor(Math.random() * 100)
      )
        .padStart(6, "0")
        .slice(0, 6);
      const nisitId = `${yearPrefix}${facultyCode}${personalId}`;

      return {
        id: `user_${globalRank}`,
        odySd: `OD${String(globalRank).padStart(4, "0")}`,
        nisitId,
        name: tempUser.name,
        email: tempUser.email,
        avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${tempUser.name}${globalRank}`,
        globalRank,
        tierRank,
        tier: assignedTier,
        tierColor,
        completedCount: tempUser.completedCount,
        requiredCount,
        nextTierCount,
        completedAt: tempUser.completedAt,
        joinCode: `EVT-${String(globalRank).padStart(3, "0")}`,
        status,
      };
    });

    return users;
  }

  function nextRewardEventsPage() {
    if (rewardEventsPage < totalRewardEventsPages) {
      rewardEventsPage += 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function prevRewardEventsPage() {
    if (rewardEventsPage > 1) {
      rewardEventsPage -= 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function jumpToRewardEventsPage(page: number) {
    rewardEventsPage = page;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function nextRewardUsersPage() {
    if (rewardUsersPage < totalRewardUsersPages) {
      rewardUsersPage += 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function prevRewardUsersPage() {
    if (rewardUsersPage > 1) {
      rewardUsersPage -= 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function jumpToRewardUsersPage(page: number) {
    rewardUsersPage = page;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function openMessageModal(user: RewardUser) {
    selectedUserForMessage = user;
    messageText = "";
    showMessageModal = true;
  }

  function closeMessageModal() {
    showMessageModal = false;
    selectedUserForMessage = null;
    messageText = "";
  }

  async function sendMessage() {
    if (!messageText.trim() || !selectedUserForMessage) return;

    try {
      // ‡∏™‡πà‡∏á notification ‡πÑ‡∏õ‡∏¢‡∏±‡∏á user ‡∏ú‡πà‡∏≤‡∏ô API
      // ‡πÉ‡∏ä‡πâ send-pending endpoint ‡∏ï‡∏≤‡∏° API spec
      await api.post("/api/notifications/send-pending", null, {
        params: { limit: 50 },
      });

      Swal.fire({
        title: lang.notificationSent,
        text:
          currentLang === "th"
            ? `‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ñ‡∏∂‡∏á ${selectedUserForMessage.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`
            : `Notification sent to ${selectedUserForMessage.name}`,
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
        timer: 2000,
        showConfirmButton: false,
      });

      closeMessageModal();
    } catch (error: any) {
      console.error("Error sending notification:", error);
      Swal.fire({
        title: lang.error,
        text:
          error.response?.data?.detail ||
          error.message ||
          (currentLang === "th"
            ? "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÑ‡∏î‡πâ"
            : "Failed to send notification"),
        icon: "error",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#ef4444",
      });
    }
  }

  function resetRewardState() {
    rewardData.selectedEvent = null;
    rewardData.users = [];
    rewardData.loading = false;
    rewardData.error = "";
    rewardData.searchQuery = "";
    rewardData.selectedTier = "All";
    rewardEventsPage = 1;
    rewardUsersPage = 1;
    rewardSortBy = "all";
    rewardTierFilter = "all";
    rewardSortDropdownOpen = false;
    rewardTierFilterDropdownOpen = false;
    newRewardUsersCount = 0;
    rewardAutoRefreshEnabled = false;
    rewardIsConnected = false;
    searchQueryReward = "";
    selectedMonthReward = "All";
    selectedYearReward = "All";
  }

  function applyRewardFilters() {
    // Reset status card selection ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ filter
    rewardData.selectedTier = "All";
    rewardUsersPage = 1;
  }

  function resetRewardFilters() {
    rewardData.searchQuery = "";
    rewardData.selectedTier = "All";
    rewardTierDropdownOpen = false;
    rewardSortBy = "all";
    rewardSortDropdownOpen = false;
    rewardTierFilter = "all";
    rewardTierFilterDropdownOpen = false;
    nisitYearFilter = "";
    nisitIdFilter = "";
    rewardUsersPage = 1;
  }

  $: if (currentView === "reward") {
    // Reset filters ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ reward
    if (rewardData.selectedEvent === null) {
      searchQueryReward = "";
      selectedMonthReward = "All";
      selectedYearReward = "All";
      rewardEventsPage = 1;
    }
  }

  // Reset reward events page when filters change
  $: if (searchQueryReward || selectedMonthReward || selectedYearReward) {
    rewardEventsPage = 1;
  }

  let rewardEventsPage = 1;
  const rewardEventsPerPage = 8;
  let showRewardEventsPageDropdown = false;
  let showRewardUsersPageDropdown = false;
  let rewardUsersPage = 1;
  const rewardUsersPerPage = 8;
  let rewardTierDropdownOpen = false;
  let showMessageModal = false;
  let selectedUserForMessage: RewardUser | null = null;
  let messageText = "";
  // Send to All Modal
  let showSendAllModal = false;
  let sendAllTargetTier: string = "All";
  let sendAllMessageTemplate = "";
  let sendAllUseTemplate = false;

  // Sort & Filter
  let rewardSortBy:
    | "all"
    | "global_best"
    | "global_lowest"
    | "tier_best"
    | "tier_lowest" = "all";
  let rewardSortDropdownOpen = false;
  let rewardTierFilter: string = "all";
  let rewardTierFilterDropdownOpen = false;

  // Nisit ID Filter
  let nisitYearFilter: string = ""; // ‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤ (‡∏õ‡∏µ) ‡πÄ‡∏ä‡πà‡∏ô 67, 68
  let nisitIdFilter: string = "";

  function refreshRewardUsers() {
    newRewardUsersCount = 0;
    if (rewardData.selectedEvent) {
      rewardData.loading = true;
      fetchRewardUsers(rewardData.selectedEvent.id);
    }
  }

  function openSendAllModal() {
    showSendAllModal = true;
    sendAllTargetTier = "All";
    sendAllMessageTemplate = "";
    sendAllUseTemplate = false;
  }

  function closeSendAllModal() {
    showSendAllModal = false;
    sendAllTargetTier = "All";
    sendAllMessageTemplate = "";
    sendAllUseTemplate = false;
  }

  function getTargetUsers(): RewardUser[] {
    if (sendAllTargetTier === "All") {
      return rewardData.users;
    } else if (sendAllTargetTier === "In Progress") {
      return rewardData.users.filter((u) => u.status === "in_progress");
    } else if (sendAllTargetTier === "No Tier") {
      return rewardData.users.filter((u) => u.tier === "No Tier");
    } else {
      return rewardData.users.filter((u) => u.tier === sendAllTargetTier);
    }
  }

  function generateMessageForUser(user: RewardUser, template: string): string {
    const sortedTiers = [...(rewardData.selectedEvent?.rewards || [])].sort(
      (a, b) => {
        const reqA = a.rangeEnd || a.quota || 0;
        const reqB = b.rangeEnd || b.quota || 0;
        return reqB - reqA;
      }
    );
    const tierIdx = sortedTiers.findIndex((t) => t.name === user.tier);
    const tierInfo = getTierDisplayName(
      user.tier,
      tierIdx >= 0 ? tierIdx : 999
    );

    return template
      .replace(/\{name\}/g, user.name)
      .replace(/\{email\}/g, user.email)
      .replace(/\{globalRank\}/g, String(user.globalRank))
      .replace(/\{tierRank\}/g, String(user.tierRank))
      .replace(/\{tier\}/g, tierInfo.name)
      .replace(/\{event\}/g, rewardData.selectedEvent?.title || "");
  }

  async function sendAllMessages() {
    const targetUsers = getTargetUsers();
    if (targetUsers.length === 0 || !sendAllMessageTemplate.trim()) return;

    try {
      const token = localStorage.getItem("access_token");
      const headers: HeadersInit = { "Content-Type": "application/json" };
      if (token) headers["Authorization"] = `Bearer ${token}`;

      let successCount = 0;
      let failCount = 0;

      // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡∏•‡∏∞‡∏Ñ‡∏ô
      for (const user of targetUsers) {
        const message = sendAllUseTemplate
          ? generateMessageForUser(user, sendAllMessageTemplate)
          : sendAllMessageTemplate;

        try {
          // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° /ku-run prefix
          const res = await fetch(`${API_BASE_URL}/ku-run/api/notifications/`, {
            method: "POST",
            headers,
            body: JSON.stringify({
              user_id: parseInt(
                user.id.replace("participation_", "").replace("user_", "")
              ),
              title: `‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° ${rewardData.selectedEvent?.title || ""}`,
              message: message,
              type: "reward",
              event_id: rewardData.selectedEvent?.id,
            }),
          });

          if (res.ok) {
            successCount++;
          } else {
            failCount++;
          }
        } catch (e) {
          failCount++;
        }
      }

      Swal.fire({
        title: "Messages Sent!",
        html: `<p style="color: #94a3b8;">Sent: <span style="color: #10b981;">${successCount}</span> / Failed: <span style="color: #ef4444;">${failCount}</span></p>`,
        icon: successCount > 0 ? "success" : "error",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });

      closeSendAllModal();
    } catch (error: any) {
      console.error("Error sending messages:", error);
      Swal.fire({
        title: "Error",
        text: error.message || "Failed to send messages",
        icon: "error",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#ef4444",
      });
    }
  }

  function getTierDisplayName(
    tierName: string,
    index: number
  ): { name: string; color: string } {
    // ‡∏™‡∏µ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ tier (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏à‡∏≤‡∏Å‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÑ‡∏õ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î)
    const tierColors = [
      "#FFD700", // 1. ‡∏ó‡∏≠‡∏á
      "#C0C0C0", // 2. ‡πÄ‡∏á‡∏¥‡∏ô
      "#CD7F32", // 3. ‡∏ó‡∏≠‡∏á‡πÅ‡∏î‡∏á
      "#8B5CF6", // 4. ‡∏°‡πà‡∏ß‡∏á
      "#3B82F6", // 5. ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô
      "#10B981", // 6. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
      "#F59E0B", // 7. ‡∏™‡πâ‡∏°
      "#EC4899", // 8. ‡∏ä‡∏°‡∏û‡∏π
      "#06B6D4", // 9. ‡∏ü‡πâ‡∏≤
      "#84CC16", // 10. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô
      "#EF4444", // 11. ‡πÅ‡∏î‡∏á
      "#A855F7", // 12. ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô
      "#14B8A6", // 13. ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏Ç‡πâ‡∏°
      "#F97316", // 14. ‡∏™‡πâ‡∏°‡πÄ‡∏Ç‡πâ‡∏°
      "#6366F1", // 15. indigo
      "#22D3EE", // 16. cyan
      "#FB7185", // 17. rose
      "#A3E635", // 18. lime
      "#FBBF24", // 19. amber
      "#818CF8", // 20. violet
    ];

    if (tierName === "No Tier") {
      return { name: "Newcomer", color: "#64748b" };
    }

    // ‚úÖ FIXED: ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤
    const colorIndex = index % tierColors.length;
    return {
      name: tierName, // ‡πÉ‡∏ä‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
      color: tierColors[colorIndex],
    };
  }

  function getTierIcon(icon: string): string {
    const icons: { [key: string]: string } = {
      crown: `<path stroke-linecap="round" stroke-linejoin="round" d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>`,
      star: `<path stroke-linecap="round" stroke-linejoin="round" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"></path>`,
      medal: `<path stroke-linecap="round" stroke-linejoin="round" d="M12 15a7 7 0 100-14 7 7 0 000 14zm0 0v6m-4-3h8"></path>`,
      bolt: `<path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path>`,
      clock: `<path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>`,
      flag: `<path stroke-linecap="round" stroke-linejoin="round" d="M3 21v-4m0 0V5a2 2 0 012-2h6.5l1 1H21l-3 6 3 6h-8.5l-1-1H5a2 2 0 00-2 2zm9-13.5V9"></path>`,
      compass: `<path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>`,
      award: `<path stroke-linecap="round" stroke-linejoin="round" d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V6a2 2 0 10-2 2h2zm0 0h4l-4 4-4-4h4z"></path>`,
    };
    return icons[icon] || icons.award;
  }

  // Reset ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πâ‡∏≤ reward detail
  function backToRewardEventsList() {
    rewardData.selectedEvent = null;
    rewardData.users = [];
    rewardData.searchQuery = "";
    rewardData.selectedTier = "All";
    rewardEventsPage = 1;
    rewardSortBy = "all";
    // Reset auto refresh
    newRewardUsersCount = 0;
    rewardAutoRefreshEnabled = false;
    rewardIsConnected = false;
    // Force rebuild cache
    lastRewardEventsKey = "";
  }
  function toggleRewardExportMenu() {
    showRewardExportMenu = !showRewardExportMenu;
  }
  function closeAllLogsDropdowns() {
    logsData.actionDropdownOpen = false;
    logsData.dateFromDropdownOpen = false;
    logsData.dateToDropdownOpen = false;
  }

  /**
   * toggleRewardAutoRefresh - ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ auto refresh ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö rewards
   */
  function toggleRewardAutoRefresh() {
    rewardAutoRefreshEnabled = !rewardAutoRefreshEnabled;
    rewardIsConnected = rewardAutoRefreshEnabled;
  }

  /**
   * processImageUrl - ‡πÅ‡∏õ‡∏•‡∏á URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
   * @param raw - URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏î‡∏¥‡∏ö‡∏à‡∏≤‡∏Å API
   * @param title - ‡∏ä‡∏∑‡πà‡∏≠ event (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debug log)
   * @returns string - URL ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
   *
   * ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö formats:
   * - Base64 data URL
   * - Full HTTP URL
   * - Relative path (/uploads/, /api/uploads/)
   */
  function processImageUrl(
    raw: string | null | undefined,
    title?: string
  ): string {
    if (!raw || raw === "string" || raw === "null") {
      return "";
    }

    let imgUrl = "";

    if (raw.startsWith("data:")) {
      // Base64 - ‡πÉ‡∏ä‡πâ‡πÄ‡∏•‡∏¢
      return raw;
    }

    if (raw.startsWith("http")) {
      // Full URL
      if (raw.includes("/api/uploads/")) {
        imgUrl = raw;
      } else if (raw.includes("/uploads/")) {
        imgUrl = raw.replace("/uploads/", "/api/uploads/");
      } else {
        imgUrl = raw;
      }
    } else if (raw.startsWith("/uploads/")) {
      imgUrl = `${API_BASE_URL}/api${raw}`;
    } else if (raw.startsWith("/api/uploads/")) {
      imgUrl = `${API_BASE_URL}${raw}`;
    } else {
      imgUrl = `${API_BASE_URL}${raw}`;
    }

    if (title) {
      console.log(`üì∑ Image for "${title}":`, { raw, final: imgUrl });
    }
    return imgUrl;
  }

  /**
   * fetchEvents - ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• events ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å API
   *
   * ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
   * 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token
   * 2. ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API /api/events/
   * 3. ‡∏î‡∏∂‡∏á holidays data
   * 4. Map response ‡πÄ‡∏õ‡πá‡∏ô AppEvent interface
   * 5. ‡∏î‡∏∂‡∏á pending counts ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ event
   */
  async function fetchEvents(forceRefresh: boolean = false) {
  const token = localStorage.getItem("access_token");
  if (!token) {
    window.location.href = `/ku-run/auth/login`;
    return;
  }

  try {
    const timestamp = forceRefresh ? `?_t=${Date.now()}` : "";
    const res = await api.get(`/api/events/${timestamp}`, {
      headers: forceRefresh ? { "Cache-Control": "no-cache" } : {},
    });
    const data = res.data;

    const holidaysData = allHolidaysData || [];
    const rewardConfigs = allRewardConfigs || [];
    const pad = (num: number) => num.toString().padStart(2, "0");

    events = data.map((item: any) => {
      const eventHolidays = holidaysData.find((h: any) => h.eventId === item.id);
      const eventRewardConfig = rewardConfigs.find((r: any) => r.event_id === item.id);

      const rewards = eventRewardConfig?.reward_tiers?.map((tier: any) => ({
        name: tier.reward_name || tier.name || `Tier ${tier.tier}`,
        requirement: tier.required_completions || tier.quantity,
        rangeStart: tier.min_rank,
        rangeEnd: tier.max_rank,
        tier: tier.tier,
        reward_id: tier.reward_id,
      })) || [];

      // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å UTC ‚Üí Bangkok time (+7 hours) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
      const startDateUTC = new Date(item.event_date);
      const endDateUTC = new Date(item.event_end_date);
      
      // ‡πÅ‡∏õ‡∏•‡∏á UTC ‚Üí Bangkok time (+7 hours)
      const bangkokOffset = 7 * 60 * 60 * 1000; // 7 hours in milliseconds
      const startDate = new Date(startDateUTC.getTime() + bangkokOffset);
      const endDate = new Date(endDateUTC.getTime() + bangkokOffset);
      
      // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Database
      const isPublished = item.is_published === true;
      const isActive = item.is_active === true;

      return {
        id: item.id,
        title: item.title,
        description: item.description,
        location: item.location,
        day: startDate.getUTCDate().toString(),
        month: ce_months[startDate.getUTCMonth()],
        year: startDate.getUTCFullYear().toString(),
        endDay: endDate.getUTCDate().toString(),
        endMonth: ce_months[endDate.getUTCMonth()],
        endYear: endDate.getUTCFullYear().toString(),
        
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏ö‡∏ö Bangkok time (‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        startTime: `${pad(startDate.getUTCHours())}:${pad(startDate.getUTCMinutes())}`,
        endTime: `${pad(endDate.getUTCHours())}:${pad(endDate.getUTCMinutes())}`,

        startDate: {
          day: startDate.getUTCDate().toString(),
          month: ce_months[startDate.getUTCMonth()],
          year: startDate.getUTCFullYear().toString(),
        },
        endDate: {
          day: endDate.getUTCDate().toString(),
          month: ce_months[endDate.getUTCMonth()],
          year: endDate.getUTCFullYear().toString(),
        },

        image: processImageUrl(item.banner_image_url, item.title),
        slots: item.max_participants,
        totalSlots: item.max_participants,
        usedSlots: item.participant_count || 0,
        distanceKm: item.distance_km || 0,
        
        // ‚úÖ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô ce_formData
        is_published: isPublished,
        is_active: isActive,
        isPublic: isPublished, 
        isActive: isActive,
        
        status: isPublished && isActive ? "Active" : !isPublished && !isActive ? "Draft" : isPublished && !isActive ? "Closed" : "Private",
        rewards: rewards,
        rewardConfigId: eventRewardConfig?.id,
        totalRewards: eventRewardConfig?.max_reward_recipients || null,
        requiredCompletions: eventRewardConfig?.required_completions || null,
        holidays: eventHolidays?.holidays || [],
        excludeWeekends: eventHolidays?.excludeWeekends || false,
      };
    });

    events = [...events];
    fetchPendingCountsForEvents();
    fetchUniqueParticipantCounts(); // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥
  } catch (err: any) {
    console.error("Error fetching events:", err);
  }
}

  // ===== OPTIMIZED: Fetch pending counts in parallel with batching =====
  async function fetchPendingCountsForEvents() {
    const token = localStorage.getItem("access_token");
    const headers: HeadersInit = { "Content-Type": "application/json" };
    if (token) headers["Authorization"] = `Bearer ${token}`;

    // ‚úÖ OPTIMIZATION: Fetch all pending counts in parallel (batch of 5)
    const BATCH_SIZE = 5;
    const eventsCopy = [...events];
    
    for (let i = 0; i < eventsCopy.length; i += BATCH_SIZE) {
      const batch = eventsCopy.slice(i, i + BATCH_SIZE);
      
      const results = await Promise.allSettled(
        batch.map(async (event) => {
          try {
            const res = await fetch(
              `${API_BASE_URL}/api/participations/event/${event.id}/report`,
              { headers }
            );

            if (res.status === 404) {
              return { eventId: event.id, pendingCount: 0 };
            }

            if (res.ok) {
              const data = await res.json();
              const subs = Array.isArray(data) ? data : data.data || [];
              const pendingCount = subs.filter(
                (s: any) => s.status === "proof_submitted"
              ).length;
              return { eventId: event.id, pendingCount };
            }
            return { eventId: event.id, pendingCount: 0 };
          } catch (err) {
            console.warn(`Failed to fetch pending count for event ${event.id}:`, err);
            return { eventId: event.id, pendingCount: 0 };
          }
        })
      );

      // Update events with results
      results.forEach((result) => {
        if (result.status === "fulfilled") {
          const { eventId, pendingCount } = result.value;
          const eventIndex = events.findIndex((e) => e.id === eventId);
          if (eventIndex !== -1) {
            events[eventIndex].pendingCount = pendingCount;
          }
        }
      });
    }

    // Force reactivity update
    events = [...events];
  }

  // ===== OPTIMIZED: Fetch unique participant counts for all events =====
  async function fetchUniqueParticipantCounts() {
    const token = localStorage.getItem("access_token");
    const headers: HeadersInit = { "Content-Type": "application/json" };
    if (token) headers["Authorization"] = `Bearer ${token}`;

    // Fetch unique counts in parallel (batch of 5)
    const BATCH_SIZE = 5;
    const eventsCopy = [...events];
    
    for (let i = 0; i < eventsCopy.length; i += BATCH_SIZE) {
      const batch = eventsCopy.slice(i, i + BATCH_SIZE);
      
      const results = await Promise.allSettled(
        batch.map(async (event) => {
          try {
            const res = await fetch(
              `${API_BASE_URL}/api/events/${event.id}/participants`,
              { headers }
            );

            if (!res.ok) {
              return { eventId: event.id, uniqueCount: event.usedSlots || 0 };
            }

            const data = await res.json();
            let participants: any[] = [];
            if (Array.isArray(data)) {
              participants = data;
            } else if (data?.participants) {
              participants = data.participants;
            } else if (data?.data) {
              participants = data.data;
            }

            // Deduplicate by user_id
            const uniqueUserIds = new Set<number>();
            participants.forEach((p: any) => {
              const userId = p.user_id || p.id;
              if (userId) uniqueUserIds.add(userId);
            });

            return { eventId: event.id, uniqueCount: uniqueUserIds.size };
          } catch (err) {
            console.warn(`Failed to fetch unique count for event ${event.id}:`, err);
            return { eventId: event.id, uniqueCount: event.usedSlots || 0 };
          }
        })
      );

      // Update events with results
      results.forEach((result) => {
        if (result.status === "fulfilled") {
          const { eventId, uniqueCount } = result.value;
          const eventIndex = events.findIndex((e) => e.id === eventId);
          if (eventIndex !== -1) {
            events[eventIndex].usedSlots = uniqueCount;
          }
        }
      });
    }

    // Force reactivity update
    events = [...events];
    console.log("‚úÖ Unique participant counts updated for all events");
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤ lang ‡∏°‡∏≤‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤)
  const formatDate = (dateString: string, lang: string) => {
    if (!dateString) return "-";
    const date = new Date(dateString);
    return date.toLocaleDateString(lang === "th" ? "th-TH" : "en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
    });
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤ (ISO) ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ï‡∏£‡∏¥‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà+‡πÄ‡∏ß‡∏•‡∏≤
  const formatDateTime = (iso?: string) => {
    if (!iso) return "-";
    try {
      const d = new Date(iso);
      return d.toLocaleString(currentLang === "th" ? "th-TH" : "en-US", {
        year: "numeric",
        month: "short",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });
    } catch (e) {
      return iso;
    }
  };

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 24-hour ‚Üí ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
  const formatDisplayTime = (time: string): string => {
    if (!time || time === "00:00") return time;
    
    const [hour, minute] = time.split(':').map(Number);
    
    // ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ö‡∏ö 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
    const hourStr = String(hour).padStart(2, '0');
    const minStr = String(minute).padStart(2, '0');
    
    return `${hourStr}:${minStr} ${currentLang === 'th' ? '‡∏ô.' : ''}`;
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏à‡∏≤‡∏Å translateStatus ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà)
  const getStatusLabel = (status: string, langData: any) => {
    // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ lang ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏°‡∏≤
    if (status === "Active") return langData.active || "Active";
    if (status === "Draft") return langData.draft || "Draft";
    if (status === "Closed") return langData.closed || "Closed";
    return status;
  };

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å ISO ‡πÄ‡∏õ‡πá‡∏ô Object
  function parseDate(isoString: string) {
    const d = new Date(isoString);
    return {
      day: d.getDate().toString(),
      month: (d.getMonth() + 1).toString(),
      year: d.getFullYear().toString(),
    };
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡∏°‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏à‡∏≤‡∏Å API ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Event
  async function fetchHolidaysFromFile() {
    try {
      // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ event ‡πÅ‡∏ó‡∏ô
      // allHolidaysData ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç event
      allHolidaysData = [];
      console.log("üìù Using event-specific holidays from API");
      return;
    } catch (e) {
      console.error("Load holidays failed", e);
      allHolidaysData = [];
    }
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á holidays ‡∏Ç‡∏≠‡∏á event ‡πÄ‡∏â‡∏û‡∏≤‡∏∞
  async function fetchEventHolidays(eventId: number) {
    try {
      const res = await api.get(`/api/events/${eventId}/holidays`);
      
      // ‚úÖ FIX: Axios response - ‡πÉ‡∏ä‡πâ res.data ‡πÅ‡∏•‡∏∞ res.status
      if (res.status !== 200) {
        console.warn(`‚ö†Ô∏è Failed to fetch holidays for event ${eventId}`);
        return [];
      }

      // Axios ‡∏à‡∏∞ parse JSON ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
      const holidaysArray = Array.isArray(res.data) ? res.data : [];
      allHolidaysData = holidaysArray;
      console.log(`‚úÖ Loaded ${allHolidaysData.length} holidays`);
      return holidaysArray;
    } catch (e: unknown) {
      const errorMessage = e instanceof Error ? e.message : "Unknown error";
      console.log("‚ö†Ô∏è Could not load holidays:", errorMessage);
      allHolidaysData = [];
    }
  }

  async function fetchRewardConfigs() {
    try {
      const res = await api.get("/api/reward-leaderboards/configs");
      // ‚úÖ FIX: Check response structure - API ‡∏≠‡∏≤‡∏à‡∏Ñ‡∏∑‡∏ô { data: [...] } ‡∏´‡∏£‡∏∑‡∏≠ array ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
      const responseData = res.data;
      allRewardConfigs = Array.isArray(responseData) ? responseData : (responseData?.data || []);
      if (isDev) console.log(`‚úÖ Loaded ${allRewardConfigs.length} reward configs`);
    } catch (e: unknown) {
      const errorMessage = e instanceof Error ? e.message : "Unknown error";
      console.log("‚ö†Ô∏è Could not load reward configs:", errorMessage);
      allRewardConfigs = [];
    }
  }

  async function fetchRewardStats(configId: number) {
    try {
      const res = await api.get(
        `/api/reward-leaderboards/configs/${configId}/stats`
      );
      return res.data;
    } catch (e: unknown) {
      const errorMessage = e instanceof Error ? e.message : "Unknown error";
      console.log(
        `‚ö†Ô∏è Could not load reward stats for config ${configId}:`,
        errorMessage
      );
      return null;
    }
  }

  // ===== OPTIMIZED: Main data loading with parallel fetch =====
  onMount(() => {
    isInitializing = true;
    eventsLoading = true;
    configsLoading = true;
    
    (async () => {
      try {
        // ‚úÖ OPTIMIZATION: Load all data in parallel
        const [holidaysResult, configsResult] = await Promise.allSettled([
          fetchHolidaysFromFile(),
          fetchRewardConfigs()
        ]);
        
        configsLoading = false;
        
        if (isDev) {
          console.log(`‚úÖ Loaded ${allHolidaysData?.length || 0} holidays`);
          console.log(`‚úÖ Loaded ${allRewardConfigs?.length || 0} reward configs`);
        }

        // ‚úÖ Fetch events after configs loaded (needed for mapping)
        await fetchEvents();
        eventsLoading = false;
        
      } catch (error: unknown) {
        const errorMessage = error instanceof Error ? error.message : "Unknown error";
        console.error("‚ùå OnMount error:", errorMessage);
        eventsLoading = false;
        configsLoading = false;
      } finally {
        isInitializing = false;
      }
    })();

    // ‚úÖ Event listener cleanup ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å async
    const handleClickOutside = (event: MouseEvent) => {
      const target = event.target as HTMLElement;
      if (
        !target.closest(".filter-dropdown-logs") &&
        !target.closest(".custom-date-dropdown-logs")
      ) {
        closeAllLogsDropdowns();
      }
    };

    document.addEventListener("click", handleClickOutside);

    // ‚úÖ Return cleanup function ‡∏ï‡∏≤‡∏°‡∏õ‡∏Å‡∏ï‡∏¥
    return () => {
      document.removeEventListener("click", handleClickOutside);
    };
  });

  async function exportRewards(format: string) {
    isRewardExporting = true;
    showRewardExportMenu = false;

    try {
      await new Promise((resolve) => setTimeout(resolve, 1000));

      const allRewardUsers = filteredRewardUsers;

      if (format === "csv") {
        exportRewardsToCSV(allRewardUsers);
      } else if (format === "json") {
        exportRewardsToJSON(allRewardUsers);
      } else if (format === "pdf") {
        exportRewardsToPDF(allRewardUsers);
      } else if (format === "excel") {
        await exportRewardsToExcel(allRewardUsers);
      } else if (format === "report-png") {
        await exportRewardsReportDirect("png");
      } else if (format === "report-pdf") {
        await exportRewardsReportDirect("pdf");
      }

      Swal.fire({
        title: "Export Successful!",
        text: `Rewards exported as ${format.toUpperCase()}`,
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
        timer: 2000,
      });
    } catch (error) {
      Swal.fire({
        title: "Export Failed",
        text: "Failed to export rewards. Please try again.",
        icon: "error",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#ef4444",
      });
    } finally {
      isRewardExporting = false;
    }
  }

  async function exportRewardsReportDirect(format: string) {
    if (!rewardData.selectedEvent) return;

    const event = rewardData.selectedEvent;
    const users = rewardData.users;

    const sortedTiers = [...(event.rewards || [])].sort((a, b) => {
      const reqA = a.rangeEnd || a.quota || 0;
      const reqB = b.rangeEnd || b.quota || 0;
      return reqB - reqA;
    });

    const totalUsers = users.length;
    const completedUsers = users.filter((u) => u.status === "completed").length;
    const inProgressUsers = users.filter(
      (u) => u.status === "in_progress"
    ).length;
    const noTierUsers = users.filter((u) => u.tier === "No Tier").length;
    const completionRate =
      totalUsers > 0 ? ((completedUsers / totalUsers) * 100).toFixed(1) : "0";
    const totalQuota = sortedTiers.reduce((sum, t) => sum + (t.quota || 0), 0);
    const fillRate =
      totalQuota > 0
        ? (((totalUsers - noTierUsers) / totalQuota) * 100).toFixed(1)
        : "0";

    const tierStats = sortedTiers.map((tier, index) => {
      const tierInfo = getTierDisplayName(tier.name, index);
      const usersInTier = users.filter((u) => u.tier === tier.name);
      const totalPoints = usersInTier.reduce(
        (sum, u) => sum + u.completedCount,
        0
      );
      return {
        name: tierInfo.name,
        color: tierInfo.color,
        count: usersInTier.length,
        quota: tier.quota || 0,
        fillRate:
          (tier.quota || 0) > 0
            ? ((usersInTier.length / (tier.quota || 1)) * 100).toFixed(1)
            : "0",
        avgPoints:
          usersInTier.length > 0
            ? Math.round(totalPoints / usersInTier.length)
            : 0,
        minPoints:
          usersInTier.length > 0
            ? Math.min(...usersInTier.map((u) => u.completedCount))
            : 0,
        maxPoints:
          usersInTier.length > 0
            ? Math.max(...usersInTier.map((u) => u.completedCount))
            : 0,
      };
    });

    const topPerformers = [...users]
      .sort((a, b) => a.globalRank - b.globalRank)
      .slice(0, 10)
      .map((user) => {
        const tierIdx = sortedTiers.findIndex((t) => t.name === user.tier);
        const tierInfo = getTierDisplayName(
          user.tier,
          tierIdx >= 0 ? tierIdx : 999
        );
        return {
          ...user,
          tierDisplayName: tierInfo.name,
          tierColor: tierInfo.color,
        };
      });

    // Status Data for Pie Chart
    const statusData = [
      { label: "Completed", value: completedUsers, color: "#10b981" },
      { label: "In Progress", value: inProgressUsers, color: "#f59e0b" },
      { label: "No Tier", value: noTierUsers, color: "#64748b" },
    ];

    // Quota Fill Rate Data for Doughnut
    const quotaFillData = [
      { label: "Filled", value: totalUsers - noTierUsers, color: "#10b981" },
      {
        label: "Remaining",
        value: Math.max(0, totalQuota - (totalUsers - noTierUsers)),
        color: "#e2e8f0",
      },
    ];

    // Points Distribution Data
    const pointsRanges = [
      { label: "0-25%", min: 0, max: 25, color: "#ef4444" },
      { label: "26-50%", min: 26, max: 50, color: "#f59e0b" },
      { label: "51-75%", min: 51, max: 75, color: "#3b82f6" },
      { label: "76-100%", min: 76, max: 100, color: "#10b981" },
    ];
    const maxPoints = Math.max(...users.map((u) => u.completedCount), 1);
    const pointsDistribution = pointsRanges.map((range) => {
      const count = users.filter((u) => {
        const percent = (u.completedCount / maxPoints) * 100;
        return percent >= range.min && percent <= range.max;
      }).length;
      return { label: range.label, value: count, color: range.color };
    });

    // LINE CHART DATA - Top 10 Performance Trend
    const top10ForLine = [...users]
      .sort((a, b) => a.globalRank - b.globalRank)
      .slice(0, 10);
    const performanceTrendData = {
      labels: top10ForLine.map((u, i) => `#${i + 1}`),
      points: top10ForLine.map((u) => u.completedCount),
      required: top10ForLine.map((u) => u.requiredCount),
    };

    // LINE CHART DATA - Tier Progress (Cumulative)
    const tierProgressData = {
      labels: [...tierStats].reverse().map((t) => t.name),
      cumulative: [...tierStats].reverse().reduce((acc: number[], t, i) => {
        acc.push((acc[i - 1] || 0) + t.count);
        return acc;
      }, []),
      quota: [...tierStats].reverse().reduce((acc: number[], t, i) => {
        acc.push((acc[i - 1] || 0) + t.quota);
        return acc;
      }, []),
    };

    // LINE CHART DATA - Points Range Analysis
    const sortedByPoints = [...users].sort(
      (a, b) => b.completedCount - a.completedCount
    );
    const pointsLineData = {
      labels: sortedByPoints.slice(0, 15).map((_, i) => `${i + 1}`),
      points: sortedByPoints.slice(0, 15).map((u) => u.completedCount),
    };

    let tierRowsHTML = "";
    tierStats.forEach((tier, idx) => {
      tierRowsHTML +=
        "<tr><td>" +
        (idx + 1) +
        '</td><td><span style="border-left:4px solid ' +
        tier.color +
        ';padding-left:8px">' +
        tier.name +
        "</span></td>";
      tierRowsHTML +=
        '<td class="text-right">' +
        tier.count +
        '</td><td class="text-right">' +
        tier.quota +
        '</td><td class="text-right">' +
        tier.fillRate +
        "%</td>";
      tierRowsHTML +=
        '<td class="text-right">' +
        tier.avgPoints +
        '</td><td class="text-right">' +
        tier.minPoints +
        " - " +
        tier.maxPoints +
        "</td></tr>";
    });

    let topRowsHTML = "";
    topPerformers.forEach((user) => {
      topRowsHTML +=
        '<tr><td class="text-center">' +
        user.globalRank +
        "</td><td>" +
        user.name +
        "</td><td>" +
        user.email +
        "</td>";
      topRowsHTML +=
        '<td><span style="border-left:4px solid ' +
        user.tierColor +
        ';padding-left:8px">' +
        user.tierDisplayName +
        "</span></td>";
      topRowsHTML +=
        '<td class="text-center">' +
        user.tierRank +
        '</td><td class="text-right">' +
        user.completedCount +
        "</td></tr>";
    });

    const eventDateRange = formatDateRange(event, currentLang);
    const generatedDate = new Date().toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
    const generatedTime = new Date().toLocaleTimeString("en-US", {
      hour: "2-digit",
      minute: "2-digit",
    });
    const fileName =
      "reward-report-" +
      event.title.replace(/\s+/g, "-").toLowerCase() +
      "-" +
      new Date().toISOString().split("T")[0];

    const css =
      "@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');:root{--primary:#0f766e;--primary-light:#14b8a6;--secondary:#1e293b;--bg:#fff;--bg-alt:#f8fafc;--border:#e2e8f0;--text:#1e293b;--text-muted:#64748b}*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;font-size:14px}.container{max-width:1100px;margin:0 auto;padding:40px}.report-header{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:24px;border-bottom:2px solid var(--primary);margin-bottom:32px}.brand{display:flex;align-items:center;gap:12px}.brand-logo{width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:10px;display:flex;align-items:center;justify-content:center}.brand-logo svg{width:28px;height:28px;color:white}.brand-text h1{font-size:20px;font-weight:700;color:var(--primary)}.brand-text p{font-size:12px;color:var(--text-muted)}.report-meta{text-align:right}.report-meta h2{font-size:14px;font-weight:600}.report-meta p{font-size:12px;color:var(--text-muted)}.event-title{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:32px}.event-title h3{font-size:24px;font-weight:700;color:var(--secondary);margin-bottom:8px}.event-info{display:flex;flex-wrap:wrap;gap:24px;color:var(--text-muted);font-size:13px}.section{margin-bottom:32px}.section-title{font-size:16px;font-weight:600;color:var(--secondary);margin-bottom:16px}.stats-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px}.stat-card{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center}.stat-card.highlight{background:linear-gradient(135deg,var(--primary),var(--primary-light));border:none;color:white}.stat-card.highlight .stat-label{color:rgba(255,255,255,0.8)}.stat-value{font-size:28px;font-weight:700;margin-bottom:4px}.stat-label{font-size:12px;color:var(--text-muted);text-transform:uppercase}.charts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}.charts-grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:24px;margin-top:24px}.chart-card{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:20px}.chart-card.full-width{grid-column:span 2}.chart-title{font-size:14px;font-weight:600;color:var(--secondary);margin-bottom:16px}.chart-container{height:220px;position:relative}.chart-container.tall{height:280px}.table-wrapper{overflow-x:auto}table{width:100%;border-collapse:collapse;font-size:13px}th,td{padding:12px;text-align:left;border-bottom:1px solid var(--border)}th{background:var(--bg-alt);font-weight:600;color:var(--secondary)}.text-center{text-align:center}.text-right{text-align:right}.report-footer{margin-top:40px;padding-top:20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:12px;color:var(--text-muted)}";

    const chartJs = `
      const tierData=${JSON.stringify(tierStats)};
      const statusData=${JSON.stringify(statusData)};
      const quotaFillData=${JSON.stringify(quotaFillData)};
      const pointsDistribution=${JSON.stringify(pointsDistribution)};
      const topData=${JSON.stringify(topPerformers.slice(0, 5).map((u) => ({ name: u.name, points: u.completedCount, color: u.tierColor })))};
      const performanceTrendData=${JSON.stringify(performanceTrendData)};
      const tierProgressData=${JSON.stringify(tierProgressData)};
      const pointsLineData=${JSON.stringify(pointsLineData)};
      
      Chart.defaults.font.family="'Inter',sans-serif";
      
      // 1. Tier Distribution - Doughnut
      new Chart(document.getElementById('tierPieChart'),{
        type:'doughnut',
        data:{
          labels:tierData.map(t=>t.name),
          datasets:[{data:tierData.map(t=>t.count),backgroundColor:tierData.map(t=>t.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 2. Completion Status - Pie
      new Chart(document.getElementById('statusChart'),{
        type:'pie',
        data:{
          labels:statusData.map(s=>s.label),
          datasets:[{data:statusData.map(s=>s.value),backgroundColor:statusData.map(s=>s.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 3. Quota Fill Rate - Doughnut
      new Chart(document.getElementById('quotaFillChart'),{
        type:'doughnut',
        data:{
          labels:quotaFillData.map(q=>q.label),
          datasets:[{data:quotaFillData.map(q=>q.value),backgroundColor:quotaFillData.map(q=>q.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 4. Tier Capacity - Bar
      new Chart(document.getElementById('tierBarChart'),{
        type:'bar',
        data:{
          labels:tierData.map(t=>t.name),
          datasets:[
            {label:'Participants',data:tierData.map(t=>t.count),backgroundColor:tierData.map(t=>t.color),borderRadius:4},
            {label:'Quota',data:tierData.map(t=>t.quota),backgroundColor:'#e2e8f0',borderRadius:4}
          ]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom'}},scales:{y:{beginAtZero:true}}}
      });
      
      // 5. Points Distribution - Pie
      new Chart(document.getElementById('pointsDistChart'),{
        type:'pie',
        data:{
          labels:pointsDistribution.map(p=>p.label),
          datasets:[{data:pointsDistribution.map(p=>p.value),backgroundColor:pointsDistribution.map(p=>p.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 6. Top Performers - Horizontal Bar
      new Chart(document.getElementById('topPerformersChart'),{
        type:'bar',
        data:{
          labels:topData.map(t=>t.name.split(' ')[0]),
          datasets:[{label:'Points',data:topData.map(t=>t.points),backgroundColor:topData.map(t=>t.color),borderRadius:4}]
        },
        options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}}}
      });
      
      // 7. TOP 10 Performance Trend - LINE CHART
      new Chart(document.getElementById('performanceLineChart'),{
        type:'line',
        data:{
          labels:performanceTrendData.labels,
          datasets:[
            {
              label:'Points Achieved',
              data:performanceTrendData.points,
              borderColor:'#10b981',
              backgroundColor:'rgba(16,185,129,0.1)',
              fill:true,
              tension:0.4,
              pointBackgroundColor:'#10b981',
              pointBorderColor:'#fff',
              pointBorderWidth:2,
              pointRadius:5
            },
            {
              label:'Required Points',
              data:performanceTrendData.required,
              borderColor:'#f59e0b',
              backgroundColor:'transparent',
              borderDash:[5,5],
              tension:0.4,
              pointBackgroundColor:'#f59e0b',
              pointRadius:3
            }
          ]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{position:'bottom'}},
          scales:{
            y:{beginAtZero:true,grid:{color:'#f1f5f9'}},
            x:{grid:{display:false}}
          }
        }
      });
      
      // 8. Tier Progress Cumulative - LINE CHART
      new Chart(document.getElementById('tierProgressLineChart'),{
        type:'line',
        data:{
          labels:tierProgressData.labels,
          datasets:[
            {
              label:'Cumulative Participants',
              data:tierProgressData.cumulative,
              borderColor:'#3b82f6',
              backgroundColor:'rgba(59,130,246,0.1)',
              fill:true,
              tension:0.4,
              pointBackgroundColor:'#3b82f6',
              pointBorderColor:'#fff',
              pointBorderWidth:2,
              pointRadius:5
            },
            {
              label:'Cumulative Quota',
              data:tierProgressData.quota,
              borderColor:'#64748b',
              backgroundColor:'transparent',
              borderDash:[5,5],
              tension:0.4,
              pointBackgroundColor:'#64748b',
              pointRadius:3
            }
          ]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{position:'bottom'}},
          scales:{
            y:{beginAtZero:true,grid:{color:'#f1f5f9'}},
            x:{grid:{display:false}}
          }
        }
      });
      
      // 9. Points Ranking Curve - LINE CHART
      new Chart(document.getElementById('pointsRankingLineChart'),{
        type:'line',
        data:{
          labels:pointsLineData.labels,
          datasets:[{
            label:'Points by Rank',
            data:pointsLineData.points,
            borderColor:'#8b5cf6',
            backgroundColor:'rgba(139,92,246,0.1)',
            fill:true,
            tension:0.3,
            pointBackgroundColor:'#8b5cf6',
            pointBorderColor:'#fff',
            pointBorderWidth:2,
            pointRadius:4
          }]
        },
        options:{
          responsive:true,
          maintainAspectRatio:false,
          plugins:{legend:{display:false}},
          scales:{
            y:{beginAtZero:true,grid:{color:'#f1f5f9'},title:{display:true,text:'Points'}},
            x:{grid:{display:false},title:{display:true,text:'Rank'}}
          }
        }
      });
    `;

    const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Reward Report - ${event.title}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"><\/script>
    <style>${css}</style></head><body><div class="container">
    <header class="report-header">
      <div class="brand">
        <div class="brand-logo"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg></div>
        <div class="brand-text"><h1>Reward Management</h1><p>Event Analytics Report</p></div>
      </div>
      <div class="report-meta"><h2>Analysis Report</h2><p>Generated: ${generatedDate}</p><p>Time: ${generatedTime}</p></div>
    </header>
    
    <div class="event-title"><h3>${event.title}</h3><div class="event-info"><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>${event.location}</span><span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>${eventDateRange}</span></div></div>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Executive Summary</h4>
      <div class="stats-grid">
        <div class="stat-card highlight"><div class="stat-value">${totalUsers}</div><div class="stat-label">Total Participants</div></div>
        <div class="stat-card"><div class="stat-value">${completedUsers}</div><div class="stat-label">Completed</div></div>
        <div class="stat-card"><div class="stat-value">${inProgressUsers}</div><div class="stat-label">In Progress</div></div>
        <div class="stat-card"><div class="stat-value">${completionRate}%</div><div class="stat-label">Completion Rate</div></div>
        <div class="stat-card"><div class="stat-value">${fillRate}%</div><div class="stat-label">Quota Fill Rate</div></div>
      </div>
    </section>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>Distribution Charts</h4>
      <div class="charts-grid">
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#3b82f6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Tier Distribution</div><div class="chart-container"><canvas id="tierPieChart"></canvas></div></div>
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#10b981"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Completion Status</div><div class="chart-container"><canvas id="statusChart"></canvas></div></div>
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#8b5cf6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path></svg>Quota Fill Rate</div><div class="chart-container"><canvas id="quotaFillChart"></canvas></div></div>
      </div>
    </section>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>Trend Analysis (Line Charts)</h4>
      <div class="charts-grid-2">
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#f59e0b"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg>Top 10 Performance vs Required</div><div class="chart-container tall"><canvas id="performanceLineChart"></canvas></div></div>
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#3b82f6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>Cumulative Tier Progress</div><div class="chart-container tall"><canvas id="tierProgressLineChart"></canvas></div></div>
      </div>
      <div class="charts-grid-2">
        <div class="chart-card full-width"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#ef4444"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path></svg>Points Ranking Curve (Top 15)</div><div class="chart-container tall"><canvas id="pointsRankingLineChart"></canvas></div></div>
      </div>
    </section>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Comparison Charts</h4>
      <div class="charts-grid-2">
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#06b6d4"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>Tier Capacity Analysis</div><div class="chart-container"><canvas id="tierBarChart"></canvas></div></div>
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#8b5cf6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>Points Distribution</div><div class="chart-container"><canvas id="pointsDistChart"></canvas></div></div>
      </div>
      <div class="charts-grid-2">
        <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#f59e0b"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path></svg>Top 5 Performers</div><div class="chart-container"><canvas id="topPerformersChart"></canvas></div></div>
      </div>
    </section>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>Tier Analysis Table</h4>
      <div class="table-wrapper"><table><thead><tr><th>#</th><th>Tier</th><th class="text-right">Participants</th><th class="text-right">Quota</th><th class="text-right">Fill Rate</th><th class="text-right">Avg Points</th><th class="text-right">Range</th></tr></thead><tbody>${tierRowsHTML}</tbody></table></div>
    </section>
    
    <section class="section">
      <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path></svg>Top 10 Performers</h4>
      <div class="table-wrapper"><table><thead><tr><th class="text-center">Rank</th><th>Name</th><th>Email</th><th>Tier</th><th class="text-center">Tier Rank</th><th class="text-right">Points</th></tr></thead><tbody>${topRowsHTML}</tbody></table></div>
    </section>
    
    <footer class="report-footer"><span>Reward Management System - Confidential</span><span>Page 1 of 1</span></footer>
    </div><script>${chartJs}<\/script></body></html>`;

    const iframe = document.createElement("iframe");
    iframe.style.cssText =
      "position:fixed;left:-9999px;width:1200px;height:4000px";
    document.body.appendChild(iframe);
    const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
    if (!iframeDoc) {
      document.body.removeChild(iframe);
      return;
    }
    iframeDoc.open();
    iframeDoc.write(html);
    iframeDoc.close();

    await new Promise((r) => setTimeout(r, 3500));

    try {
      // ‡πÇ‡∏´‡∏•‡∏î html2canvas
      // @ts-ignore
      if (typeof window.html2canvas === "undefined") {
        await new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src =
            "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
          s.onload = resolve;
          s.onerror = reject;
          document.head.appendChild(s);
        });
      }

      // ‡πÇ‡∏´‡∏•‡∏î jspdf
      // @ts-ignore
      if (typeof window.jspdf === "undefined") {
        await new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src =
            "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
          s.onload = resolve;
          s.onerror = reject;
          document.head.appendChild(s);
        });
      }

      await new Promise((r) => setTimeout(r, 500));

      const container = iframeDoc.querySelector(".container");
      if (!container) throw new Error("Container not found");
      // @ts-ignore
      const canvas = await window.html2canvas(container, {
        scale: 2,
        useCORS: true,
        logging: false,
        backgroundColor: "#ffffff",
      });

      if (format === "png") {
        const link = document.createElement("a");
        link.download = fileName + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      } else {
        // @ts-ignore
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");
        const w = 210,
          h = (canvas.height * w) / canvas.width;
        let position = 0;
        const pageHeight = 297;

        if (h > pageHeight) {
          while (position < h) {
            if (position > 0) pdf.addPage();
            pdf.addImage(
              canvas.toDataURL("image/png"),
              "PNG",
              0,
              -position,
              w,
              h
            );
            position += pageHeight;
          }
        } else {
          pdf.addImage(canvas.toDataURL("image/png"), "PNG", 0, 0, w, h);
        }
        pdf.save(fileName + ".pdf");
      }
      Swal.fire({
        title: "Downloaded!",
        text: format.toUpperCase() + " saved.",
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
    } catch (e) {
      console.error(e);
      window.open(
        URL.createObjectURL(new Blob([html], { type: "text/html" })),
        "_blank"
      );
      Swal.fire({
        title: "Report Generated!",
        text: "Use browser save.",
        icon: "info",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
    } finally {
      document.body.removeChild(iframe);
    }
    showRewardExportMenu = false;
  }

  function exportRewardsToCSV(users: RewardUser[]) {
    // Ensure stable ordering by Global Rank (ascending)
    const sorted = [...users].sort((a, b) => {
      const ra = Number(a.globalRank) || Number.MAX_SAFE_INTEGER;
      const rb = Number(b.globalRank) || Number.MAX_SAFE_INTEGER;
      return ra - rb;
    });

    const headers = [
      "Global Rank",
      "Tier Rank",
      "Nisit ID",
      "User ID",
      "Participation ID",
      "Name",
      "Email",
      "Tier",
      "Progress",
      "Required",
      "Status",
      "Completed At",
      "Join Code",
      "Strava Link",
      "Distance (km)",
      "Proof Image URL",
    ];

    const rows = sorted.map((user) => [
      user.globalRank ?? "",
      user.tierRank ?? "",
      user.nisitId ?? "",
      user.userId ?? "",
      user.participationId ?? "",
      user.name ?? "",
      user.email ?? "",
      user.tier ?? "",
      user.completedCount ?? "",
      user.requiredCount ?? "",
      user.status ?? "",
      user.completedAt ?? "",
      user.joinCode ?? "",
      // extra dynamic fields if present on RewardUser
      (user as any).stravaLink ?? "",
      ((user as any).distance || (user as any).actual_distance_km) ?? "",
      (user as any).proofImage ?? "",
    ]);

    // Add UTF-8 BOM so Excel opens CSV with correct encoding
    let csvContent = "\uFEFF" + headers.join(",") + "\n";
    rows.forEach((row) => {
      csvContent += row
        .map((cell) => {
          if (cell === null || cell === undefined) return '""';
          const value = String(cell).replace(/"/g, '""');
          return `"${value}"`;
        })
        .join(",") + "\n";
    });

    downloadFile(csvContent, "rewards-export.csv", "text/csv;charset=utf-8;");
  }

  function exportRewardsToJSON(users: RewardUser[]) {
    const jsonContent = JSON.stringify(users, null, 2);
    downloadFile(jsonContent, "rewards-export.json", "application/json");
  }

  function exportRewardsToPDF(users: RewardUser[]) {
    let pdfContent = `Rewards Report - ${rewardData.selectedEvent?.title || "Event"}\n\n`;
    users.forEach((user) => {
      pdfContent += `Rank: ${user.globalRank}\n`;
      pdfContent += `Name: ${user.name} (${user.email})\n`;
      pdfContent += `Tier: ${user.tier}\n`;
      pdfContent += `Progress: ${user.completedCount}/${user.requiredCount}\n`;
      pdfContent += `Status: ${user.status}\n`;
      pdfContent += `---\n\n`;
    });
    downloadFile(pdfContent, "rewards-export.txt", "text/plain");
  }

  let allSavedHolidays = [];

  // ‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á loadHolidays ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß - ‡πÉ‡∏ä‡πâ API ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ event
  async function loadHolidays() {
    // Deprecated - holidays are now per-event via API
    console.log("üìù Holidays are now loaded per-event from API");
  }

  interface RewardForm {
    name: string;
    requirement: number | null;  // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πà‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
    tier?: number;
    reward_id?: number;
  }

  interface CreateEventForm {
    title: string;
    description: string;
    location: string;
    sDay: string;
    sMonth: string;
    sYear: string;
    eDay: string;
    eMonth: string;
    eYear: string;
    startTime: string;
    endTime: string;
    totalSlots: number | null;
    distanceKm: number | null;
    holidays: string[];
    excludeWeekends: boolean;
    holidayType: "none" | "thai" | "specific" | "weekends"; // ‚úÖ Added: holiday type selection
    specificDates: string[]; // ‚úÖ Added: specific dates for holidays
    tempHoliday: string;
    totalRewards: number | null; // max_reward_recipients
    requiredCompletions: number | null; // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πà‡∏á
    rewards: RewardForm[];
    isPublic: boolean;
    isActive: boolean;
    imagePreview: string | null;
    // Event Type fields
    eventType: "single_day" | "multi_day";
    allowDailyCheckin: boolean;
    maxCheckinsPerUser: number;
    rewardTiers?: any[];
  }

  interface AppEvent {
      id: number;
      title: string;
      description?: string;
      image: string;
      location: string;
      finalized_at?: string | null;
      // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
      startDate?: {
        day: string;
        month: string;
        year: string;
      };
      endDate?: {
        day: string;
        month: string;
        year: string;
      };

    // ‡πÄ‡∏ß‡∏•‡∏≤
    startTime?: string;
    endTime?: string;

    // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    totalSlots?: number;
    usedSlots?: number;
    distanceKm?: number;
    totalRewards?: number;

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÄ‡∏î‡∏¥‡∏°
    rewards?: Array<{
      quota?: number | null;
      rangeStart?: number;
      rangeEnd?: number | null;
      name: string;
      requirement?: number | null;
      tier?: number;
      reward_id?: number;
      // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
      required_completions?: number;
      max_reward_recipients?: number;
      description?: string;
      reward_tiers?: Array<{
        tier: number;
        min_rank: number;
        max_rank: number;
        reward_id: number;
        reward_name: string;
        quantity: number;
      }>;
    }>;

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡∏°‡πà (‡∏£‡∏∞‡∏î‡∏±‡∏ö event)
    reward_tiers?: Array<{
      tier: number;
      min_rank: number;
      max_rank: number;
      reward_id: number;
      reward_name: string;
      quantity: number;
    }>;
    required_completions?: number;
    max_reward_recipients?: number;
    name?: string;

    rewardConfigId?: number;

    // Holidays
    holidays?: string[];
    excludeWeekends?: boolean;

    // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    isPublic?: boolean;
    isActive?: boolean;
    is_published?: boolean;
    is_active?: boolean;
    status: string;

    pendingCount?: number;
    month: string;
    year: string;
  }

  interface Log {
    id: string;
    eventId: string;
    eventTitle: string;
    userId: string;
    userName: string;
    userEmail: string;
    userAvatar: string;
    userNisitId?: string;
    participationId?: number; // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á proof ‡∏à‡∏≤‡∏Å API
    action: string;
    timestamp: string;
    status: string;
    details?: any;
    metadata?: any;
    proofImage?: string | null;
    fetchedAt?: string;
  }

  interface LogsData {
    selectedEvent: AppEvent | null;
    logs: Log[];
    loading: boolean;
    error: string;
    searchQuery: string;
    selectedAction: string;
    selectedStatus: string;
    dateFrom: string;
    dateTo: string;
    currentPage: number;
    itemsPerPage: number;
    totalItems: number;
    totalPages: number;

    // ‡∏™‡πà‡∏ß‡∏ô UI Controls
    actionDropdownOpen: boolean;
    statusDropdownOpen: boolean;
    dateFromDropdownOpen: boolean;
    dateToDropdownOpen: boolean;
    showDetailModal: boolean;
    selectedLog: Log | null;
    statistics: LogStatistics;

    stats?: {
      total: number;
      by_status: Record<string, number>;
      by_role: Record<string, number>;
    };
    
    eventStats?: {
      total: number;
      by_status: Record<string, number>;
      by_role: Record<string, number>;
      quickStats?: any;
      activeParticipants?: number;
    };
  }

  interface LogStatistics {
    totalLogs: number;
    uniqueUsers: number;
    successRate: number;
    topAction: string;
    // ‡πÄ‡∏û‡∏¥‡πà‡∏° properties ‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
    totalRegistrations?: number;
    totalCheckIns?: number;
    totalRewards?: number;
    totalCancelled?: number;
  }

  interface TimelineItem {
    timestamp: string;
    action: string;
    userName: string;
    status: string;
    details: string;
  }
  // --- Configuration ---
  const searchEnabledViews = ["list", "verify-proof", "log", "reward"];

  let currentView = "list";
  let isMobileMenuOpen = false;

  let showPageDropdown = false;
  let showExportMenu = false;
  let showTimelineModal = false;
  let exportFormat = "csv";
  let isExporting = false;
  let showLogsPageDropdown = false;
  let showLogsExportMenu = false;
  let showEventsForLogsPageDropdown = false;

  // WebSocket States
  let ws: WebSocket | null = null;
  let isConnected = false;
  let newLogsCount = 0;
  let autoRefreshEnabled = true;
  let isEventListView = false;
  let logsNisitYearFilter: string = "";
  let logsNisitIdFilter: string = "";

  // Mock Data
  let events: AppEvent[] = [];

  let allHolidaysData: any[] = [];
  let allRewardConfigs: any[] = [];
  let nextEventId = 9;

  let timerInterval: any;

  let showSearchSection = false;
  // Search & Filter States
  let searchQuery = "";
  let selectedYear = "All";
  let selectedMonth = "All";
  let monthOpen = false;
  let yearOpen = false;

  // Search & Filter States - ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤
  let searchQueryEventList = "";
  let searchQueryVerifyProof = "";
  let searchQueryLogs = "";
  let searchQueryReward = "";

  // Filter States - ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤
  let selectedYearEventList = "All";
  let selectedMonthEventList = "All";

  let selectedYearVerifyProof = "All";
  let selectedMonthVerifyProof = "All";

  let selectedYearLogs = "All";
  let selectedMonthLogs = "All";

  let selectedYearReward = "All";
  let selectedMonthReward = "All";

  // Dropdown States - ‡πÅ‡∏¢‡∏Å‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤
  let monthOpenEventList = false;
  let yearOpenEventList = false;

  let monthOpenVerifyProof = false;
  let yearOpenVerifyProof = false;

  let monthOpenLogs = false;
  let yearOpenLogs = false;

  let monthOpenReward = false;
  let yearOpenReward = false;

  // Pagination States
  let currentPage = 1;
  const itemsPerPage = 8;

  const years = [
    "All",
    "2023",
    "2024",
    "2025",
    "2026",
    "2027",
    "2028",
    "2029",
    "2030",
  ];
  const months = [
    "All",
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December",
  ];

  $: menuItems = [
    {
      id: "list",
      label: lang.events,
      svg: "M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01",
    },
    { id: "create", label: lang.createEvent, svg: "M12 4v16m8-8H4" },
    {
      id: "verify-code",
      label: lang.verifyCode,
      svg: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
    },
    {
      id: "verify-proof",
      label: lang.verifyProof,
      svg: "M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",
    },
    {
      id: "unlock",
      label: lang.unlock,
      svg: "M8 11V7a4 4 0 118 0m-4 8v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2z",
    },
    {
      id: "log",
      label: lang.logs,
      svg: "M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z",
    },
    {
      id: "reward",
      label: lang.rewards,
      svg: "M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V6a2 2 0 10-2 2h2zm0 0h4l-4 4-4-4h4z",
    },
    {
      id: "settings",
      label: lang.settings,
      svg: "M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z",
    },
  ];

  $: currentSearchQuery =
    currentView === "list"
      ? searchQueryEventList
      : currentView === "verify-proof"
        ? searchQueryVerifyProof
        : currentView === "log"
          ? searchQueryLogs
          : currentView === "reward"
            ? searchQueryReward
            : "";

  $: currentSelectedMonth =
    currentView === "list"
      ? selectedMonthEventList
      : currentView === "verify-proof"
        ? selectedMonthVerifyProof
        : currentView === "log"
          ? selectedMonthLogs
          : currentView === "reward"
            ? selectedMonthReward
            : "All";

  $: currentSelectedYear =
    currentView === "list"
      ? selectedYearEventList
      : currentView === "verify-proof"
        ? selectedYearVerifyProof
        : currentView === "log"
          ? selectedYearLogs
          : currentView === "reward"
            ? selectedYearReward
            : "All";

  $: currentMonthOpen =
    currentView === "list"
      ? monthOpenEventList
      : currentView === "verify-proof"
        ? monthOpenVerifyProof
        : currentView === "log"
          ? monthOpenLogs
          : currentView === "reward"
            ? monthOpenReward
            : false;

  $: currentYearOpen =
    currentView === "list"
      ? yearOpenEventList
      : currentView === "verify-proof"
        ? yearOpenVerifyProof
        : currentView === "log"
          ? yearOpenLogs
          : currentView === "reward"
            ? yearOpenReward
            : false;

  function toggleCurrentMonthDropdown() {
    if (currentView === "list") {
      monthOpenEventList = !monthOpenEventList;
      yearOpenEventList = false;
    } else if (currentView === "verify-proof") {
      monthOpenVerifyProof = !monthOpenVerifyProof;
      yearOpenVerifyProof = false;
    } else if (currentView === "log") {
      monthOpenLogs = !monthOpenLogs;
      yearOpenLogs = false;
    } else if (currentView === "reward") {
      monthOpenReward = !monthOpenReward;
      yearOpenReward = false;
    }
  }

  function parseAPIDate(dateStr: string) {
    const d = new Date(dateStr);
    return {
      day: d.getDate().toString(),
      month: (d.getMonth() + 1).toString(),
      year: d.getFullYear().toString(),
    };
  }

  async function refreshData() {
    const token = localStorage.getItem("access_token");

    if (!token) {
      console.error("No token found");
      return;
    }

    try {
      // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° /ku-run prefix
      const res = await fetch(`${API_BASE_URL}/ku-run/api/events/`, {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`,
        },
      });

      if (res.status === 401) {
        console.error("Token expired or invalid");
        localStorage.removeItem("access_token");
        // ‚úÖ ‡πÅ‡∏Å‡πâ redirect URL
        window.location.href = "/ku-run/auth/login";
        return;
      }

      if (!res.ok) {
        console.error("Failed to fetch events:", res.status);
        return;
      }

      const data: any = await res.json();

      // ‚úÖ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á holidays ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON ‡πÅ‡∏•‡πâ‡∏ß - ‡∏à‡∏∞‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ event ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
      console.log("üì• Refreshed events from API:", data);

      // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å API ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö AppEvent interface
      // ‡πÅ‡∏•‡∏∞‡∏î‡∏∂‡∏á holidays ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ event (parallel)
      const eventsWithHolidays = await Promise.all(
        data.map(async (item: any) => {
          const startDate = new Date(item.event_date);
          const endDate = new Date(item.event_end_date);
          
          // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á UTC ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û (+7 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
          const bangkokOffset = 7 * 60 * 60 * 1000;
          const startBangkok = new Date(startDate.getTime() + bangkokOffset);
          const endBangkok = new Date(endDate.getTime() + bangkokOffset);
          
          const isPublished = item.is_published === true;
          const isActive = item.is_active === true;
          const imageUrl = processImageUrl(item.banner_image_url);

          // ‚úÖ ‡∏î‡∏∂‡∏á holidays ‡∏à‡∏≤‡∏Å API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö event ‡∏ô‡∏µ‡πâ
          let eventHolidays: string[] = [];
          try {
            const holidaysRes = await api.get(`/api/events/${item.id}/holidays`);
            // ‚úÖ FIX: Axios response - ‡πÉ‡∏ä‡πâ res.status ‡πÅ‡∏•‡∏∞ res.data
            if (holidaysRes.status === 200) {
              const holidaysData = Array.isArray(holidaysRes.data) ? holidaysRes.data : [];
              // API ‡∏Ñ‡∏∑‡∏ô array ‡∏Ç‡∏≠‡∏á {holiday_date, holiday_name, ...}
              eventHolidays = holidaysData.map((h: any) => h.holiday_date);
            }
          } catch (err) {
            console.warn(`‚ö†Ô∏è Failed to fetch holidays for event ${item.id}:`, err);
          }

          return {
          id: item.id,
          title: item.title,
          description: item.description,
          location: item.location,

          // Date fields - ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û
          day: startBangkok.getUTCDate().toString(),
          month: ce_months[startBangkok.getUTCMonth()],
          year: startBangkok.getUTCFullYear().toString(),
          endDay: endBangkok.getUTCDate().toString(),
          endMonth: ce_months[endBangkok.getUTCMonth()],
          endYear: endBangkok.getUTCFullYear().toString(),

          // Time fields - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û
          startTime: `${String(startBangkok.getUTCHours()).padStart(2, '0')}:${String(startBangkok.getUTCMinutes()).padStart(2, '0')}`,
          endTime: `${String(endBangkok.getUTCHours()).padStart(2, '0')}:${String(endBangkok.getUTCMinutes()).padStart(2, '0')}`,

          // Capacity
          slots: item.max_participants,
          totalSlots: item.max_participants,
          usedSlots: item.participant_count || 0,
          distanceKm: item.distance_km || 0,

          // Status - ‚úÖ FIXED: ‡πÉ‡∏ä‡πâ logic ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö getEventStatus
          status:
            isPublished && isActive
              ? "Active"
              : !isPublished && !isActive
                ? "Draft"
                : isPublished && !isActive
                  ? "Closed"
                  : "Private",
          is_published: isPublished,
          is_active: isActive,
          isPublic: isPublished,
          isActive: isActive,

          // Other
          image: imageUrl,
          rewards: item.rewards || [],
          holidays: eventHolidays,
          excludeWeekends: item.exclude_weekends || false,
        };
        })
      );

      events = eventsWithHolidays;
      fetchUniqueParticipantCounts(); // ‡∏î‡∏∂‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥

      console.log("‚úÖ Events refreshed:", events.length);
    } catch (err) {
      console.error("Error fetching data:", err);
    }
  }

  function toggleSearchSection() {
    showSearchSection = !showSearchSection;
    if (!showSearchSection) {
      // Reset filters when closing
      if (currentView === "list") {
        searchQueryEventList = "";
        selectedYearEventList = "All";
        selectedMonthEventList = "All";
      } else if (currentView === "log" && !logsData.selectedEvent) {
        searchQueryLogs = "";
        selectedYearLogs = "All";
        selectedMonthLogs = "All";
      } else if (currentView === "reward" && !rewardData.selectedEvent) {
        searchQueryReward = "";
        selectedYearReward = "All";
        selectedMonthReward = "All";
      }
    }
  }

  function toggleCurrentYearDropdown() {
    if (currentView === "list") {
      yearOpenEventList = !yearOpenEventList;
      monthOpenEventList = false;
    } else if (currentView === "verify-proof") {
      yearOpenVerifyProof = !yearOpenVerifyProof;
      monthOpenVerifyProof = false;
    } else if (currentView === "log") {
      yearOpenLogs = !yearOpenLogs;
      monthOpenLogs = false;
    } else if (currentView === "reward") {
      yearOpenReward = !yearOpenReward;
      monthOpenReward = false;
    }
  }

  function selectCurrentMonth(month: string) {
    if (currentView === "list") {
      selectedMonthEventList = month;
      monthOpenEventList = false;
    } else if (currentView === "verify-proof") {
      selectedMonthVerifyProof = month;
      monthOpenVerifyProof = false;
    } else if (currentView === "log") {
      selectedMonthLogs = month;
      monthOpenLogs = false;
    } else if (currentView === "reward") {
      selectedMonthReward = month;
      monthOpenReward = false;
    }
  }

  function selectCurrentYear(year: string) {
    if (currentView === "list") {
      selectedYearEventList = year;
      yearOpenEventList = false;
    } else if (currentView === "verify-proof") {
      selectedYearVerifyProof = year;
      yearOpenVerifyProof = false;
    } else if (currentView === "log") {
      selectedYearLogs = year;
      yearOpenLogs = false;
    } else if (currentView === "reward") {
      selectedYearReward = year;
      yearOpenReward = false;
    }
  }

  function handleSearch() {
    // Search ‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏° currentView
    if (currentView === "list") {
      currentPage = 1;
    } else if (currentView === "log" && !logsData.selectedEvent) {
      eventsForLogsPage = 1;
    } else if (currentView === "reward" && !rewardData.selectedEvent) {
      rewardEventsPage = 1;
    }
  }

  // Logic Checks
  // Logic Checks
  $: isSearchableView = searchEnabledViews.includes(currentView);

  $: searchPlaceholder =
    currentView === "list"
      ? "Search events..."
      : currentView === "log" && !logsData.selectedEvent
        ? "Search events..."
        : currentView === "log" && logsData.selectedEvent
          ? "Search by name or email..."
          : currentView === "reward" && !rewardData.selectedEvent
            ? "Search events..."
            : "Search name...";

  $: canSearch =
    currentView === "list" ||
    (currentView === "log" && !logsData.selectedEvent) ||
    (currentView === "reward" && !rewardData.selectedEvent);

  // ‚úÖ FIXED: ‡πÄ‡∏û‡∏¥‡πà‡∏° parameter _lang ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ Svelte ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏•‡∏∞ re-render
  // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á currentLang ‡πÄ‡∏õ‡πá‡∏ô argument: formatDateRange(event, currentLang)
  function formatDateRange(event: AppEvent, _lang?: Language): string {
    // ‡πÉ‡∏ä‡πâ currentLang ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô (parameter _lang ‡πÅ‡∏Ñ‡πà trigger reactivity)
    const activeLang = currentLang;

    // Helper function ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ ‡∏Ñ.‡∏®. ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®. (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢)
    const formatYear = (year: string | number): string => {
      const yearNum = typeof year === "string" ? parseInt(year) : year;
      if (activeLang === "th") {
        return String(yearNum + 543); // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®.
      }
      return String(yearNum); // ‡∏Ñ.‡∏®. ‡πÄ‡∏î‡∏¥‡∏°
    };

    if (event.startDate && event.endDate) {
      const { day: sDay, month: sMonth, year: sYear } = event.startDate;
      const { day: eDay, month: eMonth, year: eYear } = event.endDate;

      const sMonthT = translateMonth(sMonth);
      const eMonthT = translateMonth(eMonth);
      const sYearF = formatYear(sYear);
      const eYearF = formatYear(eYear);

      // ‡∏ñ‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
      if (sDay === eDay && sMonth === eMonth && sYear === eYear) {
        return `${sDay} ${sMonthT} ${sYearF}`;
      }

      // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
      if (sMonth === eMonth && sYear === eYear) {
        return `${sDay}-${eDay} ${sMonthT} ${sYearF}`;
      }

      // ‡∏ñ‡πâ‡∏≤‡∏õ‡∏µ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÅ‡∏ï‡πà‡∏ï‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      if (sYear === eYear) {
        return `${sDay} ${sMonthT} - ${eDay} ${eMonthT} ${sYearF}`;
      }

      // ‡∏ñ‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏µ
      return `${sDay} ${sMonthT} ${sYearF} - ${eDay} ${eMonthT} ${eYearF}`;
    }

    // Fallback: ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤
    const yearF =
      activeLang === "th" ? String(parseInt(event.year) + 543) : event.year;
    return `${translateMonth(event.month)} ${yearF}`;
  }

  function getNextHoliday(
    event: AppEvent
  ): { date: string; display: string } | null {
    if (!event.holidays || event.holidays.length === 0) return null;

    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // ‡∏´‡∏≤‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ
    const upcomingHolidays = event.holidays
      .map((h) => new Date(h))
      .filter((d) => d >= today)
      .sort((a, b) => a.getTime() - b.getTime());

    if (upcomingHolidays.length === 0) return null;

    const nextHoliday = upcomingHolidays[0];

    // Format: "15 Jan 2026" ‡∏´‡∏£‡∏∑‡∏≠ "15 ‡∏°.‡∏Ñ. 2569"
    const day = nextHoliday.getDate();
    const month = translateMonth(ce_months[nextHoliday.getMonth()]);
    const year =
      currentLang === "th"
        ? nextHoliday.getFullYear() + 543
        : nextHoliday.getFullYear();

    return {
      date: nextHoliday.toISOString().split("T")[0],
      display: `${day} ${month} ${year}`,
    };
  }

  // üîµ Helper: ‡∏ô‡∏±‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  function getHolidayCount(event: AppEvent): number {
    return event.holidays?.length || 0;
  }

  // üîµ Helper: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ event ‡∏°‡∏µ custom holidays (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏Ñ‡πà weekends)
  function hasCustomHolidays(event: AppEvent): boolean {
    if (!event.holidays || event.holidays.length === 0) return false;
    if (!event.excludeWeekends) return true;

    return event.holidays.some((h) => {
      const d = new Date(h);
      const day = d.getDay();
      return day !== 0 && day !== 6;
    });
  }

  // üîµ Helper: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î
  function getHolidayDisplay(event: AppEvent): string | null {
    if (!event.holidays || event.holidays.length === 0) {
      if (!event.excludeWeekends) return null;
      return "Off: Sat-Sun";
    }

    if (event.excludeWeekends && !hasCustomHolidays(event)) {
      return "Off: Sat-Sun";
    }

    const next = getNextHoliday(event);
    if (next) {
      return `Off: ${next.display}`;
    }

    return null;
  }

  // üîµ Helper: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  function hasFullDetails(event: AppEvent): boolean {
    return !!(
      event.startDate &&
      event.endDate &&
      event.startTime &&
      event.endTime &&
      event.totalSlots !== undefined
    );
  }

  // üîµ Helper: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏∏
  function getCapacityPercentage(event: AppEvent): number {
    if (!event.totalSlots || event.totalSlots === 0) return 0;
    const used = event.usedSlots || 0;
    return Math.min((used / event.totalSlots) * 100, 100);
  }

  // üîµ Helper: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå pending submissions
  function getPendingPercentage(event: AppEvent): number {
    if (!event.totalSlots || event.totalSlots === 0) return 0;
    const pending = event.pendingCount || 0;
    return Math.min((pending / event.totalSlots) * 100, 100);
  }

  // üîµ Helper: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏≤‡∏Å flags
  function getEventStatus(isPublic?: boolean, isActive?: boolean): string {
    if (isPublic === undefined || isActive === undefined) return "Active"; // Default

    if (!isPublic && !isActive) return "Draft";
    if (isPublic && !isActive) return "Closed";
    if (!isPublic && isActive) return "Private";
    return "Active";
  }
  // Functions

  function toggleDropdown(type: "month" | "year") {
    if (type === "month") {
      monthOpen = !monthOpen;
      yearOpen = false;
    } else {
      yearOpen = !yearOpen;
      monthOpen = false;
    }
  }

  function selectOption(type: "month" | "year", value: string) {
    if (type === "month") selectedMonth = value;
    else selectedYear = value;
    monthOpen = false;
    yearOpen = false;
    currentPage = 1;
  }

  // --- Beautiful Toast ---

  function selectView(id: string) {
    const previousView = currentView;

    // ‚úÖ FIXED: Reset view state ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô tab
    closeAllDropdowns();

    // Reset selected events ‡πÅ‡∏•‡∏∞ filters ‡∏Ç‡∏≠‡∏á view ‡πÄ‡∏î‡∏¥‡∏°
    if (previousView !== id) {
      resetViewState(previousView);

      // ‚úÖ Reset selected events ‡∏î‡πâ‡∏ß‡∏¢
      if (previousView === "log") {
        logsData.selectedEvent = null;
        logsData.logs = [];
        filteredLogs = [];
      } else if (previousView === "reward") {
        rewardData.selectedEvent = null;
        rewardData.users = [];
      } else if (previousView === "verify-proof") {
        verifyProofData.selectedEvent = null;
        verifyProofData.submissions = [];
      }
    }

    currentView = id;
    isMobileMenuOpen = false;
    showSearchSection = false;
    showPageDropdown = false;

    // ‚úÖ FIXED: Reset form ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤ create ‡∏à‡∏≤‡∏Å menu
    if (id === "create") {
      ce_initCreate();
    }

    // Fetch fresh data for the new view
    if (id === "list") {
      fetchEvents();
    }
  }

  function closeAllDropdowns() {
    showPageDropdown = false;
    showExportMenu = false;
    yearOpenEventList = false;
    monthOpenEventList = false;
    yearOpenLogs = false;
    monthOpenLogs = false;
    yearOpenReward = false;
    monthOpenReward = false;
    yearOpenVerifyProof = false;
    monthOpenVerifyProof = false;
    rewardSortDropdownOpen = false;
    rewardTierDropdownOpen = false;
    rewardTierFilterDropdownOpen = false;
  }

  function resetViewState(viewId: string) {
    // Close all dropdowns first
    closeAllDropdowns();

    // Reset specific view state - only filters, not data
    switch (viewId) {
      case "verify-proof":
        // Keep selectedEvent and submissions
        verifyProofSearchQuery = "";
        verifyProofBatchFilter = "";
        verifyProofStdIdFilter = "";
        verifyProofEventsPage = 1;
        verifyProofStatusFilter = "All";
        verifyProofFromDate = "";
        verifyProofToDate = "";
        break;

      case "log":
        // Keep selectedEvent and logs
        logsData.searchQuery = "";
        logsData.selectedAction = "All";
        logsData.selectedStatus = "All";
        logsData.dateFrom = "";
        logsData.dateTo = "";
        eventsForLogsPage = 1;
        logsListPage = 1;
        searchQueryLogs = "";
        selectedYearLogs = "All";
        selectedMonthLogs = "All";
        logsNisitYearFilter = "";
        logsNisitIdFilter = "";
        break;

      case "reward":
        // Keep selectedEvent and users
        rewardData.searchQuery = "";
        rewardData.selectedTier = "All";
        rewardEventsPage = 1;
        rewardUsersPage = 1;
        searchQueryReward = "";
        selectedYearReward = "All";
        selectedMonthReward = "All";
        rewardSortBy = "all";
        rewardTierFilter = "all";
        nisitYearFilter = "";
        nisitIdFilter = "";
        break;

      case "list":
        // Don't reset events array - just reset filters
        searchQueryEventList = "";
        selectedYearEventList = "All";
        selectedMonthEventList = "All";
        currentPage = 1;
        break;
    }
  }

  function resetAllViewStates() {
    // Reset List View
    searchQueryEventList = "";
    selectedYearEventList = "All";
    selectedMonthEventList = "All";
    currentPage = 1;

    // Reset Verify Proof View
    verifyProofData.selectedEvent = null;
    verifyProofData.submissions = [];
    verifyProofData.loading = false;
    verifyProofData.error = "";
    verifyProofSearchQuery = "";
    verifyProofBatchFilter = "";
    verifyProofStdIdFilter = "";
    verifyProofEventsPage = 1;
    newVerifyProofCount = 0;
    verifyProofStatusFilter = "All";
    verifyProofFromDate = "";
    verifyProofToDate = "";

    // Reset Logs View
    logsData.selectedEvent = null;
    logsData.logs = [];
    logsData.loading = false;
    logsData.error = "";
    logsData.searchQuery = "";
    logsData.selectedAction = "All";
    logsData.selectedStatus = "All";
    logsData.dateFrom = "";
    logsData.dateTo = "";
    logsData.eventStats = undefined;
    filteredLogs = [];
    eventsForLogsPage = 1;
    logsListPage = 1;
    searchQueryLogs = "";
    selectedYearLogs = "All";
    selectedMonthLogs = "All";
    logsNisitYearFilter = "";
    logsNisitIdFilter = "";

    // Reset Reward View
    rewardData.selectedEvent = null;
    rewardData.users = [];
    rewardData.loading = false;
    rewardData.error = "";
    rewardData.searchQuery = "";
    rewardData.selectedTier = "All";
    rewardEventsPage = 1;
    rewardUsersPage = 1;
    newRewardUsersCount = 0;
    rewardAutoRefreshEnabled = true;
    rewardIsConnected = true;
    searchQueryReward = "";
    selectedYearReward = "All";
    selectedMonthReward = "All";
    rewardSortBy = "all";
    rewardTierFilter = "all";
    nisitYearFilter = "";
    nisitIdFilter = "";

    // Reset Unlock User View
    // (variables are local to the view)

    // Close all dropdowns
    showPageDropdown = false;
    showExportMenu = false;
    yearOpenEventList = false;
    monthOpenEventList = false;
    yearOpenLogs = false;
    monthOpenLogs = false;
    yearOpenReward = false;
    monthOpenReward = false;
    yearOpenVerifyProof = false;
    monthOpenVerifyProof = false;
    rewardSortDropdownOpen = false;
    rewardTierDropdownOpen = false;
    rewardTierFilterDropdownOpen = false;
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö Event (‡πÅ‡∏ö‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå)
  async function handleDelete(id: number | string) {
    // 1. ‡πÅ‡∏™‡∏î‡∏á Popup ‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô (SweetAlert2)
    const result = await Swal.fire({
      title: "Delete Event?",
      text: "You won't be able to revert this!",
      icon: "warning",
      iconColor: "#ef4444",
      showCancelButton: true,
      confirmButtonColor: "#ef4444",
      cancelButtonColor: "#64748b",
      confirmButtonText: "Yes, delete it!",
      background: "#1e293b",
      color: "#fff",
      customClass: { popup: "swal-rounded-popup" },
    });

    // 2. ‡∏ñ‡πâ‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏ï‡∏Å‡∏•‡∏á (Yes)
    if (result.isConfirmed) {
      try {
        const token = localStorage.getItem("access_token");

        // ‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß: ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Token ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
        if (!token) {
          Swal.fire({
            title: "Error",
            text: "Authentication token not found. Please login again.",
            icon: "error",
            background: "#1e293b",
            color: "#fff",
          });
          return;
        }

        console.log(`üóëÔ∏è Deleting Event ID: ${id}`);

        // -----------------------------------------------------------
        // üöÄ STEP 0: ‡∏•‡∏ö Reward Configs ‡∏Å‡πà‡∏≠‡∏ô (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô Foreign Key Error)
        // -----------------------------------------------------------
        try {
          const existingConfigs = allRewardConfigs.filter(
            (c: any) => c.event_id === id
          );

          if (existingConfigs.length > 0) {
            console.log("üóëÔ∏è Deleting reward configs first...", existingConfigs);
            const deletePromises = existingConfigs.map((config: any) =>
              api
                .delete(`/api/reward-leaderboards/configs/${config.id}`)
                .catch((err) => {
                  console.warn(`Failed to delete config ${config.id}:`, err);
                  return null; // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ throw error ‡∏ñ‡πâ‡∏≤‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
                })
            );
            await Promise.all(deletePromises);
            console.log("‚úÖ All reward configs deleted");
          }
        } catch (configErr) {
          console.warn("‚ö†Ô∏è Reward config deletion error:", configErr);
          // ‡πÑ‡∏°‡πà throw error ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏•‡∏ö event ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ
        }

        // -----------------------------------------------------------
        // üöÄ STEP 1: ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Database ‡∏´‡∏•‡∏±‡∏Å (‡∏ú‡πà‡∏≤‡∏ô API 8003)
        // -----------------------------------------------------------
        try {
          await api.delete(`/api/events/${id}`);
          console.log("‚úÖ Event deleted from server");
        } catch (err: any) {
          if (err.response?.status === 401) {
            throw new Error("Unauthorized: Token expired");
          }
          if (err.response?.status === 404) {
            // ‡∏ñ‡πâ‡∏≤ event ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡πá‡∏•‡∏ö‡∏à‡∏≤‡∏Å UI ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢
            console.log("‚ö†Ô∏è Event not found on server, removing from UI");
            events = events.filter((e) => e.id !== id);

            Swal.fire({
              title: "Already Deleted",
              text: "This event was already deleted.",
              icon: "info",
              background: "#1e293b",
              color: "#fff",
              confirmButtonColor: "#3b82f6",
              timer: 1500,
            });
            return;
          }
          throw new Error(
            `Failed to delete event (Status: ${err.response?.status})`
          );
        }

        // -----------------------------------------------------------
        // üöÄ STEP 2: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Holidays ‡∏Ç‡∏≠‡∏á Event (CASCADE ‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
        // -----------------------------------------------------------
        try {
          // ‚úÖ ‡πÉ‡∏ä‡πâ API DELETE /api/events/{event_id}/holidays - ‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
          const deleteHolidayRes = await api.delete(
            `/api/events/${id}/holidays`
          );

          // ‚úÖ FIX: Axios response - ‡πÉ‡∏ä‡πâ status ‡πÅ‡∏ó‡∏ô ok
          if (deleteHolidayRes.status !== 200 && deleteHolidayRes.status !== 204 && deleteHolidayRes.status !== 404) {
            console.warn(
              "‚ö†Ô∏è Failed to delete holidays, but continuing..."
            );
          } else {
            console.log("‚úÖ Event holidays deleted (or none existed)");
          }
        } catch (holidayErr) {
          console.warn("‚ö†Ô∏è Holiday deletion error:", holidayErr);
          // ‡πÑ‡∏°‡πà throw error ‡πÄ‡∏û‡∏£‡∏≤‡∏∞ event ‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏•‡∏∞ CASCADE ‡∏Å‡πá‡∏à‡∏∞‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        }

        // -----------------------------------------------------------
        // üöÄ STEP 3: Refresh Reward Configs & Events
        // -----------------------------------------------------------
        await Promise.all([fetchRewardConfigs(), fetchEvents(true)]);

        // -----------------------------------------------------------
        // üöÄ STEP 4: ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠ Refresh)
        // -----------------------------------------------------------
        events = events.filter((e) => e.id !== id);

        // ‚úÖ Clear caches (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô Create/Edit)
        lastFilteredEventsKey = "";
        cachedFilteredEvents = [];
        filterCache.clear();
        cachedFilteredEventsForReward = [];

        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        Swal.fire({
          title: "Deleted!",
          text: "Your event has been deleted.",
          icon: "success",
          background: "#1e293b",
          color: "#fff",
          confirmButtonColor: "#10b981",
          timer: 1500,
          showConfirmButton: false,
        });
      } catch (error: any) {
        console.error("‚ùå Delete error:", error);

        Swal.fire({
          title: "Error",
          text: error.message || "Something went wrong while deleting.",
          icon: "error",
          background: "#1e293b",
          color: "#fff",
          confirmButtonColor: "#ef4444",
        });
      }
    }
  }

  function openEventModal(event: AppEvent) {
    const imgSrc =
      event.image || "https://placehold.co/600x300/1e293b/64748b?text=No+Image";
    const desc =
      event.description ||
      (currentLang === "th"
        ? "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
        : "No detailed description available.");

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢
    const targetGoal = event.totalSlots || 0;
    const currentParticipants = event.usedSlots || 0;
    const progressPercent =
      targetGoal > 0
        ? ((currentParticipants / targetGoal) * 100).toFixed(1)
        : 0;

    const remainingSlots = Math.max(0, targetGoal - currentParticipants);
    const topReward =
      event.rewards && event.rewards.length > 0
        ? event.rewards.reduce((max, reward) => {
            // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ max ‡πÅ‡∏•‡∏∞ reward ‡∏à‡∏∞‡∏£‡∏π‡πâ type ‡πÅ‡∏•‡πâ‡∏ß
            const rEnd = reward.rangeEnd || 0;
            const mEnd = max.rangeEnd || 0;
            return rEnd > mEnd ? reward : max;
          }, event.rewards[0]!)
        : null;

    const topRank = topReward ? topReward.rangeEnd : 0;

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°
    let totalDays = 1;
    if (event.startDate && event.endDate) {
      const start = new Date(
        parseInt(event.startDate.year),
        getMonthIdx(event.startDate.month),
        parseInt(event.startDate.day)
      );
      const end = new Date(
        parseInt(event.endDate.year),
        getMonthIdx(event.endDate.month),
        parseInt(event.endDate.day)
      );
      totalDays =
        Math.ceil((end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24)) +
        1;

      // ‡∏´‡∏±‡∏Å‡∏ß‡∏±‡∏ô Holidays
      if (event.holidays && event.holidays.length > 0) {
        totalDays -= event.holidays.length;
      }

      // ‡∏´‡∏±‡∏Å Weekends (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î excludeWeekends)
      if (event.excludeWeekends) {
        let weekendCount = 0;
        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
          if (d.getDay() === 0 || d.getDay() === 6) weekendCount++;
        }
        totalDays -= weekendCount;
      }
    }

    // i18n labels
    const i18nLabels = {
      participants: currentLang === "th" ? "‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°" : "Participants",
      reached: currentLang === "th" ? "‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß" : "reached",
      slotsRemaining:
        currentLang === "th" ? "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠" : "slots remaining",
      location: currentLang === "th" ? "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" : "Location",
      dateRange: currentLang === "th" ? "‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà" : "Date Range",
      time: currentLang === "th" ? "‡πÄ‡∏ß‡∏•‡∏≤" : "Time",
      distance: currentLang === "th" ? "‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á" : "Distance",
      description: currentLang === "th" ? "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" : "Description",
      competitionRoadmap:
        currentLang === "th" ? "‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô" : "Competition Roadmap",
      howRankingWorks:
        currentLang === "th" ? "‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö" : "How Ranking Works",
      complete: currentLang === "th" ? "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö" : "Complete",
      rounds: currentLang === "th" ? "‡∏£‡∏≠‡∏ö" : "rounds",
      first: currentLang === "th" ? "‡∏Ñ‡∏ô‡πÅ‡∏£‡∏Å" : "First",
      finishers: currentLang === "th" ? "‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÄ‡∏™‡∏£‡πá‡∏à" : "finishers",
      next: currentLang === "th" ? "‡∏ñ‡∏±‡∏î‡πÑ‡∏õ" : "Next",
      tier: currentLang === "th" ? "‡∏£‡∏∞‡∏î‡∏±‡∏ö" : "Tier",
      slots: currentLang === "th" ? "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á" : "Slots",
      requirement: currentLang === "th" ? "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç" : "Requirement",
      ranking: currentLang === "th" ? "‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö" : "Ranking",
      finishFaster:
        currentLang === "th"
          ? "‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤!"
          : "Finish faster to secure better rewards!",
      completeQuickly:
        currentLang === "th"
          ? "‡∏£‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô"
          : "rounds quickly to rank higher",
    };

    console.log("Event rewards:", event.rewards);
    if (event.rewards && event.rewards.length > 0) {
      event.rewards.forEach((r, i) => {
        console.log(`Reward ${i}:`, r);
      });
    }

    Swal.fire({
      width: "550px",
      padding: "0",
      background: "transparent",
      showConfirmButton: false,
      showCloseButton: false,

      html: `
  <div style="background: #1e293b; border-radius: 20px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1); font-family: 'Inter', sans-serif; position: relative;">
    
    <!-- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û -->
    <div style="position: relative; width: 100%; height: 200px;">
      <img src="${imgSrc}" style="width: 100%; height: 100%; object-fit: cover; display: block;" />
      
      <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î -->
      <button id="custom-close-btn" style="position: absolute; top: 12px; right: 12px; width: 32px; height: 32px; background: rgba(0, 0, 0, 0.7); border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; color: white; display: grid; place-items: center; padding: 0; cursor: pointer; z-index: 50; transition: 0.2s;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="display: block;">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>

      <!-- Status Badge -->
      <span style="position: absolute; top: 12px; left: 12px; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 700; color: white; background: ${event.status === "Active" ? "#10b981" : event.status === "Draft" ? "#f59e0b" : "#ef4444"}; box-shadow: 0 2px 6px rgba(0,0,0,0.3); text-transform: uppercase; letter-spacing: 0.5px;">
        ${event.status === "Active" ? (currentLang === "th" ? "‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô" : "Active") : event.status === "Draft" ? (currentLang === "th" ? "‡∏â‡∏ö‡∏±‡∏ö‡∏£‡πà‡∏≤‡∏á" : "Draft") : currentLang === "th" ? "‡∏õ‡∏¥‡∏î" : "Closed"}
      </span>
    </div>

    <!-- Content -->
    <div style="padding: 28px; text-align: left; color: #f8fafc;">
      <!-- Title -->
      <h2 style="margin: 0 0 12px 0; font-size: 24px; color: #10b981; line-height: 1.3; font-weight: 700;">${event.title}</h2>
      
      <!-- ‚úÖ Capacity & Goal Section -->
      ${
        targetGoal > 0
          ? `
        <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(6, 95, 70, 0.05)); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 12px; padding: 16px; margin-bottom: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <div style="display: flex; align-items: center; gap: 8px;">
              <svg width="18" height="18" fill="none" stroke="#10b981" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <span style="font-size: 14px; font-weight: 600; color: #cbd5e1;">${i18nLabels.participants}</span>
            </div>
            <span style="font-size: 20px; font-weight: 700; color: #10b981;">${currentParticipants} / ${targetGoal}</span>
          </div>
          
          <!-- Progress Bar -->
          <div style="background: rgba(51, 65, 85, 0.5); border-radius: 10px; height: 10px; overflow: hidden; margin-bottom: 12px;">
            <div style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: ${progressPercent}%; transition: width 0.4s ease; border-radius: 10px;"></div>
          </div>
          
          <div style="display: flex; justify-content: space-between; font-size: 12px; color: #94a3b8;">
            <span>${progressPercent}% ${i18nLabels.reached}</span>
            <span>${remainingSlots} ${i18nLabels.slotsRemaining}</span>
          </div>
        </div>
      `
          : ""
      }
      
      <!-- ‚úÖ Meta Information Grid -->
      <div style="display: grid; gap: 12px; margin-top: 24px; margin-bottom: 18px;">
        <!-- Location -->
        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: rgba(100, 116, 139, 0.1); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.2);">
          <svg width="16" height="16" fill="none" stroke="#94a3b8" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <div style="flex: 1;">
            <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">${i18nLabels.location}</div>
            <div style="font-size: 14px; color: #e2e8f0; font-weight: 500;">${event.location}</div>
          </div>
        </div>
        
        <!-- Date Range -->
        <div style="display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: rgba(100, 116, 139, 0.1); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.2);">
          <svg width="16" height="16" fill="none" stroke="#94a3b8" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
          </svg>
          <div style="flex: 1;">
            <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">${i18nLabels.dateRange}</div>
            <div style="font-size: 14px; color: #e2e8f0; font-weight: 500;">${event.startDate ? `${event.startDate.day} ${event.startDate.month} ${event.startDate.year}` : event.month} ‚Üí ${event.endDate ? `${event.endDate.day} ${event.endDate.month} ${event.endDate.year}` : event.month}</div>
          </div>
        </div>
        
        ${
          event.startTime && event.endTime
            ? `
          <!-- Time -->
          <div style="display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: rgba(100, 116, 139, 0.1); border-radius: 8px; border: 1px solid rgba(100, 116, 139, 0.2);">
            <svg width="16" height="16" fill="none" stroke="#94a3b8" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div style="flex: 1;">
              <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">${i18nLabels.time}</div>
              <div style="font-size: 14px; color: #e2e8f0; font-weight: 500;">${event.startTime} - ${event.endTime}</div>
            </div>
          </div>
        `
            : ""
        }
        
        ${
          event.distanceKm && event.distanceKm > 0
            ? `
          <!-- Distance -->
          <div style="display: flex; align-items: center; gap: 10px; padding: 12px 14px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(6, 182, 212, 0.1)); border-radius: 8px; border: 1px solid rgba(16, 185, 129, 0.2);">
            <svg width="16" height="16" fill="none" stroke="#10b981" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
            </svg>
            <div style="flex: 1;">
              <div style="font-size: 11px; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px;">${i18nLabels.distance}</div>
              <div style="font-size: 14px; color: #10b981; font-weight: 600;">${event.distanceKm} km</div>
            </div>
          </div>
        `
            : ""
        }
      </div>

      <div style="height: 1px; background: rgba(255,255,255,0.1); margin-bottom: 18px;"></div>

      <!-- Description -->
      <div style="margin-bottom: 18px;">
        <div style="font-size: 12px; font-weight: 600; color: #94a3b8; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;">
          <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16m-7 6h7"></path>
          </svg>
          ${i18nLabels.description}
        </div>
        <div style="max-height: 140px; overflow-y: auto; font-size: 14px; line-height: 1.7; color: #cbd5e1; padding: 12px; background: rgba(15, 23, 42, 0.5); border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.05);">
          ${desc}
        </div>
      </div>
      
      ${
        event.rewards && event.rewards.length > 0
          ? `
    <div style="height: 1px; background: rgba(255,255,255,0.1); margin-bottom: 20px;"></div>
    
    <!-- üéÅ Rewards Section -->
    <div>
      <div style="font-size: 13px; font-weight: 700; color: #f8fafc; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
        <svg width="18" height="18" fill="none" stroke="#f59e0b" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        ${currentLang === "th" ? "‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" : "Rewards"}
      </div>
      
      <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ -->
      <div style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.12), rgba(37, 99, 235, 0.06)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px; margin-bottom: 16px;">
        <div style="display: flex; align-items: start; gap: 12px;">
          <div style="width: 32px; height: 32px; background: rgba(59, 130, 246, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
            <svg width="18" height="18" fill="none" stroke="#3b82f6" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div style="flex: 1;">
            <div style="font-size: 13px; font-weight: 600; color: #60a5fa; margin-bottom: 6px;">${currentLang === "th" ? "‡∏ß‡∏¥‡∏ò‡∏µ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" : "How to Get Rewards"}</div>
            <div style="font-size: 12px; color: #93c5fd; line-height: 1.6;">
              ${
                currentLang === "th"
                  ? '‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• <strong style="color: #f59e0b;">‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏ô</strong> ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏∞‡∏´‡∏°‡∏î'
                  : 'Complete the required rounds to receive rewards. <strong style="color: #f59e0b;">No limit on number of people</strong> until rewards run out.'
              }
            </div>
          </div>
        </div>
      </div>
      
      ${event.rewards
        .map((config: any, index: number) => {
          // --- üõ†Ô∏è ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Logic extraction) ---

          // 1. ‡πÄ‡∏à‡∏≤‡∏∞‡πÄ‡∏≠‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Tier ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
          const tierData =
            config.reward_tiers && config.reward_tiers.length > 0
              ? config.reward_tiers[0]
              : null;

          // 2. ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ‡πÄ‡∏≠‡∏≤‡∏à‡∏≤‡∏Å Tier ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡πà‡∏≠‡∏ô -> ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡πà‡∏≠‡∏¢‡πÄ‡∏≠‡∏≤‡∏ä‡∏∑‡πà‡∏≠ Config -> ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô Reward X
          const name =
            tierData && tierData.reward_name
              ? tierData.reward_name
              : config.reward_name ||
                config.name ||
                (currentLang === "th" ? "‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏µ‡πà " : "Reward ") + (index + 1);

          // 3. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö: ‡πÄ‡∏≠‡∏≤‡∏à‡∏≤‡∏Å Config (required_completions) ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å
          const completions =
            config.required_completions ||
            config.requirement ||
            (tierData ? tierData.requirement : 1);

          // 4. ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•: ‡πÄ‡∏≠‡∏≤‡∏à‡∏≤‡∏Å Tier ‡∏Ç‡πâ‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡πà‡∏≠‡∏ô
          const qty =
            (tierData ? tierData.quantity : null) ||
            config.quantity ||
            config.quota ||
            null;

          // 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏µ
          const colors = [
            "#f59e0b",
            "#10b981",
            "#3b82f6",
            "#8b5cf6",
            "#ec4899",
          ];
          const color = colors[index % colors.length];

          // 6. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (Rank)
          const minRank =
            (tierData ? tierData.min_rank : null) ||
            config.rangeStart ||
            index + 1;
          const maxRank =
            (tierData ? tierData.max_rank : null) || config.rangeEnd || null;

          const rankDisplay =
            maxRank && maxRank !== minRank
              ? (currentLang === "th" ? "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà " : "Rank ") +
                minRank +
                "-" +
                maxRank
              : (currentLang === "th" ? "‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà " : "Rank ") + minRank;

          const rewardDesc = config.description || "";

          // --- üé® ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (HTML) ---
          return `
      <div style="background: linear-gradient(135deg, ${color}15, ${color}08); border: 2px solid ${color}40; border-radius: 14px; padding: 16px; margin-bottom: 12px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 14px;">
          <div style="width: 44px; height: 44px; background: ${color}; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px ${color}40;">
            <svg width="22" height="22" fill="none" stroke="#1e293b" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
          <div>
            <div style="font-size: 16px; font-weight: 700; color: ${color}; margin-bottom: 2px;">${name}</div>
            <div style="font-size: 13px; font-weight: 500; color: #94a3b8;">${rankDisplay}</div>
          </div>
        </div>
        
        ${
          rewardDesc
            ? `
          <div style="background: rgba(59, 130, 246, 0.08); border-left: 3px solid ${color}; padding: 10px 12px; margin-bottom: 12px; border-radius: 6px;">
            <div style="font-size: 12px; color: #94a3b8; line-height: 1.6;">${rewardDesc}</div>
          </div>
        `
            : ""
        }
        
        <div style="background: rgba(0, 0, 0, 0.25); border-radius: 10px; padding: 14px; border: 1px solid rgba(255, 255, 255, 0.05);">
          <div style="display: flex; align-items: center; gap: 10px; margin-bottom: ${qty ? "10px" : "0"};">
            <svg width="18" height="18" fill="none" stroke="#10b981" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div style="flex: 1;">
              <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">${currentLang === "th" ? "‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç" : "Requirement"}</div>
              <div style="font-size: 14px; color: #e2e8f0; font-weight: 600;">
                ${currentLang === "th" ? "‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏ö " : "Complete "}<span style="color: #10b981; font-weight: 700;">${completions}${currentLang === "th" ? " ‡∏£‡∏≠‡∏ö" : " rounds"}</span>
              </div>
            </div>
          </div>
          
          ${
            qty
              ? `
            <div style="display: flex; align-items: center; gap: 10px;">
              <svg width="18" height="18" fill="none" stroke="#f59e0b" viewBox="0 0 24 24" stroke-width="2.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
              </svg>
              <div style="flex: 1;">
                <div style="font-size: 12px; color: #64748b; margin-bottom: 3px;">${currentLang === "th" ? "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" : "Quantity"}</div>
                <div style="font-size: 14px; color: #e2e8f0; font-weight: 600;">
                  <span style="color: #f59e0b; font-weight: 700;">${qty}</span> ${currentLang === "th" ? "‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" : "rewards"}
                </div>
              </div>
            </div>
          `
              : ""
          }
        </div>
      </div>
    `;
        })
        .join("")}

      <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;">
        <svg width="18" height="18" fill="none" stroke="#10b981" viewBox="0 0 24 24" stroke-width="2.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
        </svg>
        <div style="font-size: 12px; color: #6ee7b7; line-height: 1.5;">
          <strong style="color: #10b981;">${currentLang === "th" ? "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ß‡∏¥‡πà‡∏á‡πÄ‡∏•‡∏¢!" : "Start running now!"}</strong> ${currentLang === "th" ? "‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•" : "Complete the rounds to claim your rewards"}.
        </div>
      </div>
    </div>
    `
          : ""
      }
    </div>
  </div>
`,

      didOpen: () => {
        const btn = document.getElementById("custom-close-btn");
        if (btn) {
          btn.addEventListener("click", () => Swal.close());
          btn.onmouseenter = () => {
            btn.style.background = "#ef4444";
            btn.style.transform = "scale(1.1)";
          };
          btn.onmouseleave = () => {
            btn.style.background = "rgba(0, 0, 0, 0.7)";
            btn.style.transform = "scale(1)";
          };
        }
      },
    });
  }

  // Filter Logic - OPTIMIZED with memoization
  $: debouncedUpdateSearch(searchQueryEventList);

  // Cache key for filteredEvents
  let lastFilteredEventsKey = "";
  let cachedFilteredEvents: AppEvent[] = [];
  let eventsVersion = 0; // ‚úÖ FIXED: ‡πÉ‡∏ä‡πâ version number ‡πÅ‡∏ó‡∏ô length

  $: {
    // ‚úÖ FIXED: ‡πÉ‡∏ä‡πâ eventsVersion ‡πÅ‡∏•‡∏∞ events data hash ‡πÄ‡∏û‡∏∑‡πà‡∏≠ detect changes
    const eventsHash = events.map((e) => `${e.id}-${e.status}`).join(",");
    const cacheKey = `events_v${eventsVersion}_${eventsHash}_${debouncedSearchQuery}_${selectedMonthEventList}_${selectedYearEventList}`;
    if (cacheKey !== lastFilteredEventsKey) {
      lastFilteredEventsKey = cacheKey;
      cachedFilteredEvents = filterEventsOptimized(
        events,
        debouncedSearchQuery,
        selectedMonthEventList,
        selectedYearEventList
      );
    }
  }

  $: filteredEvents = cachedFilteredEvents;

  // Pagination Logic
  $: totalPages = Math.ceil(filteredEvents.length / itemsPerPage);
  $: paginatedEvents = filteredEvents.slice(
    (currentPage - 1) * itemsPerPage,
    currentPage * itemsPerPage
  );

  function nextPage() {
    if (currentPage < totalPages) currentPage += 1;
    showPageDropdown = false;
  }
  function prevPage() {
    if (currentPage > 1) currentPage -= 1;
    showPageDropdown = false;
  }
  function jumpToPage(page: number) {
    currentPage = page;
    showPageDropdown = false;
  }
  $: if (searchQuery) currentPage = 1;

  let perfPointsStr = "";
  $: if (perfHistory.length > 1) {
    perfPointsStr = perfHistory
      .map((p, i) => {
        const x = (i / (MAX_PERF_POINTS - 1)) * 120;
        const y =
          p.latency < 0
            ? 30
            : Math.min(30, Math.max(2, (p.latency / 500) * 28));
        return `${x},${y}`;
      })
      .join(" ");
  }

  // Timer & Logout
  function formatTime(seconds: number) {
    const hrs = Math.floor(seconds / 3600);
    const mins = Math.floor((seconds % 3600) / 60);
    const secs = seconds % 60;
    return `${hrs.toString().padStart(2, "0")}:${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
  }

  function startTimer() {
    timerInterval = setInterval(() => {
      if (timeLeft > 0) timeLeft -= 1;
      else handleAutoLogout();
    }, 1000);
  }

  function formatClockTime(dateInput: any): string {
    if (!dateInput || dateInput === "-") return "-";
    try {
      const date = new Date(dateInput);
      if (isNaN(date.getTime())) return "-";
      return date.toLocaleTimeString("th-TH", {
        hour: "2-digit",
        minute: "2-digit",
      });
    } catch (e) {
      return "-";
    }
  }

  let isLoggingOut = false; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥

  async function handleAutoLogout() {
    // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ã‡πâ‡∏≥
    if (isLoggingOut) return;
    isLoggingOut = true;

    // ‡∏´‡∏¢‡∏∏‡∏î timer
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    // ‚úÖ Clear ALL storage and cookies
    if (typeof localStorage !== 'undefined') {
      localStorage.clear();
    }
    if (typeof sessionStorage !== 'undefined') {
      sessionStorage.clear();
    }
    if (typeof document !== 'undefined') {
      document.cookie.split(";").forEach((c) => {
        document.cookie = c
          .replace(/^ +/, "")
          .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
      });
    }

    await Swal.fire({
      title: "Session Expired",
      text: "Please login again to continue.",
      icon: "warning",
      background: "#1e293b",
      color: "#fff",
      confirmButtonColor: "#ef4444",
      confirmButtonText: "Login",
      allowOutsideClick: false,
    });

    window.location.href = "/auth/login";
  }

  function handleLogout() {
    Swal.fire({
      title: "Logout?",
      text: "You will be returned to the login screen.",
      icon: "warning",
      iconColor: "#ef4444",
      showCancelButton: true,
      confirmButtonColor: "#ef4444",
      cancelButtonColor: "#64748b",
      confirmButtonText: "Yes, Logout",
      background: "#1e293b",
      color: "#fff",
      customClass: {
        popup: "swal-rounded-popup",
      },
    }).then((result) => {
      if (result.isConfirmed) {
        // ‚úÖ ‡∏´‡∏¢‡∏∏‡∏î timer ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô handleAutoLogout ‡∏ñ‡∏π‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }
        timeLeft = 999999; // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô timer trigger

        // ‚úÖ Clear ALL storage and cookies
        if (typeof localStorage !== 'undefined') {
          localStorage.clear();
        }
        if (typeof sessionStorage !== 'undefined') {
          sessionStorage.clear();
        }
        if (typeof document !== 'undefined') {
          document.cookie.split(";").forEach((c) => {
            document.cookie = c
              .replace(/^ +/, "")
              .replace(/=.*/, "=;expires=" + new Date().toUTCString() + ";path=/");
          });
        }

        // ‚úÖ ‡πÉ‡∏ä‡πâ window.location ‡πÅ‡∏ó‡∏ô goto ‡πÄ‡∏û‡∏∑‡πà‡∏≠ full page reload
        window.location.href = "/auth/login";
      }
    });
  }

  function shouldShowJoined(log: Log): boolean {
    const actionOrder = [
      "registration",
      "check_in",
      "reward_unlocked",
      "registration_cancelled",
    ];
    const currentIndex = actionOrder.indexOf(log.action);
    return currentIndex >= 0; // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å action
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á "Checked In" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  function shouldShowCheckedIn(log: Log): boolean {
    const actionOrder = ["check_in", "reward_unlocked"];
    return actionOrder.includes(log.action);
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á "Completed" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  function shouldShowCompleted(log: Log): boolean {
    return log.action === "reward_unlocked";
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ñ‡∏ß‡∏£‡πÅ‡∏™‡∏î‡∏á "Proof Submitted" ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  function shouldShowProofSubmitted(log: Log): boolean {
    return log.action === "reward_unlocked";
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á timestamp ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Join (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ metadata)
  function getJoinedTimestamp(log: Log): string {
    // ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API ‡∏´‡∏£‡∏∑‡∏≠ metadata
    // ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ return "-" ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô
    return log.details?.joinedAt || "-";
  }

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á timestamp ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Check In (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ metadata)
  function getCheckedInTimestamp(log: Log): string {
    // ‡πÉ‡∏ô‡∏Å‡∏£‡∏ì‡∏µ‡∏à‡∏£‡∏¥‡∏á ‡∏Ñ‡∏∏‡∏ì‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API ‡∏´‡∏£‡∏∑‡∏≠ metadata
    return log.details?.checkedInAt || "-";
  }

  // Real-time polling intervals
  let rewardPollingInterval: ReturnType<typeof setInterval> | null = null;
  let logsPollingInterval: ReturnType<typeof setInterval> | null = null;
  let verifyProofPollingInterval: ReturnType<typeof setInterval> | null = null;
  const POLLING_INTERVAL = 10000; // 10 seconds

  // Real-time status tracking
  let lastSyncTime: string = "";
  $: realtimePollingActive = !!(
    rewardPollingInterval ||
    logsPollingInterval ||
    verifyProofPollingInterval
  );

  function updateLastSyncTime() {
    const now = new Date();
    lastSyncTime = now.toLocaleTimeString("th-TH", {
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
    });
  }

  function startRewardPolling() {
    if (rewardPollingInterval) return;
    rewardPollingInterval = setInterval(async () => {
      if (
        rewardAutoRefreshEnabled &&
        rewardData.selectedEvent &&
        currentView === "reward"
      ) {
        try {
          const token = localStorage.getItem("access_token");
          const headers: HeadersInit = { "Content-Type": "application/json" };
          if (token) headers["Authorization"] = `Bearer ${token}`;

          // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° /ku-run prefix
          const res = await fetch(
            `${API_BASE_URL}/api/participations/event/${rewardData.selectedEvent.id}/report`,
            { headers }
          );

          if (res.status === 404) {
            // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
            updateLastSyncTime();
            return;
          }

          if (res.ok) {
            const data = await res.json();
            const newCount = (
              Array.isArray(data) ? data : data.data || []
            ).filter((s: any) => s.status === "completed").length;
            const currentCount = rewardData.users.length;
            if (newCount > currentCount) {
              newRewardUsersCount = newCount - currentCount;
            }
            updateLastSyncTime();
          }
        } catch (e) {
          console.warn("Polling error:", e);
        }
      }
    }, POLLING_INTERVAL);
  }

  function stopRewardPolling() {
    if (rewardPollingInterval) {
      clearInterval(rewardPollingInterval);
      rewardPollingInterval = null;
    }
  }

  function startLogsPolling() {
    // ‚úÖ ‡∏õ‡∏¥‡∏î auto-refresh ‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡πÜ‡πÅ‡∏õ‡∏õ
    // ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î refresh button ‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
    console.log("üìã Logs polling disabled - manual refresh only");
    return;
  }

  function stopLogsPolling() {
    if (logsPollingInterval) {
      clearInterval(logsPollingInterval);
      logsPollingInterval = null;
    }
  }

  function startVerifyProofPolling() {
    if (verifyProofPollingInterval) return;
    verifyProofPollingInterval = setInterval(async () => {
      if (
        verifyProofAutoRefreshEnabled &&
        verifyProofData.selectedEvent &&
        currentView === "verify-proof"
      ) {
        try {
          const token = localStorage.getItem("access_token");
          const headers: HeadersInit = { "Content-Type": "application/json" };
          if (token) headers["Authorization"] = `Bearer ${token}`;

          // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° /ku-run prefix
          const res = await fetch(
            `${API_BASE_URL}/api/participations/event/${verifyProofData.selectedEvent.id}/report`,
            { headers }
          );

          if (res.status === 404) {
            // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£
            updateLastSyncTime();
            return;
          }

          if (res.ok) {
            const data = await res.json();
            const newPending = (
              Array.isArray(data) ? data : data.data || []
            ).filter((s: any) => s.status === "proof_submitted").length;
            const currentPending = verifyProofData.submissions.length;
            if (newPending > currentPending) {
              newVerifyProofCount = newPending - currentPending;
            }
            updateLastSyncTime();
          }
        } catch (e) {
          console.warn("Verify proof polling error:", e);
        }
      }
    }, POLLING_INTERVAL);
  }

  function stopVerifyProofPolling() {
    if (verifyProofPollingInterval) {
      clearInterval(verifyProofPollingInterval);
      verifyProofPollingInterval = null;
    }
  }

  // ===== OPTIMIZED: Lazy start polling - only after main data loads =====
  // Polling ‡∏à‡∏∞‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡πÅ‡∏¢‡πà‡∏á‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£
  let pollingStarted = false;
  
  function startAllPolling() {
    if (pollingStarted) return;
    pollingStarted = true;
    
    // ‚úÖ ‡πÄ‡∏£‡∏¥‡πà‡∏° polling ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ UI render ‡∏Å‡πà‡∏≠‡∏ô
    setTimeout(() => {
      initializeTokenTimer();
      startRewardPolling();
      startLogsPolling();
      startVerifyProofPolling();
    }, 2000);
  }
  
  // ‚úÖ Reactive: ‡πÄ‡∏£‡∏¥‡πà‡∏° polling ‡πÄ‡∏°‡∏∑‡πà‡∏≠ initialization ‡πÄ‡∏™‡∏£‡πá‡∏à
  $: if (!isInitializing && !eventsLoading && !pollingStarted) {
    startAllPolling();
  }
  
  onDestroy(() => {
    clearInterval(timerInterval);

    stopCamera();
    stopRewardPolling();
    stopLogsPolling();
    stopVerifyProofPolling();
    if (verifyErrorTimeout) clearTimeout(verifyErrorTimeout);
  });

  const ce_days = Array.from({ length: 31 }, (_, i) => i + 1);
  const ce_months = [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December",
  ];

  const ce_months_th = [
    "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°",
    "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå",
    "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°",
    "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
    "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°",
    "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
    "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°",
    "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
    "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô",
    "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°",
    "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô",
    "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°",
  ];

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏õ‡∏•‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  function translateMonth(monthEn: string): string {
    const idx = ce_months.indexOf(monthEn);
    if (idx === -1) return monthEn;
    return currentLang === "th" ? ce_months_th[idx] : monthEn;
  }

  // ‚úÖ Reactive: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å month list ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤
  $: ce_displayMonths = currentLang === "th" ? ce_months_th : ce_months;
  
  // ‚úÖ Reactive: placeholders ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤
  $: ce_dayPlaceholder = currentLang === "th" ? "‡∏ß‡∏±‡∏ô" : "Day";
  $: ce_monthPlaceholder = currentLang === "th" ? "‡πÄ‡∏î‡∏∑‡∏≠‡∏ô" : "Month";
  $: ce_yearPlaceholder = currentLang === "th" ? "‡∏õ‡∏µ" : "Year";

  const ce_currYear = new Date().getFullYear();
  const ce_years = Array.from({ length: 5 }, (_, i) => ce_currYear + i);
  
  // ‚úÖ Reactive: ‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏µ‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ currentLang ‡πÄ‡∏õ‡πá‡∏ô th
  $: ce_displayYears = currentLang === "th" 
    ? ce_years.map(y => y + 543)
    : ce_years;

  // ‚úÖ Reactive: ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏µ‡πÉ‡∏ô input field (‡∏û.‡∏®. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏ó‡∏¢, ‡∏Ñ.‡∏®. ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô EN)
  $: ce_displaySYear = ce_formData.sYear 
    ? (currentLang === "th" ? (parseInt(ce_formData.sYear) + 543).toString() : ce_formData.sYear)
    : "";
  $: ce_displayEYear = ce_formData.eYear 
    ? (currentLang === "th" ? (parseInt(ce_formData.eYear) + 543).toString() : ce_formData.eYear)
    : "";

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á List ‡πÄ‡∏ß‡∏•‡∏≤ 00:00 - 23:30
  const ce_timeList: string[] = [];
  for (let h = 0; h < 24; h++) {
    for (let m = 0; m < 60; m += 30) {
      ce_timeList.push(
        `${h.toString().padStart(2, "0")}:${m.toString().padStart(2, "0")}`
      );
    }
  }

  // ==========================================
  // üü¢ STATE VARIABLES (Prefix: ce_)
  // ==========================================

  let ce_fileInput: HTMLInputElement | undefined;
  let ce_activeDropdown: string | null = null; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏Ñ‡∏∏‡∏° Dropdown ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ

  // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô ce_formData)
  // ‚úÖ FIXED: default isPublic ‡πÅ‡∏•‡∏∞ isActive ‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö API default
  let ce_formData: CreateEventForm = {
    title: "",
    description: "",
    location: "",
    sDay: "",
    sMonth: "",
    sYear: "",
    eDay: "",
    eMonth: "",
    eYear: "",
    startTime: "",
    endTime: "",
    totalSlots: null,
    distanceKm: null,
    holidays: [],
    excludeWeekends: false,
    holidayType: "none", // ‚úÖ Added: default holiday type
    specificDates: [], // ‚úÖ Added: specific dates array
    tempHoliday: "",
    totalRewards: null,
    requiredCompletions: null,
    rewards: [
      {
        name: "",
        requirement: null,
      },
    ],
    isPublic: true,
    isActive: true,
    imagePreview: null,
    // Event Type defaults
    eventType: "single_day",
    allowDailyCheckin: false,
    maxCheckinsPerUser: 1,
  };

  let ce_selectedFile: File | null = null;
  let ce_tempSelectedDates: string[] = [];
  let ce_availableDatesList: {
    value: string;
    day: string;
    monthShort: string;
  }[] = [];

  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° Holiday Options
  let ce_holidayMode: "none" | "weekends" | "specific" | null = null;
  let ce_validationErrors: Set<string> = new Set();

  // ==========================================
  // üü¢ COMPUTED & LIFECYCLE
  // ==========================================

  $: ce_hasDates =
    ce_formData.sDay &&
    ce_formData.sMonth &&
    ce_formData.sYear &&
    ce_formData.eDay &&
    ce_formData.eMonth &&
    ce_formData.eYear;
  $: ce_hasSlots = ce_formData.totalSlots && ce_formData.totalSlots > 0;

  // ‡∏õ‡∏¥‡∏î Dropdown ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
  onMount(() => {
    const handleGlobalClick = (e: MouseEvent) => {
      const target = e.target as Element;
      // ‚úÖ ‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î dropdown ‡∏ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà trigger ‡∏´‡∏£‡∏∑‡∏≠ options ‡∏´‡∏£‡∏∑‡∏≠ opt ‡∏´‡∏£‡∏∑‡∏≠ dd-wrap
      if (
        !target.closest(".ce-trigger") &&
        !target.closest(".ce-options") &&
        !target.closest(".ce-opt") &&
        !target.closest(".ce-dd-wrap")
      ) {
        ce_activeDropdown = null;
      }
    };

    function handleClickOutside(event: MouseEvent) {
      const target = event.target as HTMLElement;

      if (!target.closest(".filter-dropdown-logs")) {
        logsData.actionDropdownOpen = false;
        logsData.statusDropdownOpen = false;
      }

      if (!target.closest(".custom-date-dropdown-logs")) {
        logsData.dateFromDropdownOpen = false;
        logsData.dateToDropdownOpen = false;
      }
    }

    document.addEventListener("click", handleClickOutside);
    // ‚úÖ ‡πÉ‡∏ä‡πâ mousedown ‡πÅ‡∏ó‡∏ô click ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ click event ‡πÉ‡∏ô dropdown ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô
    window.addEventListener("mousedown", handleGlobalClick);
    return () => {
      window.removeEventListener("mousedown", handleGlobalClick);
      document.removeEventListener("click", handleClickOutside);
    };
  });

  // ==========================================
  // üü¢ FUNCTIONS (Prefix: ce_)
  // ==========================================

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á Event ‡πÉ‡∏´‡∏°‡πà (Reset ‡∏Ñ‡πà‡∏≤)
  // ** ‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "+ Create" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ List **
  function ce_initCreate() {
    // ‚úÖ FIXED: Reset editingEventId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
    editingEventId = null;

    // ‚úÖ FIXED: Reset selected file ‡∏î‡πâ‡∏ß‡∏¢
    ce_selectedFile = null;

    ce_formData = {
      title: "",
      description: "",
      location: "",
      sDay: "",
      sMonth: "",
      sYear: "",
      eDay: "",
      eMonth: "",
      eYear: "",
      startTime: "",
      endTime: "",
      totalSlots: null,
      distanceKm: null,
      holidays: [],
      excludeWeekends: false,
      holidayType: "none", // ‚úÖ Added
      specificDates: [], // ‚úÖ Added
      tempHoliday: "",
      totalRewards: null,
      requiredCompletions: null,
      rewards: [
        {
          name: "",
          requirement: null,
        },
      ],
      // ‚úÖ FIXED: ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ default ‡πÄ‡∏õ‡πá‡∏ô true ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö API default
      // API ‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ is_active: true, is_published: true ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á
      isPublic: true,
      isActive: true,
      imagePreview: null,
      // Event Type defaults
      eventType: "single_day",
      allowDailyCheckin: false,
      maxCheckinsPerUser: 1,
    };
    ce_holidayMode = null; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô null
    ce_validationErrors = new Set(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ
    ce_activeDropdown = null;
    currentView = "create";
  }

  function ce_setHolidayMode(mode: "none" | "weekends" | "specific" | null) {
    ce_holidayMode = mode;

    if (mode === "none") {
      ce_formData.holidays = [];
      ce_formData.excludeWeekends = false;
      ce_formData.holidayType = "none";
      ce_formData.specificDates = [];
    } else if (mode === "weekends") {
      ce_formData.holidays = [];
      ce_formData.excludeWeekends = true;
      ce_formData.holidayType = "none";
      ce_formData.specificDates = [];
    } else if (mode === "specific") {
      ce_formData.excludeWeekends = false;
      ce_formData.holidayType = "specific";
      // ‡πÄ‡∏Å‡πá‡∏ö holidays ‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°
      ce_formData.specificDates = [...ce_formData.holidays];
    }

    ce_formData = { ...ce_formData };
  }

  // Function to handle event type selection
  function ce_setEventType(type: "single_day" | "multi_day") {
    ce_formData.eventType = type;

    if (type === "single_day") {
      // Single day: auto set allowDailyCheckin = false, maxCheckinsPerUser = 1
      ce_formData.allowDailyCheckin = false;
      ce_formData.maxCheckinsPerUser = 1;
    } else {
      // Multi day: auto set allowDailyCheckin = true
      ce_formData.allowDailyCheckin = true;
      // Keep maxCheckinsPerUser as is (default is 1, user can increase)
    }

    ce_formData = { ...ce_formData };
  }

  function ce_resetHolidays() {
    ce_formData.holidays = [];
    ce_formData = { ...ce_formData };
  }
  // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î Dropdown
  function ce_toggleDD(id: string) {
    console.log("üîΩ ce_toggleDD:", { id, current: ce_activeDropdown });
    if (ce_activeDropdown === id) {
      ce_activeDropdown = null;
    } else {
      ce_activeDropdown = id;
    }
  }

  // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (‡∏ß‡∏±‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ) -> ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
  function ce_selectOpt(key: string, value: any) {
    console.log("üîÑ ce_selectOpt called:", {
      key,
      value,
      before: (ce_formData as any)[key],
    });

    // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á day ‡πÅ‡∏•‡∏∞ year ‡πÄ‡∏õ‡πá‡∏ô string ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ consistent
    if (
      key === "sDay" ||
      key === "eDay" ||
      key === "sYear" ||
      key === "eYear"
    ) {
      (ce_formData as any)[key] = String(value);
    } else {
      (ce_formData as any)[key] = value;
    }

    // Force Svelte reactivity update
    ce_formData = { ...ce_formData };
    ce_activeDropdown = null;

    console.log("üîÑ ce_selectOpt after:", {
      key,
      newValue: (ce_formData as any)[key],
    });
  }

  // ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤ Combobox (Time/Slots)
  function ce_selectCombo(key: string, value: any) {
    (ce_formData as any)[key] = value;
    ce_formData = { ...ce_formData }; // Force Svelte Update
    ce_activeDropdown = null;
  }

  // ‡∏´‡πâ‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ï‡∏¥‡∏î‡∏•‡∏ö
  function ce_noNegative(e: Event) {
    const target = e.target as HTMLInputElement;
    if (parseFloat(target.value) < 0) target.value = "";
  }

  function ce_addTier() {
    ce_formData.rewards = [
      ...ce_formData.rewards,
      {
        name: "",
        requirement: null,
        tier: ce_formData.rewards.length + 1
      },
    ];
    ce_formData = { ...ce_formData };
  }

  function ce_removeTier(idx: number) {
    ce_formData.rewards = ce_formData.rewards.filter((_, i) => i !== idx);
    ce_formData = { ...ce_formData };
  }

  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Holiday
  // Accept month names in English, Thai, or the current display months (reactive)
  const getMonthIdx = (m: string) => {
    if (!m) return -1;
    // Prefer current display list (handles locale switched values)
    if (typeof ce_displayMonths !== "undefined") {
      const idx = ce_displayMonths.indexOf(m);
      if (idx !== -1) return idx;
    }
    // Fallback to English list
    let idx = ce_months.indexOf(m);
    if (idx !== -1) return idx;
    // Fallback to Thai list
    idx = ce_months_th.indexOf(m);
    return idx;
  };

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á Date Object ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
  $: startDateObj =
    ce_formData.sDay && ce_formData.sMonth && ce_formData.sYear
      ? new Date(
          Number(ce_formData.sYear),
          getMonthIdx(ce_formData.sMonth),
          Number(ce_formData.sDay)
        )
      : null;

  $: endDateObj =
    ce_formData.eDay && ce_formData.eMonth && ce_formData.eYear
      ? new Date(
          Number(ce_formData.eYear),
          getMonthIdx(ce_formData.eMonth),
          Number(ce_formData.eDay)
        )
      : null;

  // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏° (Start <= End)
  $: isDateRangeValid =
    startDateObj &&
    endDateObj &&
    startDateObj.getTime() <= endDateObj.getTime();
  // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏≠‡∏ö‡πÄ‡∏Ç‡∏ï‡∏ß‡∏±‡∏ô (min/max) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô Holiday
  $: holidayMin = startDateObj ? startDateObj.toISOString().split("T")[0] : "";
  $: holidayMax = endDateObj ? endDateObj.toISOString().split("T")[0] : "";

  function ce_recalcRewards() {
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÉ‡∏´‡∏°‡πà
  }

  // 3. Logic ‡πÄ‡∏û‡∏¥‡πà‡∏° Holiday (‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏á‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô)
  // ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏î‡∏¥‡∏°
  function ce_addHoliday() {
    if (!ce_formData.tempHoliday) return;

    // ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏û‡∏£‡∏≤‡∏∞ dropdown ‡∏°‡∏µ‡πÅ‡∏Ñ‡πà‡∏ß‡∏±‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß
    if (!ce_formData.holidays.includes(ce_formData.tempHoliday)) {
      ce_formData.holidays = [...ce_formData.holidays, ce_formData.tempHoliday];
    }
    ce_formData.tempHoliday = "";
    // Ensure mode and type reflect the user action
    ce_formData.holidayType = ce_formData.holidays.length > 0 ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_holidayMode = ce_formData.holidayType === "specific" ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_formData = { ...ce_formData };
    ce_activeDropdown = null;
  }

  $: statusTitle = (() => {
    if (!ce_formData.isPublic && !ce_formData.isActive) return "Draft Mode";
    if (ce_formData.isPublic && !ce_formData.isActive) return "Preview Mode";
    if (!ce_formData.isPublic && ce_formData.isActive) return "Private Link";
    return "Live & Public";
  })();

  $: statusDesc = (() => {
    if (!ce_formData.isPublic && !ce_formData.isActive)
      return "Users cannot see or join this event.";
    if (ce_formData.isPublic && !ce_formData.isActive)
      return "Visible on feed, but registration is closed.";
    if (!ce_formData.isPublic && ce_formData.isActive)
      return "Hidden from feed. Join via direct link only.";
    return "Visible to everyone and registration is open.";
  })();

  function ce_handleTimeInput(e: Event, key: string) {
    const target = e.target as HTMLInputElement;
    let val = target.value.replace(/[^0-9]/g, ""); // ‡πÄ‡∏≠‡∏≤‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç

    // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á 23 ‡πÅ‡∏•‡∏∞ ‡∏ô‡∏≤‡∏ó‡∏µ 59
    if (val.length >= 2) {
      let hh = parseInt(val.substring(0, 2));
      if (hh > 23) val = "23" + val.substring(2);
    }
    if (val.length >= 4) {
      let mm = parseInt(val.substring(2, 4));
      if (mm > 59) val = val.substring(0, 2) + "59";
    }

    // ‡πÄ‡∏ï‡∏¥‡∏° : ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
    if (val.length > 2) {
      val = val.substring(0, 2) + ":" + val.substring(2, 4);
    }

    (ce_formData as any)[key] = val;
    // ‚úÖ Force Svelte reactivity update
    ce_formData = { ...ce_formData };
  }

  function ce_delHoliday(h: string) {
    ce_formData.holidays = ce_formData.holidays.filter((x) => x !== h);
    // Update holidayType & mode when a holiday is removed
    ce_formData.holidayType = ce_formData.holidays.length > 0 ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_holidayMode = ce_formData.holidayType === "specific" ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_formData = { ...ce_formData };
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏™‡∏ï‡πå‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á Start - End Date
  $: availableDates = (() => {
    if (!startDateObj || !endDateObj || !isDateRangeValid) return [];

    const dates = [];
    const current = new Date(startDateObj);

    while (current <= endDateObj) {
      const dayOfWeek = current.getDay(); // 0=Sunday, 6=Saturday
      const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

      dates.push({
        value: current.toISOString().split("T")[0],
        day: current.getDate(),
        dayName: dayNames[dayOfWeek],
        month: ce_months[current.getMonth()],
        year: current.getFullYear(),
        fullDisplay: `${dayNames[dayOfWeek]}, ${current.getDate()} ${ce_months[current.getMonth()]} ${current.getFullYear()}`,
      });
      current.setDate(current.getDate() + 1);
    }

    return dates;
  })();

  // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
  $: groupedDates = (() => {
    const groups: { [key: string]: typeof availableDates } = {};
    availableDates.forEach((date) => {
      const key = `${date.month} ${date.year}`;
      if (!groups[key]) groups[key] = [];
      groups[key].push(date);
    });
    return groups;
  })();

  function ce_toggleHoliday(dateValue: string) {
    if (ce_formData.holidays.includes(dateValue)) {
      ce_formData.holidays = ce_formData.holidays.filter(
        (h) => h !== dateValue
      );
    } else {
      ce_formData.holidays = [...ce_formData.holidays, dateValue];
    }
    // When user toggles a specific date, make sure the form's holidayType/mode reflect specific selection
    ce_formData.holidayType = ce_formData.holidays.length > 0 ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_holidayMode = ce_formData.holidayType === "specific" ? "specific" : (ce_formData.excludeWeekends ? "weekends" : "none");
    ce_formData = { ...ce_formData };
  }

  // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
  function ce_handleImg(e: Event) {
    const target = e.target as HTMLInputElement;
    if (target.files && target.files[0]) {
      const reader: FileReader = new FileReader();
      reader.onload = (ev) => {
        ce_formData.imagePreview = ev.target?.result as string;
      };
      reader.readAsDataURL(target.files[0]);
    }
  }
  function ce_trigFile() {
    ce_fileInput?.click();
  }

  let editingEventId: number | null = null;

  /**
   * handleEdit - ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Event ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
   * @param event - Event object ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
   *
   * ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
   * 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å API ‡∏Å‡πà‡∏≠‡∏ô
   * 2. ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤ isPublic/isActive ‡∏à‡∏≤‡∏Å API response
   * 3. Set ‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤ ce_formData
   * 4. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö Svelte reactivity update ‡∏î‡πâ‡∏ß‡∏¢ tick()
   * 5. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ create form
   */
  async function handleEdit(event:  AppEvent) {
    console.log("üìù handleEdit called with event:", event);

    // =========================================================
    // üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡πà‡∏≠‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
    // =========================================================
    ce_formData = {
        title: "",
        description: "",
        location: "",
        sDay: "",
        sMonth: "January",
        sYear: new Date().getFullYear().toString(),
        eDay: "",
        eMonth: "January",
        eYear: new Date().getFullYear().toString(),
        startTime: "00:00",
        endTime: "23:59",
        totalSlots: null,
        distanceKm: 0,
        rewards: [{ name: "", requirement: null, tier: 1 }],
        totalRewards: null,
        requiredCompletions: null,
        isPublic: true,
        isActive: true,
        imagePreview: null,
        eventType: "single_day",
        allowDailyCheckin: false,
        maxCheckinsPerUser: 1,
        holidays: [],
        excludeWeekends: false,
        holidayType: "none",
        specificDates: [],
        tempHoliday: ""
    };

    // Force Svelte to recognize the reset
    await tick();

    // =========================================================
    // 0. üîÑ Refresh ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    // =========================================================
    try {
        await fetchRewardConfigs();
    } catch (err) {
        console.warn("‚ö†Ô∏è Failed to refresh reward configs:", err);
    }

    // =========================================================
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Event ‡∏™‡∏î‡πÜ ‡∏à‡∏≤‡∏Å API (Fresh Data) 
    // =========================================================
    let apiData: any = {};
    try {
        const response = await api.get(`/api/events/${event.id}`);
        apiData = response.data;
      // ‚úÖ Ensure we load holidays from the dedicated endpoint if backend stores them separately
      try {
        const hres = await api.get(`/api/events/${apiData.id}/holidays`);
        // Support different response shapes: array, { data: [...] }, { holidays: [...] }
        if (Array.isArray(hres.data)) {
          apiData.holidays = hres.data.map((h: any) => h.date || h.holiday_date || h);
        } else if (Array.isArray(hres.data?.data)) {
          apiData.holidays = hres.data.data.map((h: any) => h.date || h.holiday_date || h);
        } else if (Array.isArray(hres.data?.holidays)) {
          apiData.holidays = hres.data.holidays.map((h: any) => h.date || h.holiday_date || h);
        } else if (Array.isArray(hres.data?.items)) {
          apiData.holidays = hres.data.items.map((h: any) => h.date || h.holiday_date || h);
        }
        console.log("‚úÖ Loaded holidays from /holidays endpoint:", apiData.holidays);
      } catch (herr) {
        console.warn("‚ö†Ô∏è Could not fetch separate holidays endpoint, falling back to event.holidays if present:", herr);
      }
    } catch (err) {
        console.warn("üìù Could not fetch fresh data, using event object:", err);
        apiData = event;
    }

    editingEventId = apiData.id;

    // =========================================================
    // 2. ‚úÖ ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏≤‡∏Å database ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÑ‡∏°‡πà‡πÅ‡∏õ‡∏•‡∏á timezone
    // =========================================================
    
    // =========================================================
    // 3. üïí ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢ Parse ISO Date -> Form Fields (‡πÅ‡∏õ‡∏•‡∏á UTC ‚Üí Bangkok time)
    // =========================================================
    const parseISODate = (isoStr: string) => {
        if (!isoStr) return { day: "", month: "", year: "", time: "00:00" };
        
        // ‚úÖ ‡∏î‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤ UTC ‡∏à‡∏≤‡∏Å database ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Bangkok time (UTC + 7 hours)
        const date = new Date(isoStr);
        
        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        
        // ‚úÖ ‡πÅ‡∏õ‡∏•‡∏á UTC ‚Üí Bangkok time (+7 hours)
        const bangkokOffset = 7 * 60; // 7 hours in minutes
        const utcMinutes = date.getUTCHours() * 60 + date.getUTCMinutes();
        const bangkokMinutes = utcMinutes + bangkokOffset;
        
        let bangkokHour = Math.floor(bangkokMinutes / 60);
        let bangkokMinute = bangkokMinutes % 60;
        let bangkokDay = date.getUTCDate();
        let bangkokMonth = date.getUTCMonth();
        let bangkokYear = date.getUTCFullYear();
        
        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ overflow (‡πÄ‡∏Å‡∏¥‡∏ô 24 ‡∏ä‡∏° = ‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)
        if (bangkokHour >= 24) {
            bangkokHour -= 24;
            bangkokDay += 1;
            
            const daysInMonth = new Date(bangkokYear, bangkokMonth + 1, 0).getDate();
            if (bangkokDay > daysInMonth) {
                bangkokDay = 1;
                bangkokMonth += 1;
                if (bangkokMonth > 11) {
                    bangkokMonth = 0;
                    bangkokYear += 1;
                }
            }
        }
        
        const hours = String(bangkokHour).padStart(2, '0');
        const minutes = String(bangkokMinute).padStart(2, '0');

        console.log("üìÖ parseISODate (UTC ‚Üí Bangkok):", {
            input: isoStr,
            utc: `${date.getUTCFullYear()}-${date.getUTCMonth()+1}-${date.getUTCDate()} ${date.getUTCHours()}:${date.getUTCMinutes()}`,
            bangkok: `${bangkokYear}-${bangkokMonth+1}-${bangkokDay} ${hours}:${minutes}`
        });

        return {
            day: String(bangkokDay),
            month: months[bangkokMonth],
            year: String(bangkokYear),
            time: `${hours}:${minutes}`
        };
    };

    // Always convert UTC from backend to Bangkok for display/edit
    const startInfo = parseISODate(apiData.event_date);
    const endInfo = parseISODate(apiData.event_end_date);

    // =========================================================
    // 4. üèÜ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Reward Config
    // =========================================================
    const rewardConfigs = allRewardConfigs.filter(
        (c: any) => c.event_id === apiData.id
    );

    let rewardsData = [];
    let totalRewardsCount: number | null = null;
    let globalRequirement: number | null = null;

    if (rewardConfigs && rewardConfigs.length > 0) {
      console.log("üì¶ Found reward configs for event:", rewardConfigs);
      // Flatten all reward_tiers from all configs
      rewardsData = rewardConfigs.flatMap((config: any) => {
        if (!Array.isArray(config.reward_tiers)) return [];
        return config.reward_tiers.map((tier: any) => {
          console.log("üéØ Mapping reward tier:", {
            name: tier.reward_name,
            requirement: tier.required_completions ?? config.required_completions,
            quantity: tier.quantity ?? (tier.max_rank - tier.min_rank + 1),
            tier: tier.tier,
            reward_id: tier.reward_id
          });
          return {
            name: tier.reward_name || "",
            requirement: tier.required_completions ?? config.required_completions ?? 1,
            quantity: tier.quantity ?? (tier.max_rank - tier.min_rank + 1),
            tier: tier.tier,
            reward_id: tier.reward_id
          };
        });
      });
      // totalRewards = sum of all quantities
      totalRewardsCount = rewardsData.reduce((sum, r) => sum + (r.quantity || 0), 0);
      globalRequirement = rewardsData[0]?.requirement || 1;
      console.log("‚úÖ Loaded rewards for edit (all tiers):", { rewardsData, totalRewardsCount, globalRequirement });
    } else {
      console.log("‚ö†Ô∏è No reward configs found, using default");
      rewardsData = [{ name: "", requirement: 1, quantity: null }];
    }

    // =========================================================
    // 5. üéâ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Holidays
    // =========================================================
    let holidaysData: string[] = [];
    try {
      const holidaysRes = await api.get(`/api/events/${apiData.id}/holidays`);
      // ‚úÖ FIX: Axios response - ‡πÉ‡∏ä‡πâ status ‡πÅ‡∏•‡∏∞ data
      if (holidaysRes.status === 200) {
        const holidaysArray = Array.isArray(holidaysRes.data) ? holidaysRes.data : [];
        // API ‡∏Ñ‡∏∑‡∏ô array ‡∏Ç‡∏≠‡∏á {holiday_date, holiday_name, ...}
        holidaysData = holidaysArray.map((h: any) => h.holiday_date);
        console.log("‚úÖ Loaded holidays for edit:", holidaysData);
      }
    } catch (err) {
      console.warn("‚ö†Ô∏è Failed to fetch holidays for edit:", err);
      holidaysData = [];
    }

    // =========================================================
    // 5. üî• Mapping ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á ce_formData (Full Update)
    // =========================================================
    ce_formData = {
      title: apiData.title || "",
      description: apiData.description || "",
      location: apiData.location || "",

      // --- Date & Time (Bangkok time for form) ---
      sDay: startInfo.day,
      sMonth: startInfo.month,
      sYear: startInfo.year,
      eDay: endInfo.day,
      eMonth: endInfo.month,
      eYear: endInfo.year,
      startTime: startInfo.time,
      endTime: endInfo.time,

      // --- Capacity & Distance ---
      totalSlots: apiData.max_participants || null,
      distanceKm: apiData.distance_km || 0,

      // --- Rewards ---
      rewards: rewardsData,
      totalRewards: totalRewardsCount,
      requiredCompletions:  globalRequirement || 1,

      // --- Status & Settings ---
      isPublic: apiData.is_published === true,
      isActive: apiData.is_active === true,
      imagePreview: apiData.banner_image_url || null,
      eventType: apiData.event_type === "multi_day" ? "multi_day" : "single_day",
      allowDailyCheckin:  apiData.allow_daily_checkin || false,
      maxCheckinsPerUser: apiData.max_checkins_per_user || 1,
        
      // --- Holidays ---
      holidays:  holidaysData,
      excludeWeekends: apiData.exclude_weekends || false,
      holidayType: apiData.exclude_weekends ? "none" : (holidaysData && holidaysData.length > 0) ? "specific" : "none",
      specificDates: holidaysData,
      tempHoliday:  ""
    };

    // =========================================================
    // 6. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏´‡∏ô‡πâ‡∏≤
    // =========================================================
    if (ce_formData.excludeWeekends) {
        ce_holidayMode = "weekends";
    } else if (ce_formData.holidays.length > 0) {
        ce_holidayMode = "specific";
    } else {
        ce_holidayMode = "none";
    }

    // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ create ‡∏Å‡πà‡∏≠‡∏ô force update
    currentView = "create";
    editingEventId = apiData.id;

    // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ Svelte ‡∏£‡∏±‡∏ö‡∏£‡∏π‡πâ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡∏≠‡∏á Object (reactive update)
    ce_formData = { ...ce_formData };
    await tick();
    
    console.log("‚úÖ Edit mode ready with parsed data:", ce_formData);
}
  /**
   * ce_submit - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Event (‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç)
   *
   * ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
   * 1. Validate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
   * 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Date objects ‡∏à‡∏≤‡∏Å form data
   * 3. ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
   * 4. ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ API (POST ‡∏´‡∏£‡∏∑‡∏≠ PUT)
   * 5. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å holidays ‡πÅ‡∏•‡∏∞ rewards
   * 6. Refresh events list
   */
  async function ce_submit() {
    // 0. üìç ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Base URL
    const API_BASE_URL = "http://158.108.102.14:8001";
    console.log("üîó API_BASE_URL:", API_BASE_URL);

    // 1. ‡∏î‡∏∂‡∏á Token ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
    const token = localStorage.getItem("access_token");
    if (!token) {
        Swal.fire("Error", "Session expired. Please login.", "error")
            .then(() => window.location.href = "/ku-run/auth/login");
        return;
    }

    // üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö JWT Expiry (use robust decoder)
    try {
      const payload = decodeJwtPayload(token);
      if (payload && typeof payload.exp === 'number') {
        const expiry = payload.exp * 1000;
        const now = Date.now();
        console.log("üîë Token expiry:", new Date(expiry).toUTCString());
        console.log("‚è∞ Current time:", new Date(now).toUTCString());
        console.log("‚úÖ Token valid:", expiry > now);
        if (expiry < now) {
          await Swal.fire({
            title: "Session Expired",
            text: "Your session has expired. Please login again.",
            icon: "warning"
          });
          localStorage.removeItem("access_token");
          window.location.href = "/ku-run/auth/login";
          return;
        }
      } else {
        console.warn("‚ö†Ô∏è Cannot decode token expiry (not a JWT or missing exp)");
      }
    } catch (e) {
      console.warn("‚ö†Ô∏è Error while decoding token:", e);
    }

    // 2. üõ°Ô∏è ‡∏™‡∏£‡πâ‡∏≤‡∏á Config ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏¢‡∏¥‡∏á Axios
    const axiosConfig = {
        headers: {
            "Authorization": `Bearer ${token}`,
            "Content-Type": "application/json",
            "Accept": "application/json"
        },
        withCredentials: false
    };

    console.log("üì§ Axios Config:", {
        headers: {
            Authorization: token ?  "Bearer " + token. substring(0, 30) + "..." : "MISSING",
            "Content-Type":  "application/json",
            "Accept": "application/json"
        },
        withCredentials: false
    });

    console.log("üöÄ Submitting form...   Mode:", editingEventId ? "EDIT" : "CREATE");
    console.log("üìã Current form data:", JSON.stringify(ce_formData, null, 2));

    // 3. Validation
    ce_validationErrors = new Set();
    if (!ce_formData.title || ! ce_formData.sDay || !ce_formData.eDay) {
        Swal.fire("Error", "Please fill in all required fields", "error");
        return;
    }


    // 4. Date Preparation (Bangkok input ‚Üí UTC ISO for backend)
    const pad = (n: number) => n.toString().padStart(2, '0');
    const sMonthNum = pad(getMonthIdx(ce_formData.sMonth) + 1);
    const sDayNum = pad(Number(ce_formData.sDay));
    const eMonthNum = pad(getMonthIdx(ce_formData.eMonth) + 1);
    const eDayNum = pad(Number(ce_formData.eDay));

    // Use the global createUTCISOFromBangkok function (should be defined at top-level)
    let startISOStr: string;
    let endISOStr: string;
    try {
      startISOStr = createUTCISOFromBangkok(
        `${ce_formData.sYear}-${sMonthNum}-${sDayNum}`,
        ce_formData.startTime || '00:00'
      );
      endISOStr = createUTCISOFromBangkok(
        `${ce_formData.eYear}-${eMonthNum}-${eDayNum}`,
        ce_formData.endTime || '23:59'
      );
    } catch (dateErr: any) {
      console.error("‚ùå Date parsing failed:", dateErr);
      Swal.fire("Error", "Invalid date format:  " + dateErr.message, "error");
      return;
    }
    console.log("üìÖ Date Range (Bangkok input ‚Üí UTC for backend):", {
      start: startISOStr,
      end: endISOStr
    });

    try {
        // üîµ STEP A: Image Upload
        let bannerImageUrl = ce_formData.imagePreview || "";
        if (ce_formData.imagePreview?. startsWith("data:")) {
            console.log("üì§ Uploading banner image...");
            
            const formData = new FormData();
            const base64Data = ce_formData. imagePreview;
            const byteString = atob(base64Data. split(",")[1]);
            const mimeType = base64Data.split(",")[0].split(":")[1].split(";")[0];
            const ab = new ArrayBuffer(byteString.length);
            const ia = new Uint8Array(ab);
            for (let i = 0; i < byteString.length; i++) ia[i] = byteString. charCodeAt(i);
            const blob = new Blob([ab], { type: mimeType });
            const file = new File([blob], "banner.jpg", { type: mimeType });
            formData.append("file", file);

            try {
                const uploadRes = await axios.post(`${API_BASE_URL}/api/images/upload`, formData, {
                    headers: { 
                        "Authorization": `Bearer ${token}`
                    }
                });
                bannerImageUrl = uploadRes.data.url || uploadRes.data.image_url || "";
                console.log("‚úÖ Image uploaded:", bannerImageUrl);
            } catch (imgErr: any) {
                console.error("‚ö†Ô∏è Image upload failed, continuing without image");
            }
        }

        // üîµ STEP B:  Save Event
        const apiPayload = {
            title: ce_formData.title,
            description: ce_formData.description,
            event_date: startISOStr,     // ‚úÖ UTC ISO from Bangkok time
            event_end_date: endISOStr,   // ‚úÖ UTC ISO from Bangkok time
            location: ce_formData.location,
            distance_km: Math.round(Number(ce_formData.distanceKm) || 0),
            max_participants: Number(ce_formData.totalSlots) || 1,
            event_type: ce_formData.eventType,
            allow_daily_checkin: ce_formData.allowDailyCheckin,
            max_checkins_per_user: ce_formData.maxCheckinsPerUser,
            is_active: ce_formData.isActive !== undefined ? ce_formData.isActive : true,
            is_published: ce_formData.isPublic !== undefined ? ce_formData. isPublic : true,
            banner_image_url: bannerImageUrl
        };

        console.log("üìã Event Payload (" + (editingEventId ? "UPDATE" : "CREATE") + "):", JSON.stringify(apiPayload, null, 2));

        let createdEvent: any;
        if (editingEventId) {
            console.log("üîÑ Updating event ID:", editingEventId);
            const updateUrl = `${API_BASE_URL}/api/events/${editingEventId}`;
            console.log("üîÑ Update URL:", updateUrl);
            console.log("üîÑ Update payload:", JSON.stringify(apiPayload, null, 2));
            
            try {
                const res = await axios.put(updateUrl, apiPayload, axiosConfig);
                createdEvent = res.data;
                __createdEventId = createdEvent.id;
                console.log("‚úÖ Event updated successfully!");
                console.log("‚úÖ Response data:", JSON.stringify(res.data, null, 2));
                console.log("‚úÖ Updated event ID:", createdEvent.id);
            } catch (updateErr:  any) {
                console.error("‚ùå Update failed");
                console.error("‚ùå Status:", updateErr.response?.status);
                console.error("‚ùå Response data:", updateErr.response?.data);
                console.error("‚ùå Full error:", updateErr);
                throw updateErr;
            }
        } else {
            console.log("üÜï Creating new event");
            const createUrl = `${API_BASE_URL}/api/events`;
            
            try {
                const res = await axios.post(createUrl, apiPayload, axiosConfig);
                createdEvent = res.data;
                console.log("‚úÖ Event created successfully, ID:", createdEvent.id);
                // send structured log (fire-and-forget)
                __createdEventId = createdEvent.id;
                sendEventLog(__createdEventId, undefined, { type: "event_created", data: createdEvent }).catch(() => {});
            } catch (createErr: any) {
                console.error("‚ùå Create failed");
                console.error("Response data:", createErr.response?. data);
                throw createErr;
            }
        }

        // üîµ STEP C: Save Reward Tiers (Create separate config for each tier)
        if (ce_formData.rewards && ce_formData.rewards.length > 0) {
            console.log("üéÅ Processing reward tiers... Total:", ce_formData.rewards.length);
            console.log("üìã Reward tiers data:", JSON.stringify(ce_formData.rewards, null, 2));
            // log to backend that reward processing started
            sendEventLog(__createdEventId, undefined, { type: "reward_processing_started", total: ce_formData.rewards.length, tiers: ce_formData.rewards }).catch(() => {});
            
            // ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ filter tiers ‡∏ó‡∏µ‡πà valid (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö)
            const validTiers = ce_formData.rewards.filter((tier: RewardForm) => {
                const hasName = tier.name && tier.name.trim() !== "";
                const hasRequirement = (tier.requirement || 0) > 0;
                
                const isValid = hasName && hasRequirement;
                
                if (!isValid) {
                    console.warn("‚ö†Ô∏è Invalid tier skipped:", tier);
                    console.warn("  - Has name:", hasName);
                    console.warn("  - Has requirement (>0):", hasRequirement, "Value:", tier.requirement);
                }
                return isValid;
            });

            console.log("‚úÖ Valid tiers count:", validTiers.length);

            if (validTiers.length > 0) {
                // ‚úÖ STEP C. 1: ‡∏™‡∏£‡πâ‡∏≤‡∏á Rewards ‡πÅ‡∏ö‡∏ö Sequential
                console.log("üéÅ Creating reward items...");
                
                const createdRewardIds:  number[] = [];
                for (let i = 0; i < validTiers.length; i++) {
                    const tier = validTiers[i];
                    console.log(`üì¶ Creating reward ${i + 1}/${validTiers.length}:  `, tier.name);
                    sendEventLog(__createdEventId, undefined, { type: "reward_create_started", tier_index: i + 1, tier }).catch(() => {});
                    
                    try {
                        const rewardUrl = `${API_BASE_URL}/api/rewards`;
                        const res = await axios.post(
                            rewardUrl,
                            {
                                name: tier.name,
                                description: `Reward for ${ce_formData.title}`,
                                reward_type: "ITEM",
                                value: 0
                            }, 
                            axiosConfig
                        );
                        createdRewardIds.push(res.data.id);
                        console.log(`‚úÖ Reward created with ID: ${res.data.id}`);
                        sendEventLog(__createdEventId, undefined, { type: "reward_created", tier_index: i + 1, reward_id: res.data.id }).catch(() => {});
                    } catch (err: any) {
                        console.error(`‚ùå Failed to create reward "${tier.name}"`);
                        console.error("Status:", err.response?.status);
                        console.error("Error data:", err.response?.data || err.message);
                        // send error log
                        sendEventLog(__createdEventId, undefined, { type: "reward_create_failed", tier: tier, status: err.response?.status, error: err.response?.data || err.message }).catch(() => {});
                        throw new Error(`Failed to create reward: ${tier.name}`);
                    }
                }

                console.log("‚úÖ All rewards created IDs:", createdRewardIds);

                // ‚úÖ STEP C.2: ‡∏™‡∏£‡πâ‡∏≤‡∏á Reward Config ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏∏‡∏Å Tiers
                console.log("üéÅ Creating single reward config with all tiers...");
                console.log("üéØ Current Event ID:", createdEvent.id);
                console.log("üéØ __createdEventId:", __createdEventId);
                
                // ‚úÖ ‡πÄ‡∏ä‡πá‡∏Ñ existing configs ‡∏Ç‡∏≠‡∏á event ‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏ó‡∏¥‡πâ‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô edit)
                let existingConfigs: any[] = [];
                try {
                    const configRes = await axios.get(
                        `${API_BASE_URL}/api/reward-leaderboards/configs?event_id=${createdEvent.id}`,
                        axiosConfig
                    );
                    
                    if (Array.isArray(configRes.data)) {
                        existingConfigs = configRes.data;
                    } else if (configRes.data?.results) {
                        existingConfigs = configRes.data.results;
                    }
                    
                    console.log(`‚ÑπÔ∏è Found ${existingConfigs.length} existing configs for event ${createdEvent.id}`);
                    sendEventLog(__createdEventId, undefined, { type: "existing_configs_found", count: existingConfigs.length, configs: existingConfigs }).catch(() => {});
                    
                    // ‚úÖ ‡∏•‡∏ö config ‡πÄ‡∏î‡∏¥‡∏°‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ç‡∏≠‡∏á event ‡∏ô‡∏µ‡πâ (double-check event_id)
                    if (existingConfigs.length > 0) {
                        console.log("üóëÔ∏è Deleting old configs for event:", createdEvent.id);
                        for (const config of existingConfigs) {
                            // ‚úÖ Double-check: ‡∏•‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞ config ‡∏ó‡∏µ‡πà event_id ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏à‡∏£‡∏¥‡∏á‡πÜ
                            if (config.event_id === createdEvent.id) {
                                try {
                                    await axios.delete(
                                        `${API_BASE_URL}/api/reward-leaderboards/configs/${config.id}`,
                                        axiosConfig
                                    );
                                    console.log(`‚úÖ Deleted config ID: ${config.id} for event ${config.event_id}`);
                                    sendEventLog(__createdEventId, undefined, { type: "config_deleted", config_id: config.id }).catch(() => {});
                                } catch (delErr: any) {
                                    console.warn(`‚ö†Ô∏è Failed to delete config ${config.id}:`, delErr.response?.data);
                                    sendEventLog(__createdEventId, undefined, { type: "config_delete_failed", config_id: config.id, error: delErr.response?.data }).catch(() => {});
                                }
                            } else {
                                console.warn(`‚ö†Ô∏è Skipping config ${config.id} - belongs to event ${config.event_id}, not ${createdEvent.id}`);
                            }
                        }
                    }
                } catch (err: any) {
                    console.log(`‚ÑπÔ∏è No existing configs (${err.response?.status})`);
                }
                
                // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á reward_tiers array ‡∏û‡∏£‡πâ‡∏≠‡∏° required_completions
                // ‡πÅ‡∏ö‡πà‡∏á rank range ‡πÅ‡∏•‡∏∞ quantity ‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rank ‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞ tier
                const totalRewards = Number(ce_formData.totalRewards) || 200;
                const tierCount = validTiers.length;
                
                const allRewardTiers = validTiers.map((tier, i) => {
                    // ‡πÅ‡∏ö‡πà‡∏á rank range ‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞ tier (‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ö‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏±‡∏ô)
                    const rangePerTier = Math.floor(totalRewards / tierCount);
                    const minRank = (i * rangePerTier) + 1;
                    const maxRank = (i === tierCount - 1) ? totalRewards : ((i + 1) * rangePerTier);
                    
                    // ‚úÖ quantity = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rank ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏Ç‡∏≠‡∏á tier ‡∏ô‡∏µ‡πâ
                    const tierQuantity = maxRank - minRank + 1;
                    
                    return {
                        tier: i + 1,
                        min_rank: minRank,
                        max_rank: maxRank,
                        reward_id: createdRewardIds[i],
                        reward_name: tier.name,
                        quantity: tierQuantity,  // ‚úÖ quantity = ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rank ‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ
                        required_completions: Number(tier.requirement) || 1
                    };
                });

                // ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á config ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ó‡∏∏‡∏Å tiers
                const rewardPayload = {
                    event_id: createdEvent.id,
                    name: `${ce_formData.title} - Leaderboard`,
                    description: `Reward tiers for ${ce_formData.title}`,
                    required_completions: Number(validTiers[0]?.requirement) || 30,  // ‡∏Ñ‡πà‡∏≤ default ‡∏£‡∏∞‡∏î‡∏±‡∏ö config
                    max_reward_recipients: Number(ce_formData.totalRewards) || 200,
                    reward_tiers: allRewardTiers,
                    starts_at: startISOStr,
                    ends_at: endISOStr
                };

                console.log(`üì§ Leaderboard Config Payload:`, JSON.stringify(rewardPayload, null, 2));
                console.log(`üìä All Reward Tiers:`, allRewardTiers);
                // send payload to backend logging for inspection
                sendEventLog(__createdEventId, undefined, { type: "leaderboard_payload", payload: rewardPayload, tiers: allRewardTiers }).catch(() => {});

                try {
                    console.log(`üÜï Creating leaderboard config with ${allRewardTiers.length} tiers`);
                    const response = await axios.post(
                      `${API_BASE_URL}/api/reward-leaderboards/configs`,
                      rewardPayload, 
                      axiosConfig
                    );
                    console.log(`‚úÖ Leaderboard config created successfully!`);
                    console.log(`‚úÖ Response:`, response.data);
                    // log success
                    sendEventLog(__createdEventId, undefined, { type: "leaderboard_created", response: response.data }).catch(() => {});
                } catch (configErr: any) {
                    console.error(`‚ùå Failed to create leaderboard config`);
                    console.error("‚ùå Full Error:", configErr);
                    console.error("‚ùå Response Status:", configErr.response?.status);
                    console.error("‚ùå Response Data:", configErr.response?.data);
                    
                    // ‡πÅ‡∏™‡∏î‡∏á error detail ‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
                    if (configErr.response?.data?.detail) {
                      if (Array.isArray(configErr.response.data.detail)) {
                        console.error("‚ùå Validation Errors:");
                        configErr.response.data.detail.forEach((err: any, idx: number) => {
                          console.error(`  ${idx + 1}. ${JSON.stringify(err)}`);
                        });
                      } else {
                        console.error("‚ùå Error Detail:", configErr.response.data.detail);
                      }
                    }
                    // send structured error log
                    sendEventLog(__createdEventId, undefined, { type: "leaderboard_create_failed", status: configErr.response?.status, detail: configErr.response?.data }).catch(() => {});
                    
                    throw new Error(`Failed to create leaderboard config`);
                }

                console.log("‚úÖ All reward tier configs created successfully!");
            } else {
                console.warn("‚ö†Ô∏è No valid reward tiers to process");
            }
        } else {
            console.log("‚ÑπÔ∏è No reward tiers configured");
        }

        // üîµ STEP D: Save Holidays Configuration
        if (ce_formData.holidayType !== "none" || ce_formData.excludeWeekends || (ce_formData.specificDates && ce_formData.specificDates.length > 0)) {
            console.log("üéâ Saving holidays configuration...");
            
            try {
              // ‚úÖ First, delete all existing holidays for this event
              console.log(`üóëÔ∏è Deleting existing holidays for event ${createdEvent.id}...`);
              try {
                await axios.delete(
                  `${API_BASE_URL}/api/events/${createdEvent.id}/holidays`,
                  axiosConfig
                );
                console.log("‚úÖ Existing holidays deleted");
              } catch (delErr: any) {
                // Ignore 404 errors (no existing holidays)
                if (delErr.response?.status !== 404) {
                  console.warn("‚ö†Ô∏è Failed to delete existing holidays:", delErr.response?.data);
                }
              }

              // ‚úÖ Prepare holiday dates array
              let holidayDates: string[] = [];

              // If user picked specific holidays in the UI we track them in `ce_formData.holidays`.
              // `specificDates` may be empty if the UI did not sync ‚Äî ensure we use holidays as fallback.
              if (ce_formData.holidayType === "specific") {
                if (!ce_formData.specificDates || ce_formData.specificDates.length === 0) {
                  ce_formData.specificDates = [...(ce_formData.holidays || [])];
                }
                holidayDates = [...(ce_formData.specificDates || [])];
              }
              
              // ‚úÖ Add weekends if enabled
              if (ce_formData.excludeWeekends) {
                // Generate all weekend dates in event range
                const start = new Date(`${ce_formData.sYear}-${String(getMonthIdx(ce_formData.sMonth) + 1).padStart(2, '0')}-${String(ce_formData.sDay).padStart(2, '0')}`);
                const end = new Date(`${ce_formData.eYear}-${String(getMonthIdx(ce_formData.eMonth) + 1).padStart(2, '0')}-${String(ce_formData.eDay).padStart(2, '0')}`);
                
                const current = new Date(start);
                while (current <= end) {
                  const dayOfWeek = current.getDay();
                  if (dayOfWeek === 0 || dayOfWeek === 6) { // Sunday or Saturday
                    const dateStr = current.toISOString().split('T')[0];
                    if (!holidayDates.includes(dateStr)) {
                      holidayDates.push(dateStr);
                    }
                  }
                  current.setDate(current.getDate() + 1);
                }
              }

              console.log("üìù Holiday dates to save:", holidayDates);
              sendEventLog(__createdEventId, undefined, { type: "holidays_save_attempt", dates: holidayDates }).catch(() => {});

              // ‚úÖ Use bulk API to save all holidays at once
              if (holidayDates.length > 0) {
                const holidaysPayload = {
                  holiday_dates: holidayDates,
                  holiday_names: holidayDates.map(() => "")
                };

                console.log("üì§ Sending holidays to API:", holidaysPayload);
                const response = await axios.post(
                  `${API_BASE_URL}/api/events/${createdEvent.id}/holidays/quick`,
                  holidaysPayload,
                  axiosConfig
                );

                console.log("‚úÖ Holidays saved successfully!", response.data);
                console.log(`‚úÖ Created ${response.data.created_count} holidays, Skipped ${response.data.skipped_count}`);
                sendEventLog(__createdEventId, undefined, { type: "holidays_saved", result: response.data }).catch(() => {});
              } else {
                console.log("‚ÑπÔ∏è No holidays to save");
              }
            } catch (holidaysErr: any) {
              console.error("‚ùå Holidays save error:", holidaysErr);
              console.error("‚ùå Error response:", holidaysErr.response?.data);
              sendEventLog(__createdEventId, undefined, { type: "holidays_save_error", error: holidaysErr?.response?.data || holidaysErr.message || holidaysErr }).catch(() => {});
            }
        }

        // üîµ STEP E:  Refresh Data
        console.log("üîÑ Refreshing data after " + (editingEventId ? "update" : "create") + "...");
        sendEventLog(__createdEventId, undefined, { type: "refresh_data" }).catch(() => {});
        
        console.log("üîÑ Fetching updated reward configs...");
        await fetchRewardConfigs();
        console.log("üîÑ Fetching updated events list (force refresh)...");
        await fetchEvents(true);
        console.log("‚úÖ Data refresh completed");
        
        await Swal.fire({ 
            title: "Success", 
            text: editingEventId ? "Event updated successfully!" : "Event created successfully!",
            icon: "success", 
            timer: 2000,
            showConfirmButton: false
        });
        
        const wasEditing = editingEventId !== null;
        currentView = "list";
        editingEventId = null;
        console.log("‚úÖ All process finished! Was editing:", wasEditing);
        sendEventLog(__createdEventId, undefined, { type: "ce_submit_finished", event_id: __createdEventId, was_editing: wasEditing }).catch(() => {});
        
        // ‚úÖ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï __createdEventId ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á event ‡πÉ‡∏´‡∏°‡πà‡πÑ‡∏î‡πâ
        __createdEventId = undefined;

    } catch (error: any) {
      console.error("‚ùå Error occurred:", error);
      console.error("üìã Full error object:", error.response?.data);
      // send error log with as much info as available
      sendEventLog(__createdEventId, undefined, { type: "ce_submit_failed", status: error.response?.status, detail: error.response?.data, message: error.message }).catch(() => {});
        
        const status = error.response?.status;
        const detail = error.response?.data?.detail;
        const message = error.response?.data?. message || error.message;

        if (status === 401) {
            localStorage.removeItem("access_token");
            window.location.href = "/ku-run/auth/login";
        } else if (status === 403) {
            Swal. fire({
                title: "Permission Denied",
                text: "You don't have permission to perform this action.",
                icon: "error"
            });
        } else if (status === 404) {
            Swal.fire({
                title: "Not Found",
                text: "The requested resource was not found.",
                icon: "error"
            });
        } else if (status === 422 || status === 400) {
            Swal.fire({
                title: "Validation Error",
                html: `<pre class="text-left text-sm overflow-auto max-h-96">${JSON.stringify(detail || message || error.response?.data, null, 2)}</pre>`,
                icon: "error",
                width: 600
            });
        } else if (status >= 500) {
            Swal.fire({
                title: "Server Error",
                text: "Server error occurred. Please try again later.",
                icon: "error"
            });
        } else {
            Swal.fire({
                title: "Error",
                text:  message || detail || "Something went wrong.",
                icon: "error"
            });
        }
    }
}
  // ==========================================
  // üîß LOGS VIEW STATE VARIABLES
  // ==========================================

  let logsData: LogsData = {
    selectedEvent: null,
    logs: [],
    loading: false,
    error: "",
    searchQuery: "",
    selectedAction: "All",
    selectedStatus: "All",
    dateFrom: "",
    dateTo: "",
    currentPage: 1,
    itemsPerPage: 10,
    totalItems: 0,
    totalPages: 0,

    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤
    actionDropdownOpen: false,
    statusDropdownOpen: false,
    dateFromDropdownOpen: false,
    dateToDropdownOpen: false,
    showDetailModal: false,
    selectedLog: null,
    statistics: {
      totalLogs: 0,
      uniqueUsers: 0,
      successRate: 0,
      topAction: "-",
    },
  };

  let filteredLogs: Log[] = [];

  // ‚úÖ Check if any filter is active (not based on result count)
  $: isAnyLogsFilterActive = !!(
    logsData.searchQuery?.trim() ||
    logsData.selectedAction?.trim() ||
    logsData.selectedStatus?.trim() ||
    logsData.dateFrom ||
    logsData.dateTo ||
    logsNisitYearFilter?.trim() ||
    logsNisitIdFilter?.trim()
  );

  // ‚úÖ Fixed: Use filters when active, otherwise show all logs
  $: logsToDisplay = isAnyLogsFilterActive ? filteredLogs : logsData.logs;

  $: paginatedLogsForList = logsToDisplay.slice(
    (logsListPage - 1) * logsListPerPage,
    logsListPage * logsListPerPage
  );

  // Group the currently paginated logs by fetched date (YYYY-MM-DD) so UI can render multiple-days batches
  $: groupedPaginatedLogs = (() => {
    const map = new Map();
    for (const log of paginatedLogsForList) {
      const dateKey = log.fetchedAt
        ? log.fetchedAt.split("T")[0]
        : log.timestamp
        ? log.timestamp.split("T")[0]
        : "unknown";
      if (!map.has(dateKey)) map.set(dateKey, []);
      map.get(dateKey).push(log);
    }
    const arr = Array.from(map.entries()).map(([date, items]) => ({ date, items }));
    arr.sort((a, b) => (a.date < b.date ? 1 : -1));
    return arr;
  })();

  let eventsForLogsPage = 1;
  const eventsForLogsPerPage = 8;

  // Action Types Configuration
  const actionTypes = [
    {
      value: "registration",
      label: "Joined",
      labelTh: "‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô",
      icon: "M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z",
      color: "#3b82f6",
    },
    {
      value: "check_in",
      label: "Checked In",
      labelTh: "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô",
      icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
      color: "#06b6d4",
    },
    {
      value: "reward_unlocked",
      label: "Completed",
      labelTh: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
      icon: "M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z",
      color: "#10b981",
    },
    {
      value: "registration_cancelled",
      label: "Cancelled",
      labelTh: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
      icon: "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
      color: "#64748b",
    },
    {
      value: "no_show",
      label: "Rejected",
      labelTh: "‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò",
      icon: "M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z",
      color: "#ef4444",
    },
  ];

  // ‚úÖ Function to get action label based on current language
  function getActionLabel(actionValue: string): string {
    const action = actionTypes.find(a => a.value === actionValue);
    if (!action) return actionValue;
    return currentLang === 'th' ? (action.labelTh || action.label) : action.label;
  }

  const statusTypes = [
    { value: "All", label: "All Status", labelTh: "‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", color: "#64748b" },
    { value: "success", label: "Success", labelTh: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", color: "#10b981" },
    { value: "failed", label: "Failed", labelTh: "‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß", color: "#ef4444" },
    { value: "pending", label: "Pending", labelTh: "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£", color: "#f59e0b" },
    { value: "warning", label: "Warning", labelTh: "‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô", color: "#f97316" },
  ];

  // ‚úÖ Function to get log status label based on current language
  function getLogStatusLabel(statusValue: string): string {
    const status = statusTypes.find(s => s.value === statusValue);
    if (!status) return statusValue;
    return currentLang === 'th' ? (status.labelTh || status.label) : status.label;
  }

  // ==========================================
  // üîÑ LOGS FUNCTIONS
  // ==========================================

  $: availableDatesForFilter = (() => {
    if (!logsData.selectedEvent) return [];

    const event = logsData.selectedEvent;
    const startDate = new Date(
      parseInt(event.year),
      getMonthIdx(event.month),
      1
    );
    const endDate = new Date(
      parseInt(event.year),
      getMonthIdx(event.month) + 1,
      0
    );

    const dates = [];
    const current = new Date(startDate);
    const dayNames = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];

    while (current <= endDate) {
      dates.push({
        value: current.toISOString().split("T")[0],
        display: `${dayNames[current.getDay()]}, ${current.getDate()} ${event.month} ${event.year}`,
      });
      current.setDate(current.getDate() + 1);
    }

    return dates;
  })();

  $: totalEventsForLogsDisplayPages = Math.ceil(
    filteredEventsForLogs.length / eventsForLogsPerPage
  );
  $: paginatedEventsForLogsDisplay = filteredEventsForLogs.slice(
    (eventsForLogsPage - 1) * eventsForLogsPerPage,
    eventsForLogsPage * eventsForLogsPerPage
  );

  function nextEventsForLogsPage() {
    if (eventsForLogsPage < totalEventsForLogsDisplayPages) {
      eventsForLogsPage += 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function prevEventsForLogsPage() {
    if (eventsForLogsPage > 1) {
      eventsForLogsPage -= 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function jumpToEventsForLogsPage(page: number) {
    eventsForLogsPage = page;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  async function selectEventForLogs(event: AppEvent) {
    logsData.selectedEvent = event;
    logsData.loading = true;
    logsData.error = "";

    // Reset filters
    logsData.searchQuery = "";
    logsData.selectedAction = "";
    logsData.selectedStatus = "";
    logsData.dateFrom = "";
    logsData.dateTo = "";

    try {
      await fetchLogs();

      // ‚¨áÔ∏è ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: set filteredLogs ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö logsData.logs
      filteredLogs = [...logsData.logs];
    } catch (err: any) {
      logsData.error = err.message;
    } finally {
      logsData.loading = false;
    }
  }

  function backToEventsList() {
    logsData.selectedEvent = null;
    logsData.logs = [];
    logsData.searchQuery = "";
    logsData.selectedAction = "All";
    logsData.selectedStatus = "All";
    logsData.dateFrom = "";
    logsData.dateTo = "";
    eventsForLogsPage = 1;
    // Force rebuild cache
    lastLogsEventsKey = "";
  }

  async function fetchLogs(isBackground = false) {
    // 1. ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ (Background) ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô Loading
    if (!isBackground) {
      logsData.loading = true;
      logsData.error = "";
    }

    const eventId = logsData.selectedEvent?.id;

    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ Event ID ‡πÉ‡∏´‡πâ‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    if (!eventId) {
      if (!isBackground) logsData.loading = false;
      return;
    }

    if (!isBackground) {
      console.log(`üöÄ [FetchLogs] ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Event ID: ${eventId}`);
    }

    try {
      const API_URL = "http://158.108.102.14:8001";
      const token = localStorage.getItem("access_token");
      if (!token) {
        throw new Error("No access token found");
      }
      
      const axiosHeaders = {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      };
      
      // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• participants
      const participantsUrl = `${API_URL}/api/events/${eventId}/participants`;
      console.log(`üì° Fetching participants from: ${participantsUrl}`);
      
      const participantsResponse = await axios.get(participantsUrl, { headers: axiosHeaders });
      
      // Handle different response formats
      let participants: any[] = [];
      if (Array.isArray(participantsResponse.data)) {
        participants = participantsResponse.data;
      } else if (participantsResponse.data?.participants) {
        participants = participantsResponse.data.participants;
      } else if (participantsResponse.data?.data) {
        participants = participantsResponse.data.data;
      }
      
      console.log("üë• Participants array:", participants);
      console.log(`‚úÖ Participants count: ${participants.length}`);
      
      // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• participations ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ user ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ proof_image_url
      let userParticipationsMap: Map<number, any> = new Map();
      
      // ‡∏î‡∏∂‡∏á participations ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ user (‡∏£‡∏ß‡∏° proof_image_url)
      console.log(`üì∑ Fetching participations for ${participants.length} users...`);
      
      for (const p of participants) {
        try {
          const userParticipationsUrl = `${API_URL}/api/participations/user/${p.user_id}`;
          const userParticipationsRes = await axios.get(userParticipationsUrl, { headers: axiosHeaders });
          
          let userParticipations: any[] = [];
          if (Array.isArray(userParticipationsRes.data)) {
            userParticipations = userParticipationsRes.data;
          } else if (userParticipationsRes.data?.participations) {
            userParticipations = userParticipationsRes.data.participations;
          }
          
          // ‡∏´‡∏≤ participation ‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö event ‡∏ô‡∏µ‡πâ
          const matchingParticipation = userParticipations.find(
            (part: any) => part.event_id === eventId || part.event_id === Number(eventId)
          );
          
          if (matchingParticipation) {
            userParticipationsMap.set(p.user_id, matchingParticipation);
            console.log(`üì∑ User ${p.user_id} participation:`, {
              proof_image_url: matchingParticipation.proof_image_url,
              strava_link: matchingParticipation.strava_link,
              actual_distance_km: matchingParticipation.actual_distance_km
            });
          }
        } catch (err: any) {
          console.warn(`‚ö†Ô∏è Could not fetch participations for user ${p.user_id}:`, err.message);
        }
      }
      
      console.log(`üì∑ Loaded participations for ${userParticipationsMap.size} users`);
      
      // ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• users ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÑ‡∏î‡πâ nisit_id
      let usersMap: Map<number, any> = new Map();
      try {
        const usersUrl = `${API_URL}/api/users/`;
        console.log(`üë§ Fetching users from: ${usersUrl}`);
        
        const usersResponse = await axios.get(usersUrl, { headers: axiosHeaders });
        console.log("üë§ Users response:", usersResponse.data);
        
        let usersData: any[] = [];
        if (Array.isArray(usersResponse.data)) {
          usersData = usersResponse.data;
        } else if (usersResponse.data?.users) {
          usersData = usersResponse.data.users;
        } else if (usersResponse.data?.data) {
          usersData = usersResponse.data.data;
        }
        
        usersData.forEach((user: any) => {
          usersMap.set(user.id, user);
        });
        console.log(`üë§ Loaded ${usersMap.size} users`);
      } catch (usersErr: any) {
        console.warn("‚ö†Ô∏è Could not fetch users:", usersErr.message);
      }
      
      if (participants.length === 0) {
        console.log("‚ÑπÔ∏è Event has no participants yet");
        logsData.logs = [];
        
        logsData.statistics = {
          totalLogs: 0,
          uniqueUsers: 0,
          successRate: 0,
          topAction: "-",
          totalRegistrations: 0,
          totalCheckIns: 0,
          totalRewards: 0,
          totalCancelled: 0
        };
        
        logsData.eventStats = {
          total: 0,
          by_status: {},
          by_role: { officer: 0, student: 0 }
        };
      } else {
        console.log(`‚úÖ Found ${participants.length} participants from API`);
        
        const selectedEvent = logsData.selectedEvent;
        const eventIdStr = String(eventId);
        const eventTitleStr = selectedEvent?.title || '';
        
        // ‚úÖ Debug: Log first participant's raw data to see all available fields
        if (participants.length > 0) {
          console.log("üîç [DEBUG] First participant RAW data:", JSON.stringify(participants[0], null, 2));
          console.log("üîç [DEBUG] All field names:", Object.keys(participants[0]));
        }
        
        // ‚úÖ DEDUPLICATE: Group by user_id to remove duplicates
        const uniqueParticipantsMap = new Map<number, any>();
        participants.forEach((p: any) => {
          const userId = p.user_id;
          if (!uniqueParticipantsMap.has(userId)) {
            uniqueParticipantsMap.set(userId, p);
          } else {
            // Keep the most recent participation (by joined_at or completed_at)
            const existing = uniqueParticipantsMap.get(userId)!;
            const existingDate = new Date(existing.completed_at || existing.joined_at || 0);
            const newDate = new Date(p.completed_at || p.joined_at || 0);
            if (newDate > existingDate) {
              uniqueParticipantsMap.set(userId, p);
            }
          }
        });
        
        const uniqueParticipants = Array.from(uniqueParticipantsMap.values());
        console.log(`‚úÖ Deduplicated: ${participants.length} ‚Üí ${uniqueParticipants.length} unique users`);
        
        logsData.logs = uniqueParticipants.map((p: any, idx: number): Log => {
          // ‚úÖ Look up participation details for this user (includes proof_image_url)
          const userParticipation = userParticipationsMap.get(p.user_id);
          const participationId = userParticipation?.id || p.participation_id || p.id;
          
          // ‚úÖ Get proof_image_url and convert /uploads/ to /api/uploads/
          let rawProofUrl = userParticipation?.proof_image_url || p.proof_image_url || null;
          
          // ‚úÖ Convert /uploads/ to /api/uploads/ (backend serves static files via /api/uploads/)
          if (rawProofUrl && rawProofUrl.includes('/uploads/') && !rawProofUrl.includes('/api/uploads/')) {
            rawProofUrl = rawProofUrl.replace('/uploads/', '/api/uploads/');
          }
          
          const proofImageUrl = rawProofUrl 
            ? (rawProofUrl.startsWith('http') ? rawProofUrl : `${API_URL}${rawProofUrl}`)
            : null;
          
          const stravaLink = userParticipation?.strava_link || p.strava_link || null;
          const actualDistance = userParticipation?.actual_distance_km || p.actual_distance_km || p.distance_covered || 0;
          
          // Look up user details for nisit_id
          const userDetails = usersMap.get(p.user_id);
          const nisitId = p.nisit_id || p.student_id || userDetails?.nisit_id || userDetails?.student_id || '';
          
          // ‚úÖ Debug: Log proof lookup
          console.log(`üîç [DEBUG] User ${p.user_id}:`);
          console.log(`üîç [DEBUG] - participation found: ${!!userParticipation}, participation_id: ${participationId}`);
          console.log(`üîç [DEBUG] - proof_image_url: ${proofImageUrl}`);
          console.log(`üîç [DEBUG] - nisit_id: ${nisitId}`);
          
          return {
            id: String(participationId || p.user_id || `log_${idx}`),
            eventId: eventIdStr,
            eventTitle: eventTitleStr,
            userId: String(p.user_id || ''),
            userName: `${p.first_name || ''} ${p.last_name || ''}`.trim() || `User ${p.user_id}`,
            userEmail: p.email || '',
            userAvatar: (p.first_name?.[0] || 'U').toUpperCase(),
            userNisitId: nisitId,
            participationId: participationId, // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏î‡∏∂‡∏á proof ‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á
            action: p.status === 'completed' ? 'reward_unlocked' : 
                    p.status === 'proof_submitted' ? 'reward_unlocked' :
                    p.status === 'checked_in' ? 'check_in' : 
                    'registration',
            timestamp: p.joined_at || p.created_at || new Date().toISOString(),
            fetchedAt: new Date().toISOString(),
            status: 'success',
            proofImage: proofImageUrl,
            metadata: {
              role: p.role || 'student',
              participationStatus: p.status || 'joined',
              joinedAt: p.joined_at,
              checkedInAt: p.checked_in_at || userParticipation?.checked_in_at,
              completedAt: p.completed_at || userParticipation?.completed_at,
              cancelledAt: p.cancelled_at || userParticipation?.cancelled_at,
              distance_covered: actualDistance,
              actual_distance_km: actualDistance,
              checkin_count: p.checkin_count || 0,
              proof_image_url: proofImageUrl,
              proof_submitted_at: userParticipation?.proof_submitted_at || p.proof_submitted_at,
              strava_link: stravaLink
            }
          };
        });
        
        console.log(`üìù Mapped ${logsData.logs.length} logs with proofs`);

        // ‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì statistics ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
        calculateLogsStatistics(logsData.logs);
        
        console.log("üìä Statistics calculated:", {
          total: logsData.eventStats?.total,
          byRole: logsData.eventStats?.by_role,
          byStatus: logsData.eventStats?.by_status,
          registrations: logsData.statistics.totalRegistrations,
          checkIns: logsData.statistics.totalCheckIns,
          completed: logsData.statistics.totalRewards
        });
      }
      
      // ‚úÖ Update filteredLogs as well
      filteredLogs = [...logsData.logs];
      
      if (!isBackground) {
        console.log(`‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${logsData.logs.length} participants`);
      }

    } catch (error: any) {
      console.error("‚ùå Error fetching logs:", error);
      console.error("‚ùå Error message:", error.message);
      console.error("‚ùå Error details:", error.response?.data);
      console.error("‚ùå Error status:", error.response?.status);
      
      logsData.error = `Failed to load participants: ${error.message}`;
      logsData.logs = [];
      filteredLogs = [];
      
      logsData.statistics = {
        totalLogs: 0,
        uniqueUsers: 0,
        successRate: 0,
        topAction: "-",
        totalRegistrations: 0,
        totalCheckIns: 0,
        totalRewards: 0,
        totalCancelled: 0
      };
      
      logsData.eventStats = {
        total: 0,
        by_status: {},
        by_role: { officer: 0, student: 0 }
      };
    } finally {
      logsData.loading = false;
    }
  }

  function generateMockLogs() {
    const allMockLogs = [
      // ‚úÖ JOINED - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Join Code ‡πÅ‡∏•‡∏∞ Joined
      {
        id: "log_001",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_456",
        userName: "John Doe",
        userEmail: "john.doe@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=John",
        action: "registration",
        timestamp: "2025-01-15T14:30:25Z",
        userNisitId: "6730200001",
        status: "success",
        details: {
          registrationCode: "EVT-ABC123",
          slotNumber: 125,
          rewardTier: "Silver Medal",
          tierRange: "51-150",
        },
        metadata: {
          ipAddress: "192.168.1.100",
          device: "Chrome 120 / Windows 10",
          role: "student",
        },
      },

      // ‚úÖ CHECKED IN - ‡πÅ‡∏™‡∏î‡∏á Join Code, Joined, Checked In
      {
        id: "log_002",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_789",
        userName: "Jane Smith",
        userEmail: "jane.smith@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Jane",
        action: "check_in",
        timestamp: "2025-01-16T09:15:42Z",
        userNisitId: "6730200021",
        status: "success",
        details: {
          registrationCode: "EVT-XYZ789",
          checkInMethod: "QR Code",
          location: "Gate A",
          joinedAt: "2025-01-15T10:00:00Z", // ‡πÄ‡∏û‡∏¥‡πà‡∏° timestamp ‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ Join
        },
        metadata: {
          ipAddress: "192.168.1.101",
          device: "Safari / iPhone",
          role: "student",
        },
      },

      // ‚úÖ COMPLETED - ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á
      {
        id: "log_003",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_456",
        userName: "John Doe",
        userEmail: "john.doe@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=John",
        action: "reward_unlocked",
        timestamp: "2025-01-17T17:00:12Z",
        status: "success",
        details: {
          registrationCode: "EVT-DEF456",
          rewardName: "Gold Medal",
          rank: 25,
          joinedAt: "2025-01-15T08:00:00Z", // ‡πÄ‡∏û‡∏¥‡πà‡∏°
          checkedInAt: "2025-01-16T09:00:00Z", // ‡πÄ‡∏û‡∏¥‡πà‡∏°
        },
        metadata: {
          ipAddress: "192.168.1.100",
          device: "Chrome 120 / Windows 10",
          role: "officer",
        },
      },

      // ‚úÖ CANCELLED - ‡πÅ‡∏™‡∏î‡∏á Join Code, Joined, Cancelled
      {
        id: "log_004",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_005",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_006",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_007",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_008",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_009",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
      {
        id: "log_010",
        eventId: "evt_123",
        eventTitle: "Executive Green Marathon",
        userId: "usr_999",
        userName: "Bob Johnson",
        userEmail: "bob@example.com",
        userAvatar: "https://api.dicebear.com/7.x/avataaars/svg?seed=Bob",
        action: "registration_cancelled",
        timestamp: "2025-01-12T15:45:30Z",
        status: "success",
        details: {
          registrationCode: "EVT-GHI789",
          reason: "Schedule conflict",
          refundAmount: 500,
          joinedAt: "2025-01-10T10:00:00Z",
        },
        metadata: {
          ipAddress: "192.168.1.105",
          device: "Firefox / Windows 11",
          role: "student",
        },
      },
    ];

    return {
      logs: allMockLogs,
      pagination: {
        currentPage: logsData.currentPage,
        totalPages: Math.ceil(allMockLogs.length / logsData.itemsPerPage),
        totalItems: allMockLogs.length,
        itemsPerPage: logsData.itemsPerPage,
      },
    };
  }

  function getActionConfig(action: string) {
    return actionTypes.find((a) => a.value === action) || actionTypes[0];
  }

  function getStatusConfig(status: string) {
    return statusTypes.find((s) => s.value === status) || statusTypes[0];
  }

  function formatTimestamp(timestamp: string, language: string = currentLang) {
    if (!timestamp || timestamp === "-" || timestamp === "") return "-";
    
    try {
      // Parse the timestamp
      const date = new Date(timestamp);
      if (isNaN(date.getTime())) return "-";
      
      // Convert to GMT+7 (Asia/Bangkok timezone)
      const locale = language === "en" ? "en-GB" : "th-TH";
      
      return date.toLocaleString(locale, {
        timeZone: "Asia/Bangkok", // ‚úÖ GMT+7
        day: "2-digit",
        month: "short",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false,
      });
    } catch (error) {
      return "-";
    }
  }

  function formatLogDetails(log: Log) {
    const action = log.action;
    const details = log.details || {};

    switch (action) {
      case "registration":
        return `Code: ${details.registrationCode || '-'} ‚Ä¢ Slot #${details.slotNumber || '-'} ‚Ä¢ ${details.rewardTier || '-'}`;
      case "check_in":
        return `${details.checkInMethod || 'Manual'} ‚Ä¢ Location: ${details.location || '-'}`;
      case "reward_unlocked":
        return `${details.rewardName || 'Reward'} ‚Ä¢ Rank #${details.rank || '-'}`;
      case "registration_cancelled":
        return `Reason: ${details.reason || 'N/A'}${details.refundAmount ? ` ‚Ä¢ Refund: ‡∏ø${details.refundAmount}` : ""}`;
      case "event_updated":
        return `Updated: ${details.changedFields?.join(", ") || '-'}`;
      case "reward_claimed":
        return `${details.rewardName || 'Reward'} ‚Ä¢ ${details.estimatedDelivery || '-'}`;
      default:
        return details && Object.keys(details).length > 0 ? JSON.stringify(details) : '-';
    }
  }

  async function openProofImage(log: any) {
    const API_URL = "http://158.108.102.14:8001";
    
    console.log("üì∑ openProofImage called with log:", JSON.stringify(log, null, 2));
    console.log("üì∑ logsData.selectedEvent:", logsData.selectedEvent);
    
    // Get proof image URL from log
    let proofImageUrl = log.proofImage || log.metadata?.proof_image_url || null;
    let stravaLink = log.metadata?.strava_link || null;
    let actualDistance = log.metadata?.distance_covered || log.metadata?.actual_distance_km || 0;
    
    console.log("üì∑ Initial values - proofImageUrl:", proofImageUrl, "stravaLink:", stravaLink, "actualDistance:", actualDistance);

    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ proofImage ‡πÉ‡∏ô log ‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ user_id
    if (!proofImageUrl) {
      const userId = log.userId;
      const eventId = log.eventId || logsData.selectedEvent?.id;
      
      console.log(`üì∑ proofImageUrl is null, fetching from API...`);
      console.log(`üì∑ userId: ${userId}, eventId: ${eventId}`);
      
      if (userId) {
        try {
          const token = localStorage.getItem("access_token");
          
          console.log(`üì∑ Fetching participations for user_id: ${userId}`);
          
          const response = await axios.get(
            `${API_URL}/api/participations/user/${userId}`,
            {
              headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
              }
            }
          );
          
          console.log("üì∑ User participations (all):", JSON.stringify(response.data, null, 2));
          
          // Find participation matching this event
          const participations = Array.isArray(response.data) ? response.data : [];
          
          console.log(`üì∑ Looking for event_id: ${eventId} (type: ${typeof eventId})`);
          participations.forEach((p: any, i: number) => {
            console.log(`üì∑ Participation[${i}]: event_id=${p.event_id} (type: ${typeof p.event_id}), proof_image_url=${p.proof_image_url}, actual_distance_km=${p.actual_distance_km}`);
          });
          
          const matchingParticipation = participations.find(
            (p: any) => p.event_id === Number(eventId) || p.event_id === eventId
          );
          
          console.log(`üì∑ Matching participation found:`, matchingParticipation ? JSON.stringify(matchingParticipation, null, 2) : 'null');
          
          if (matchingParticipation) {
            console.log("üì∑ Found matching participation:", matchingParticipation);
            proofImageUrl = matchingParticipation.proof_image_url || null;
            stravaLink = stravaLink || matchingParticipation.strava_link || null;
            actualDistance = actualDistance || matchingParticipation.actual_distance_km || 0;
            
            console.log(`üì∑ After extraction - proofImageUrl: ${proofImageUrl}, stravaLink: ${stravaLink}, actualDistance: ${actualDistance}`);
          } else {
            console.log(`üì∑ No matching participation for event_id ${eventId}`);
          }
        } catch (err: any) {
          console.warn("‚ö†Ô∏è Could not fetch user participations:", err.message, err.response?.status);
        }
      }
    }
    
    // ‚úÖ Convert /uploads/ to /api/uploads/ (backend serves static files via /api/uploads/)
    if (proofImageUrl && proofImageUrl.includes('/uploads/') && !proofImageUrl.includes('/api/uploads/')) {
      proofImageUrl = proofImageUrl.replace('/uploads/', '/api/uploads/');
      console.log("üì∑ Converted to /api/uploads/:", proofImageUrl);
    }
    
    // ‚úÖ Prepend API_URL if proof_image_url is a relative path
    if (proofImageUrl && !proofImageUrl.startsWith('http')) {
      proofImageUrl = `${API_URL}${proofImageUrl}`;
      console.log("üì∑ Full proof URL:", proofImageUrl);
    }

    if (!proofImageUrl) {
      Swal.fire({
        title: currentLang === "th" ? "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô" : "No Proof Image",
        text:
          currentLang === "th"
            ? "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ"
            : "No proof image available for this entry",
        icon: "info",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
      return;
    }

    // ‚úÖ Try to load image with authentication (in case server requires it)
    let imageDataUrl = proofImageUrl;
    try {
      const token = localStorage.getItem("access_token");
      console.log("üì∑ Trying to fetch image with auth:", proofImageUrl);
      
      const imgResponse = await fetch(proofImageUrl, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });
      
      if (imgResponse.ok) {
        const blob = await imgResponse.blob();
        imageDataUrl = URL.createObjectURL(blob);
        console.log("üì∑ Image loaded successfully as blob URL");
      } else {
        console.warn("üì∑ Image fetch failed with status:", imgResponse.status, "- will try direct URL");
      }
    } catch (imgErr: any) {
      console.warn("üì∑ Could not fetch image with auth, using direct URL:", imgErr.message);
    }

    // Build HTML content with image and optional Strava link
    let htmlContent = `
      <div style="padding: 0; border-radius: 12px; overflow: hidden;">
        <img src="${imageDataUrl}" style="width: 100%; height: auto; display: block; border-radius: 8px; max-height: 60vh; object-fit: contain;" alt="Proof" onerror="this.onerror=null; this.src='https://placehold.co/800x600/1e293b/64748b?text=Image+Not+Found';" />
      </div>
      <p style="font-size: 10px; color: #64748b; margin-top: 8px; word-break: break-all;">URL: ${proofImageUrl}</p>
    `;

    // Add Strava link if available
    if (stravaLink) {
      htmlContent += `
        <div style="margin-top: 16px; text-align: center;">
          <a href="${stravaLink}" target="_blank" rel="noopener noreferrer" 
             style="display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; background: linear-gradient(135deg, #FC4C02, #FF6B35); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M15.387 17.944l-2.089-4.116h-3.065L15.387 24l5.15-10.172h-3.066m-7.008-5.599l2.836 5.599h4.172L10.463 0l-7 13.828h4.172"/>
            </svg>
            ‡∏î‡∏π Strava Activity
          </a>
        </div>
      `;
    }

    // Add user info
    htmlContent += `
      <div style="margin-top: 16px; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; text-align: left;">
        <p style="margin: 0 0 8px 0; font-size: 14px;">
          <strong style="color: #94a3b8;">‡∏ä‡∏∑‡πà‡∏≠:</strong> 
          <span style="color: #e2e8f0;">${log.userName || 'N/A'}</span>
        </p>
        <p style="margin: 0 0 8px 0; font-size: 14px;">
          <strong style="color: #94a3b8;">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï:</strong> 
          <span style="color: #22d3ee;">${log.userNisitId || 'N/A'}</span>
        </p>
        <p style="margin: 0; font-size: 14px;">
          <strong style="color: #94a3b8;">‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á:</strong> 
          <span style="color: #10b981;">${actualDistance || 0} km</span>
        </p>
      </div>
    `;

    Swal.fire({
      title: currentLang === "th" ? "‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô" : "Proof Image",
      html: htmlContent,
      width: "600px",
      showCloseButton: true,
      showConfirmButton: false,
      background: "#1e293b",
      customClass: {
        popup: "swal-rounded-popup",
      },
    });
  }

  function calculateLogsStatistics(logs: Log[]) {
    // Basic stats
    logsData.statistics.totalLogs = logs.length;
    logsData.statistics.uniqueUsers = new Set(logs.map((l) => l.userId)).size;
    logsData.statistics.successRate =
      logs.length > 0
        ? (logs.filter((l) => l.status === "success").length / logs.length) *
          100
        : 0;

    // Count by action type
    logsData.statistics.totalRegistrations = logs.filter(
      (l) => l.action === "registration"
    ).length;

    logsData.statistics.totalCheckIns = logs.filter(
      (l) => l.action === "check_in"
    ).length;

    logsData.statistics.totalRewards = logs.filter(
      (l) => l.action === "reward_unlocked"
    ).length;

    logsData.statistics.totalCancelled = logs.filter(
      (l) => l.action === "registration_cancelled"
    ).length;

    // Calculate topAction
    const actionCounts = logs.reduce(
      (acc, log) => {
        acc[log.action] = (acc[log.action] || 0) + 1;
        return acc;
      },
      {} as Record<string, number>
    );

    logsData.statistics.topAction =
      Object.keys(actionCounts).length > 0
        ? Object.entries(actionCounts).sort((a, b) => b[1] - a[1])[0][0]
        : "none";

    // ‚úÖ Calculate by_status
    const byStatus: Record<string, number> = {};
    logs.forEach((log) => {
      const status = log.metadata?.participationStatus || "unknown";
      byStatus[status] = (byStatus[status] || 0) + 1;
    });

    // ‚úÖ Calculate by_role
    const byRole: Record<string, number> = {
      officer: logs.filter((l) => l.metadata?.role === "officer").length,
      student: logs.filter((l) => l.metadata?.role === "student").length,
    };

    // ‚úÖ Update eventStats with all required fields
    logsData.eventStats = {
      total: logs.length,
      by_status: byStatus,
      by_role: byRole,
    };

    console.log("üìä Statistics:", logsData.statistics);
    console.log("üìä Event Stats:", logsData.eventStats);
  }

  function openLogDetailModal(log: Log) {
    logsData.selectedLog = log;
    logsData.showDetailModal = true;
  }

  function closeLogDetailModal() {
    logsData.showDetailModal = false;
    logsData.selectedLog = null;
  }

  function applyLogsFilters() {
    let filtered: Log[] = [...logsData.logs];

    // 1. ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Search Query
    if (logsData.searchQuery && logsData.searchQuery.trim() !== "") {
      const query = logsData.searchQuery.toLowerCase().trim();
      filtered = filtered.filter(
        (log: Log) =>
          log.userName.toLowerCase().includes(query) ||
          log.userEmail.toLowerCase().includes(query) ||
          (log.userNisitId && log.userNisitId.includes(query))
      );
    }

    if (logsNisitYearFilter && logsNisitYearFilter.trim() !== "") {
      filtered = filtered.filter(
        (log: Log) =>
          log.userNisitId && log.userNisitId.startsWith(logsNisitYearFilter)
      );
    }

    // 1.6 ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Nisit ID (‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏á)
    if (logsNisitIdFilter && logsNisitIdFilter.trim() !== "") {
      filtered = filtered.filter(
        (log: Log) =>
          log.userNisitId &&
          log.userNisitId.slice(-6).includes(logsNisitIdFilter)
      );
    }

    // 2. ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Action
    if (
      logsData.selectedAction &&
      logsData.selectedAction !== "" &&
      logsData.selectedAction !== "All"
    ) {
      const actionMap: Record<string, string> = {
        officer: "officer",
        student: "student",
        registration: "registration",
        check_in: "check_in",
        reward_unlocked: "reward_unlocked",
        no_show: "no_show",
        registration_cancelled: "registration_cancelled",
      };

      const targetAction = actionMap[logsData.selectedAction];

      if (targetAction === "officer") {
        filtered = filtered.filter(
          (log: Log) => log.metadata?.role === "officer"
        );
      } else if (targetAction === "student") {
        filtered = filtered.filter(
          (log: Log) => log.metadata?.role === "student"
        );
      } else if (targetAction) {
        filtered = filtered.filter((log: Log) => log.action === targetAction);
      }
    }

    // ‚ùå ‡∏•‡∏ö‡∏™‡πà‡∏ß‡∏ô Status filter ‡∏≠‡∏≠‡∏Å (‡∏Ç‡πâ‡∏≠ 3 ‡πÄ‡∏î‡∏¥‡∏°)

    // 3. ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏° Date Range (‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠ 3)
    if (logsData.dateFrom) {
      filtered = filtered.filter((log: Log) => {
        const logDate = new Date(log.timestamp);
        const fromDate = new Date(logsData.dateFrom);
        return logDate >= fromDate;
      });
    }

    if (logsData.dateTo) {
      filtered = filtered.filter((log: Log) => {
        const logDate = new Date(log.timestamp);
        const toDate = new Date(logsData.dateTo);
        toDate.setHours(23, 59, 59, 999);
        return logDate <= toDate;
      });
    }

    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
    filteredLogs = filtered;
    logsData.totalItems = filtered.length;
    logsData.totalPages = Math.ceil(filtered.length / logsData.itemsPerPage);
    logsData.currentPage = 1;
    logsListPage = 1;
  }

  function resetLogsFilters() {
    logsData.searchQuery = "";
    logsData.selectedAction = "";
    logsData.selectedStatus = "";
    logsData.dateFrom = "";
    logsData.dateTo = "";
    logsNisitYearFilter = "";
    logsNisitIdFilter = "";

    // ‡∏õ‡∏¥‡∏î dropdowns
    logsData.actionDropdownOpen = false;
    logsData.statusDropdownOpen = false;
    logsData.dateFromDropdownOpen = false;
    logsData.dateToDropdownOpen = false;

    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    filteredLogs = [...logsData.logs];
    logsData.totalItems = logsData.logs.length;
    logsData.totalPages = Math.ceil(
      logsData.logs.length / logsData.itemsPerPage
    );
    logsData.currentPage = 1;

    console.log("Filters reset");
  }

  async function exportLogsReport(format: string) {
    if (!logsData.selectedEvent) return;

    const event = logsData.selectedEvent;
    const logs = logsData.logs;

    const totalLogs = logs.length;
    const registrations = logs.filter(
      (l) => l.action === "registration"
    ).length;
    const checkIns = logs.filter((l) => l.action === "check_in").length;
    const completed = logs.filter((l) => l.action === "reward_unlocked").length;
    const cancelled = logs.filter(
      (l) => l.action === "registration_cancelled"
    ).length;
    const noShow = logs.filter((l) => l.action === "no_show").length;
    const uniqueUsers = new Set(logs.map((l) => l.userId)).size;
    const checkInRate =
      registrations > 0 ? ((checkIns / registrations) * 100).toFixed(1) : "0";
    const completionRate =
      checkIns > 0 ? ((completed / checkIns) * 100).toFixed(1) : "0";

    // Action Distribution Data
    const actionStats = [
      { label: "Joined", value: registrations, color: "#3b82f6" },
      { label: "Checked In", value: checkIns, color: "#06b6d4" },
      { label: "Completed", value: completed, color: "#10b981" },
      { label: "Cancelled", value: cancelled, color: "#64748b" },
      { label: "No Show", value: noShow, color: "#ef4444" },
    ];

    // User Journey Funnel Data
    const funnelData = [
      { label: "Registered", value: registrations, color: "#3b82f6" },
      { label: "Checked In", value: checkIns, color: "#06b6d4" },
      { label: "Completed", value: completed, color: "#10b981" },
    ];

    // Success vs Drop-off Data
    const successData = [
      { label: "Completed", value: completed, color: "#10b981" },
      { label: "In Progress", value: checkIns - completed, color: "#f59e0b" },
      {
        label: "Dropped",
        value: registrations - checkIns + cancelled + noShow,
        color: "#ef4444",
      },
    ];

    // Engagement Rate Data
    const engagementData = [
      { label: "Active", value: checkIns, color: "#10b981" },
      {
        label: "Inactive",
        value: Math.max(0, registrations - checkIns),
        color: "#e2e8f0",
      },
    ];

    // Hourly Activity Data for Line Chart
    const hours = Array.from({ length: 24 }, (_, i) => i);
    const hourlyData = {
      labels: hours.map((h) => `${h.toString().padStart(2, "0")}:00`),
      joined: hours.map(
        (h) =>
          logs.filter(
            (l) =>
              l.action === "registration" &&
              new Date(l.timestamp).getHours() === h
          ).length
      ),
      checkIn: hours.map(
        (h) =>
          logs.filter(
            (l) =>
              l.action === "check_in" && new Date(l.timestamp).getHours() === h
          ).length
      ),
      completed: hours.map(
        (h) =>
          logs.filter(
            (l) =>
              l.action === "reward_unlocked" &&
              new Date(l.timestamp).getHours() === h
          ).length
      ),
      cancelled: hours.map(
        (h) =>
          logs.filter(
            (l) =>
              l.action === "registration_cancelled" &&
              new Date(l.timestamp).getHours() === h
          ).length
      ),
    };

    // Cumulative Activity Data
    let cumJoined = 0,
      cumCheckIn = 0,
      cumCompleted = 0;
    const cumulativeData = {
      labels: hours.map((h) => `${h.toString().padStart(2, "0")}:00`),
      joined: hours.map((h) => {
        cumJoined += hourlyData.joined[h];
        return cumJoined;
      }),
      checkIn: hours.map((h) => {
        cumCheckIn += hourlyData.checkIn[h];
        return cumCheckIn;
      }),
      completed: hours.map((h) => {
        cumCompleted += hourlyData.completed[h];
        return cumCompleted;
      }),
    };

    const generatedDate = new Date().toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
    });
    const generatedTime = new Date().toLocaleTimeString("en-US", {
      hour: "2-digit",
      minute: "2-digit",
    });
    const eventTitle = event.title;
    const eventLocation = event.location;
    const fileName =
      "logs-report-" +
      eventTitle.replace(/\s+/g, "-").toLowerCase() +
      "-" +
      new Date().toISOString().split("T")[0];

    const cssStyles = `
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
      :root{--primary:#0f766e;--primary-light:#14b8a6;--secondary:#1e293b;--bg:#ffffff;--bg-alt:#f8fafc;--border:#e2e8f0;--text:#1e293b;--text-muted:#64748b}
      *{margin:0;padding:0;box-sizing:border-box}
      body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;font-size:14px}
      .container{max-width:1100px;margin:0 auto;padding:40px}
      .report-header{display:flex;justify-content:space-between;align-items:flex-start;padding-bottom:24px;border-bottom:2px solid var(--primary);margin-bottom:32px}
      .brand{display:flex;align-items:center;gap:12px}
      .brand-logo{width:48px;height:48px;background:linear-gradient(135deg,var(--primary),var(--primary-light));border-radius:10px;display:flex;align-items:center;justify-content:center}
      .brand-logo svg{width:28px;height:28px;color:white}
      .brand-text h1{font-size:20px;font-weight:700;color:var(--primary)}
      .brand-text p{font-size:12px;color:var(--text-muted)}
      .report-meta{text-align:right}
      .report-meta h2{font-size:14px;font-weight:600;color:var(--text)}
      .report-meta p{font-size:12px;color:var(--text-muted)}
      .event-title{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:24px;margin-bottom:32px}
      .event-title h3{font-size:24px;font-weight:700;color:var(--secondary);margin-bottom:8px}
      .event-info{display:flex;flex-wrap:wrap;gap:24px;color:var(--text-muted);font-size:13px}
      .event-info span{display:flex;align-items:center;gap:6px}
      .section{margin-bottom:32px}
      .section-title{font-size:16px;font-weight:600;color:var(--secondary);margin-bottom:16px;display:flex;align-items:center;gap:8px}
      .section-title svg{width:20px;height:20px;color:var(--primary)}
      .stats-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:16px}
      .stat-card{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:20px;text-align:center}
      .stat-card.highlight{background:linear-gradient(135deg,var(--primary),var(--primary-light));border:none;color:white}
      .stat-card.highlight .stat-label{color:rgba(255,255,255,0.8)}
      .stat-value{font-size:28px;font-weight:700;margin-bottom:4px}
      .stat-label{font-size:12px;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.5px}
      .charts-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:24px}
      .charts-grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:24px;margin-top:24px}
      .chart-card{background:var(--bg-alt);border:1px solid var(--border);border-radius:12px;padding:20px}
      .chart-title{font-size:14px;font-weight:600;color:var(--secondary);margin-bottom:16px}
      .chart-container{height:220px;position:relative}
      .table-wrapper{overflow-x:auto}
      table{width:100%;border-collapse:collapse;font-size:13px}
      th,td{padding:12px;text-align:left;border-bottom:1px solid var(--border)}
      th{background:var(--bg-alt);font-weight:600;color:var(--secondary)}
      .text-center{text-align:center}
      .action-badge{display:inline-block;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:500}
      .report-footer{margin-top:40px;padding-top:20px;border-top:1px solid var(--border);display:flex;justify-content:space-between;font-size:12px;color:var(--text-muted)}
      @media print{body{print-color-adjust:exact;-webkit-print-color-adjust:exact}}
    `;

    const chartScript = `
      const actionData=${JSON.stringify(actionStats)};
      const funnelData=${JSON.stringify(funnelData)};
      const successData=${JSON.stringify(successData)};
      const engagementData=${JSON.stringify(engagementData)};
      const hourlyData=${JSON.stringify(hourlyData)};
      const cumulativeData=${JSON.stringify(cumulativeData)};
      
      Chart.defaults.font.family="'Inter',sans-serif";
      
      // 1. Activity Distribution - Doughnut
      new Chart(document.getElementById('activityPieChart'),{
        type:'doughnut',
        data:{
          labels:actionData.map(a=>a.label),
          datasets:[{data:actionData.map(a=>a.value),backgroundColor:actionData.map(a=>a.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 2. Success Rate - Pie
      new Chart(document.getElementById('successChart'),{
        type:'pie',
        data:{
          labels:successData.map(s=>s.label),
          datasets:[{data:successData.map(s=>s.value),backgroundColor:successData.map(s=>s.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 3. Engagement Rate - Doughnut
      new Chart(document.getElementById('engagementChart'),{
        type:'doughnut',
        data:{
          labels:engagementData.map(e=>e.label),
          datasets:[{data:engagementData.map(e=>e.value),backgroundColor:engagementData.map(e=>e.color),borderWidth:0}]
        },
        options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{legend:{position:'right',labels:{boxWidth:12,padding:8,font:{size:11}}}}}
      });
      
      // 4. Activity Bar Chart
      new Chart(document.getElementById('activityBarChart'),{
        type:'bar',
        data:{
          labels:actionData.map(a=>a.label),
          datasets:[{label:'Count',data:actionData.map(a=>a.value),backgroundColor:actionData.map(a=>a.color),borderRadius:4}]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,grid:{color:'#f1f5f9'}},x:{grid:{display:false}}}}
      });
      
      // 5. User Journey Funnel - Horizontal Bar
      new Chart(document.getElementById('funnelChart'),{
        type:'bar',
        data:{
          labels:funnelData.map(f=>f.label),
          datasets:[{label:'Users',data:funnelData.map(f=>f.value),backgroundColor:funnelData.map(f=>f.color),borderRadius:4}]
        },
        options:{indexAxis:'y',responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{beginAtZero:true}}}
      });

      // 6. Hourly Activity Timeline - Line Chart
      new Chart(document.getElementById('hourlyLineChart'),{
        type:'line',
        data:{
          labels:hourlyData.labels,
          datasets:[
            {label:'Joined',data:hourlyData.joined,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.1)',fill:true,tension:0.4,borderWidth:2,pointRadius:3,pointBackgroundColor:'#3b82f6'},
            {label:'Check-in',data:hourlyData.checkIn,borderColor:'#06b6d4',backgroundColor:'transparent',fill:false,tension:0.4,borderWidth:2,pointRadius:3,pointBackgroundColor:'#06b6d4'},
            {label:'Completed',data:hourlyData.completed,borderColor:'#10b981',backgroundColor:'transparent',fill:false,tension:0.4,borderWidth:2,pointRadius:3,pointBackgroundColor:'#10b981'},
            {label:'Cancelled',data:hourlyData.cancelled,borderColor:'#ef4444',backgroundColor:'transparent',fill:false,tension:0.4,borderWidth:2,pointRadius:3,pointBackgroundColor:'#ef4444'}
          ]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{boxWidth:12,padding:15,font:{size:11}}}},scales:{y:{beginAtZero:true,grid:{color:'#f1f5f9'}},x:{grid:{display:false},ticks:{maxTicksLimit:12}}}}
      });

      // 7. Cumulative Progress - Area Line Chart
      new Chart(document.getElementById('cumulativeLineChart'),{
        type:'line',
        data:{
          labels:cumulativeData.labels,
          datasets:[
            {label:'Total Joined',data:cumulativeData.joined,borderColor:'#3b82f6',backgroundColor:'rgba(59,130,246,0.15)',fill:true,tension:0.4,borderWidth:2.5,pointRadius:0},
            {label:'Total Check-in',data:cumulativeData.checkIn,borderColor:'#06b6d4',backgroundColor:'rgba(6,182,212,0.15)',fill:true,tension:0.4,borderWidth:2.5,pointRadius:0},
            {label:'Total Completed',data:cumulativeData.completed,borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.15)',fill:true,tension:0.4,borderWidth:2.5,pointRadius:0}
          ]
        },
        options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'top',labels:{boxWidth:12,padding:15,font:{size:11}}}},scales:{y:{beginAtZero:true,grid:{color:'#f1f5f9'}},x:{grid:{display:false},ticks:{maxTicksLimit:12}}}}
      });
    `;

    const reportHTML = `
      <!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Activity Logs Report - ${eventTitle}</title>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"><\/script>
      <style>${cssStyles}</style></head><body>
      <div class="container">
      
      <header class="report-header">
        <div class="brand">
          <div class="brand-logo"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg></div>
          <div class="brand-text"><h1>Activity Logs</h1><p>Event Analytics Report</p></div>
        </div>
        <div class="report-meta"><h2>Analysis Report</h2><p>Generated: ${generatedDate}</p><p>Time: ${generatedTime}</p></div>
      </header>
      
      <div class="event-title"><h3>${eventTitle}</h3><div class="event-info">
        <span><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>${eventLocation}</span>
      </div></div>
      
      <section class="section">
        <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Executive Summary</h4>
        <div class="stats-grid">
          <div class="stat-card highlight"><div class="stat-value">${totalLogs.toLocaleString()}</div><div class="stat-label">Total Activities</div></div>
          <div class="stat-card"><div class="stat-value">${uniqueUsers.toLocaleString()}</div><div class="stat-label">Unique Users</div></div>
          <div class="stat-card"><div class="stat-value">${checkInRate}%</div><div class="stat-label">Check-in Rate</div></div>
          <div class="stat-card"><div class="stat-value">${completionRate}%</div><div class="stat-label">Completion Rate</div></div>
        </div>
      </section>
      
      <section class="section">
        <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>Activity Analytics - Distribution Charts</h4>
        <div class="charts-grid">
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#3b82f6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>Activity Distribution</div><div class="chart-container"><canvas id="activityPieChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#10b981"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Success Rate</div><div class="chart-container"><canvas id="successChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#8b5cf6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path></svg>Engagement Rate</div><div class="chart-container"><canvas id="engagementChart"></canvas></div></div>
        </div>
        <div class="charts-grid-2">
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#06b6d4"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-5v5m-4-2v2m-2 4h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>Activity Count by Type</div><div class="chart-container"><canvas id="activityBarChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#f59e0b"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>User Journey Funnel</div><div class="chart-container"><canvas id="funnelChart"></canvas></div></div>
        </div>
      </section>

      <section class="section">
        <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>Activity Timeline - Trend Analysis (Line Charts)</h4>
        <div class="charts-grid-2">
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#3b82f6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Hourly Activity Timeline</div><div class="chart-container" style="height:280px"><canvas id="hourlyLineChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16" style="vertical-align:middle;margin-right:4px;color:#10b981"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>Cumulative Progress</div><div class="chart-container" style="height:280px"><canvas id="cumulativeLineChart"></canvas></div></div>
        </div>
      </section>
      
      <section class="section">
        <h4 class="section-title"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="20" height="20" style="vertical-align:middle;margin-right:6px;color:#0f766e"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>Recent Activities (Top 10)</h4>
        <div class="table-wrapper"><table><thead><tr><th>#</th><th>Name</th><th>Nisit ID</th><th>Action</th><th>Time</th></tr></thead>
        <tbody>${recentLogsHTML}</tbody></table></div>
      </section>
      
      <footer class="report-footer"><span>Activity Logs Management System - Confidential</span><span>Page 1 of 1</span></footer>
      </div>
      <script>${chartScript}<\/script></body></html>
    `;

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á iframe ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠ render ‡πÅ‡∏•‡πâ‡∏ß capture
    const iframe = document.createElement("iframe");
    iframe.style.position = "fixed";
    iframe.style.left = "-9999px";
    iframe.style.width = "1200px";
    iframe.style.height = "3200px";
    document.body.appendChild(iframe);

    const iframeDoc = iframe.contentDocument || iframe.contentWindow?.document;
    if (!iframeDoc) {
      document.body.removeChild(iframe);
      return;
    }

    iframeDoc.open();
    iframeDoc.write(reportHTML);
    iframeDoc.close();

    // ‡∏£‡∏≠‡πÉ‡∏´‡πâ Chart.js ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞ render
    await new Promise((resolve) => setTimeout(resolve, 2500));

    try {
      // ‡πÇ‡∏´‡∏•‡∏î html2canvas ‡πÅ‡∏•‡∏∞ jspdf
      if (!document.querySelector('script[src*="html2canvas"]')) {
        const html2canvasScript = document.createElement("script");
        html2canvasScript.src =
          "https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js";
        document.head.appendChild(html2canvasScript);
      }

      if (!document.querySelector('script[src*="jspdf"]')) {
        const jspdfScript = document.createElement("script");
        jspdfScript.src =
          "https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js";
        document.head.appendChild(jspdfScript);
      }

      await new Promise((resolve) => setTimeout(resolve, 1000));

      const container = iframeDoc.querySelector(".container");
      if (!container) {
        throw new Error("Container not found");
      }

      // @ts-ignore
      const canvas = await html2canvas(container, {
        scale: 2,
        useCORS: true,
        logging: false,
        backgroundColor: "#ffffff",
      });

      if (format === "png") {
        const link = document.createElement("a");
        link.download = fileName + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
      } else if (format === "pdf") {
        // @ts-ignore
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");
        const imgWidth = 210;
        const imgHeight = (canvas.height * imgWidth) / canvas.width;
        const imgData = canvas.toDataURL("image/png");

        let position = 0;
        const pageHeight = 297;

        if (imgHeight > pageHeight) {
          while (position < imgHeight) {
            if (position > 0) pdf.addPage();
            pdf.addImage(imgData, "PNG", 0, -position, imgWidth, imgHeight);
            position += pageHeight;
          }
        } else {
          pdf.addImage(imgData, "PNG", 0, 0, imgWidth, imgHeight);
        }
        pdf.save(fileName + ".pdf");
      }

      Swal.fire({
        title: "Report Downloaded!",
        text: "Your " + format.toUpperCase() + " report has been saved.",
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
    } catch (error) {
      console.error("Export error:", error);
      // Fallback: ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô tab ‡πÉ‡∏´‡∏°‡πà
      const blob = new Blob([reportHTML], { type: "text/html;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      window.open(url, "_blank");

      Swal.fire({
        title: "Report Generated!",
        text: "Please use the browser's save function to download.",
        icon: "info",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
    } finally {
      document.body.removeChild(iframe);
    }
  }

  let logs: any[] = [];
  let recentLogsHTML = "";

  const getLogColor = (action: string) => {
    // ‡∏•‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏Å getActionConfig ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤
    try {
      // @ts-ignore
      if (typeof getActionConfig === "function")
        return getActionConfig(action).color;
    } catch (e) {}
    return "#64748b"; // ‡∏™‡∏µ Default
  };

  const getLogLabel = (action: string) => {
    try {
      // @ts-ignore
      if (typeof getActionConfig === "function")
        return getActionConfig(action).label;
    } catch (e) {}
    return action;
  };

  // 3. ‡πÉ‡∏ä‡πâ $: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà logsData ‡∏´‡∏£‡∏∑‡∏≠ currentLang ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô
  $: {
    // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤ logsData ‡πÅ‡∏•‡∏∞ logsData.logs ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏´‡∏°
    // (‡πÅ‡∏Å‡πâ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà Code ‡πÄ‡∏Å‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ logs ‡πÄ‡∏â‡∏¢‡πÜ ‡∏ã‡∏∂‡πà‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏£‡∏¥‡∏á)
    const sourceLogs =
      typeof logsData !== "undefined" && logsData.logs ? logsData.logs : [];

    if (sourceLogs && Array.isArray(sourceLogs)) {
      // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏Å‡πâ‡∏≠‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß (‡πÉ‡∏ä‡πâ map ‡πÅ‡∏•‡πâ‡∏ß join ‡∏à‡∏∞‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
      recentLogsHTML = sourceLogs
        .slice(0, 10)
        .map((log: any, idx: number) => {
          // -- ‡∏™‡πà‡∏ß‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á Real-time) + GMT+7 --
          const dateText = new Date(log.timestamp).toLocaleString(
            currentLang === "th" ? "th-TH" : "en-GB",
            { timeZone: "Asia/Bangkok" }
          );
          // ---------------------------------------------

          const color = getLogColor(log.action);
          const label = getLogLabel(log.action);

          // ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô HTML String
          return `
          <tr>
            <td class="text-center">${idx + 1}</td>
            <td>${log.userName || "-"}</td>
            <td>${log.userNisitId || "-"}</td>
            <td>
              <span class="action-badge" style="background:${color}20; color:${color}">
                ${label}
              </span>
            </td>
            <td>${dateText}</td>
          </tr>
        `;
        })
        .join(""); // ‡∏£‡∏ß‡∏°‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏±‡∏ô
    } else {
      recentLogsHTML = "";
    }
  }

  const formatLogDate = (dateStr: string, lang: string = currentLang) => {
    if (!dateStr) return "-";
    return new Date(dateStr).toLocaleString(lang === "th" ? "th-TH" : "en-GB", { timeZone: "Asia/Bangkok" });
  };

  function changeLogsPage(page: number) {
    if (page < 1 || page > logsData.totalPages) return;
    logsData.currentPage = page;
    fetchLogs();
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  function selectDateFrom(date: string) {
    logsData.dateFrom = date;
    logsData.dateFromDropdownOpen = false;
  }

  function selectDateTo(date: string) {
    logsData.dateTo = date;
    logsData.dateToDropdownOpen = false;
  }

  // Pagination for Logs List
  let logsListPage = 1;
  const logsListPerPage = 8;

  $: totalLogsListPages = Math.ceil(logsToDisplay.length / logsListPerPage);

  function nextLogsListPage() {
    if (logsListPage < totalLogsListPages) {
      logsListPage += 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function prevLogsListPage() {
    if (logsListPage > 1) {
      logsListPage -= 1;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }
  }

  function jumpToLogsListPage(page: number) {
    logsListPage = page;
    window.scrollTo({ top: 0, behavior: "smooth" });
  }

  // Reset pagination when filters change
  $: if (
    logsData.searchQuery ||
    logsData.selectedAction ||
    logsData.selectedStatus ||
    logsData.dateFrom ||
    logsData.dateTo
  ) {
    logsListPage = 1;
  }

  $: if (currentView === "log" && !logsData.selectedEvent) {
    // Reset filters only when entering log view without selected event
    eventsForLogsPage = 1;
  }

  // OPTIMIZED: filteredEventsForLogs with memoization
  let lastLogsEventsKey = "";
  let cachedFilteredEventsForLogs: AppEvent[] = [];

  $: {
    // Only rebuild cache when in log view and no event is selected
    if (currentView === "log" && !logsData.selectedEvent) {
      const cacheKey = `logs_${events.length}_${searchQueryLogs}_${selectedMonthLogs}_${selectedYearLogs}`;
      if (cacheKey !== lastLogsEventsKey) {
        lastLogsEventsKey = cacheKey;
        cachedFilteredEventsForLogs = filterEventsOptimized(
          events,
          searchQueryLogs,
          selectedMonthLogs,
          selectedYearLogs
        );
      }
    }
  }

  $: filteredEventsForLogs = cachedFilteredEventsForLogs;

  // ‚úÖ Pagination ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Events in Logs View

  $: paginatedEventsForLogs = filteredEventsForLogs.slice(
    (eventsForLogsPage - 1) * eventsForLogsPerPage,
    eventsForLogsPage * eventsForLogsPerPage
  );

  // ========================================
  // üì§ EXPORT FUNCTIONS
  // ========================================

  function toggleExportMenu() {
    showExportMenu = !showExportMenu;
  }

  async function exportLogs(format: string) {
    isExporting = true;
    showExportMenu = false;

    try {
      await new Promise((resolve) => setTimeout(resolve, 1000)); // Simulate export

      const allLogs = logsData.logs; // ‡πÉ‡∏ä‡πâ logs ‡∏ó‡∏µ‡πà filter ‡πÅ‡∏•‡πâ‡∏ß

      if (format === "csv") {
        exportToCSV(allLogs);
      } else if (format === "json") {
        exportToJSON(allLogs);
      } else if (format === "pdf") {
        exportToPDF(allLogs);
      } else if (format === "excel") {
        exportToExcel(allLogs);
      }

      Swal.fire({
        title: "Export Successful!",
        text: `Logs exported as ${format.toUpperCase()}`,
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
        timer: 2000,
      });
    } catch (error) {
      Swal.fire({
        title: "Export Failed",
        text: "Failed to export logs. Please try again.",
        icon: "error",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#ef4444",
      });
    } finally {
      isExporting = false;
    }
  }

  function exportToCSV(logs: Log[]) {
    const headers = [
      "Timestamp",
      "Event Title",
      "User Name",
      "User Email",
      "Action Type",
      "Status",
      "Details",
      "IP Address",
    ];
    const rows = logs.map((log) => [
      log.timestamp,
      log.eventTitle,
      log.userName,
      log.userEmail,
      log.action,
      log.status,
      JSON.stringify(log.details),
      log.metadata?.ipAddress || "N/A",
    ]);

    let csvContent = headers.join(",") + "\n";
    rows.forEach((row) => {
      csvContent += row.map((cell) => `"${cell}"`).join(",") + "\n";
    });

    downloadFile(csvContent, "logs-export.csv", "text/csv");
  }

  function exportToJSON(logs: Log[]) {
    const jsonContent = JSON.stringify(logs, null, 2);
    downloadFile(jsonContent, "logs-export.json", "application/json");
  }

  function exportToPDF(logs: Log[]) {
    // Simplified PDF export - in production, use a library like jsPDF
    let pdfContent = "Event Logs Report\n\n";
    logs.forEach((log) => {
      pdfContent += `Timestamp: ${log.timestamp}\n`;
      pdfContent += `User: ${log.userName} (${log.userEmail})\n`;
      pdfContent += `Action: ${log.action}\n`;
      pdfContent += `Status: ${log.status}\n`;
      pdfContent += `---\n\n`;
    });
    downloadFile(pdfContent, "logs-export.txt", "text/plain");
  }

  async function exportToExcel(logs: Log[]) {
    // ‡πÇ‡∏´‡∏•‡∏î SheetJS library
    // @ts-ignore
    if (typeof window.XLSX === "undefined") {
      await new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src =
          "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
        s.onload = resolve;
        s.onerror = reject;
        document.head.appendChild(s);
      });
    }

    // @ts-ignore
    const XLSX = window.XLSX;

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    const data = logs.map((log, idx) => ({
      "No.": idx + 1,
      Name: log.userName,
      "Nisit ID": log.userNisitId || "N/A",
      Email: log.userEmail,
      Action: getActionConfig(log.action).label,
      Status: log.status,
      "Join Code": log.details?.registrationCode || "N/A",
      Timestamp: new Date(log.timestamp).toLocaleString(currentLang === "th" ? "th-TH" : "en-GB", { timeZone: "Asia/Bangkok" }),
      Role: log.metadata?.role || "N/A",
    }));

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á workbook ‡πÅ‡∏•‡∏∞ worksheet
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    ws["!cols"] = [
      { wch: 5 }, // No.
      { wch: 20 }, // Name
      { wch: 12 }, // Nisit ID
      { wch: 25 }, // Email
      { wch: 12 }, // Action
      { wch: 10 }, // Status
      { wch: 12 }, // Join Code
      { wch: 20 }, // Timestamp
      { wch: 10 }, // Role
    ];

    XLSX.utils.book_append_sheet(wb, ws, "Activity Logs");

    // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
    const fileName = `logs-${logsData.selectedEvent?.title?.replace(/\s+/g, "-") || "export"}-${new Date().toISOString().split("T")[0]}.xlsx`;
    XLSX.writeFile(wb, fileName);
  }

  async function exportRewardsToExcel(users: RewardUser[]) {
    // ‡πÇ‡∏´‡∏•‡∏î SheetJS library
    // @ts-ignore
    if (typeof window.XLSX === "undefined") {
      await new Promise((resolve, reject) => {
        const s = document.createElement("script");
        s.src =
          "https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js";
        s.onload = resolve;
        s.onerror = reject;
        document.head.appendChild(s);
      });
    }

    // @ts-ignore
    const XLSX = window.XLSX;

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    // Sort by Global Rank ascending for predictable ordering
    const sorted = [...users].sort((a, b) => {
      const ra = Number(a.globalRank) || Number.MAX_SAFE_INTEGER;
      const rb = Number(b.globalRank) || Number.MAX_SAFE_INTEGER;
      return ra - rb;
    });

    const data = sorted.map((user) => ({
      "Global Rank": user.globalRank ?? "",
      "Tier Rank": user.tierRank ?? "",
      "Nisit ID": user.nisitId ?? "",
      "User ID": (user as any).userId ?? "",
      "Participation ID": (user as any).participationId ?? "",
      Name: user.name ?? "",
      Email: user.email ?? "",
      Tier: user.tier ?? "",
      Progress: user.completedCount ?? "",
      Required: user.requiredCount ?? "",
      Status:
        user.status === "completed"
          ? "Completed"
          : user.status === "in_progress"
            ? "In Progress"
            : "No Tier",
      "Completed At": user.completedAt
        ? new Date(user.completedAt).toLocaleString(currentLang === "th" ? "th-TH" : "en-GB", { timeZone: "Asia/Bangkok" })
        : "N/A",
      "Join Code": user.joinCode ?? "",
      "Strava Link": (user as any).stravaLink ?? "",
      "Distance (km)": ((user as any).distance || (user as any).actual_distance_km) ?? "",
      "Proof Image URL": (user as any).proofImage ?? "",
    }));

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á workbook ‡πÅ‡∏•‡∏∞ worksheet
    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();

    // ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå
    ws["!cols"] = [
      { wch: 12 }, // Global Rank
      { wch: 10 }, // Tier Rank
      { wch: 12 }, // Nisit ID
      { wch: 12 }, // User ID
      { wch: 14 }, // Participation ID
      { wch: 20 }, // Name
      { wch: 25 }, // Email
      { wch: 15 }, // Tier
      { wch: 10 }, // Progress
      { wch: 10 }, // Required
      { wch: 12 }, // Status
      { wch: 20 }, // Completed At
      { wch: 12 }, // Join Code
      { wch: 25 }, // Strava Link
      { wch: 12 }, // Distance
      { wch: 40 }, // Proof Image URL
    ];

    XLSX.utils.book_append_sheet(wb, ws, "Rewards");

    // ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î
    const fileName = `rewards-${rewardData.selectedEvent?.title?.replace(/\s+/g, "-") || "export"}-${new Date().toISOString().split("T")[0]}.xlsx`;
    XLSX.writeFile(wb, fileName);
  }

  function downloadFile(content: string, filename: string, mimeType: string) {
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  }

  // ========================================
  // üîå WEBSOCKET FUNCTIONS
  // ========================================

  let logsRefreshInterval: any = null;
  const REALTIME_POLLING_INTERVAL = 10000; // 10 seconds for real-time (‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà)
  let lastKnownLogsHash = ''; // ‡πÄ‡∏Å‡πá‡∏ö hash ‡∏Ç‡∏≠‡∏á logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö

  function initWebSocket() {
    if (!logsData.selectedEvent) return;

    isConnected = true;

    // ‡πÉ‡∏ä‡πâ Polling ‡πÅ‡∏ó‡∏ô WebSocket ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö real-time updates
    if (autoRefreshEnabled && !logsRefreshInterval) {
      console.log("üîÑ Starting real-time polling...");
      
      // ‡∏ï‡∏±‡πâ‡∏á initial hash
      lastKnownLogsHash = generateLogsHash(logsData.logs);

      logsRefreshInterval = setInterval(async () => {
        if (autoRefreshEnabled && logsData.selectedEvent && !document.hidden) {
          try {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• participants ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà timeline)
            const API_URL = "http://158.108.102.14:8001";
            const token = localStorage.getItem("access_token");
            
            const res = await axios.get(
              `${API_URL}/api/events/${logsData.selectedEvent.id}/participants`,
              {
                headers: {
                  "Authorization": `Bearer ${token}`,
                  "Content-Type": "application/json"
                }
              }
            );

            let newParticipants: any[] = [];
            if (Array.isArray(res.data)) {
              newParticipants = res.data;
            } else if (res.data?.participants) {
              newParticipants = res.data.participants;
            } else if (res.data?.data) {
              newParticipants = res.data.data;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á hash ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö
            const newHash = generateParticipantsHash(newParticipants);
            const currentCount = logsData.logs?.length || 0;
            
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏à‡∏£‡∏¥‡∏á‡πÜ (hash ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô)
            if (newHash !== lastKnownLogsHash && newParticipants.length > currentCount) {
              newLogsCount = newParticipants.length - currentCount;
              console.log(
                `üì¢ New activity detected: ${newLogsCount} new items (hash changed)`
              );
              lastKnownLogsHash = newHash;
            } else if (newHash !== lastKnownLogsHash) {
              // Hash changed but count same = status updated
              console.log("üìù Data updated (status change detected)");
              lastKnownLogsHash = newHash;
              // Auto refresh silently
              await fetchLogs(true);
            }

            updateLastSyncTime();
          } catch (err) {
            console.warn("‚ö†Ô∏è Real-time polling error:", err);
          }
        }
      }, REALTIME_POLLING_INTERVAL);
    }
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á hash ‡∏à‡∏≤‡∏Å logs ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á
  function generateLogsHash(logs: Log[]): string {
    if (!logs || logs.length === 0) return '';
    return logs.map(l => `${l.userId}:${l.action}:${l.timestamp}`).sort().join('|');
  }

  // ‡∏™‡∏£‡πâ‡∏≤‡∏á hash ‡∏à‡∏≤‡∏Å participants
  function generateParticipantsHash(participants: any[]): string {
    if (!participants || participants.length === 0) return '';
    return participants.map(p => `${p.user_id}:${p.status}:${p.joined_at}`).sort().join('|');
  }

  function disconnectWebSocket() {
    if (ws) {
      ws.close();
      ws = null;
    }
    if (logsRefreshInterval) {
      clearInterval(logsRefreshInterval);
      logsRefreshInterval = null;
    }
    isConnected = false;
    console.log("üî¥ Real-time polling stopped");
  }

  function refreshLogs() {
    newLogsCount = 0;
    fetchLogs();

    Swal.fire({
      title: "Refreshed!",
      text: "Logs have been refreshed",
      icon: "success",
      background: "#1e293b",
      color: "#fff",
      confirmButtonColor: "#10b981",
      timer: 1500,
      showConfirmButton: false,
    });
  }

  function toggleAutoRefresh() {
    autoRefreshEnabled = !autoRefreshEnabled;

    if (autoRefreshEnabled) {
      initWebSocket();
      Swal.fire({
        title:
          currentLang === "th" ? "‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" : "Auto-refresh Enabled",
        text:
          currentLang === "th"
            ? "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ"
            : "System will check for new data every 5 seconds",
        icon: "success",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
        timer: 1500,
        showConfirmButton: false,
      });
    } else {
      disconnectWebSocket();
      Swal.fire({
        title:
          currentLang === "th" ? "‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥" : "Auto-refresh Disabled",
        text:
          currentLang === "th"
            ? "‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° Refresh ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á"
            : "Click Refresh button to update manually",
        icon: "info",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#64748b",
        timer: 1500,
        showConfirmButton: false,
      });
    }
  }

  // ========================================
  // üìÖ TIMELINE FUNCTIONS
  // ========================================

  function openTimelineModal() {
    console.log("üîµ Opening timeline modal");
    console.log("üìä Selected Event:", logsData.selectedEvent);
    console.log("üìù Total Logs:", logsData.logs?.length || 0);

    if (!logsData.selectedEvent) {
      console.error("‚ùå No event selected!");
      Swal.fire({
        title: "No Event Selected",
        text: "Please select an event first",
        icon: "warning",
        background: "#1e293b",
        color: "#fff",
        confirmButtonColor: "#10b981",
      });
      return;
    }

    showTimelineModal = true;
    console.log("‚úÖ Modal opened");
  }

  /**
   * closeTimelineModal - ‡∏õ‡∏¥‡∏î modal ‡πÅ‡∏™‡∏î‡∏á timeline
   */
  function closeTimelineModal() {
    console.log("üî¥ Closing timeline modal");
    showTimelineModal = false;
  }

  /**
   * generateTimeline - ‡∏™‡∏£‡πâ‡∏≤‡∏á timeline items ‡∏à‡∏≤‡∏Å logs data
   * @returns TimelineItem[] - array ‡∏Ç‡∏≠‡∏á timeline items ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ß‡∏•‡∏≤
   *
   * ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:
   * 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ logs ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
   * 2. Sort logs ‡∏ï‡∏≤‡∏° timestamp
   * 3. Map ‡πÄ‡∏õ‡πá‡∏ô TimelineItem format
   */
  function generateTimeline(): TimelineItem[] {
    // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ logs ‡πÉ‡∏´‡πâ return array ‡πÄ‡∏õ‡∏•‡πà‡∏≤ (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á warn)
    if (!logsData.logs || logsData.logs.length === 0) {
      return [];
    }

    // Sort logs ‡∏ï‡∏≤‡∏° timestamp (‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô)
    const sortedLogs = [...logsData.logs].sort(
      (a, b) =>
        new Date(a.timestamp).getTime() - new Date(b.timestamp).getTime()
    );

    // Map ‡πÄ‡∏õ‡πá‡∏ô TimelineItem format
    const timeline = sortedLogs.map((log) => ({
      timestamp: log.timestamp,
      action: log.action,
      userName: log.userName,
      status: log.status,
      details: formatLogDetails(log),
    }));

    console.log("‚úÖ Timeline items generated:", timeline.length);
    return timeline;
  }

  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà + ‡πÄ‡∏ß‡∏•‡∏≤ (‡πÄ‡∏ä‡πà‡∏ô 04 ‡∏°.‡∏Ñ. 2569 10:30)

  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á ‡∏ß‡∏±‡∏ô(04) ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô(Jan) ‡∏õ‡∏µ + ‡πÄ‡∏ß‡∏•‡∏≤ + ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ (English)
  // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤ (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÅ‡∏ö‡∏ö Real-time + GMT+7)
  function formatFullDate(dateInput: any, language: string = currentLang): string {
    // 1. ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
    if (!dateInput || dateInput === "-" || dateInput === "") return "-";

    try {
      // 2. ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Date
      const date = new Date(dateInput);
      if (isNaN(date.getTime())) return "-";

      // 3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Locale ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡∏°‡∏≤ (th=‡πÑ‡∏ó‡∏¢, en=‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©)
      const locale = language === "en" ? "en-GB" : "th-TH";

      // 4. ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô th-TH ‡∏õ‡∏µ‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô ‡∏û.‡∏®. ‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏á‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥) + GMT+7
      return date.toLocaleString(locale, {
        timeZone: "Asia/Bangkok", // ‚úÖ GMT+7
        day: "2-digit",
        month: "short", // th=‡∏°.‡∏Ñ., en=Jan
        year: "numeric", // th=2569, en=2026
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
        hour12: false,
      });
    } catch (error) {
      return "-";
    }
  }

  // Initialize WebSocket when event is selected
  $: if (logsData.selectedEvent && autoRefreshEnabled) {
    initWebSocket();
  }

  $: timelineItems = generateTimeline();

  // Cleanup on component destroy
  onDestroy(() => {
    disconnectWebSocket();
  });
</script>

<svelte:head>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link
    rel="preconnect"
    href="https://fonts.gstatic.com"
    crossorigin="anonymous"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap"
    rel="stylesheet"
  />
</svelte:head>

<svelte:window on:click={() => (showPageDropdown = false)} />

<div class="app-container">
  <header class="header-bar">
    <div class="header-inner">
      <div class="brand">
        <div class="logo-container"></div>
        <span class="brand-name">{lang.organizer}</span>
      </div>

      <nav class="nav-menu desktop-only">
        {#each menuItems as item}
          <button
            class="menu-btn"
            class:active={currentView === item.id}
            on:click={() => selectView(item.id)}
          >
            <svg
              class="line-icon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d={item.svg}
              ></path></svg
            >
            <span class="btn-label">{item.label}</span>
          </button>
        {/each}
        <div class="nav-divider"></div>

        {#if isSearchableView && showSearchSection && !(currentView === "log" && logsData.selectedEvent) && !(currentView === "reward" && rewardData.selectedEvent) && !(currentView === "verify-proof" && verifyProofData.selectedEvent)}
          <!-- Search Toggle Button -->
          <button
            class="search-toggle-btn"
            class:active={showSearchSection}
            on:click={toggleSearchSection}
            title="Toggle Search"
          >
            <svg
              width="18"
              height="18"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              stroke-width="2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
              ></path>
            </svg>
          </button>
        {/if}
      </nav>

      <div class="user-zone">
        <!-- Language Toggle Switch - Simple TH/EN -->
        <button
          class="lang-toggle-btn"
          on:click={toggleLanguage}
          title={currentLang === "th"
            ? "Switch to English"
            : "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢"}
          aria-label="Toggle language"
        >
          <span class="lang-option" class:active={currentLang === "th"}>TH</span
          >
          <span class="lang-divider">/</span>
          <span class="lang-option" class:active={currentLang === "en"}>EN</span
          >
        </button>

        <div class="token-timer" class:warning={timeLeft < 60}>
          {formatTime(timeLeft)}
        </div>
        <button
          class="logout-icon-btn desktop-only"
          on:click={handleLogout}
          aria-label="Logout"
        >
          <svg
            class="line-icon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            ></path></svg
          >
        </button>

        <div class="mobile-controls mobile-only">
          <button
            class="mobile-icon-btn"
            on:click={() => (isMobileMenuOpen = !isMobileMenuOpen)}
            aria-label="Open menu"
          >
            <svg
              width="24"
              height="24"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"
              ></path></svg
            >
          </button>
        </div>
      </div>
    </div>
  </header>

  {#if isMobileMenuOpen}
    <div
      class="mobile-overlay"
      on:click={() => (isMobileMenuOpen = false)}
      on:keydown={(e) => {
        if (e.key === "Enter" || e.key === " ") isMobileMenuOpen = false;
      }}
      role="button"
      tabindex="0"
      aria-label="Close menu overlay"
    ></div>
    <div class="mobile-drawer">
      <div class="drawer-header">
        <span class="brand-name">{lang.navigation}</span>
        <button
          class="close-btn"
          on:click={() => (isMobileMenuOpen = false)}
          aria-label="Close menu">&times;</button>
      </div>
      <div class="drawer-content">
        <!-- Language Toggle in Mobile -->
        <button class="drawer-item lang-drawer-item" on:click={toggleLanguage}>
          <svg
            class="lang-icon-mobile"
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"
            />
          </svg>
          <span class="drawer-label">
            <span class="mobile-lang-option" class:active={currentLang === "th"}
              >TH</span
            >
            <span class="mobile-lang-divider">/</span>
            <span class="mobile-lang-option" class:active={currentLang === "en"}
              >EN</span
            >
          </span>
        </button>
        <div class="drawer-divider"></div>
        {#each menuItems as item}
          <button
            class="drawer-item"
            class:active={currentView === item.id}
            on:click={() => selectView(item.id)}
          >
            <svg
              class="line-icon fixed-size"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              ><path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d={item.svg}
              ></path></svg
            >
            <span class="drawer-label">{item.label}</span>
          </button>
        {/each}
      </div>
      <div class="drawer-footer">
        <button class="drawer-item logout-special" on:click={handleLogout}>
          <svg
            class="line-icon fixed-size"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            ></path></svg
          >
          <span>{lang.logout}</span>
        </button>
      </div>
    </div>
  {/if}

  <main class="page-content">
    <div class="wrapper">
      <div class="static-view-header">
        <div class="title-with-toggle">
          <div class="view-title">
            <h2>{menuItems.find((m) => m.id === currentView)?.label}</h2>
            <div class="divider"></div>
          </div>
        </div>
      </div>

      {#if isSearchableView && showSearchSection && !(currentView === "log" && logsData.selectedEvent) && !(currentView === "reward" && rewardData.selectedEvent)}
        <div class="filter-slide-wrapper">
          <div class="filter-bar-container">
            <div class="filter-bar">
              <div class="search-input-wrapper">
                <svg
                  class="search-icon"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                  ></path>
                </svg>
                <input
                  type="text"
                  placeholder={searchPlaceholder}
                  bind:value={currentSearchQuery}
                  on:input={(e) => {
                    const value = e.currentTarget.value;
                    if (currentView === "list") searchQueryEventList = value;
                    else if (currentView === "verify-proof")
                      searchQueryVerifyProof = value;
                    else if (currentView === "log") searchQueryLogs = value;
                    else if (currentView === "reward")
                      searchQueryReward = value;
                  }}
                  on:keydown={(e) => {
                    if (e.key === "Enter") {
                      if (currentView === "list") currentPage = 1;
                      else if (currentView === "log" && !logsData.selectedEvent)
                        eventsForLogsPage = 1;
                      else if (
                        currentView === "reward" &&
                        !rewardData.selectedEvent
                      )
                        rewardEventsPage = 1;
                    }
                  }}
                />
              </div>

              <div class="filter-actions-wrapper">
                <div class="filter-group-dropdowns">
                  <!-- Month Dropdown -->
                  <div class="custom-select-container">
                    <button
                      class="select-trigger"
                      on:click={() => toggleCurrentMonthDropdown()}
                    >
                      <span>{currentSelectedMonth}</span>
                      <svg
                        class="chevron-icon"
                        class:rotated={currentMonthOpen}
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 9l-7 7-7-7"
                        ></path>
                      </svg>
                    </button>
                    {#if currentMonthOpen}
                      <div class="dropdown-wrapper">
                        <div class="dropdown-scroll-area">
                          {#each months as month}
                            <button class="option-btn" class:selected={currentSelectedMonth === month} on:click={() => selectCurrentMonth(month)}>{month}</button>
                          {/each}
                        </div>
                      </div>
                    {/if}
                  </div>

                  <!-- Year Dropdown -->
                  <div class="custom-select-container">
                    <button
                      class="select-trigger"
                      on:click={() => toggleCurrentYearDropdown()}
                    >
                      <span>{currentSelectedYear}</span>
                      <svg
                        class="chevron-icon"
                        class:rotated={currentYearOpen}
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M19 9l-7 7-7-7"
                        ></path>
                      </svg>
                    </button>
                    {#if currentYearOpen}
                      <div class="dropdown-wrapper">
                        <div class="dropdown-scroll-area">
                          {#each years as year}
                            <button class="option-btn" class:selected={currentSelectedYear === year} on:click={() => selectCurrentYear(year)}>{year}</button>
                          {/each}
                        </div>
                      </div>
                    {/if}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      {/if}

      {#if currentView === "list"}
        <div class="grid-section">
          <!-- ===== OPTIMIZATION: Skeleton loading while events load ===== -->
          {#if eventsLoading}
            <div class="grid">
              {#each [1, 2, 3, 4, 5, 6] as _}
                <div class="glass-card skeleton-card">
                  <div class="card-img-wrapper skeleton-img"></div>
                  <div class="card-body">
                    <div class="skeleton-line skeleton-title"></div>
                    <div class="skeleton-line skeleton-desc"></div>
                    <div class="skeleton-line skeleton-desc short"></div>
                    <div class="skeleton-meta">
                      <div class="skeleton-badge"></div>
                      <div class="skeleton-badge"></div>
                    </div>
                  </div>
                </div>
              {/each}
            </div>
          {:else if paginatedEvents.length === 0}
            <div class="empty-state">
              <svg
                width="48"
                height="48"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                ><path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="1.5"
                  d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path></svg
              >
              <p>{lang.noResults}</p>
            </div>
          {:else}
            <div class="grid">
              {#each paginatedEvents as event (event.id)}
                <div class="glass-card">
                  <div class="card-img-wrapper">
                    <!-- ===== OPTIMIZATION: Lazy loading images ===== -->
                    <img
                      src={event.image ||
                        "https://placehold.co/400x200/1e293b/64748b?text=No+Image"}
                      alt={event.title}
                      class="card-img"
                      loading="lazy"
                      decoding="async"
                      on:error={(e) => {
                        (e.currentTarget as HTMLImageElement).src =
                          "https://placehold.co/400x200/1e293b/64748b?text=Image+Unavailable";
                      }}
                    />
                  </div>

                  <div class="card-body">
                    <!-- ‚úÖ Header with Status & Participants -->
                    <div class="card-header">
                      <h3>{event.title}</h3>
                      <div class="status-group">
                        <span
                          class="status-badge"
                          class:status-active={event.status === "Active"}
                          class:status-closed={event.status === "Closed"}
                          class:status-draft={event.status === "Draft"}
                        >
                          {translateStatus(event.status)}
                        </span>
                      </div>
                    </div>
                    <!-- ‚úÖ Description -->
                    {#if event.description}
                      <p class="event-description-short">
                        {event.description.substring(0, 80)}{event.description
                          .length > 80
                          ? "..."
                          : ""}
                      </p>
                    {/if}

                    <!-- ‚úÖ Simple Meta Info (Location, Date, Time) -->
                    <div class="event-simple-meta">
                      <div class="meta-row">
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                          ></path>
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                          ></path>
                        </svg>
                        <span>{event.location}</span>
                      </div>

                      <div class="meta-row">
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                        <span>{formatDateRange(event, currentLang)}</span>
                      </div>

                      {#if event.startTime && event.endTime}
                        <div class="meta-row">
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                            ></path>
                          </svg>
                          <span>{formatDisplayTime(event.startTime)} - {formatDisplayTime(event.endTime)}</span>
                        </div>
                      {/if}
                      {#if event.distanceKm && event.distanceKm > 0}
                        <div class="meta-row">
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                            ></path>
                          </svg>
                          <span>{event.distanceKm} km</span>
                        </div>
                      {/if}
                      {#if getHolidayDisplay(event)}
                        <div class="meta-row holiday-row">
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                            ></path>
                          </svg>
                          <span>{getHolidayDisplay(event)}</span>
                        </div>
                      {/if}
                    </div>

                    <!-- ‚úÖ Bottom Section - ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠ -->
                    <div class="card-bottom-section">
                      <!-- ‚úÖ Rewards Summary - ‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏Ñ‡πà‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• -->
                      {#if event.rewards && event.rewards.length > 0}
                        <div
                          class="rewards-summary-card"
                          style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(234, 88, 12, 0.05)); border: 1px solid rgba(245, 158, 11, 0.25); border-radius: 10px; padding: 8px 12px; margin-bottom: 10px;"
                        >
                          <div
                            style="display: flex; align-items: center; gap: 8px;"
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="#f59e0b"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                              ></path>
                            </svg>
                            <span
                              style="font-size: 12px; font-weight: 600; color: #f59e0b;"
                            >
                              {currentLang === "th"
                                ? "‡∏°‡∏µ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•"
                                : "Has Rewards"}
                            </span>
                          </div>
                        </div>
                      {/if}

                      <!-- ‚úÖ Progress Bar (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ capacity) -->
                      {#if event.totalSlots}
                        <div class="capacity-progress">
                          <div class="capacity-info">
                            <span class="capacity-text"
                              >{event.usedSlots || 0} / {event.totalSlots}
                              {lang.participants}</span
                            >
                            <span class="capacity-percent"
                              >{Math.round(getCapacityPercentage(event))}%</span
                            >
                          </div>
                          <div class="progress-bar">
                            <div
                              class="progress-fill"
                              style="width: {getCapacityPercentage(event)}%"
                              class:full={getCapacityPercentage(event) >= 100}
                            ></div>
                          </div>
                        </div>
                      {/if}

                      {#if event.pendingCount !== undefined && event.pendingCount > 0}
                        <div class="capacity-progress" style="margin-top: 8px;">
                          <div class="capacity-info">
                            <span class="capacity-text" style="color: #f59e0b;">
                              {currentLang === "th" ? "‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö" : "Pending"}: {event.pendingCount}
                            </span>
                          </div>
                          <div class="progress-bar">
                            <div
                              class="progress-fill"
                              style="width: {getPendingPercentage(
                                event
                              )}%; background: linear-gradient(90deg, #f59e0b, #d97706);"
                            ></div>
                          </div>
                        </div>
                      {/if}

                      <div class="action-buttons">
                        <button
                          class="action-btn btn-view"
                          on:click={() => openEventModal(event)}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                            ></path>
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                            ></path>
                          </svg>
                          {lang.viewDetails}
                        </button>

                        <div class="small-actions">
                          <button
                            class="action-btn btn-edit"
                            on:click={() => handleEdit(event)}
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                              ></path>
                            </svg>
                            {lang.edit}
                          </button>
                          <button
                            class="action-btn btn-delete"
                            on:click|stopPropagation={() =>
                              handleDelete(event.id)}
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                              ></path>
                            </svg>
                            {lang.delete}
                          </button>
                        </div>
                      </div>
                    </div>
                    <!-- close card-bottom-section -->
                  </div>
                </div>
              {/each}
            </div>
            {#if totalPages > 1}
              <div class="pagination-controls">
                <!-- Previous Button -->
                <button
                  class="page-btn"
                  on:click={prevPage}
                  disabled={currentPage === 1}
                  aria-label="Previous Page"
                >
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    ></path>
                  </svg>
                </button>

                <!-- Page Selector -->
                <div class="page-select-wrapper">
                  <button
                    class="page-indicator-box clickable"
                    on:click|stopPropagation={() =>
                      (showPageDropdown = !showPageDropdown)}
                  >
                    <span class="current-page">{currentPage}</span>
                    <span class="sep">/</span>
                    <span class="total-page">{totalPages}</span>
                    <svg
                      class="dropdown-arrow"
                      class:flipped={showPageDropdown}
                      width="12"
                      height="12"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="3"
                        d="M19 9l-7 7-7-7"
                      ></path>
                    </svg>
                  </button>

                  {#if showPageDropdown}
                    <div
                      class="click-outside"
                      on:click|stopPropagation={() =>
                        (showPageDropdown = false)}
                      on:keydown={(e) => {
                        if (e.key === "Enter") showPageDropdown = false;
                      }}
                      role="button"
                      tabindex="0"
                      aria-label="Close dropdown"
                    ></div>
                    <div class="page-dropdown-list">
                      {#each Array(totalPages) as _, i}
                        <button
                          class="page-option"
                          class:active={currentPage === i + 1}
                          on:click={() => jumpToPage(i + 1)}
                        >
                          Page {i + 1}
                        </button>
                      {/each}
                    </div>
                  {/if}
                </div>

                <!-- Next Button -->
                <button
                  class="page-btn"
                  on:click={nextPage}
                  disabled={currentPage === totalPages}
                  aria-label="Next Page"
                >
                  <svg
                    width="16"
                    height="16"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M9 5l7 7-7 7"
                    ></path>
                  </svg>
                </button>
              </div>
              <div class="page-info">
                Showing {(currentPage - 1) * itemsPerPage + 1} - {Math.min(
                  currentPage * itemsPerPage,
                  filteredEvents.length
                )} of {filteredEvents.length} events
              </div>
            {/if}
          {/if}
        </div>
      {:else if currentView === "log"}
        <div class="logs-container">
          {#if !logsData.selectedEvent}
            <!-- Grid Layout ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List -->
            <div class="events-selection">
              {#if events.length === 0}
                <div class="empty-state">
                  <svg
                    width="48"
                    height="48"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path></svg
                  >
                  <p>{lang.noResults}</p>
                </div>
              {:else if paginatedEventsForLogsDisplay.length === 0}
                <div class="empty-state">
                  <svg
                    width="48"
                    height="48"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <p>{lang.noResults}</p>
                </div>
              {:else}
                <div class="grid">
                  {#each paginatedEventsForLogsDisplay as event (event.id)}
                    <div class="glass-card">
                      <div class="card-img-wrapper">
                        <img
                          src={event.image ||
                            "https://placehold.co/400x200/1e293b/64748b?text=No+Image"}
                          alt={event.title}
                          class="card-img"
                          loading="lazy"
                          decoding="async"
                          on:error={(e) => {
                            (e.currentTarget as HTMLImageElement).src =
                              "https://placehold.co/400x200/1e293b/64748b?text=Image+Unavailable";
                          }}
                        />
                      </div>

                      <div class="card-body">
                        <div class="card-header">
                          <h3>{event.title}</h3>
                          <div class="status-group">
                            <span
                              class="status-badge"
                              class:status-active={event.status === "Active"}
                              class:status-closed={event.status === "Closed"}
                              class:status-draft={event.status === "Draft"}
                            >
                              {translateStatus(event.status)}
                            </span>
                          </div>
                        </div>

                        {#if event.description}
                          <p class="event-description-short">
                            {event.description.substring(0, 80)}{event
                              .description.length > 80
                              ? "..."
                              : ""}
                          </p>
                        {/if}

                        <div class="event-simple-meta">
                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                              ></path>
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                              ></path>
                            </svg>
                            <span>{event.location}</span>
                          </div>

                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                              ></path>
                            </svg>
                            <span>{formatDateRange(event, currentLang)}</span>
                          </div>

                          {#if event.startTime && event.endTime}
                            <div class="meta-row">
                              <svg
                                width="14"
                                height="14"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                ></path>
                              </svg>
                              <span>{event.startTime} - {event.endTime}</span>
                            </div>
                          {/if}
                          {#if event.distanceKm && event.distanceKm > 0}
                            <div class="meta-row">
                              <svg
                                width="14"
                                height="14"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                                ></path>
                              </svg>
                              <span>{event.distanceKm} km</span>
                            </div>
                          {/if}
                        </div>

                        {#if event.totalSlots}
                          <div class="card-bottom-section">
                            <div class="capacity-progress">
                              <div class="capacity-info">
                                <span class="capacity-text"
                                  >{event.usedSlots || 0} / {event.totalSlots}
                                  {lang.participants}</span
                                >
                                <span class="capacity-percent"
                                  >{Math.round(
                                    getCapacityPercentage(event)
                                  )}%</span
                                >
                              </div>
                              <div class="progress-bar">
                                <div
                                  class="progress-fill"
                                  style="width: {getCapacityPercentage(event)}%"
                                  class:full={getCapacityPercentage(event) >=
                                    100}
                                ></div>
                              </div>
                            </div>
                          </div>
                        {/if}

                        <div class="action-buttons">
                          <button
                            class="action-btn btn-view"
                            on:click={() => selectEventForLogs(event)}
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                              ></path>
                            </svg>
                            {lang.viewLogs}
                          </button>
                        </div>
                      </div>
                    </div>
                  {/each}
                </div>

                <!-- Pagination ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List -->
                {#if paginatedEventsForLogs.length > 0 && totalEventsForLogsDisplayPages > 1}
                  <div class="pagination-controls">
                    <button
                      class="page-btn"
                      aria-label="Previous page"
                      on:click={() => {
                        prevEventsForLogsPage();
                        window.scrollTo({ top: 0, behavior: "smooth" });
                      }}
                      disabled={eventsForLogsPage === 1}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 19l-7-7 7-7"
                        ></path>
                      </svg>
                    </button>

                    <div class="page-select-wrapper">
                      <button
                        class="page-indicator-box clickable"
                        on:click|stopPropagation={() =>
                          (showEventsForLogsPageDropdown =
                            !showEventsForLogsPageDropdown)}
                      >
                        <span class="current-page">{eventsForLogsPage}</span>
                        <span class="sep">/</span>
                        <span class="total-page"
                          >{totalEventsForLogsDisplayPages}</span
                        >
                        <svg
                          class="dropdown-arrow"
                          class:flipped={showEventsForLogsPageDropdown}
                          width="12"
                          height="12"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="3"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>

                      {#if showEventsForLogsPageDropdown}
                        <button
                          type="button"
                          class="click-outside"
                          on:click|stopPropagation={() =>
                            (showEventsForLogsPageDropdown = false)}
                          aria-label="Close dropdown"
                        ></button>
                        <div class="page-dropdown-list">
                          {#each Array(totalEventsForLogsDisplayPages) as _, i}
                            <button
                              class="page-option"
                              class:active={eventsForLogsPage === i + 1}
                              on:click|stopPropagation={() => {
                                jumpToEventsForLogsPage(i + 1);
                                showEventsForLogsPageDropdown = false;
                                window.scrollTo({ top: 0, behavior: "smooth" });
                              }}
                            >
                              Page {i + 1}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <button
                      class="page-btn"
                      aria-label="Next page"
                      on:click={() => {
                        nextEventsForLogsPage();
                        window.scrollTo({ top: 0, behavior: "smooth" });
                      }}
                      disabled={eventsForLogsPage ===
                        totalEventsForLogsDisplayPages}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        ></path>
                      </svg>
                    </button>
                  </div>

                  <!-- Showing text -->
                  <div class="showing-text">
                    Showing {(eventsForLogsPage - 1) * eventsForLogsPerPage + 1}
                    - {Math.min(
                      eventsForLogsPage * eventsForLogsPerPage,
                      filteredEventsForLogs.length
                    )} of {filteredEventsForLogs.length} events
                  </div>
                {/if}
              {/if}
            </div>
          {:else}
            <!-- Logs Detail View -->
            <div class="logs-detail">
              <div class="logs-header">
                <button class="btn-back-logs" on:click={backToEventsList}>
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    ></path>
                  </svg>
                  Back to Events
                </button>
                <div class="selected-event-info">
                  <h3>{logsData.selectedEvent.title}</h3>
                  <div class="event-meta-small">
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        ></path>
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        ></path>
                      </svg>
                      {logsData.selectedEvent.location}
                    </span>
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                        >formatDate
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                      </svg>
                      {formatDateRange(logsData.selectedEvent, currentLang)}
                    </span>
                    {#if logsData.selectedEvent.startTime && logsData.selectedEvent.endTime}
                      <span>
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        {logsData.selectedEvent.startTime} - {logsData
                          .selectedEvent.endTime}
                      </span>
                    {/if}
                    <span
                      class="status-badge-inline"
                      class:active={logsData.selectedEvent.status === "Active"}
                      >{logsData.selectedEvent.status}</span
                    >
                  </div>
                </div>

                <!-- ‚ú® Action Buttons -->
                <div class="logs-action-buttons">
                  <!-- Real-time Indicator & Refresh -->
                  <div class="realtime-controls">
                    {#if newLogsCount > 0}
                      <button class="btn-new-logs" on:click={refreshLogs}>
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                          ></path>
                        </svg>
                        {newLogsCount} New
                      </button>
                    {/if}

                    <button
                      class="btn-auto-refresh"
                      class:active={autoRefreshEnabled}
                      on:click={toggleAutoRefresh}
                      title={autoRefreshEnabled
                        ? "Auto-refresh ON"
                        : "Auto-refresh OFF"}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                        ></path>
                      </svg>
                      {#if isConnected}
                        <span class="live-dot"></span>
                      {/if}
                    </button>
                  </div>

                  <!-- Timeline Button -->
                  <button
                    class="btn-timeline"
                    on:click|stopPropagation={() => {
                      console.log("Timeline clicked");
                      showTimelineModal = true;
                    }}
                  >
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2.5"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    Timeline
                  </button>

                  <!-- Export Button -->
                  <div class="export-dropdown-wrapper">
                    <button
                      class="btn-export"
                      on:click={toggleExportMenu}
                      disabled={isExporting}
                    >
                      {#if isExporting}
                        <svg
                          class="spinner-icon"
                          width="16"
                          height="16"
                          fill="none"
                          viewBox="0 0 24 24"
                        >
                          <circle
                            class="opacity-25"
                            cx="12"
                            cy="12"
                            r="10"
                            stroke="currentColor"
                            stroke-width="4"
                          ></circle>
                          <path
                            class="opacity-75"
                            fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                          ></path>
                        </svg>
                        Exporting...
                      {:else}
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                          ></path>
                        </svg>
                        Export
                      {/if}
                    </button>

                    {#if showExportMenu}
                      <div class="export-menu">
                        <button
                          class="export-option"
                          on:click={() => exportLogsReport("png")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="#10b981"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                            ></path>
                          </svg>
                          Export Report (PNG)
                        </button>
                        <button
                          class="export-option"
                          on:click={() => exportLogsReport("pdf")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="#ef4444"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                            ></path>
                          </svg>
                          Export Report (PDF)
                        </button>
                        <button
                          class="export-option"
                          on:click={() => exportLogs("csv")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                            ></path>
                          </svg>
                          Export as CSV
                        </button>
                        <button
                          class="export-option"
                          on:click={() => exportLogs("json")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"
                            ></path>
                          </svg>
                          Export as JSON
                        </button>
                        <button
                          class="export-option"
                          on:click={() => exportLogs("pdf")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"
                            ></path>
                          </svg>
                          Export as PDF
                        </button>
                        <button
                          class="export-option"
                          on:click={() => exportLogs("excel")}
                        >
                          <svg
                            width="16"
                            height="16"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"
                            ></path>
                          </svg>
                          Export as Excel
                        </button>
                      </div>
                    {/if}
                  </div>
                </div>
              </div>

              <!-- ‚úÖ Statistics Dashboard - ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡∏ï‡∏±‡∏ß -->
              <div class="stats-dashboard-single-row">
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === ""}
                  on:click={() => {
                    logsData.selectedAction = "";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(100, 116, 139, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#64748b"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.eventStats?.total ||
                        logsData.statistics.uniqueUsers}
                    </div>
                    <div class="stat-label-compact">All</div>
                  </div>
                </button>
                <!-- Officer -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "officer"}
                  on:click={() => {
                    logsData.selectedAction = "officer";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(59, 130, 246, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#3b82f6"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.eventStats?.by_role?.officer || 0}
                    </div>
                    <div class="stat-label-compact">Officer</div>
                  </div>
                </button>

                <!-- Student -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "student"}
                  on:click={() => {
                    logsData.selectedAction = "student";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(168, 85, 247, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#a855f7"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.eventStats?.by_role?.student || 0}
                    </div>
                    <div class="stat-label-compact">Student</div>
                  </div>
                </button>

                <!-- Joined -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "registration"}
                  on:click={() => {
                    logsData.selectedAction = "registration";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(59, 130, 246, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#3b82f6"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.statistics.totalRegistrations}
                    </div>
                    <div class="stat-label-compact">Joined</div>
                  </div>
                </button>

                <!-- Checked In -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "check_in"}
                  on:click={() => {
                    logsData.selectedAction = "check_in";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(6, 182, 212, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#06b6d4"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.statistics.totalCheckIns}
                    </div>
                    <div class="stat-label-compact">Checked In</div>
                  </div>
                </button>

                <!-- Completed -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "reward_unlocked"}
                  on:click={() => {
                    logsData.selectedAction = "reward_unlocked";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(16, 185, 129, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#10b981"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.statistics.totalRewards}
                    </div>
                    <div class="stat-label-compact">Completed</div>
                  </div>
                </button>

                <!-- Rejected -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction === "no_show"}
                  on:click={() => {
                    logsData.selectedAction = "no_show";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(239, 68, 68, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#ef4444"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.logs.filter((l) => l.action === "no_show")
                        .length}
                    </div>
                    <div class="stat-label-compact">Rejected</div>
                  </div>
                </button>

                <!-- Cancelled -->
                <button
                  class="stat-card-compact clickable"
                  class:active={logsData.selectedAction ===
                    "registration_cancelled"}
                  on:click={() => {
                    logsData.selectedAction = "registration_cancelled";
                    applyLogsFilters();
                  }}
                >
                  <div
                    class="stat-icon-compact"
                    style="background: rgba(100, 116, 139, 0.1);"
                  >
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="#64748b"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {logsData.statistics.totalCancelled}
                    </div>
                    <div class="stat-label-compact">Cancelled</div>
                  </div>
                </button>
              </div>

              <!-- ‚úÖ Filter Section - ‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà -->
              <div class="filter-section-logs">
                <!-- ‡πÅ‡∏ñ‡∏ß 1: Search Box + Nisit Filters -->
                <div class="filter-row-logs">
                  <div class="search-box-logs">
                    <svg
                      class="search-icon"
                      width="18"
                      height="18"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                      ></path>
                    </svg>
                    <input
                      class="logs-search-input"
                      type="text"
                      placeholder="Search by name, email, or Nisit ID..."
                      bind:value={logsData.searchQuery}
                      on:input={() => applyLogsFilters()}
                    />
                  </div>
                  <div class="nisit-filter-box">
                    <input
                      class="logs-nisit-input"
                      type="text"
                      placeholder="Batch"
                      maxlength="2"
                      bind:value={logsNisitYearFilter}
                      on:input={(e) => {
                        logsNisitYearFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                        applyLogsFilters();
                      }}
                    />
                  </div>
                  <div class="nisit-filter-box" style="width: 120px;">
                    <input
                      class="logs-nisit-input"
                      type="text"
                      placeholder="Std ID"
                      maxlength="6"
                      bind:value={logsNisitIdFilter}
                      on:input={(e) => {
                        logsNisitIdFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                        applyLogsFilters();
                      }}
                    />
                  </div>
                </div>

                <!-- ‡πÅ‡∏ñ‡∏ß 2: Filters ‡πÅ‡∏•‡∏∞ Date Range -->
                <div class="filter-row-logs">
                  <div
                    class="filter-dropdown-logs"
                    class:dropdown-open={logsData.actionDropdownOpen}
                  >
                    <button
                      class="filter-trigger-logs"
                      on:click|stopPropagation={() => {
                        const wasOpen = logsData.actionDropdownOpen;
                        closeAllLogsDropdowns();
                        logsData.actionDropdownOpen = !wasOpen;
                      }}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                        ></path>
                      </svg>
                      <span
                        >{logsData.selectedAction
                          ? getActionConfig(logsData.selectedAction).label
                          : "All"}</span
                      >
                      <svg
                        class="chevron"
                        class:rotated={logsData.actionDropdownOpen}
                        width="12"
                        height="12"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M19 9l-7 7-7-7"
                        ></path>
                      </svg>
                    </button>
                    {#if logsData.actionDropdownOpen}
                      <div class="filter-menu-logs">
                        <button
                          class="filter-option-logs"
                          class:selected={!logsData.selectedAction ||
                            logsData.selectedAction === ""}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}>All Actions</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction === "officer"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "officer";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #3b82f6;">‚óè</span> Officer</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction === "student"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "student";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #a855f7;">‚óè</span> Student</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction ===
                            "registration"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "registration";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #3b82f6;">‚óè</span> Joined</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction ===
                            "check_in"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "check_in";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #06b6d4;">‚óè</span> Checked In</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction ===
                            "reward_unlocked"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "reward_unlocked";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #10b981;">‚óè</span> Completed</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction === "no_show"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "no_show";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #ef4444;">‚óè</span> Rejected</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={logsData.selectedAction ===
                            "registration_cancelled"}
                          on:click|stopPropagation={() => {
                            logsData.selectedAction = "registration_cancelled";
                            logsData.actionDropdownOpen = false;
                            applyLogsFilters();
                          }}
                          ><span style="color: #64748b;">‚óè</span> Cancelled</button
                        >
                      </div>
                    {/if}
                  </div>

                  <div
                    class="date-input-group-logs"
                    class:dropdown-open={logsData.dateFromDropdownOpen}
                  >
                    <label for="date-from-trigger">From:</label>
                    <div class="custom-date-dropdown-logs">
                      <button
                        class="custom-date-trigger-logs"
                        on:click|stopPropagation={() => {
                          const wasOpen = logsData.dateFromDropdownOpen;
                          closeAllLogsDropdowns();
                          logsData.dateFromDropdownOpen = !wasOpen;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                        <span
                          >{logsData.dateFrom
                            ? availableDatesForFilter.find(
                                (d) => d.value === logsData.dateFrom
                              )?.display || logsData.dateFrom
                            : "Select"}</span
                        >
                        <svg
                          class="chevron"
                          class:rotated={logsData.dateFromDropdownOpen}
                          width="10"
                          height="10"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>
                      {#if logsData.dateFromDropdownOpen}
                        <div class="custom-date-menu-logs">
                          {#each availableDatesForFilter as date}
                            <button
                              class="date-option-logs"
                              class:selected={logsData.dateFrom === date.value}
                              on:click|stopPropagation={() => {
                                logsData.dateFrom = date.value;
                                logsData.dateFromDropdownOpen = false;
                              }}>{date.display}</button
                            >
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>

                  <div
                    class="date-input-group-logs"
                    class:dropdown-open={logsData.dateToDropdownOpen}
                  >
                    <label for="date-from-trigger">To:</label>
                    <div class="custom-date-dropdown-logs">
                      <button
                        class="custom-date-trigger-logs"
                        on:click|stopPropagation={() => {
                          const wasOpen = logsData.dateToDropdownOpen;
                          closeAllLogsDropdowns();
                          logsData.dateToDropdownOpen = !wasOpen;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                        <span
                          >{logsData.dateTo
                            ? availableDatesForFilter.find(
                                (d) => d.value === logsData.dateTo
                              )?.display || logsData.dateTo
                            : "Select"}</span
                        >
                        <svg
                          class="chevron"
                          class:rotated={logsData.dateToDropdownOpen}
                          width="10"
                          height="10"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>
                      {#if logsData.dateToDropdownOpen}
                        <div class="custom-date-menu-logs">
                          {#each availableDatesForFilter as date}
                            <button
                              class="date-option-logs"
                              class:selected={logsData.dateTo === date.value}
                              on:click|stopPropagation={() => {
                                logsData.dateTo = date.value;
                                logsData.dateToDropdownOpen = false;
                              }}>{date.display}</button
                            >
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>

                  <button class="btn-apply-logs" on:click={applyLogsFilters}>
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                      ></path>
                    </svg>
                    {lang.apply}
                  </button>
                  <button class="btn-reset-logs" on:click={resetLogsFilters}>
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      ></path>
                    </svg>
                    {lang.reset}
                  </button>
                </div>
              </div>

              <!-- Loading State -->
              {#if logsData.loading}
                <div class="loading-state">
                  <div class="spinner"></div>
                  <p>Loading logs...</p>
                </div>
              {/if}

              <!-- Error State -->
              {#if logsData.error}
                <div class="error-state">
                  <svg
                    width="48"
                    height="48"
                    fill="none"
                    stroke="#ef4444"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <p>{logsData.error}</p>
                  <button class="btn-retry" on:click={() => fetchLogs(false)}
                    >Retry</button
                  >
                </div>
              {/if}

              <!-- ‚úÖ Logs Grid Layout (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List) -->
              {#if !logsData.loading && !logsData.error}
                <div class="logs-list-container">
                  {#if paginatedLogsForList.length === 0}
                    <div class="empty-state">
                      <svg
                        width="48"
                        height="48"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="1.5"
                          d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                      <p>{lang.noResults}</p>
                    </div>
                  {:else}
                    <!-- ‚úÖ 2 Column Grid -->
                    <div class="logs-grid-2col">
                      {#each paginatedLogsForList as log, index (log.id + '-' + (log.fetchedAt || log.timestamp || '') + '-' + index)}
                        {@const actionColor = getActionConfig(log.action).color}
                        <div class="log-list-card">
                          <!-- Avatar Circle with Number -->
                          <div
                            class="log-avatar-circle"
                            style="background: linear-gradient(135deg, {actionColor}, {actionColor}dd);"
                          >
                            <span
                              >{index +
                                1 +
                                (logsListPage - 1) * logsListPerPage}</span
                            >
                          </div>

                          <!-- Card Content -->
                          <div class="log-list-content">
                            <!-- Header Row -->
                            <div class="log-list-header">
                              <div class="log-user-info">
                                <h3 class="log-user-name">{log.userName}</h3>
                                <div class="log-user-details">
                                  <span class="log-user-nisit" title="‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï">
                                    <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 4px;">
                                      <path stroke-linecap="round" stroke-linejoin="round" d="M10 6H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V8a2 2 0 00-2-2h-5m-4 0V5a2 2 0 114 0v1m-4 0a2 2 0 104 0m-5 8a2 2 0 100-4 2 2 0 000 4zm0 0c1.306 0 2.417.835 2.83 2M9 14a3.001 3.001 0 00-2.83 2M15 11h3m-3 4h2"></path>
                                    </svg>
                                    {log.userNisitId || "N/A"}
                                  </span>
                                  <span class="log-separator">‚Ä¢</span>
                                  <span class="log-user-email" title="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">{log.userEmail}</span>
                                </div>
                              </div>
                              <button
                                class="log-status-badge-compact clickable-badge"
                                style="background: {actionColor}20; border-color: {actionColor}40; color: {actionColor};"
                                on:click|stopPropagation={() => {
                                  logsData.selectedAction = log.action;
                                  applyLogsFilters();
                                }}
                              >
                                <svg
                                  width="14"
                                  height="14"
                                  fill="none"
                                  stroke="currentColor"
                                  viewBox="0 0 24 24"
                                  stroke-width="2"
                                >
                                  <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d={getActionConfig(log.action).icon}
                                  ></path>
                                </svg>
                                {getActionLabel(log.action).toUpperCase()}
                              </button>
                            </div>

                            <!-- Details Grid - ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ -->
                            <div class="log-details-grid">
                              <!-- Join Code - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡∏°‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ -->
                              {#if log.details?.registrationCode}
                                <div class="log-detail-item">
                                  <span class="log-detail-label"
                                    >{currentLang === 'th' ? '‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°:' : 'Join Code:'}</span
                                  >
                                  <span class="log-detail-value log-code"
                                    >{log.details.registrationCode}</span
                                  >
                                </div>
                              {/if}

                              <!-- ‚úÖ Joined - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏™‡∏°‡∏≠‡∏ñ‡πâ‡∏≤‡∏°‡∏µ joinedAt -->
                              {#if log.metadata?.joinedAt || log.timestamp}
                                <div class="log-detail-item">
                                  <span class="log-detail-label">{currentLang === 'th' ? '‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:' : 'Joined:'}</span>
                                  <span class="log-detail-value">
                                    {formatFullDate(log.metadata?.joinedAt || log.timestamp)}
                                  </span>
                                </div>
                              {/if}

                              <!-- ‚úÖ Checked In - ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ checkedInAt -->
                              {#if log.metadata?.checkedInAt}
                                <div class="log-detail-item">
                                  <span class="log-detail-label"
                                    >{currentLang === 'th' ? '‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:' : 'Checked In:'}</span
                                  >
                                  <span class="log-detail-value">
                                    {formatFullDate(log.metadata.checkedInAt)}
                                  </span>
                                </div>
                              {/if}

                              <!-- ‚úÖ Proof Submitted - ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ proof_submitted_at -->
                              {#if log.metadata?.proof_submitted_at}
                                <div class="log-detail-item">
                                  <span class="log-detail-label"
                                    >{currentLang === 'th' ? '‡∏™‡πà‡∏á‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠:' : 'Proof Submitted:'}</span
                                  >
                                  <span class="log-detail-value">
                                    {formatFullDate(log.metadata.proof_submitted_at)}
                                  </span>
                                </div>
                              {/if}

                              <!-- ‚úÖ Completed - ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ completedAt -->
                              {#if log.metadata?.completedAt}
                                <div class="log-detail-item">
                                  <span class="log-detail-label"
                                    >{currentLang === 'th' ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏°‡∏∑‡πà‡∏≠:' : 'Completed:'}</span
                                  >
                                  <span class="log-detail-value">
                                    {formatFullDate(log.metadata.completedAt)}
                                  </span>
                                </div>
                              {/if}

                              <!-- ‚úÖ Cancelled - ‡πÅ‡∏™‡∏î‡∏á‡∏ñ‡πâ‡∏≤‡∏°‡∏µ cancelledAt -->
                              {#if log.metadata?.cancelledAt}
                                <div class="log-detail-item">
                                  <span class="log-detail-label"
                                    >{currentLang === 'th' ? '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠:' : 'Cancelled:'}</span
                                  >
                                  <span class="log-detail-value">
                                    {formatFullDate(log.metadata.cancelledAt)}
                                  </span>
                                </div>
                              {/if}
                            </div>

                            <!-- View Proof Image - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ proof ‡∏´‡∏£‡∏∑‡∏≠ status completed -->
                            {#if log.action === "reward_unlocked" || log.proofImage || log.metadata?.proof_image_url}
                              <button
                                class="log-proof-link"
                                on:click|stopPropagation={() =>
                                  openProofImage(log)}
                              >
                                <svg
                                  width="16"
                                  height="16"
                                  fill="none"
                                  stroke="currentColor"
                                  viewBox="0 0 24 24"
                                  stroke-width="2"
                                >
                                  <path
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                    d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                                  ></path>
                                </svg>
                                <span>{currentLang === 'th' ? '‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô' : 'View Proof Image'}</span>
                              </button>
                            {/if}

                            <!-- Cancellation Reason - ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Cancelled -->
                            {#if log.action === "registration_cancelled" && log.details?.reason}
                              <div class="log-cancellation-reason">
                                <strong>{currentLang === 'th' ? '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å:' : 'Cancellation Reason:'}</strong>
                                <p>{log.details.reason}</p>
                              </div>
                            {/if}

                            <!-- Footer -->
                            <div class="log-list-footer">
                              <span class="log-last-updated"
                                >{currentLang === 'th' ? '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:' : 'Last updated:'} {formatTimestamp(
                                  log.timestamp
                                )}</span
                              >
                            </div>
                          </div>
                        </div>
                      {/each}
                    </div>
                  {/if}
                </div>

                <!-- ‚úÖ Pagination (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List) -->
                {#if paginatedLogsForList.length > 0 && totalLogsListPages > 1}
                  <div class="pagination-controls">
                    <button
                      class="page-btn"
                      aria-label="Previous page"
                      on:click={prevLogsListPage}
                      disabled={logsListPage === 1}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M15 19l-7-7 7-7"
                        ></path>
                      </svg>
                    </button>

                    <div class="page-select-wrapper">
                      <button
                        class="page-indicator-box clickable"
                        on:click|stopPropagation={() =>
                          (showLogsPageDropdown = !showLogsPageDropdown)}
                      >
                        <span class="current-page">{logsListPage}</span>
                        <span class="sep">/</span>
                        <span class="total-page">{totalLogsListPages}</span>
                        <svg
                          class="dropdown-arrow"
                          class:flipped={showLogsPageDropdown}
                          width="12"
                          height="12"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="3"
                            d="M19 9l-7 7-7-7"
                          ></path></svg
                        >
                      </button>

                      {#if showLogsPageDropdown}
                        <div
                          class="click-outside"
                          role="button"
                          tabindex="0"
                          on:click|stopPropagation={() =>
                            (showLogsPageDropdown = false)}
                          on:keydown={(e) => {
                            if (e.key === "Enter" || e.key === " ") {
                              showLogsPageDropdown = false;
                            }
                          }}
                        ></div>
                        <div class="page-dropdown-list">
                          {#each Array(totalLogsListPages) as _, i}
                            <button
                              class="page-option"
                              class:active={logsListPage === i + 1}
                              on:click|stopPropagation={() => {
                                jumpToLogsListPage(i + 1);
                                showLogsPageDropdown = false;
                              }}
                            >
                              Page {i + 1}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <button
                      class="page-btn"
                      aria-label="Next page"
                      on:click={nextLogsListPage}
                      disabled={logsListPage === totalLogsListPages}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M9 5l7 7-7 7"
                        ></path>
                      </svg>
                    </button>
                  </div>
                  <!-- Showing text -->
                  <div class="showing-text">
                    Showing {(logsListPage - 1) * logsListPerPage + 1} - {Math.min(
                      logsListPage * logsListPerPage,
                      logsToDisplay.length
                    )} of {logsToDisplay.length} logs
                  </div>
                {/if}
              {/if}
            </div>
          {/if}
        </div>
      {:else if currentView === "reward"}
        <div class="logs-container">
          {#if !rewardData.selectedEvent}
            <div class="grid-section">
              <!-- Events List -->
              {#if paginatedEventsForReward.length === 0}
                <div class="empty-state">
                  <svg
                    width="48"
                    height="48"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <p>{lang.noResults}</p>
                </div>
              {:else}
                <div class="grid">
                  {#each paginatedEventsForReward as event (event.id)}
                    <div class="glass-card">
                      <div class="card-img-wrapper">
                        <img
                          src={event.image ||
                            "https://placehold.co/400x200/1e293b/64748b?text=No+Image"}
                          alt={event.title}
                          class="card-img"
                          loading="lazy"
                          decoding="async"
                          on:error={(e) => {
                            (e.currentTarget as HTMLImageElement).src =
                              "https://placehold.co/400x200/1e293b/64748b?text=Image+Unavailable";
                          }}
                        />
                      </div>

                      <div class="card-body">
                        <div class="card-header">
                          <h3>{event.title}</h3>
                          <div class="status-group">
                            <span
                              class="status-badge"
                              class:status-active={event.status === "Active"}
                              class:status-closed={event.status === "Closed"}
                              class:status-draft={event.status === "Draft"}
                            >
                              {translateStatus(event.status)}
                            </span>
                          </div>
                        </div>

                        {#if event.description}
                          <p class="event-description-short">
                            {event.description.substring(0, 80)}{event
                              .description.length > 80
                              ? "..."
                              : ""}
                          </p>
                        {/if}

                        <div class="event-simple-meta">
                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                              ></path>
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                              ></path>
                            </svg>
                            <span>{event.location}</span>
                          </div>

                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                              ></path>
                            </svg>
                            <span>{formatDateRange(event, currentLang)}</span>
                          </div>

                          {#if event.startTime && event.endTime}
                            <div class="meta-row">
                              <svg
                                width="14"
                                height="14"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                ></path>
                              </svg>
                              <span>{event.startTime} - {event.endTime}</span>
                            </div>
                          {/if}
                          {#if event.distanceKm && event.distanceKm > 0}
                            <div class="meta-row">
                              <svg
                                width="14"
                                height="14"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"
                                ></path>
                              </svg>
                              <span>{event.distanceKm} km</span>
                            </div>
                          {/if}
                        </div>

                        {#if event.totalSlots}
                          <div class="card-bottom-section">
                            <div class="capacity-progress">
                              <div class="capacity-info">
                                <span class="capacity-text"
                                  >{event.usedSlots || 0} / {event.totalSlots}
                                  {lang.participants}</span
                                >
                                <span class="capacity-percent"
                                  >{Math.round(
                                    getCapacityPercentage(event)
                                  )}%</span
                                >
                              </div>
                              <div class="progress-bar">
                                <div
                                  class="progress-fill"
                                  style="width: {getCapacityPercentage(event)}%"
                                  class:full={getCapacityPercentage(event) >=
                                    100}
                                ></div>
                              </div>
                            </div>
                          </div>
                        {/if}

                        <div class="action-buttons">
                          <button
                            class="action-btn btn-view"
                            on:click={() => selectEventForReward(event)}
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V6a2 2 0 10-2 2h2zm0 0h4l-4 4-4-4h4z"
                              ></path>
                            </svg>
                            {lang.viewRewards}
                          </button>
                        </div>
                      </div>
                    </div>
                  {/each}
                </div>

                <!-- Pagination for Reward Events List -->
                {#if totalRewardEventsPages > 1}
                  <div class="pagination-wrapper">
                    <div class="pagination-controls">
                      <button
                        class="page-btn"
                        aria-label="Next page"
                        on:click={prevRewardEventsPage}
                        disabled={rewardEventsPage === 1}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"
                          ></path>
                        </svg>
                      </button>
                      <div class="page-select-wrapper">
                        <button
                          class="page-indicator-box clickable"
                          on:click|stopPropagation={() =>
                            (showRewardEventsPageDropdown =
                              !showRewardEventsPageDropdown)}
                        >
                          <span class="current-page">{rewardEventsPage}</span>
                          <span class="sep">/</span>
                          <span class="total-page"
                            >{totalRewardEventsPages}</span
                          >
                          <svg
                            class="dropdown-arrow"
                            class:flipped={showRewardEventsPageDropdown}
                            width="12"
                            height="12"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="3"
                              d="M19 9l-7 7-7-7"
                            ></path>
                          </svg>
                        </button>
                        {#if showRewardEventsPageDropdown}
                          <div
                            class="click-outside"
                            role="button"
                            tabindex="0"
                            on:click|stopPropagation={() =>
                              (showRewardEventsPageDropdown = false)}
                            on:keydown={(e) => {
                              if (e.key === "Enter" || e.key === " ") {
                                showRewardEventsPageDropdown = false;
                              }
                            }}
                          ></div>
                          <div class="page-dropdown-list">
                            {#each Array(totalRewardEventsPages) as _, i}
                              <button
                                class="page-option"
                                class:active={rewardEventsPage === i + 1}
                                on:click|stopPropagation={() => {
                                  jumpToRewardEventsPage(i + 1);
                                  showRewardEventsPageDropdown = false;
                                }}
                              >
                                Page {i + 1}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                      <button
                        class="page-btn"
                        aria-label="Next page"
                        on:click={nextRewardEventsPage}
                        disabled={rewardEventsPage === totalRewardEventsPages}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          ></path>
                        </svg>
                      </button>
                    </div>
                    <div class="showing-text">
                      Showing {(rewardEventsPage - 1) * rewardEventsPerPage + 1}
                      - {Math.min(
                        rewardEventsPage * rewardEventsPerPage,
                        filteredEventsForReward.length
                      )} of {filteredEventsForReward.length} events
                    </div>
                  </div>
                {/if}
              {/if}
            </div>
          {:else}
            <!-- Selected Event - Reward Users -->
            <div class="logs-detail">
              <div class="logs-header">
                <button class="btn-back-logs" on:click={backToRewardEventsList}>
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    ></path>
                  </svg>
                  Back to Events
                </button>

                <div class="selected-event-info">
                  <h3>{rewardData.selectedEvent.title}</h3>
                  <div class="event-meta-small">
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        ></path>
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        ></path>
                      </svg>
                      {rewardData.selectedEvent.location}
                    </span>
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                      </svg>
                      {formatDateRange(rewardData.selectedEvent, currentLang)}
                    </span>
                    {#if rewardData.selectedEvent.startTime && rewardData.selectedEvent.endTime}
                      <span>
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        {rewardData.selectedEvent.startTime} - {rewardData
                          .selectedEvent.endTime}
                      </span>
                    {/if}
                    <span
                      class="status-badge-inline"
                      class:active={rewardData.selectedEvent.status ===
                        "Active"}>{rewardData.selectedEvent.status}</span
                    >
                  </div>
                </div>

                <div class="logs-action-buttons">
                  <div class="realtime-controls">
                    {#if newRewardUsersCount > 0}
                      <button
                        class="btn-new-logs"
                        on:click={refreshRewardUsers}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                          ></path>
                        </svg>
                        {newRewardUsersCount} New
                      </button>
                    {/if}

                    <button
                      class="btn-auto-refresh"
                      class:active={rewardAutoRefreshEnabled}
                      on:click={toggleRewardAutoRefresh}
                      title={rewardAutoRefreshEnabled
                        ? "Auto-refresh ON"
                        : "Auto-refresh OFF"}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                        ></path>
                      </svg>
                      {#if rewardIsConnected}<span class="live-dot"></span>{/if}
                    </button>
                  </div>

                  <!-- üéØ Leaderboard Status Badge -->
                  {#if rewardData.selectedEvent}
                    <div
                      class="leaderboard-status-badge"
                      style="padding: 0.4rem 0.75rem; background: {leaderboardStatus.color}20; color: {leaderboardStatus.color}; border: 1px solid {leaderboardStatus.color}40; border-radius: 8px; font-size: 0.75rem; font-weight: 600; display: flex; align-items: center; gap: 0.375rem;"
                      title={currentLang === 'th' ? leaderboardStatus.message : leaderboardStatus.messageEn}
                    >
                      {#if leaderboardStatus.status === 'finalized'}
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      {:else if leaderboardStatus.status === 'active'}
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      {:else if leaderboardStatus.status === 'ready_to_finalize'}
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                      {:else}
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                      {/if}
                      {currentLang === 'th' ? leaderboardStatus.message : leaderboardStatus.messageEn}
                    </div>
                  {/if}

                  <!-- üîÑ Calculate Ranks Button (‡∏î‡∏π‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà finalize) -->
                  {#if showCalculateRanksButton}
                    <button
                      class="btn-new-logs"
                      on:click={handleCalculateRanks}
                      disabled={rewardData.loading}
                      style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none;"
                      title={currentLang === 'th' ? '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö (‡∏î‡∏π‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ ‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)' : 'Calculate Ranks (preview only, no side effects)'}
                    >
                      <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                      </svg>
                      {currentLang === 'th' ? 'üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö' : 'üîÑ Calculate Ranks'}
                    </button>
                  {/if}

                  <!-- üèÅ Finalize Button (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏ö‡πÅ‡∏•‡πâ‡∏ß + ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà finalize) -->
                  {#if showFinalizeButton}
                    <button
                      class="btn-new-logs"
                      style="background: linear-gradient(135deg, #dc2626, #b91c1c); color: white; border: none;"
                      on:click={handleFinalizeRewards}
                      disabled={rewardData.loading}
                      title={currentLang === 'th' ? '‚ö†Ô∏è ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ!' : '‚ö†Ô∏è This action cannot be undone!'}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                        />
                      </svg>
                      {currentLang === 'th' ? 'üèÅ Finalize (‡∏ó‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!)' : 'üèÅ Finalize (Once!)'}
                    </button>
                  {/if}

                  <div class="export-dropdown-wrapper">
                    <button
                      class="btn-export"
                      on:click|stopPropagation={() =>
                        (showRewardExportMenu = !showRewardExportMenu)}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                        ></path>
                      </svg>
                      Export
                    </button>
                    {#if showRewardExportMenu}
                      <div class="export-menu" style="z-index: 1000;">
                        <button class="export-option" on:click={() => exportRewardsReportDirect("png")}>Export Report (PNG)</button>
                        <button class="export-option" on:click={() => exportRewardsReportDirect("pdf")}>Export Report (PDF)</button>
                        <button class="export-option" on:click={() => exportRewards("csv")}>Export as CSV</button>
                        <button class="export-option" on:click={() => exportRewards("json")}>Export as JSON</button>
                        <button class="export-option" on:click={() => exportRewards("excel")}>Export as Excel</button>
                      </div>
                    {/if}
                  </div>
                </div>
              </div>

              <!-- üìä Leaderboard Info Box - ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ flow -->
              {#if rewardData.selectedEvent && !rewardData.leaderboardFinalized}
                <div 
                  class="leaderboard-info-box"
                  style="margin: 0 1rem 1rem; padding: 0.75rem 1rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; font-size: 0.8rem; color: #94a3b8;"
                >
                  <div style="display: flex; align-items: flex-start; gap: 0.5rem;">
                    <svg width="16" height="16" fill="none" stroke="#3b82f6" viewBox="0 0 24 24" stroke-width="2" style="flex-shrink: 0; margin-top: 2px;">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <div>
                      <strong style="color: #e2e8f0;">{currentLang === 'th' ? 'üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Ranking:' : 'üìä Ranking Info:'}</strong>
                      <ul style="margin: 0.25rem 0 0 1rem; padding: 0; list-style: disc;">
                        <li>
                          <strong style="color: #3b82f6;">{currentLang === 'th' ? '‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö' : 'Calculate Ranks'}:</strong>
                          {currentLang === 'th' ? '‡∏î‡∏π‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠ (‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)' : 'Preview current rankings anytime (no side effects)'}
                        </li>
                        {#if leaderboardStatus.status === 'active'}
                          <li style="color: #f59e0b;">
                            <strong>{currentLang === 'th' ? 'Finalize:' : 'Finalize:'}</strong>
                            {currentLang === 'th' ? '‚è≥ ‡∏£‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏ö‡∏Å‡πà‡∏≠‡∏ô (‡∏¢‡∏±‡∏á‡∏Å‡∏î Finalize ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)' : '‚è≥ Wait for event to end (Finalize disabled)'}
                          </li>
                        {:else}
                          <li style="color: #dc2626;">
                            <strong>{currentLang === 'th' ? 'Finalize:' : 'Finalize:'}</strong>
                            {currentLang === 'th' ? '‚ö†Ô∏è ‡∏ó‡∏≥‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ! (‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö + ‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•)' : '‚ö†Ô∏è Cannot be undone! (Lock ranks + distribute rewards)'}
                          </li>
                        {/if}
                      </ul>
                    </div>
                  </div>
                </div>
              {/if}

              <!-- Tier Cards -->
              {#if rewardData.selectedEvent.rewards && rewardData.selectedEvent.rewards.length > 0}
                {@const sortedTiers = [
                  ...(rewardData.selectedEvent?.rewards || []),
                ].sort((a, b) => {
                  const reqA = a.requirement || a.rangeEnd || 0;
                  const reqB = b.requirement || b.rangeEnd || 0;
                  return reqB - reqA;
                })}
                <div class="stats-dashboard-single-row">
                  <!-- All (Unique Users) -->
                  <button
                    class="stat-card-compact clickable"
                    class:active={rewardData.selectedTier === "All"}
                    on:click={() => {
                      rewardData.selectedTier = "All";
                      rewardUsersPage = 1;
                    }}
                  >
                    <div
                      class="stat-icon-compact"
                      style="background: rgba(100, 116, 139, 0.1);"
                    >
                      <svg
                        width="20"
                        height="20"
                        fill="none"
                        stroke="#64748b"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                        ></path>
                      </svg>
                    </div>
                    <div class="stat-info-compact">
                      <div class="stat-value-compact">
                        {rewardData.users.length}
                      </div>
                      <div class="stat-label-compact">{currentLang === 'th' ? '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥)' : 'All (Unique)'}</div>
                    </div>
                  </button>

                  <!-- Dynamic Tiers -->
                  {#each sortedTiers as tier, index}
                    {@const tierInfo = getTierDisplayName(tier.name, index)}

                    {@const completedInTier = rewardData.users.filter(
                      (u) =>
                        String(u.rewardTier) === String(tier.name) ||
                        String(u.tier) === String(tier.name)
                    ).length}

                    <button
                      class="stat-card-compact clickable"
                      class:active={rewardData.selectedTier === tier.name}
                      on:click={() => {
                        rewardData.selectedTier =
                          rewardData.selectedTier === tier.name
                            ? "All"
                            : tier.name;
                        rewardUsersPage = 1;
                      }}
                    >
                      <div
                        class="stat-icon-compact"
                        style="background: {tierInfo.color}15;"
                      >
                        <svg
                          width="20"
                          height="20"
                          fill="none"
                          stroke={tierInfo.color}
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                          ></path>
                        </svg>
                      </div>
                      <div class="stat-info-compact">
                        <div class="stat-value-compact">
                          {completedInTier}
                        </div>

                        <div
                          class="stat-label-compact"
                          style="color: {tierInfo.color};"
                        >
                          {tierInfo.name}
                        </div>
                      </div>
                    </button>
                  {/each}

                  <!-- In Progress -->
                  <button
                    class="stat-card-compact clickable"
                    class:active={rewardData.selectedTier === "In Progress"}
                    on:click={() => {
                      rewardData.selectedTier =
                        rewardData.selectedTier === "In Progress"
                          ? "All"
                          : "In Progress";
                      rewardUsersPage = 1;
                    }}
                  >
                    <div
                      class="stat-icon-compact"
                      style="background: rgba(59, 130, 246, 0.1);"
                    >
                      <svg
                        width="20"
                        height="20"
                        fill="none"
                        stroke="#3b82f6"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M13 10V3L4 14h7v7l9-11h-7z"
                        ></path>
                      </svg>
                    </div>
                    <div class="stat-info-compact">
                      <div class="stat-value-compact">
                        {rewardData.users.filter(
                          (u) => u.status === "in_progress"
                        ).length}
                      </div>
                      <div class="stat-label-compact">In Progress</div>
                    </div>
                  </button>

                  <!-- Newcomer (No Tier) -->
                  <button
                    class="stat-card-compact clickable"
                    class:active={rewardData.selectedTier === "No Tier"}
                    on:click={() => {
                      rewardData.selectedTier =
                        rewardData.selectedTier === "No Tier"
                          ? "All"
                          : "No Tier";
                      rewardUsersPage = 1;
                    }}
                  >
                    <div
                      class="stat-icon-compact"
                      style="background: rgba(100, 116, 139, 0.1);"
                    >
                      <svg
                        width="20"
                        height="20"
                        fill="none"
                        stroke="#64748b"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                    </div>
                    <div class="stat-info-compact">
                      <div class="stat-value-compact">
                        {rewardData.users.filter((u) => u.tier === "No Tier")
                          .length}
                      </div>
                      <div class="stat-label-compact">Newcomer</div>
                    </div>
                  </button>
                </div>
              {/if}

              <!-- Filter -->
              <div class="filter-section-logs">
                <div
                  class="filter-row-logs"
                  style="flex-wrap: wrap; gap: 0.75rem;"
                >
                  <!-- Search -->
                  <div
                    class="search-box-logs"
                    style="flex: 1; min-width: 200px;"
                  >
                    <svg
                      class="search-icon"
                      width="18"
                      height="18"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                      ></path>
                    </svg>
                    <input
                      type="text"
                      placeholder="Search by name or email..."
                      bind:value={rewardData.searchQuery}
                      on:input={() => {
                        rewardData.selectedTier = "All";
                      }}
                      on:keydown={(e) =>
                        e.key === "Enter" && applyRewardFilters()}
                    />
                  </div>

                  <!-- Nisit Year Filter (‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤) -->
                  <div class="nisit-filter-box">
                    <input
                      type="text"
                      placeholder="Batch"
                      maxlength="2"
                      bind:value={nisitYearFilter}
                      on:input={(e) => {
                        nisitYearFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                        rewardData.selectedTier = "All";
                      }}
                    />
                  </div>

                  <!-- Nisit ID Filter (‡πÄ‡∏•‡∏Ç‡∏´‡∏•‡∏±‡∏á) -->
                  <div class="nisit-filter-box" style="width: 120px;">
                    <input
                      type="text"
                      placeholder="Std ID"
                      maxlength="6"
                      bind:value={nisitIdFilter}
                      on:input={(e) => {
                        nisitIdFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                        rewardData.selectedTier = "All";
                      }}
                    />
                  </div>

                  <!-- Sort Dropdown -->
                  <div class="filter-dropdown-logs">
                    <button
                      class="filter-trigger-logs"
                      on:click|stopPropagation={() => {
                        rewardSortDropdownOpen = !rewardSortDropdownOpen;
                        // Reset status card selection ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î dropdown
                        rewardData.selectedTier = "All";
                      }}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"
                        ></path>
                      </svg>
                      <span>
                        {#if rewardSortBy === "all"}
                          {lang.all}
                        {:else if rewardSortBy === "global_best"}
                          {lang.globalRank}: {lang.bestFirst}
                        {:else if rewardSortBy === "global_lowest"}
                          {lang.globalRank}: {lang.lowestFirst}
                        {:else if rewardSortBy === "tier_best"}
                          {lang.tierRank}: {lang.bestFirst}
                        {:else if rewardSortBy === "tier_lowest"}
                          {lang.tierRank}: {lang.lowestFirst}
                        {:else}
                          {lang.all}
                        {/if}
                      </span>
                      <svg
                        class="chevron"
                        class:rotated={rewardSortDropdownOpen}
                        width="12"
                        height="12"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M19 9l-7 7-7-7"
                        ></path>
                      </svg>
                    </button>
                    {#if rewardSortDropdownOpen}
                      <div class="filter-menu-logs">
                        <button
                          class="filter-option-logs"
                          class:selected={rewardSortBy === "all"}
                          on:click|stopPropagation={() => {
                            rewardSortBy = "all";
                            rewardTierFilter = "all";
                            rewardData.selectedTier = "All";
                            rewardSortDropdownOpen = false;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M4 6h16M4 12h16M4 18h16"
                            ></path></svg
                          >
                          All (Default)
                        </button>
                        <div
                          style="height: 1px; background: rgba(255,255,255,0.1); margin: 0.5rem 0;"
                        ></div>
                        <div
                          style="padding: 0.25rem 0.75rem; font-size: 0.7rem; color: #64748b; text-transform: uppercase;"
                        >
                          {lang.globalRank}
                        </div>
                        <button
                          class="filter-option-logs"
                          class:selected={rewardSortBy === "global_best"}
                          on:click|stopPropagation={() => {
                            rewardSortBy = "global_best";
                            rewardTierFilter = "all";
                            rewardData.selectedTier = "All";
                            rewardSortDropdownOpen = false;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="#10b981"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5 10l7-7m0 0l7 7m-7-7v18"
                            ></path></svg
                          >
                          {lang.bestFirst}
                        </button>
                        <button
                          class="filter-option-logs"
                          class:selected={rewardSortBy === "global_lowest"}
                          on:click|stopPropagation={() => {
                            rewardSortBy = "global_lowest";
                            rewardTierFilter = "all";
                            rewardData.selectedTier = "All";
                            rewardSortDropdownOpen = false;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="#ef4444"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M19 14l-7 7m0 0l-7-7m7 7V3"
                            ></path></svg
                          >
                          {lang.lowestFirst}
                        </button>
                        <div
                          style="height: 1px; background: rgba(255,255,255,0.1); margin: 0.5rem 0;"
                        ></div>
                        <div
                          style="padding: 0.25rem 0.75rem; font-size: 0.7rem; color: #64748b; text-transform: uppercase;"
                        >
                          {lang.tierRank}
                        </div>
                        <button
                          class="filter-option-logs"
                          class:selected={rewardSortBy === "tier_best"}
                          on:click|stopPropagation={() => {
                            rewardSortBy = "tier_best";
                            rewardData.selectedTier = "All";
                            rewardSortDropdownOpen = false;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="#f59e0b"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5 10l7-7m0 0l7 7m-7-7v18"
                            ></path></svg
                          >
                          {lang.bestFirst}
                        </button>
                        <button
                          class="filter-option-logs"
                          class:selected={rewardSortBy === "tier_lowest"}
                          on:click|stopPropagation={() => {
                            rewardSortBy = "tier_lowest";
                            rewardData.selectedTier = "All";
                            rewardSortDropdownOpen = false;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="#f59e0b"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M19 14l-7 7m0 0l-7-7m7 7V3"
                            ></path></svg
                          >
                          {lang.lowestFirst}
                        </button>
                      </div>
                    {/if}
                  </div>

                  <!-- Tier Filter (‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Tier Rank) -->
                  {#if rewardSortBy === "tier_best" || rewardSortBy === "tier_lowest"}
                    {@const sortedTiersForFilter = [
                      ...(rewardData.selectedEvent?.rewards || []),
                    ].sort((a, b) => {
                      const reqA = a.requirement || a.rangeEnd || 0;
                      const reqB = b.requirement || b.rangeEnd || 0;
                      return reqB - reqA;
                    })}
                    <div class="filter-dropdown-logs">
                      <button
                        class="filter-trigger-logs"
                        on:click|stopPropagation={() =>
                          (rewardTierFilterDropdownOpen =
                            !rewardTierFilterDropdownOpen)}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V6a2 2 0 10-2 2h2zm0 0h4l-4 4-4-4h4z"
                          ></path>
                        </svg>
                        <span>
                          {#if rewardTierFilter === "all"}
                            {lang.allTiers}
                          {:else if rewardTierFilter === "No Tier"}
                            Newcomer
                          {:else}
                            {@const tierIdx = sortedTiersForFilter.findIndex(
                              (t) => t.name === rewardTierFilter
                            )}
                            {@const tInfo = getTierDisplayName(
                              rewardTierFilter,
                              tierIdx >= 0 ? tierIdx : 0
                            )}
                            {tInfo.name}
                          {/if}
                        </span>
                        <svg
                          class="chevron"
                          class:rotated={rewardTierFilterDropdownOpen}
                          width="12"
                          height="12"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>
                      {#if rewardTierFilterDropdownOpen}
                        <div class="filter-menu-logs">
                          <button
                            class="filter-option-logs"
                            class:selected={rewardTierFilter === "all"}
                            on:click|stopPropagation={() => {
                              rewardTierFilter = "all";
                              rewardTierFilterDropdownOpen = false;
                              rewardUsersPage = 1;
                            }}
                          >
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="#64748b"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                              ><path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M4 6h16M4 12h16M4 18h16"
                              ></path></svg
                            >
                            {lang.allTiers}
                          </button>
                          <div
                            style="height: 1px; background: rgba(255,255,255,0.1); margin: 0.5rem 0;"
                          ></div>
                          {#each sortedTiersForFilter as tier, index}
                            {@const tierInfo = getTierDisplayName(
                              tier.name,
                              index
                            )}
                            <button
                              class="filter-option-logs"
                              class:selected={rewardTierFilter === tier.name}
                              on:click|stopPropagation={() => {
                                rewardTierFilter = tier.name;
                                rewardTierFilterDropdownOpen = false;
                                rewardUsersPage = 1;
                              }}
                            >
                              <span style="color: {tierInfo.color};">‚óè</span>
                              {tierInfo.name}
                              <span
                                style="color: #64748b; font-size: 0.75rem; margin-left: auto;"
                                >({rewardData.users.filter(
                                  (u) => u.tier === tier.name
                                ).length})</span
                              >
                            </button>
                          {/each}
                          <button
                            class="filter-option-logs"
                            class:selected={rewardTierFilter === "No Tier"}
                            on:click|stopPropagation={() => {
                              rewardTierFilter = "No Tier";
                              rewardTierFilterDropdownOpen = false;
                              rewardUsersPage = 1;
                            }}
                          >
                            <span style="color: #64748b;">‚óè</span>
                            Newcomer
                            <span
                              style="color: #64748b; font-size: 0.75rem; margin-left: auto;"
                              >({rewardData.users.filter(
                                (u) => u.tier === "No Tier"
                              ).length})</span
                            >
                          </button>
                        </div>
                      {/if}
                    </div>
                  {/if}

                  <!-- Apply & Reset -->
                  <button class="btn-apply-logs" on:click={applyRewardFilters}>
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                      ></path>
                    </svg>
                    {lang.apply}
                  </button>
                  <button class="btn-reset-logs" on:click={resetRewardFilters}>
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      ></path>
                    </svg>
                    {lang.reset}
                  </button>
                </div>
              </div>

              <!-- Loading -->
              {#if rewardData.loading}
                <div class="loading-state">
                  <div class="spinner"></div>
                  <p>Loading rewards...</p>
                </div>
              {/if}

              <!-- Users Grid -->
              {#if !rewardData.loading}
                {#if paginatedRewardUsers.length === 0}
                  <div class="empty-state">
                    <svg
                      width="48"
                      height="48"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    <p>{lang.noResults}</p>
                  </div>
                {:else}
                  <div class="logs-grid-2col">
                    {#each paginatedRewardUsers as user, index (user.id + '-' + index)}
                      {@const sortedTiersForCard = [
                        ...(rewardData.selectedEvent?.rewards || []),
                      ].sort((a, b) => {
                        const reqA = a.requirement || a.rangeEnd || 0;
                        const reqB = b.requirement || b.rangeEnd || 0;
                        return reqB - reqA;
                      })}
                      {@const tierIndex = sortedTiersForCard.findIndex(
                        (t) => t.name === user.tier
                      )}
                      {@const tierInfo = getTierDisplayName(
                        user.tier,
                        tierIndex >= 0 ? tierIndex : 999
                      )}
                      <div
                        class="log-list-card"
                        style="display: flex; flex-direction: column;"
                      >
                        <!-- Rank Badge -->
                        <div
                          class="log-avatar-circle"
                          style="background: linear-gradient(135deg, {tierInfo.color}, {tierInfo.color}dd);"
                        >
                          <span>#{user.globalRank}</span>
                        </div>

                        <div
                          class="log-list-content"
                          style="display: flex; flex-direction: column; flex: 1;"
                        >
                          <!-- Header -->
                          <div class="log-list-header">
                            <div class="log-user-info">
                              <h3 class="log-user-name">{user.name}</h3>
                              <span class="log-user-id"
                                >{user.nisitId} ‚Ä¢ {user.email}</span
                              >
                            </div>
                            <div
                              style="display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap;"
                            >
                              <!-- Status Badge -->
                              {#if user.status === "completed"}
                                <span
                                  class="log-status-badge-compact"
                                  style="background: rgba(16, 185, 129, 0.15); border-color: rgba(16, 185, 129, 0.4); color: #10b981; text-transform: uppercase; font-weight: 700;"
                                >
                                  <svg
                                    width="12"
                                    height="12"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    stroke-width="2.5"
                                  >
                                    <path
                                      stroke-linecap="round"
                                      stroke-linejoin="round"
                                      d="M5 13l4 4L19 7"
                                    ></path>
                                  </svg>
                                  {lang.completed}
                                </span>
                              {:else if user.status === "in_progress"}
                                <span
                                  class="log-status-badge-compact"
                                  style="background: rgba(59, 130, 246, 0.15); border-color: rgba(59, 130, 246, 0.4); color: #3b82f6; text-transform: uppercase; font-weight: 700;"
                                >
                                  <svg
                                    width="12"
                                    height="12"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    stroke-width="2.5"
                                  >
                                    <path
                                      stroke-linecap="round"
                                      stroke-linejoin="round"
                                      d="M13 10V3L4 14h7v7l9-11h-7z"
                                    ></path>
                                  </svg>
                                  {lang.inProgress}
                                </span>
                              {:else}
                                <span
                                  class="log-status-badge-compact"
                                  style="background: rgba(100, 116, 139, 0.15); border-color: rgba(100, 116, 139, 0.4); color: #64748b; text-transform: uppercase; font-weight: 700;"
                                >
                                  <svg
                                    width="12"
                                    height="12"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                    stroke-width="2.5"
                                  >
                                    <path
                                      stroke-linecap="round"
                                      stroke-linejoin="round"
                                      d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                    ></path>
                                  </svg>
                                  {lang.notStarted}
                                </span>
                              {/if}
                              <!-- Tier Badge -->
                              <span
                                class="log-status-badge-compact"
                                style="background: {tierInfo.color}20; border-color: {tierInfo.color}40; color: {tierInfo.color}; text-transform: uppercase; font-weight: 700;"
                              >
                                {#if user.tierRank > 0}#{user.tierRank}{/if}
                                {tierInfo.name}
                              </span>
                            </div>
                          </div>

                          <!-- Progress Section (fixed height) -->
                          <div style="margin: 1rem 0; min-height: 60px;">
                            <div
                              style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.5rem;"
                            >
                              <span>{lang.progressTo} {tierInfo.name}</span>
                              <span
                                >{user.completedCount} / {user.requiredCount}</span
                              >
                            </div>
                            <div
                              style="height: 8px; background: rgba(100, 116, 139, 0.2); border-radius: 10px; overflow: hidden;"
                            >
                              <div
                                style="height: 100%; width: {Math.min(
                                  (user.completedCount / user.requiredCount) *
                                    100,
                                  100
                                )}%; background: linear-gradient(90deg, {tierInfo.color}, {tierInfo.color}cc); border-radius: 10px; transition: width 0.5s ease;"
                              ></div>
                            </div>
                            <!-- Next Tier Info (always show space) -->
                            <div
                              style="font-size: 0.75rem; color: #64748b; margin-top: 0.25rem; min-height: 1.2em;"
                            >
                              {#if user.tier !== "No Tier" && user.nextTierCount > user.requiredCount}
                                {@const nextTierIdx =
                                  tierIndex > 0 ? tierIndex - 1 : 0}
                                {@const nextTierInfo = getTierDisplayName(
                                  "",
                                  nextTierIdx
                                )}
                                {lang.nextTier}: {nextTierInfo.name} at {user.nextTierCount}
                                ({user.nextTierCount - user.completedCount} {lang.more})
                              {/if}
                            </div>
                          </div>

                          <!-- Details Grid -->
                          <div
                            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; margin-bottom: 1rem;"
                          >
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏° (‡∏ß‡∏±‡∏ô)' : 'Participations'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: #f8fafc; font-weight: 600;"
                              >
                                {user.totalParticipations || user.completedCount || 0} {currentLang === 'th' ? '‡∏ß‡∏±‡∏ô' : 'days'}
                              </div>
                            </div>
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à' : 'Completed'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: #10b981; font-weight: 600;"
                              >
                                {user.completedParticipations || user.completedCount || 0} {currentLang === 'th' ? '‡∏ß‡∏±‡∏ô' : 'days'}
                              </div>
                            </div>
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏£‡∏ß‡∏°' : 'Total Distance'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: #3b82f6; font-weight: 600;"
                              >
                                {#if user.totalDistanceKm}
                                  {user.totalDistanceKm.toFixed(2)} km
                                {:else}
                                  ‚Äî
                                {/if}
                              </div>
                            </div>
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö' : 'Rank'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: {tierInfo.color}; font-weight: 600;"
                              >
                                {#if user.globalRank}#{user.globalRank}{:else}‚Äî{/if}
                              </div>
                            </div>
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡∏ß‡∏±‡∏ô‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°' : 'First Join'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: #f8fafc; font-weight: 600;"
                              >
                                {#if user.firstParticipationAt}
                                  {new Date(
                                    user.firstParticipationAt
                                  ).toLocaleDateString(currentLang === 'th' ? 'th-TH' : 'en-GB', {
                                    day: "2-digit",
                                    month: "short",
                                  })}
                                {:else}
                                  ‚Äî
                                {/if}
                              </div>
                            </div>
                            <div
                              style="padding: 0.5rem; background: rgba(15, 23, 42, 0.5); border-radius: 8px;"
                            >
                              <div style="font-size: 0.7rem; color: #64748b;">
                                {currentLang === 'th' ? '‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î' : 'Last Active'}
                              </div>
                              <div
                                style="font-size: 0.9rem; color: #f8fafc; font-weight: 600;"
                              >
                                {#if user.lastParticipationAt}
                                  {new Date(
                                    user.lastParticipationAt
                                  ).toLocaleDateString(currentLang === 'th' ? 'th-TH' : 'en-GB', {
                                    day: "2-digit",
                                    month: "short",
                                  })}
                                {:else}
                                  ‚Äî
                                {/if}
                              </div>
                            </div>
                          </div>

                          <!-- Action Button (always at bottom) -->
                          <div style="margin-top: auto;">
                            <button
                              class="btn-message"
                              on:click={() => openMessageModal(user)}
                              style="width: 100%;"
                            >
                              <svg
                                width="16"
                                height="16"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                                ></path>
                              </svg>
                              {lang.sendMessage}
                            </button>
                          </div>
                        </div>
                      </div>
                    {/each}
                  </div>

                  <!-- Pagination -->
                  {#if totalRewardUsersPages > 1}
                    <div class="pagination-controls">
                      <button
                        class="page-btn"
                        aria-label="Next page"
                        on:click={prevRewardUsersPage}
                        disabled={rewardUsersPage === 1}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"
                          ></path>
                        </svg>
                      </button>
                      <div class="page-select-wrapper">
                        <button
                          class="page-indicator-box clickable"
                          on:click|stopPropagation={() =>
                            (showRewardUsersPageDropdown =
                              !showRewardUsersPageDropdown)}
                        >
                          <span class="current-page">{rewardUsersPage}</span>
                          <span class="sep">/</span>
                          <span class="total-page">{totalRewardUsersPages}</span
                          >
                          <svg
                            class="dropdown-arrow"
                            class:flipped={showRewardUsersPageDropdown}
                            width="12"
                            height="12"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="3"
                              d="M19 9l-7 7-7-7"
                            ></path>
                          </svg>
                        </button>
                        {#if showRewardUsersPageDropdown}
                          <div
                            class="click-outside"
                            role="button"
                            tabindex="0"
                            on:click|stopPropagation={() =>
                              (showRewardUsersPageDropdown = false)}
                            on:keydown={(e) => {
                              if (e.key === "Enter" || e.key === " ") {
                                showRewardUsersPageDropdown = false;
                              }
                            }}
                          ></div>

                          <div class="page-dropdown-list">
                            {#each Array(totalRewardUsersPages) as _, i}
                              <button
                                class="page-option"
                                class:active={rewardUsersPage === i + 1}
                                on:click|stopPropagation={() => {
                                  jumpToRewardUsersPage(i + 1);
                                  showRewardUsersPageDropdown = false;
                                }}
                              >
                                Page {i + 1}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                      <button
                        class="page-btn"
                        aria-label="Next page"
                        on:click={nextRewardUsersPage}
                        disabled={rewardUsersPage === totalRewardUsersPages}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          ></path>
                        </svg>
                      </button>
                    </div>
                    <div class="showing-text">
                      {lang.showing} {(rewardUsersPage - 1) * rewardUsersPerPage + 1} -
                      {Math.min(
                        rewardUsersPage * rewardUsersPerPage,
                        filteredRewardUsers.length
                      )} {lang.of} {filteredRewardUsers.length} {lang.users}
                    </div>
                  {/if}
                {/if}
              {/if}
            </div>
          {/if}

          <!-- Message Modal -->
          {#if showMessageModal && selectedUserForMessage}
            {@const user = selectedUserForMessage}
            {@const sortedTiersForModal = [
              ...(rewardData.selectedEvent?.rewards || []),
            ].sort((a, b) => {
              const reqA = a.requirement || a.rangeEnd || 0;
              const reqB = b.requirement || b.rangeEnd || 0;
              return reqB - reqA;
            })}
            {@const modalTierIndex = sortedTiersForModal.findIndex(
              (t) => t.name === user.tier
            )}
            {@const modalTierInfo = getTierDisplayName(
              user.tier,
              modalTierIndex >= 0 ? modalTierIndex : 999
            ) || { name: "Member", color: "#64748b" }}

            <div
              class="modal-overlay"
              role="dialog"
              aria-modal="true"
              aria-labelledby="modal-title"
              tabindex="-1"
              on:click={(e) => {
                // Logic ‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏∑‡∏≠‡∏ï‡∏±‡∏ß overlay ‡πÄ‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏≤‡∏ô)
                if (e.target === e.currentTarget) closeMessageModal();
              }}
              on:keydown={(e) => {
                if (e.key === "Escape") closeMessageModal();
              }}
              style="cursor: pointer;"
            >
              <div class="modal-container" style="cursor: default;">
                <div class="modal-header">
                  <h3 id="modal-title">
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"
                      ></path>
                    </svg>
                    {lang.sendMessage}
                  </h3>
                  <button
                    class="modal-close"
                    aria-label="Close modal"
                    on:click={closeMessageModal}
                  >
                    <svg
                      width="24"
                      height="24"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"
                      ></path>
                    </svg>
                  </button>
                </div>

                <div class="modal-body">
                  <div
                    style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 12px; margin-bottom: 1.5rem;"
                  >
                    <div
                      style="width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, {modalTierInfo.color}, {modalTierInfo.color}dd); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem; color: #0f172a; flex-shrink: 0;"
                    >
                      #{user.globalRank}
                    </div>
                    <div style="flex: 1; min-width: 0;">
                      <h4 style="margin: 0 0 0.25rem 0; color: #f8fafc;">
                        {user.name}
                      </h4>
                      <span style="color: #64748b; font-size: 0.85rem;"
                        >{user.email}</span
                      >
                    </div>
                    {#if user.tier !== "No Tier"}
                      <span
                        style="padding: 0.35rem 0.75rem; background: {modalTierInfo.color}20; border: 1px solid {modalTierInfo.color}40; border-radius: 20px; color: {modalTierInfo.color}; font-size: 0.75rem; font-weight: 600; white-space: nowrap;"
                      >
                        #{user.tierRank}
                        {modalTierInfo.name}
                      </span>
                    {/if}
                  </div>

                  <div style="margin-bottom: 1rem;">
                    <span
                      style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;"
                    >
                      Quick Message
                    </span>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                      {#if user.tier !== "No Tier"}
                        <button
                          class="quick-msg-btn"
                          style="background: {modalTierInfo.color}15; border-color: {modalTierInfo.color}40; color: {modalTierInfo.color};"
                          on:click={() => {
                            messageText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì${user.name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• "${modalTierInfo.name}" (‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà ${user.tierRank}) ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${rewardData.selectedEvent?.title}" ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà`;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                            ></path>
                          </svg>
                          ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• {modalTierInfo.name} (TH)
                        </button>
                        <button
                          class="quick-msg-btn"
                          style="background: {modalTierInfo.color}15; border-color: {modalTierInfo.color}40; color: {modalTierInfo.color};"
                          on:click={() => {
                            messageText = `Congratulations! ${user.name}, you have received the "${modalTierInfo.name}" reward (Rank #${user.tierRank}) from "${rewardData.selectedEvent?.title}". Please collect your reward`;
                          }}
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                            ></path>
                          </svg>
                          {modalTierInfo.name} Reward (EN)
                        </button>
                      {/if}

                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏∏‡∏ì${user.name} ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${rewardData.selectedEvent?.title}"`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"
                          ></path>
                        </svg>
                        ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `Hello ${user.name}, thank you for joining "${rewardData.selectedEvent?.title}".`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"
                          ></path>
                        </svg>
                        Greeting (EN)
                      </button>

                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${rewardData.selectedEvent?.title}" ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `Reminder: "${rewardData.selectedEvent?.title}" is ending soon. Don't forget to participate!`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        Reminder (EN)
                      </button>

                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "${rewardData.selectedEvent?.title}" ‡∏´‡∏ß‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏û‡∏ö‡∏Å‡∏±‡∏ô‡∏≠‡∏µ‡∏Å‡πÉ‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                          ></path>
                        </svg>
                        ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          messageText = `Thank you for joining "${rewardData.selectedEvent?.title}". We hope to see you again at our next event!`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"
                          ></path>
                        </svg>
                        Thank you (EN)
                      </button>
                    </div>
                  </div>

                  <div>
                    <label
                      for="message-input-area"
                      style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;"
                    >
                      Message
                    </label>
                    <textarea
                      id="message-input-area"
                      bind:value={messageText}
                      placeholder="Type your message here..."
                      rows="5"
                      style="width: 100%; padding: 1rem; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #f8fafc; font-size: 0.9rem; resize: vertical;"
                    ></textarea>
                  </div>
                </div>

                <div
                  style="display: flex; justify-content: flex-end; gap: 1rem; padding: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.08);"
                >
                  <button
                    style="padding: 0.7rem 1.5rem; background: transparent; border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 10px; color: #94a3b8; cursor: pointer;"
                    on:click={closeMessageModal}>Cancel</button
                  >
                  <button
                    style="display: flex; align-items: center; gap: 0.5rem; padding: 0.7rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 10px; color: white; cursor: pointer;"
                    on:click={sendMessage}
                    disabled={!messageText.trim()}
                  >
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                      ></path>
                    </svg>
                    Send
                  </button>
                </div>
              </div>
            </div>
          {/if}
          {#if showSendAllModal}
            {@const sortedTiersForSendAll = [
              ...(rewardData.selectedEvent?.rewards || []),
            ].sort((a, b) => {
              const reqA = a.requirement || a.rangeEnd || 0;
              const reqB = b.requirement || b.rangeEnd || 0;
              return reqB - reqA;
            })}
            {@const targetUsers = getTargetUsers()}

            <div
              class="modal-overlay"
              role="button"
              tabindex="0"
              on:click={closeSendAllModal}
              on:keydown={(e) => {
                if (e.key === "Escape" || e.key === "Enter")
                  closeSendAllModal();
              }}
            >
              <div
                class="modal-container"
                role="dialog"
                aria-modal="true"
                tabindex="-1"
                style="max-width: 600px;"
                on:click|stopPropagation
                on:keydown|stopPropagation
              >
                <div class="modal-header">
                  <h3>
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                      ></path>
                    </svg>
                    Send to All Users
                  </h3>
                  <button
                    class="modal-close"
                    on:click={closeSendAllModal}
                    aria-label="Close modal"
                  >
                    <svg
                      width="24"
                      height="24"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M6 18L18 6M6 6l12 12"
                      ></path>
                    </svg>
                  </button>
                </div>

                <div class="modal-body">
                  <div style="margin-bottom: 1.5rem;">
                    <span
                      style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;"
                    >
                      Send to
                    </span>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                      <button
                        class="target-btn"
                        class:active={sendAllTargetTier === "All"}
                        on:click={() => (sendAllTargetTier = "All")}
                      >
                        All ({rewardData.users.length})
                      </button>
                      {#each sortedTiersForSendAll as tier, index}
                        {@const tierInfo = getTierDisplayName(tier.name, index)}
                        {@const count = rewardData.users.filter(
                          (u) => u.tier === tier.name
                        ).length}
                        <button
                          class="target-btn"
                          class:active={sendAllTargetTier === tier.name}
                          style={sendAllTargetTier === tier.name
                            ? `background: ${tierInfo.color}20; border-color: ${tierInfo.color}; color: ${tierInfo.color};`
                            : ""}
                          on:click={() => (sendAllTargetTier = tier.name)}
                        >
                          <svg
                            width="12"
                            height="12"
                            fill="none"
                            stroke={sendAllTargetTier === tier.name
                              ? tierInfo.color
                              : "currentColor"}
                            viewBox="0 0 24 24"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"
                            ></path>
                          </svg>
                          {tierInfo.name} ({count})
                        </button>
                      {/each}
                      <button
                        class="target-btn"
                        class:active={sendAllTargetTier === "In Progress"}
                        on:click={() => (sendAllTargetTier = "In Progress")}
                      >
                        In Progress ({rewardData.users.filter(
                          (u) => u.status === "in_progress"
                        ).length})
                      </button>
                      <button
                        class="target-btn"
                        class:active={sendAllTargetTier === "No Tier"}
                        on:click={() => (sendAllTargetTier = "No Tier")}
                      >
                        Newcomer ({rewardData.users.filter(
                          (u) => u.tier === "No Tier"
                        ).length})
                      </button>
                    </div>
                  </div>

                  <div
                    style="margin-bottom: 1rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px;"
                  >
                    <label
                      style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer;"
                    >
                      <input
                        type="checkbox"
                        bind:checked={sendAllUseTemplate}
                        style="width: 18px; height: 18px; accent-color: #3b82f6;"
                      />
                      <div>
                        <span style="color: #f8fafc; font-weight: 500;"
                          >Use Dynamic Variables</span
                        >
                        <p
                          style="margin: 0.25rem 0 0 0; font-size: 0.8rem; color: #94a3b8;"
                        >
                          Replace {"{name}"}, {"{tier}"}, {"{tierRank}"}, {"{globalRank}"},
                          {"{event}"} with actual values
                        </p>
                      </div>
                    </label>
                  </div>

                  <div style="margin-bottom: 1rem;">
                    <span
                      style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;"
                    >
                      Quick Templates
                    </span>
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì{name} ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• "{tier}" (‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà {tierRank}) ‡∏à‡∏≤‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "{event}" ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                          ></path>
                        </svg>
                        ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `Congratulations! {name}, you have received the "{tier}" reward (Rank #{tierRank}) from "{event}". Please collect your reward at`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                          ></path>
                        </svg>
                        Reward (EN)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞ ‡∏Ñ‡∏∏‡∏ì{name} ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "{event}"`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"
                          ></path>
                        </svg>
                        ‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `Hello {name}, thank you for joining "{event}".`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"
                          ></path>
                        </svg>
                        Greeting (EN)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° "{event}" ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏∞‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏•‡∏á‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏°‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô (TH)
                      </button>
                      <button
                        class="quick-msg-btn"
                        on:click={() => {
                          sendAllUseTemplate = true;
                          sendAllMessageTemplate = `Reminder: "{event}" is ending soon. Don't forget to participate!`;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path>
                        </svg>
                        Reminder (EN)
                      </button>
                    </div>
                  </div>

                  <div>
                    <label
                      for="message-template-input"
                      style="display: block; font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem;"
                    >
                      Message {#if sendAllUseTemplate}<span
                          style="color: #3b82f6;">(with variables)</span
                        >{/if}
                    </label>
                    <textarea
                      id="message-template-input"
                      bind:value={sendAllMessageTemplate}
                      placeholder={sendAllUseTemplate
                        ? "Use {name}, {tier}, {tierRank}, {globalRank}, {event}..."
                        : "Type your message here..."}
                      rows="4"
                      style="width: 100%; padding: 1rem; background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; color: #f8fafc; font-size: 0.9rem; resize: vertical;"
                    ></textarea>
                  </div>

                  {#if sendAllUseTemplate && sendAllMessageTemplate && targetUsers.length > 0}
                    <div
                      style="margin-top: 1rem; padding: 1rem; background: rgba(15, 23, 42, 0.5); border-radius: 10px;"
                    >
                      <span
                        style="display: block; font-size: 0.8rem; color: #64748b; margin-bottom: 0.5rem;"
                      >
                        Preview (for {targetUsers[0].name}):
                      </span>
                      <p
                        style="margin: 0; color: #94a3b8; font-size: 0.85rem; font-style: italic;"
                      >
                        "{generateMessageForUser(
                          targetUsers[0],
                          sendAllMessageTemplate
                        )}"
                      </p>
                    </div>
                  {/if}
                </div>

                <div
                  style="display: flex; justify-content: space-between; align-items: center; padding: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.08);"
                >
                  <span style="color: #64748b; font-size: 0.85rem;">
                    Sending to <strong style="color: #f8fafc;"
                      >{targetUsers.length}</strong
                    > users
                  </span>
                  <div style="display: flex; gap: 1rem;">
                    <button
                      style="padding: 0.7rem 1.5rem; background: transparent; border: 1px solid rgba(100, 116, 139, 0.3); border-radius: 10px; color: #94a3b8; cursor: pointer;"
                      on:click={closeSendAllModal}
                    >
                      Cancel
                    </button>
                    <button
                      style="display: flex; align-items: center; gap: 0.5rem; padding: 0.7rem 1.5rem; background: linear-gradient(135deg, #10b981, #059669); border: none; border-radius: 10px; color: white; cursor: pointer; opacity: {!sendAllMessageTemplate.trim() ||
                      targetUsers.length === 0
                        ? 0.5
                        : 1};"
                      on:click={sendAllMessages}
                      disabled={!sendAllMessageTemplate.trim() ||
                        targetUsers.length === 0}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                        ></path>
                      </svg>
                      Send to All ({targetUsers.length})
                    </button>
                  </div>
                </div>
              </div>
            </div>
          {/if}
        </div>
      {:else if currentView === "verify-proof"}
        <div class="logs-container">
          {#if !verifyProofData.selectedEvent}
            <div class="grid-section">
              {#if paginatedEventsForVerifyProof.length === 0}
                <div class="empty-state">
                  <svg
                    width="48"
                    height="48"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="1.5"
                      d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <p>{lang.noEventsFound}</p>
                </div>
              {:else}
                <div class="grid">
                  {#each paginatedEventsForVerifyProof as event (event.id)}
                    <div class="glass-card">
                      <div class="card-img-wrapper">
                        <img
                          src={event.image ||
                            "https://placehold.co/400x200/1e293b/64748b?text=No+Image"}
                          alt={event.title}
                          class="card-img"
                          loading="lazy"
                          decoding="async"
                          on:error={(e) => {
                            (e.currentTarget as HTMLImageElement).src =
                              "https://placehold.co/400x200/1e293b/64748b?text=Image+Unavailable";
                          }}
                        />
                        {#if event.pendingCount && event.pendingCount > 0}
                          <div class="pending-badge-overlay">
                            {event.pendingCount} Pending
                          </div>
                        {/if}
                      </div>
                      <div class="card-body">
                        <div class="card-header">
                          <h3>{event.title}</h3>
                          <div class="status-group">
                            <span
                              class="status-badge"
                              class:status-active={event.status === "Active"}
                              class:status-closed={event.status === "Closed"}
                              class:status-draft={event.status === "Draft"}
                              >{translateStatus(event.status)}</span
                            >
                          </div>
                        </div>
                        {#if event.description}
                          <p class="event-description-short">
                            {event.description.substring(0, 80)}{event
                              .description.length > 80
                              ? "..."
                              : ""}
                          </p>
                        {/if}
                        <div class="event-simple-meta">
                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                              ></path>
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                              ></path>
                            </svg>
                            <span>{event.location}</span>
                          </div>
                          <div class="meta-row">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                              ></path>
                            </svg>
                            <span>{formatDateRange(event, currentLang)}</span>
                          </div>
                          {#if event.startTime && event.endTime}
                            <div class="meta-row">
                              <svg
                                width="14"
                                height="14"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                              >
                                <path
                                  stroke-linecap="round"
                                  stroke-linejoin="round"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                                ></path>
                              </svg>
                              <span>{event.startTime} - {event.endTime}</span>
                            </div>
                          {/if}
                        </div>

                        <div class="action-buttons">
                          <button
                            class="action-btn btn-view"
                            on:click={() => selectEventForVerifyProof(event)}
                          >
                            <svg
                              width="16"
                              height="16"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                              ></path>
                            </svg>
                            Verify Submissions
                          </button>
                        </div>
                      </div>
                    </div>
                  {/each}
                </div>

                {#if totalVerifyProofEventsPages > 1}
                  <div class="pagination-wrapper">
                    <div class="pagination-controls">
                      <button
                        class="page-btn"
                        on:click={prevVerifyProofEventsPage}
                        disabled={verifyProofEventsPage === 1}
                        aria-label="Previous page"
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 19l-7-7 7-7"
                          ></path></svg
                        >
                      </button>
                      <div class="page-select-wrapper">
                        <button
                          class="page-indicator-box clickable"
                          on:click|stopPropagation={() =>
                            (showVerifyProofEventsPageDropdown =
                              !showVerifyProofEventsPageDropdown)}
                        >
                          <span class="current-page"
                            >{verifyProofEventsPage}</span
                          >
                          <span class="sep">/</span>
                          <span class="total-page"
                            >{totalVerifyProofEventsPages}</span
                          >
                          <svg
                            class="dropdown-arrow"
                            class:flipped={showVerifyProofEventsPageDropdown}
                            width="12"
                            height="12"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            ><path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              stroke-width="3"
                              d="M19 9l-7 7-7-7"
                            ></path></svg
                          >
                        </button>
                        {#if showVerifyProofEventsPageDropdown}
                          <div
                            class="click-outside"
                            role="button"
                            tabindex="0"
                            aria-label="Close dropdown"
                            on:click|stopPropagation={() =>
                              (showVerifyProofEventsPageDropdown = false)}
                            on:keydown={(e) => {
                              if (e.key === "Enter" || e.key === " ") {
                                showVerifyProofEventsPageDropdown = false;
                              }
                            }}
                          ></div>
                          <div class="page-dropdown-list">
                            {#each Array(totalVerifyProofEventsPages) as _, i}
                              <button
                                class="page-dropdown-item"
                                class:active={verifyProofEventsPage === i + 1}
                                on:click={() => {
                                  verifyProofEventsPage = i + 1;
                                  showVerifyProofEventsPageDropdown = false;
                                }}>Page {i + 1}</button
                              >
                            {/each}
                          </div>
                        {/if}
                      </div>
                      <button
                        class="page-btn"
                        on:click={nextVerifyProofEventsPage}
                        disabled={verifyProofEventsPage ===
                          totalVerifyProofEventsPages}
                        aria-label="Next page"
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 5l7 7-7 7"
                          ></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                  <div class="page-info">
                    Showing {(currentPage - 1) * itemsPerPage + 1} - {Math.min(
                      currentPage * itemsPerPage,
                      filteredEvents.length
                    )} of {filteredEvents.length} events
                  </div>
                {/if}
              {/if}
            </div>
          {:else}
            <div class="logs-detail">
              <div class="logs-header">
                <button
                  class="btn-back-logs"
                  on:click={backToVerifyProofEventsList}
                >
                  <svg
                    width="20"
                    height="20"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    ><path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 19l-7-7 7-7"
                    ></path></svg
                  >
                  Back to Events
                </button>
                <div class="selected-event-info">
                  <h3>{verifyProofData.selectedEvent.title}</h3>
                  <div class="event-meta-small">
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                        ><path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        ></path><path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        ></path></svg
                      >
                      {verifyProofData.selectedEvent.location}
                    </span>
                    <span>
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                        ><path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path></svg
                      >
                      {formatDateRange(
                        verifyProofData.selectedEvent,
                        currentLang
                      )}
                    </span>
                    {#if verifyProofData.selectedEvent.startTime && verifyProofData.selectedEvent.endTime}
                      <span>
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                          ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                          ></path></svg
                        >
                        {verifyProofData.selectedEvent.startTime} - {verifyProofData
                          .selectedEvent.endTime}
                      </span>
                    {/if}
                    <span
                      class="status-badge-inline"
                      class:active={verifyProofData.selectedEvent.status ===
                        "Active"}>{verifyProofData.selectedEvent.status}</span
                    >
                  </div>
                </div>
                <div class="logs-action-buttons">
                  <div class="realtime-controls">
                    {#if newVerifyProofCount > 0}
                      <button
                        class="btn-new-logs"
                        on:click={refreshVerifyProofSubmissions}
                      >
                        <svg
                          width="16"
                          height="16"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                          stroke-width="2.5"
                          ><path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                          ></path></svg
                        >
                        {newVerifyProofCount} New
                      </button>
                    {/if}
                    <button
                      class="btn-auto-refresh"
                      class:active={verifyProofAutoRefreshEnabled}
                      on:click={toggleVerifyProofAutoRefresh}
                      title={verifyProofAutoRefreshEnabled
                        ? "Auto-refresh ON"
                        : "Auto-refresh OFF"}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2.5"
                        ><path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                        ></path></svg
                      >
                      {#if verifyProofIsConnected}<span class="live-dot"
                        ></span>{/if}
                    </button>
                  </div>
                </div>
              </div>

              <div class="stats-dashboard-single-row">
                <div class="stat-card-compact pending">
                  <div class="stat-icon-compact">
                    <svg
                      width="20"
                      height="20"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                  </div>
                  <div class="stat-info-compact">
                    <div class="stat-value-compact">
                      {verifyProofData.submissions.length}
                    </div>
                    <div class="stat-label-compact">Pending</div>
                  </div>
                </div>
              </div>

              <div class="filter-section-logs">
                <!-- ‡πÅ‡∏ñ‡∏ß 1: Search Box + Batch + Std ID -->
                <div class="filter-row-logs">
                  <div class="search-box-logs">
                    <svg
                      class="search-icon"
                      width="18"
                      height="18"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                      ></path>
                    </svg>
                    <input
                      type="text"
                      placeholder="Search by name, email, or Nisit ID..."
                      bind:value={verifyProofSearchQuery}
                    />
                  </div>
                  <div class="nisit-filter-box">
                    <input
                      type="text"
                      placeholder="Batch"
                      maxlength="2"
                      bind:value={verifyProofBatchFilter}
                      on:input={(e) => {
                        verifyProofBatchFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                      }}
                    />
                  </div>
                  <div class="nisit-filter-box">
                    <input
                      type="text"
                      placeholder="Std ID"
                      maxlength="6"
                      bind:value={verifyProofStdIdFilter}
                      on:input={(e) => {
                        verifyProofStdIdFilter = e.currentTarget.value.replace(
                          /\D/g,
                          ""
                        );
                      }}
                    />
                  </div>
                </div>

                <!-- ‡πÅ‡∏ñ‡∏ß 2: Filter + Date Range + Buttons -->
                <div class="filter-row-logs">
                  <div
                    class="filter-dropdown-logs"
                    class:dropdown-open={showVerifyStatusDropdown}
                  >
                    <button
                      class="filter-trigger-logs"
                      on:click|stopPropagation={() => {
                        showVerifyFromDateDropdown = false;
                        showVerifyToDateDropdown = false;
                        showVerifyStatusDropdown = !showVerifyStatusDropdown;
                      }}
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                        ></path>
                      </svg>
                      <span>{verifyProofStatusFilter || "All"}</span>
                      <svg
                        class="chevron"
                        class:rotated={showVerifyStatusDropdown}
                        width="12"
                        height="12"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M19 9l-7 7-7-7"
                        ></path>
                      </svg>
                    </button>
                    {#if showVerifyStatusDropdown}
                      <div class="filter-menu-logs">
                        <button
                          class="filter-option-logs"
                          class:selected={verifyProofStatusFilter === "All"}
                          on:click|stopPropagation={() => {
                            verifyProofStatusFilter = "All";
                            showVerifyStatusDropdown = false;
                          }}>All</button
                        >
                        <button
                          class="filter-option-logs"
                          class:selected={verifyProofStatusFilter === "Pending"}
                          on:click|stopPropagation={() => {
                            verifyProofStatusFilter = "Pending";
                            showVerifyStatusDropdown = false;
                          }}>Pending</button
                        >
                      </div>
                    {/if}
                  </div>

                  <div
                    class="date-input-group-logs"
                    class:dropdown-open={showVerifyFromDateDropdown}
                  >
                    <label for="date-from">From:</label>
                    <div class="custom-date-dropdown-logs">
                      <button
                        class="custom-date-trigger-logs"
                        on:click|stopPropagation={() => {
                          showVerifyStatusDropdown = false;
                          showVerifyToDateDropdown = false;
                          showVerifyFromDateDropdown =
                            !showVerifyFromDateDropdown;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                        <span
                          >{verifyProofFromDate
                            ? availableVerifyProofDates.find(
                                (d) => d.value === verifyProofFromDate
                              )?.display || verifyProofFromDate
                            : "Select"}</span
                        >
                        <svg
                          class="chevron"
                          class:rotated={showVerifyFromDateDropdown}
                          width="10"
                          height="10"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>
                      {#if showVerifyFromDateDropdown}
                        <div class="custom-date-menu-logs">
                          {#each availableVerifyProofDates as date}
                            <button
                              class="date-option-logs"
                              class:selected={verifyProofFromDate ===
                                date.value}
                              on:click|stopPropagation={() => {
                                verifyProofFromDate = date.value;
                                showVerifyFromDateDropdown = false;
                              }}>{date.display}</button
                            >
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>

                  <div
                    class="date-input-group-logs"
                    class:dropdown-open={showVerifyToDateDropdown}
                  >
                    <label for="date-from">To:</label>
                    <div class="custom-date-dropdown-logs">
                      <button
                        class="custom-date-trigger-logs"
                        on:click|stopPropagation={() => {
                          showVerifyStatusDropdown = false;
                          showVerifyFromDateDropdown = false;
                          showVerifyToDateDropdown = !showVerifyToDateDropdown;
                        }}
                      >
                        <svg
                          width="14"
                          height="14"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                          ></path>
                        </svg>
                        <span
                          >{verifyProofToDate
                            ? availableVerifyProofDates.find(
                                (d) => d.value === verifyProofToDate
                              )?.display || verifyProofToDate
                            : "Select"}</span
                        >
                        <svg
                          class="chevron"
                          class:rotated={showVerifyToDateDropdown}
                          width="10"
                          height="10"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M19 9l-7 7-7-7"
                          ></path>
                        </svg>
                      </button>
                      {#if showVerifyToDateDropdown}
                        <div class="custom-date-menu-logs">
                          {#each availableVerifyProofDates as date}
                            <button
                              class="date-option-logs"
                              class:selected={verifyProofToDate === date.value}
                              on:click|stopPropagation={() => {
                                verifyProofToDate = date.value;
                                showVerifyToDateDropdown = false;
                              }}>{date.display}</button
                            >
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>

                  <button
                    class="btn-apply-logs"
                    on:click={() => {
                      verifyProofSubmissionsPage = 1;
                    }}
                  >
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
                      ></path>
                    </svg>
                    {lang.apply}
                  </button>

                  <button
                    class="btn-reset-logs"
                    on:click={() => {
                      verifyProofSearchQuery = "";
                      verifyProofBatchFilter = "";
                      verifyProofStdIdFilter = "";
                      verifyProofStatusFilter = "All";
                      verifyProofFromDate = "";
                      verifyProofToDate = "";
                      verifyProofSubmissionsPage = 1;
                    }}
                  >
                    <svg
                      width="16"
                      height="16"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                      ></path>
                    </svg>
                    {lang.reset}
                  </button>
                </div>
              </div>

              <div class="verify-proof-submissions-section">
                {#if verifyProofData.loading}
                  <div class="loading-state">
                    <div class="spinner"></div>
                    <span>Loading submissions...</span>
                  </div>
                {:else if sortedVerifyProofSubmissions.length === 0}
                  <div class="empty-state">
                    <svg
                      width="64"
                      height="64"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="1.5"
                        d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                      ></path>
                    </svg>
                    <p>No pending submissions</p>
                  </div>
                {:else}
                  <div class="submissions-grid-new">
                    {#each paginatedVerifyProofSubmissions as sub, index (sub.id)}
                      {@const globalIndex =
                        (verifyProofSubmissionsPage - 1) *
                          verifyProofSubmissionsPerPage +
                        index}
                      <div class="proof-card" style="position: relative;">
                        <div class="rank-circle">#{globalIndex + 1}</div>
                        <div class="user-details">
                          <h4 class="user-name">{sub.runnerName}</h4>
                          <p class="user-meta">
                            <span class="nisit-id">{sub.odySd}</span>
                            <span class="separator">‚Ä¢</span>
                            <span class="user-email">{sub.email}</span>
                          </p>
                          <p class="status-text">Pending Verification</p>
                        </div>
                        <div
                          class="proof-image-box"
                          role="button"
                          tabindex="0"
                          on:click={() => onProofImageClick(sub.proofImage)}
                          on:keydown={(e) => {
                            if (e.key === "Enter" || e.key === " ")
                              onProofImageClick(sub.proofImage);
                          }}
                        >
                          {#if sub.proofImage}
                            <img src={sub.proofImage} alt="Proof" />
                            <div class="image-overlay">
                              <svg
                                width="24"
                                height="24"
                                fill="none"
                                stroke="currentColor"
                                viewBox="0 0 24 24"
                                stroke-width="2"
                                ><path d="M21 21l-4.35-4.35"></path><path
                                  d="M11 8v6M8 11h6"
                                ></path><circle cx="11" cy="11" r="8"
                                ></circle></svg
                              >
                              <span>Click to view</span>
                            </div>
                          {:else}
                            <div class="no-image-placeholder">No image</div>
                          {/if}
                        </div>
                        <div class="proof-card-actions">
                          <button
                            class="btn-reject"
                            on:click={() => onRejectSubmission(sub)}
                            >Reject</button
                          >
                          <button
                            class="btn-approve"
                            on:click={() => onApproveSubmission(sub)}
                            >Approve</button
                          >
                        </div>
                      </div>
                    {/each}
                  </div>

                  {#if totalVerifyProofSubmissionsPages > 1}
                    <div class="pagination-wrapper">
                      <div class="pagination-controls">
                        <!-- ‡∏õ‡∏∏‡πà‡∏° Previous (‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ä‡∏µ‡πâ‡∏ã‡πâ‡∏≤‡∏¢) -->
                        <button
                          type="button"
                          class="page-btn prev"
                          on:click={prevVerifyProofSubmissionsPage}
                          disabled={verifyProofSubmissionsPage === 1}
                          aria-label="Previous page"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              d="M15 19l-7-7 7-7"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                            />
                          </svg>
                        </button>

                        <div class="page-select-wrapper">
                          <button
                            type="button"
                            class="page-indicator-box clickable"
                            on:click|stopPropagation={() =>
                              (showVerifyProofSubmissionsPageDropdown =
                                !showVerifyProofSubmissionsPageDropdown)}
                            aria-haspopup="listbox"
                            aria-expanded={showVerifyProofSubmissionsPageDropdown}
                          >
                            <span class="current-page"
                              >{verifyProofSubmissionsPage}</span
                            >
                            <span class="sep">/</span>
                            <span class="total-page"
                              >{totalVerifyProofSubmissionsPages}</span
                            >

                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              class="dropdown-arrow"
                              class:flipped={showVerifyProofSubmissionsPageDropdown}
                              width="12"
                              height="12"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="2"
                              aria-hidden="true"
                            >
                              <path
                                d="M19 9l-7 7-7-7"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                              />
                            </svg>
                          </button>

                          {#if showVerifyProofSubmissionsPageDropdown}
                            <div
                              class="click-outside"
                              role="button"
                              tabindex="0"
                              aria-label="Close dropdown"
                              on:click|stopPropagation={() =>
                                (showVerifyProofSubmissionsPageDropdown = false)}
                              on:keydown={(e) => {
                                if (e.key === "Enter" || e.key === " ") {
                                  showVerifyProofSubmissionsPageDropdown = false;
                                }
                              }}
                            ></div>
                            <div
                              class="page-dropdown-list"
                              role="listbox"
                              aria-label="Page list"
                            >
                              {#each Array(totalVerifyProofSubmissionsPages) as _, i}
                                <button
                                  type="button"
                                  class="page-dropdown-item"
                                  class:active={verifyProofSubmissionsPage ===
                                    i + 1}
                                  on:click={() => {
                                    verifyProofSubmissionsPage = i + 1;
                                    showVerifyProofSubmissionsPageDropdown = false;
                                  }}
                                  role="option"
                                  aria-selected={verifyProofSubmissionsPage ===
                                    i + 1}
                                >
                                  Page {i + 1}
                                </button>
                              {/each}
                            </div>
                          {/if}
                        </div>

                        <!-- ‡∏õ‡∏∏‡πà‡∏° Next (‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ä‡∏µ‡πâ‡∏Ç‡∏ß‡∏≤) -->
                        <button
                          type="button"
                          class="page-btn next"
                          on:click={nextVerifyProofSubmissionsPage}
                          disabled={verifyProofSubmissionsPage ===
                            totalVerifyProofSubmissionsPages}
                          aria-label="Next page"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            width="20"
                            height="20"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              d="M9 5l7 7-7 7"
                              stroke-linecap="round"
                              stroke-linejoin="round"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                    <div class="page-info">
                      Showing {(verifyProofSubmissionsPage - 1) * itemsPerPage +
                        1} - {Math.min(
                        verifyProofSubmissionsPage * itemsPerPage,
                        totalVerifyProofSubmissions
                      )} of {totalVerifyProofSubmissions} submissions
                    </div>
                  {/if}
                {/if}
              </div>
            </div>
          {/if}
        </div>
      {:else if currentView === "verify-code"}
        <div class="vc-container">
          <!-- Main Card -->
          <div class="vc-main-card">
            <!-- Action Mode Selector (Check-in / Check-out) -->
            <div class="vc-action-selector">
              <button
                class="vc-action-tab"
                class:active={verifyActionMode === "checkin"}
                on:click={() => switchActionMode("checkin")}
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4" />
                  <polyline points="10 17 15 12 10 7" />
                  <line x1="15" y1="12" x2="3" y2="12" />
                </svg>
                <span>{lang.checkIn}</span>
              </button>
              <button
                class="vc-action-tab checkout"
                class:active={verifyActionMode === "checkout"}
                on:click={() => switchActionMode("checkout")}
              >
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                  <polyline points="16 17 21 12 16 7" />
                  <line x1="21" y1="12" x2="9" y2="12" />
                </svg>
                <span>{lang.checkOut}</span>
              </button>
              <div
                class="vc-action-slider"
                class:checkout={verifyActionMode === "checkout"}
              ></div>
            </div>

            <!-- Card Header with Icon -->
            <div class="vc-card-header">
              <div
                class="vc-icon-wrapper"
                class:checkout={verifyActionMode === "checkout"}
              >
                <div class="vc-icon-bg"></div>
                {#if verifyActionMode === "checkout"}
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                    <polyline points="16 17 21 12 16 7" />
                    <line x1="21" y1="12" x2="9" y2="12" />
                  </svg>
                {:else}
                  <svg
                    width="32"
                    height="32"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                {/if}
              </div>
              <h2 class="vc-title">
                {verifyActionMode === "checkout"
                  ? lang.participantCheckOut
                  : lang.participantCheckIn}
              </h2>
              <p class="vc-subtitle">
                {verifyActionMode === "checkout"
                  ? lang.verifyParticipantCodeOut
                  : lang.verifyParticipantCode}
              </p>
            </div>

            <!-- Mode Selector -->
            <div
              class="vc-mode-selector"
              class:checkout={verifyActionMode === "checkout"}
            >
              <button
                class="vc-mode-tab"
                class:active={verifyMode === "pin"}
                class:checkout={verifyActionMode === "checkout"}
                on:click={() => switchVerifyMode("pin")}
              >
                <div class="vc-mode-icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="22"
                    height="22"
                    viewBox="-2 -2 28 28"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                  </svg>
                </div>
                <span>{lang.pinCode}</span>
              </button>

              <button
                class="vc-mode-tab"
                class:active={verifyMode === "qr"}
                class:checkout={verifyActionMode === "checkout"}
                on:click={() => switchVerifyMode("qr")}
              >
                <div class="vc-mode-icon">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="22"
                    height="22"
                    viewBox="-2 -2 28 28"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <path d="M3 7V5a2 2 0 0 1 2-2h2"></path>
                    <path d="M17 3h2a2 2 0 0 1 2 2v2"></path>
                    <path d="M21 17v2a2 2 0 0 1-2 2h-2"></path>
                    <path d="M7 21H5a2 2 0 0 1-2-2v-2"></path>
                    <rect x="7" y="7" width="10" height="10" rx="1.5"></rect>
                  </svg>
                </div>
                <span>{lang.scanQR}</span>
              </button>

              <div
                class="vc-mode-slider"
                class:qr={verifyMode === "qr"}
                class:checkout={verifyActionMode === "checkout"}
              ></div>
            </div>

            <!-- Success Message for Check-in -->
            {#if lastVerifySuccess}
              <div class="vc-success">
                <div class="vc-success-check">
                  <svg
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                  >
                    <path d="M20 6L9 17l-5-5" />
                  </svg>
                </div>
                <div class="vc-success-info">
                  <span class="vc-success-label"
                    >{currentLang === "th"
                      ? "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à"
                      : "Check-in Successful"}</span
                  >
                  <span class="vc-success-name">{lastParticipantName}</span>
                </div>
              </div>
            {/if}

            <!-- Success Message for Check-out -->
            {#if lastCheckOutSuccess}
              <div class="vc-success checkout">
                <div class="vc-success-check checkout">
                  <svg
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                  >
                    <path d="M20 6L9 17l-5-5" />
                  </svg>
                </div>
                <div class="vc-success-info">
                  <span class="vc-success-label checkout"
                    >{lang.checkOutSuccess}</span
                  >
                  <span class="vc-success-name">{lastParticipantName}</span>
                </div>
              </div>
            {/if}

            <!-- Content Area -->
            <div class="vc-content">
              <!-- PIN Mode -->
              <div class="vc-pin-mode" class:active={verifyMode === "pin"}>
                <!-- Auto Toggle -->
                <div class="vc-auto-toggle">
                  <div class="vc-auto-info">
                    <svg
                      width="18"
                      height="18"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" />
                    </svg>
                    <span
                      >{verifyActionMode === "checkout"
                        ? currentLang === "th"
                          ? "Auto Check Out"
                          : "Auto Check Out"
                        : currentLang === "th"
                          ? "Auto Check In"
                          : "Auto Check In"}</span
                    >
                  </div>
                  <button
                    class="vc-switch"
                    class:checkout={verifyActionMode === "checkout"}
                    aria-label="Switch"
                    class:on={autoCheckIn}
                    on:click={() => {
                      autoCheckIn = !autoCheckIn;
                      clearPins();
                    }}
                  >
                    <span class="vc-switch-knob"></span>
                  </button>
                </div>

                <!-- PIN Input -->
                <div class="vc-pin-area" style="margin-bottom: 1rem;">
                  <div class="vc-pin-row">
                    {#each pins as pin, i}
                      <div
                        class="vc-pin-cell"
                        class:filled={pin !== ""}
                        class:checkout={verifyActionMode === "checkout"}
                        class:error={verifyErrorIndex !== null &&
                          (verifyErrorMessage ? true : verifyErrorIndex === i)}
                      >
                        <input
                          type="text"
                          inputmode="numeric"
                          maxlength="1"
                          class="vc-pin-input"
                          bind:value={pins[i]}
                          bind:this={pinInputRefs[i]}
                          on:input={(e) => handlePinInput(i, e)}
                          on:keydown={(e) => handlePinKeydown(i, e)}
                          on:focus={() => handlePinFocus(i)}
                          disabled={isVerifying}
                        />
                      </div>
                    {/each}
                  </div>
                </div>

                <!-- Error -->
                {#if verifyErrorMessage && verifyMode === "pin"}
                  <div class="vc-error-msg">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="20"
                      height="20"
                      viewBox="-2 -2 28 28"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="8" x2="12" y2="12"></line>
                      <line x1="12" y1="16" x2="12.01" y2="16"></line>
                    </svg>
                    <span>{verifyErrorMessage}</span>
                  </div>
                {/if}

                <!-- Submit Button -->
                <div class="vc-submit-wrapper" class:hidden={autoCheckIn}>
                  <button
                    class="vc-submit"
                    class:checkout={verifyActionMode === "checkout"}
                    on:click={handleVerifyPin}
                    disabled={isVerifying ||
                      pins.some((p) => p === "") ||
                      autoCheckIn}
                  >
                    {#if isVerifying}
                      <span class="vc-loader"></span>
                      <span
                        >{currentLang === "th"
                          ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö..."
                          : "Verifying..."}</span
                      >
                    {:else if verifyActionMode === "checkout"}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4" />
                        <polyline points="16 17 21 12 16 7" />
                        <line x1="21" y1="12" x2="9" y2="12" />
                      </svg>
                      <span>{lang.checkOut}</span>
                    {:else}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        />
                      </svg>
                      <span>{lang.checkIn}</span>
                    {/if}
                  </button>
                </div>

                <!-- Loading State -->
                {#if isVerifying && autoCheckIn}
                  <div class="vc-verifying">
                    <span class="vc-loader lg"></span>
                    <span
                      >{currentLang === "th"
                        ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™..."
                        : "Verifying code..."}</span
                    >
                  </div>
                {/if}

                <!-- Hint -->
                <p class="vc-hint">
                  {#if autoCheckIn}
                    {lang.enterDigitCode} ‚Ä¢ {verifyActionMode === "checkout"
                      ? lang.autoCheckOutEnabled
                      : lang.autoCheckInEnabled}
                  {:else}
                    {lang.enterDigitCode} ‚Ä¢ {verifyActionMode === "checkout"
                      ? lang.pressCheckOut
                      : lang.pressCheckIn}
                  {/if}
                </p>
              </div>

              <!-- QR Mode -->
              <div class="vc-qr-mode" class:active={verifyMode === "qr"}>
                <div class="vc-scanner">
                  {#if cameraError}
                    <div class="vc-camera-err">
                      <svg
                        width="56"
                        height="56"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="1.5"
                      >
                        <path
                          d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"
                        />
                        <circle cx="12" cy="13" r="4" />
                        <line x1="1" y1="1" x2="23" y2="23" />
                      </svg>
                      <p>{cameraError}</p>
                      <button class="vc-retry" on:click={startCamera}>
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path d="M23 4v6h-6M1 20v-6h6" />
                          <path
                            d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"
                          />
                        </svg>
                        Try Again
                      </button>
                    </div>
                  {:else}
                    <video
                      bind:this={videoRef}
                      class="vc-video"
                      playsinline
                      muted
                    ></video>
                    <canvas bind:this={canvasRef} class="vc-canvas"></canvas>

                    <!-- Scanner Overlay -->
                    <div class="vc-scan-overlay">
                      <div
                        class="vc-scan-frame"
                        class:active={scanning &&
                          !isVerifying &&
                          !qrSuccessShow}
                        class:success={qrSuccessShow}
                        class:checkout={verifyActionMode === "checkout"}
                      >
                        <span class="vc-frame-corner tl"></span>
                        <span class="vc-frame-corner tr"></span>
                        <span class="vc-frame-corner bl"></span>
                        <span class="vc-frame-corner br"></span>
                        {#if scanning && !isVerifying && !qrSuccessShow}
                          <div
                            class="vc-scan-beam"
                            class:checkout={verifyActionMode === "checkout"}
                          ></div>
                        {/if}
                      </div>

                      <!-- QR Success Overlay -->
                      {#if qrSuccessShow}
                        <div
                          class="vc-qr-success"
                          class:checkout={verifyActionMode === "checkout"}
                        >
                          <div
                            class="vc-qr-success-icon"
                            class:checkout={verifyActionMode === "checkout"}
                          >
                            <svg
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="3"
                            >
                              <path d="M5 13l4 4L19 7"></path>
                            </svg>
                          </div>
                          <span class="vc-qr-success-text"
                            >{lastParticipantName}</span
                          >
                          <span
                            class="vc-qr-success-label"
                            class:checkout={verifyActionMode === "checkout"}
                          >
                            {verifyActionMode === "checkout"
                              ? currentLang === "th"
                                ? "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ó‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"
                                : "Check-out Success!"
                              : currentLang === "th"
                                ? "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"
                                : "Check-in Success!"}
                          </span>
                        </div>
                      {/if}
                    </div>

                    <!-- Status Badge -->
                    {#if isVerifying}
                      <div class="vc-scan-status verifying">
                        <span class="vc-loader sm"></span>
                        <span>Verifying...</span>
                      </div>
                    {:else if qrSuccessShow}
                      <div
                        class="vc-scan-status success"
                        class:checkout={verifyActionMode === "checkout"}
                      >
                        <svg
                          width="14"
                          height="14"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="3"
                        >
                          <path d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span
                          >{verifyActionMode === "checkout"
                            ? "Check-out OK!"
                            : "Check-in OK!"}</span
                        >
                      </div>
                    {:else if scanning}
                      <div
                        class="vc-scan-status active"
                        class:checkout={verifyActionMode === "checkout"}
                      >
                        <span
                          class="vc-pulse-dot"
                          class:checkout={verifyActionMode === "checkout"}
                        ></span>
                        <span>Scanning...</span>
                      </div>
                    {/if}
                  {/if}
                </div>

                <!-- Error -->
                {#if verifyErrorMessage && verifyMode === "qr"}
                  <div class="vc-error-msg">
                    <svg
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <circle cx="12" cy="12" r="10" />
                      <path d="M12 8v4m0 4h.01" />
                    </svg>
                    <span>{verifyErrorMessage}</span>
                  </div>
                {/if}

                <p class="vc-hint">
                  {verifyActionMode === "checkout"
                    ? currentLang === "th"
                      ? "‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà QR code ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°"
                      : "Point camera at participant's QR code"
                    : currentLang === "th"
                      ? "‡πÄ‡∏•‡πá‡∏á‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà QR code ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°"
                      : "Point camera at participant's QR code"}
                </p>
              </div>
            </div>
          </div>
        </div>
      {:else if currentView == "settings"}
        <div class="settings-container">
          {#if dataIsLoading}
            <div class="loading-state">
              <div class="loader"></div>
              <p>Loading your profile...</p>
            </div>
          {:else}
            <div class="settings-content">
              <!-- Header Section -->
              <div class="header-section">
                <div class="icon-wrapper">
                  <svg
                    width="28"
                    height="28"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                  </svg>
                </div>
                <div class="header-text">
                  <h1>{lang.accountSettings}</h1>
                  <p>{lang.manageProfile}</p>
                </div>
              </div>

              <!-- Personal Information Card -->
              <div class="info-card">
                <div class="card-headerr">
                  <div class="card-icon">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"
                      ></path>
                      <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                  </div>
                  <h2>{lang.personalInfo}</h2>
                </div>

                <div class="card-content">
                  <!-- Title & First Name Row -->
                  <div class="field-row">
                    <div class="form-field" style="flex: 0 0 100px;">
                      <label for="date-from">{lang.title}</label>
                      <div class="custom-select">
                        <button
                          type="button"
                          class="select-btn {fieldValidationErrors.title
                            ? 'error'
                            : ''}"
                          class:active={showTitleDropdown}
                          on:click={(e) => toggleDropdownVisibility("title", e)}
                        >
                          <span class:placeholder={!userTitle}
                            >{userTitle || lang.title}</span
                          >
                          <svg
                            class="arrow"
                            class:rotate={showTitleDropdown}
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M6 9l6 6 6-6" />
                          </svg>
                        </button>
                        {#if showTitleDropdown}
                          <div class="dropdown-menu">
                            {#each nameTitles as title}
                              <button
                                class="dropdown-item"
                                on:click={() => chooseTitle(title)}
                              >
                                {title}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                    </div>

                    <div class="form-field" style="flex: 1;">
                      <label for="date-from">{lang.firstName}</label>
                      <div
                        class="input-wrapper {fieldValidationErrors.firstName
                          ? 'error'
                          : ''}"
                      >
                        <input
                          type="text"
                          bind:value={userFirstName}
                          on:input={dismissAlert}
                          placeholder={lang.enterFirstName}
                        />
                      </div>
                    </div>
                  </div>

                  <!-- Last Name -->
                  <div class="form-field">
                    <label for="date-from">{lang.lastName}</label>
                    <div
                      class="input-wrapper {fieldValidationErrors.lastName
                        ? 'error'
                        : ''}"
                    >
                      <input
                        type="text"
                        bind:value={userLastName}
                        on:input={dismissAlert}
                        placeholder={lang.enterLastName}
                      />
                    </div>
                  </div>

                  <!-- Email (Locked) -->
                  <div class="form-field">
                    <label for="date-from">{lang.emailAddress}</label>
                    <div class="input-wrapper locked">
                      <input type="email" value={userEmail} disabled />
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                        ></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Role-Specific Information Card -->
              <div class="info-card" style="position: relative; z-index: 50;">
                <div class="card-headerr">
                  <div class="card-icon">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      {#if userRole === "student"}
                        <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
                        <path d="M6 12v5c3 3 9 3 12 0v-5"></path>
                      {:else}
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"
                        ></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                      {/if}
                    </svg>
                  </div>
                  <h2>
                    {userRole === "student"
                      ? lang.academicInfo
                      : lang.departmentInfo}
                  </h2>
                </div>

                <div class="card-content">
                  {#if userRole === "student"}
                    <!-- Nisit ID (Locked) -->
                    <div class="form-field">
                      <label for="date-from">{lang.studentId}</label>
                      <div class="input-wrapper locked">
                        <input type="text" value={studentIdNumber} disabled />
                        <svg
                          width="16"
                          height="16"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <rect
                            x="3"
                            y="11"
                            width="18"
                            height="11"
                            rx="2"
                            ry="2"
                          ></rect>
                          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                      </div>
                    </div>

                    <!-- Faculty -->
                    <div class="form-field">
                      <label for="date-from">{lang.faculty}</label>
                      <div class="custom-select">
                        <button
                          type="button"
                          class="select-btn {fieldValidationErrors.faculty
                            ? 'error'
                            : ''}"
                          class:active={showFacultyDropdown}
                          on:click={(e) =>
                            toggleDropdownVisibility("faculty", e)}
                        >
                          <span class:placeholder={!userFaculty}
                            >{retrieveFacultyName(userFaculty)}</span
                          >
                          <svg
                            class="arrow"
                            class:rotate={showFacultyDropdown}
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M6 9l6 6 6-6" />
                          </svg>
                        </button>
                        {#if showFacultyDropdown}
                          <div class="dropdown-menu">
                            {#each universityFaculties as faculty}
                              <button
                                class="dropdown-item"
                                on:click={() => chooseFaculty(faculty.id)}
                              >
                                {faculty.name}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                    </div>

                    <!-- Major -->
                    <div class="form-field">
                      <label for="date-from">{lang.major}</label>
                      <div class="custom-select" class:disabled={!userFaculty}>
                        <button
                          type="button"
                          class="select-btn {fieldValidationErrors.major
                            ? 'error'
                            : ''}"
                          class:active={showMajorDropdown}
                          class:placeholder={!userMajor}
                          disabled={!userFaculty}
                          on:click={(e) => {
                            if (userFaculty)
                              toggleDropdownVisibility("major", e);
                          }}
                        >
                          <span class:placeholder={!userMajor}
                            >{retrieveMajorName(userMajor)}</span
                          >
                          <svg
                            class="arrow"
                            class:rotate={showMajorDropdown}
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M6 9l6 6 6-6" />
                          </svg>
                        </button>
                        {#if showMajorDropdown}
                          <div class="dropdown-menu">
                            {#each availableMajorsForFaculty as major}
                              <button
                                class="dropdown-item"
                                on:click={() => chooseMajor(major.id)}
                              >
                                {major.name}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                    </div>
                  {:else}
                    <!-- Department -->
                    <div class="form-field">
                      <label for="date-from">{lang.department}</label>
                      <div class="custom-select">
                        <button
                          type="button"
                          class="select-btn {fieldValidationErrors.department
                            ? 'error'
                            : ''}"
                          class:active={showDepartmentDropdown}
                          on:click={(e) => toggleDropdownVisibility("dept", e)}
                        >
                          <span class:placeholder={!userDepartment}
                            >{retrieveDepartmentName(userDepartment)}</span
                          >
                          <svg
                            class="arrow"
                            class:rotate={showDepartmentDropdown}
                            width="16"
                            height="16"
                            viewBox="0 0 24 24"
                            fill="none"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path d="M6 9l6 6 6-6" />
                          </svg>
                        </button>
                        {#if showDepartmentDropdown}
                          <div class="dropdown-menu">
                            {#each staffDepartments as dept}
                              <button
                                class="dropdown-item"
                                on:click={() => chooseDepartment(dept.id)}
                              >
                                {dept.name}
                              </button>
                            {/each}
                          </div>
                        {/if}
                      </div>
                    </div>
                  {/if}
                </div>
              </div>

              <!-- Security Card -->
              <div class="info-card">
                <div class="card-headerr">
                  <div class="card-icon">
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                      ></rect>
                      <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                    </svg>
                  </div>
                  <h2>{lang.security}</h2>
                </div>

                <div class="card-content">
                  <div class="form-field">
                    <div class="password-row">
                      <label for="date-from">{lang.password}</label>
                      <a
                        href="/auth/forgot-password?return_to={$page.url
                          .pathname}"
                        class="change-link"
                      >
                        {lang.changePassword}
                      </a>
                    </div>
                    <div class="input-wrapper locked">
                      <input type="password" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" disabled />
                      <svg
                        width="16"
                        height="16"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                        ></rect>
                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                      </svg>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Feedback Message -->
              {#if feedbackMessage}
                <div class="feedback-toast {feedbackType}">
                  <div class="toast-icon">
                    {#if feedbackType === "error"}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="15" y1="9" x2="9" y2="15"></line>
                        <line x1="9" y1="9" x2="15" y2="15"></line>
                      </svg>
                    {:else}
                      <svg
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    {/if}
                  </div>
                  <span>{feedbackMessage}</span>
                </div>
              {/if}

              <!-- Action Buttons -->
              <div class="action-section">
                <button
                  type="button"
                  class="save-btn"
                  class:disabled={!hasUnsavedChanges || savingChanges}
                  disabled={!hasUnsavedChanges || savingChanges}
                  on:click|preventDefault={submitProfileUpdate}
                >
                  {#if savingChanges}
                    <div class="btn-loader"></div>
                    <span
                      >{currentLang === "th"
                        ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å..."
                        : "Saving Changes..."}</span
                    >
                  {:else}
                    <svg
                      width="20"
                      height="20"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
                      ></path>
                      <polyline points="17 21 17 13 7 13 7 21"></polyline>
                      <polyline points="7 3 7 8 15 8"></polyline>
                    </svg>
                    <span>{lang.saveChanges}</span>
                  {/if}
                </button>
              </div>
            </div>
          {/if}
        </div>
      {:else if currentView == "unlock"}
        <div class="unlock-user-component">
          <div class="unlock-card">
            <div class="unlock-card-header">
              <div class="unlock-icon-circle">
                <svg
                  width="32"
                  height="32"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                  ></rect>
                  <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
                </svg>
              </div>
              <h2 class="unlock-main-title">{lang.unlockAccount}</h2>
              <p class="unlock-sub-title">
                {lang.enterEmailToRestore}
              </p>
            </div>

            <form
              class="unlock-form-section"
              on:submit|preventDefault={handleUnlock}
              autocomplete="off"
            >
              <div class="unlock-form-group">
                <label class="unlock-label" for="unlock-email-input"
                  >{lang.userEmailAddress}</label
                >
                <div
                  class="unlock-input-wrapper {errorField === 'email'
                    ? 'unlock-error'
                    : ''}"
                >
                  <input
                    id="unlock-email-input"
                    type="email"
                    placeholder={lang.enterEmailPlaceholder}
                    bind:value={email}
                    on:input={clearNotification}
                    disabled={isLoading}
                  />
                </div>
              </div>

              {#if notificationMessage}
                <div class="unlock-notification unlock-{notificationType}">
                  <div class="unlock-notif-icon">
                    {#if notificationType === "error"}
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="12"></line>
                        <line x1="12" y1="16" x2="12.01" y2="16"></line>
                      </svg>
                    {:else}
                      <svg
                        width="18"
                        height="18"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      >
                        <polyline points="20 6 9 17 4 12"></polyline>
                      </svg>
                    {/if}
                  </div>
                  <span>{notificationMessage}</span>
                </div>
              {/if}

              <button
                type="submit"
                class="unlock-submit-btn"
                disabled={isLoading}
              >
                {#if isLoading}
                  <div class="unlock-spinner"></div>
                  <span
                    >{currentLang === "th"
                      ? "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£..."
                      : "Processing..."}</span
                  >
                {:else}
                  <svg
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  >
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"
                    ></rect>
                    <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                  </svg>
                  <span>{lang.unlockAccount}</span>
                {/if}
              </button>
            </form>
          </div>
        </div>
      {:else if currentView !== "create"}
        <div
          style="padding: 4rem; text-align: center; color: var(--text-muted); border: 1px dashed rgba(255,255,255,0.1); border-radius: 20px;"
        >
          <h3>
            Content for {menuItems.find((m) => m.id === currentView)?.label}
          </h3>
          <p>This page does not have search or pagination enabled.</p>
        </div>
      {/if}
    </div>

    <div class="pagination-controls"></div>

    {#if currentView === "create"}
      <div class="ce-wrapper">
        <div
          class="ce-container"
          role="button"
          tabindex="0"
          on:click={() => (ce_activeDropdown = null)}
          on:keydown={(e) => {
            if (e.key === "Escape" || e.key === "Enter")
              ce_activeDropdown = null;
          }}
        >
          <div class="ce-header">
            <h2 class="ce-title">
              {editingEventId ? lang.editEvent : lang.createNewEvent}
            </h2>
            <div class="ce-header-right">
              {#if ce_validationErrors.size > 0}
                <div class="ce-validation-alert">
                  <svg
                    class="ce-alert-icon"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                    ></path>
                  </svg>
                  <span class="ce-alert-text">{lang.fillAllFields}</span>
                </div>
              {/if}
              <div class="ce-header-actions">
                <button
                  class="ce-btn-cancel"
                  on:click={() => {
                    editingEventId = null;
                    ce_formData = {
                      title: "",
                      description: "",
                      location: "",
                      sDay: "",
                      sMonth: "",
                      sYear: "",
                      eDay: "",
                      eMonth: "",
                      eYear: "",
                      startTime: "",
                      endTime: "",
                      totalSlots: null,
                      distanceKm: null,
                      holidays: [],
                      excludeWeekends: false,
                      holidayType: "none",
                      specificDates: [],
                      tempHoliday: "",
                      totalRewards: null,
                      requiredCompletions: null,
                      rewards: [
                        {
                          name: "",
                          requirement: null,
                        },
                      ],
                      isPublic: true,
                      isActive: true,
                      imagePreview: null,
                      eventType: "single_day",
                      allowDailyCheckin: false,
                      maxCheckinsPerUser: 1,
                    };
                    ce_holidayMode = null;
                    currentView = "list";
                  }}>{lang.cancel}</button
                >
                <button class="ce-btn-save" on:click={ce_submit}
                  >{editingEventId
                    ? lang.update
                    : currentLang === "th"
                      ? "‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà"
                      : "Publish"}</button
                >
              </div>
            </div>
          </div>

          <div class="ce-grid-layout">
            <!-- Image Upload Section -->
            <div
              class="ce-card ce-img-card"
              class:has-img={ce_formData.imagePreview}
              role="button"
              tabindex="0"
              aria-label="Upload event image"
              on:click|stopPropagation={ce_trigFile}
              on:keydown={(e) => {
                if (e.key === "Enter" || e.key === " ") ce_trigFile();
              }}
            >
              <input
                type="file"
                accept="image/*"
                bind:this={ce_fileInput}
                on:change={ce_handleImg}
                hidden
              />
              {#if ce_formData.imagePreview}
                <img
                  src={ce_formData.imagePreview}
                  alt="Preview"
                  class="ce-preview-img"
                />
                <div class="ce-overlay">
                  <span
                    >{currentLang === "th"
                      ? "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û"
                      : "Change Image"}</span
                  >
                </div>
              {:else}
                <div class="ce-upload-placeholder">
                  <div class="ce-icon-upload">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
                      ></path>
                    </svg>
                  </div>
                  <span
                    >{currentLang === "th"
                      ? "‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"
                      : "Upload Event Banner"}</span
                  >
                </div>
              {/if}
            </div>

            <!-- Basic Info -->
            <div class="ce-card ce-form-card">
              <div class="ce-card-head">
                <svg
                  class="ce-icon-svg"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                  ></path>
                </svg>
                <span
                  >{currentLang === "th"
                    ? "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô"
                    : "Basic Information"}</span
                >
              </div>

              <div class="ce-input-group">
                <label for="event-title"
                  >{lang.eventName} <span class="ce-req">*</span></label
                >
                <input
                  id="event-title"
                  type="text"
                  bind:value={ce_formData.title}
                  placeholder={currentLang === "th"
                    ? "‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£"
                    : "Official Event Name"}
                  class="ce-input"
                  class:error={ce_validationErrors.has("title")}
                />
              </div>

              <div class="ce-input-group">
                <label for="event-desc"
                  >{lang.description} <span class="ce-req">*</span></label
                >
                <textarea
                  id="event-desc"
                  bind:value={ce_formData.description}
                  placeholder={currentLang === "th"
                    ? "‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°..."
                    : "Event details..."}
                  class="ce-textarea"
                  class:error={ce_validationErrors.has("description")}
                ></textarea>
              </div>

              <div class="ce-input-group">
                <label for="event-location"
                  >{lang.location} <span class="ce-req">*</span></label
                >
                <input
                  id="event-location"
                  type="text"
                  bind:value={ce_formData.location}
                  placeholder={currentLang === "th"
                    ? "‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°"
                    : "Location"}
                  class="ce-input"
                  class:error={ce_validationErrors.has("location")}
                />
              </div>
            </div>

            <!-- Event Type -->
            <div class="ce-card ce-config-card">
              <div class="ce-card-head">
                <svg
                  class="ce-icon-svg"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"
                  ></path>
                </svg>
                <span>{lang.eventTypeTitle}</span>
              </div>

              <div class="ce-event-type-control">
                <div class="ce-event-type-buttons">
                  <button
                    type="button"
                    class="ce-event-type-btn"
                    class:active={ce_formData.eventType === "single_day"}
                    on:click={() => ce_setEventType("single_day")}
                  >
                    <div class="ce-event-type-icon">
                      <svg
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                        ></path>
                      </svg>
                    </div>
                    <div class="ce-event-type-content">
                      <span class="ce-event-type-title">{lang.singleDay}</span>
                      <span class="ce-event-type-desc"
                        >{lang.singleDayDesc}</span
                      >
                    </div>
                    {#if ce_formData.eventType === "single_day"}
                      <div class="ce-event-type-check">
                        <svg
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 13l4 4L19 7"
                          ></path>
                        </svg>
                      </div>
                    {/if}
                  </button>

                  <button
                    type="button"
                    class="ce-event-type-btn"
                    class:active={ce_formData.eventType === "multi_day"}
                    on:click={() => ce_setEventType("multi_day")}
                  >
                    <div class="ce-event-type-icon">
                      <svg
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2zM9 12h.01M15 12h.01M9 16h.01M15 16h.01"
                        ></path>
                      </svg>
                    </div>
                    <div class="ce-event-type-content">
                      <span class="ce-event-type-title">{lang.multiDay}</span>
                      <span class="ce-event-type-desc">{lang.multiDayDesc}</span
                      >
                    </div>
                    {#if ce_formData.eventType === "multi_day"}
                      <div class="ce-event-type-check">
                        <svg
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M5 13l4 4L19 7"
                          ></path>
                        </svg>
                      </div>
                    {/if}
                  </button>
                </div>

                {#if ce_formData.eventType === "multi_day"}
                  <div class="ce-checkin-section">
                    <span class="ce-checkin-label"
                      >{lang.maxCheckinsPerUser}</span
                    >
                    <div class="ce-checkin-stepper">
                      <button
                        type="button"
                        class="ce-stepper-btn minus"
                        aria-label="Decrease"
                        on:click={() => {
                          if (ce_formData.maxCheckinsPerUser > 1) {
                            ce_formData.maxCheckinsPerUser--;
                            ce_formData = { ...ce_formData };
                          }
                        }}
                        disabled={ce_formData.maxCheckinsPerUser <= 1}
                      >
                        <svg
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M18 12H6"
                          ></path>
                        </svg>
                      </button>
                      <div class="ce-stepper-value">
                        {ce_formData.maxCheckinsPerUser}
                      </div>
                      <button
                        type="button"
                        class="ce-stepper-btn plus"
                        aria-label="Increase"
                        on:click={() => {
                          if (ce_formData.maxCheckinsPerUser < 365) {
                            ce_formData.maxCheckinsPerUser++;
                            ce_formData = { ...ce_formData };
                          }
                        }}
                        disabled={ce_formData.maxCheckinsPerUser >= 365}
                      >
                        <svg
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 6v12m6-6H6"
                          ></path>
                        </svg>
                      </button>
                      <span class="ce-stepper-unit">{lang.checkinTimes}</span>
                    </div>
                  </div>
                {/if}
              </div>
            </div>

            <!-- Date & Time -->
            <div class="ce-card ce-config-card">
              <div class="ce-card-head">
                <svg
                  class="ce-icon-svg"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                  ></path>
                </svg>
                <span>{lang.dateAndTime}</span>
              </div>

              <div class="ce-dual-row">
                <div class="ce-input-group">
                  <label for="ce-sDay-input"
                    >{lang.startDateLabel} <span class="ce-req">*</span></label
                  >

                  <div
                    class="ce-date-row compact-gap"
                    class:error={ce_validationErrors.has("startDate")}
                  >
                    <div class="ce-dd-wrap flex-1-5">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        aria-expanded={ce_activeDropdown === "sDay"}
                        on:click|stopPropagation={() => ce_toggleDD("sDay")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("sDay");
                          }
                        }}
                      >
                        <input
                          id="ce-sDay-input"
                          type="text"
                          value={ce_formData.sDay}
                          placeholder={ce_dayPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "sDay"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_days as d}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.sDay === String(d)}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("sDay", d)}
                            >
                              {d}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <div class="ce-dd-wrap flex-2">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        on:click|stopPropagation={() => ce_toggleDD("sMonth")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("sMonth");
                          }
                        }}
                      >
                        <input
                          type="text"
                          value={translateMonth(ce_formData.sMonth)}
                          placeholder={ce_monthPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "sMonth"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_months as m, idx}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.sMonth === m}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("sMonth", m)}
                            >
                              {ce_displayMonths[idx]}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <div class="ce-dd-wrap flex-1-5">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        on:click|stopPropagation={() => ce_toggleDD("sYear")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("sYear");
                          }
                        }}
                      >
                        <input
                          type="text"
                          value={ce_displaySYear}
                          placeholder={ce_yearPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "sYear"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_displayYears as displayY, idx}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.sYear === ce_years[idx].toString()}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("sYear", ce_years[idx])}
                            >
                              {displayY}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>
                </div>

                <div class="ce-input-group">
                  <label for="ce-eDay-input"
                    >{lang.endDateLabel} <span class="ce-req">*</span></label
                  >
                  <div
                    class="ce-date-row compact-gap"
                    class:error={ce_validationErrors.has("endDate")}
                  >
                    <div class="ce-dd-wrap flex-1-5">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        on:click|stopPropagation={() => ce_toggleDD("eDay")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("eDay");
                          }
                        }}
                      >
                        <input
                          id="ce-eDay-input"
                          type="text"
                          value={ce_formData.eDay}
                          placeholder={ce_dayPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "eDay"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_days as d}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.eDay === String(d)}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("eDay", d)}
                            >
                              {d}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <div class="ce-dd-wrap flex-2">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        on:click|stopPropagation={() => ce_toggleDD("eMonth")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("eMonth");
                          }
                        }}
                      >
                        <input
                          type="text"
                          value={translateMonth(ce_formData.eMonth)}
                          placeholder={ce_monthPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "eMonth"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_months as m, idx}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.eMonth === m}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("eMonth", m)}
                            >
                              {ce_displayMonths[idx]}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>

                    <div class="ce-dd-wrap flex-1-5">
                      <div
                        class="ce-trigger"
                        role="button"
                        tabindex="0"
                        aria-haspopup="listbox"
                        on:click|stopPropagation={() => ce_toggleDD("eYear")}
                        on:keydown={(e) => {
                          if (["Enter", " "].includes(e.key)) {
                            e.preventDefault();
                            ce_toggleDD("eYear");
                          }
                        }}
                      >
                        <input
                          type="text"
                          value={ce_displayEYear}
                          placeholder={ce_yearPlaceholder}
                          class="ce-input-dis"
                          readonly
                          tabindex="-1"
                          on:click|stopPropagation
                        />
                        <span class="ce-arrow">‚ñº</span>
                      </div>
                      {#if ce_activeDropdown === "eYear"}
                        <div
                          class="ce-options"
                          role="listbox"
                          tabindex="-1"
                          on:click|stopPropagation={() => {}}
                          on:keydown|stopPropagation={() => {}}
                        >
                          {#each ce_displayYears as displayY, idx}
                            <button
                              type="button"
                              class="ce-opt"
                              role="option"
                              aria-selected={ce_formData.eYear === ce_years[idx].toString()}
                              on:click|stopPropagation={() =>
                                ce_selectOpt("eYear", ce_years[idx])}
                            >
                              {displayY}
                            </button>
                          {/each}
                        </div>
                      {/if}
                    </div>
                  </div>
                </div>
              </div>

              {#if (startDateObj && endDateObj && !isDateRangeValid) || ce_validationErrors.has("dateRange")}
                <div class="ce-error-msg">
                  ‚ö†Ô∏è {lang.invalidDateRangeMsg}
                </div>
              {/if}

              <div class="ce-time-capacity-row">
                <div class="ce-input-group">
                  <label for="ce_startTime"
                    >{lang.startTimeLabel} <span class="ce-req">*</span></label
                  >
                  <div
                    class="ce-dd-wrap"
                    class:error={ce_validationErrors.has("startTime")}
                  >
                    <div
                      class="ce-trigger-compact"
                      role="button"
                      tabindex="0"
                      on:click|stopPropagation={() => ce_toggleDD("startTime")}
                      on:keydown={(e) => {
                        if (e.key === "Enter" || e.key === " ") {
                          e.stopPropagation();
                          ce_toggleDD("startTime");
                        }
                      }}
                    >
                      <input
                        id="ce_startTime"
                        type="text"
                        value={ce_formData.startTime}
                        placeholder="00:00"
                        class="ce-input-inline"
                        maxlength="5"
                        on:input={(e) => ce_handleTimeInput(e, "startTime")}
                        on:click|stopPropagation={() =>
                          ce_toggleDD("startTime")}
                      />
                      <span class="ce-arrow">‚ñº</span>
                    </div>

                    {#if ce_activeDropdown === "startTime"}
                      <div class="ce-options" role="listbox">
                        {#each ce_timeList as t}
                          <div
                            class="ce-opt"
                            role="option"
                            tabindex="0"
                            aria-selected={ce_formData.startTime === t}
                            on:click|stopPropagation={() =>
                              ce_selectCombo("startTime", t)}
                            on:keydown={(e) => {
                              if (e.key === "Enter") {
                                e.stopPropagation();
                                ce_selectCombo("startTime", t);
                              }
                            }}
                          >
                            {t}
                          </div>
                        {/each}
                      </div>
                    {/if}
                  </div>
                </div>

                <div class="ce-input-group">
                  <label for="ce_endTime"
                    >{lang.endTimeLabel} <span class="ce-req">*</span></label
                  >
                  <div
                    class="ce-dd-wrap"
                    class:error={ce_validationErrors.has("endTime")}
                  >
                    <div
                      class="ce-trigger-compact"
                      role="button"
                      tabindex="0"
                      on:click|stopPropagation={() => ce_toggleDD("endTime")}
                      on:keydown={(e) => {
                        if (e.key === "Enter" || e.key === " ") {
                          e.stopPropagation();
                          ce_toggleDD("endTime");
                        }
                      }}
                    >
                      <input
                        id="ce_endTime"
                        type="text"
                        value={ce_formData.endTime}
                        placeholder="00:00"
                        class="ce-input-inline"
                        maxlength="5"
                        on:input={(e) => ce_handleTimeInput(e, "endTime")}
                        on:click|stopPropagation={() => ce_toggleDD("endTime")}
                      />
                      <span class="ce-arrow">‚ñº</span>
                    </div>

                    {#if ce_activeDropdown === "endTime"}
                      <div class="ce-options" role="listbox">
                        {#each ce_timeList as t}
                          <div
                            class="ce-opt"
                            role="option"
                            tabindex="0"
                            aria-selected={ce_formData.endTime === t}
                            on:click|stopPropagation={() =>
                              ce_selectCombo("endTime", t)}
                            on:keydown={(e) => {
                              if (e.key === "Enter") {
                                e.stopPropagation();
                                ce_selectCombo("endTime", t);
                              }
                            }}
                          >
                            {t}
                          </div>
                        {/each}
                      </div>
                    {/if}
                  </div>
                </div>

                <div class="ce-input-group">
                  <label for="ce_totalSlots"
                    >{lang.capacityLabel} <span class="ce-req">*</span></label
                  >
                  <div
                    class="ce-dd-wrap"
                    class:error={ce_validationErrors.has("totalSlots")}
                  >
                    <div
                      class="ce-trigger-compact"
                      role="button"
                      tabindex="0"
                      on:click|stopPropagation={() => ce_toggleDD("slots")}
                      on:keydown={(e) => {
                        if (e.key === "Enter" || e.key === " ") {
                          e.stopPropagation();
                          ce_toggleDD("slots");
                        }
                      }}
                    >
                      <input
                        id="ce_totalSlots"
                        type="number"
                        min="0"
                        bind:value={ce_formData.totalSlots}
                        placeholder={currentLang === "th" ? "‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î" : "Max"}
                        class="ce-input-inline"
                        on:input={(e) => {
                          ce_noNegative(e);
                          ce_recalcRewards();
                        }}
                        on:click|stopPropagation={() => ce_toggleDD("slots")}
                      />
                      <span class="ce-arrow">‚ñº</span>
                    </div>

                    {#if ce_activeDropdown === "slots"}
                      <div class="ce-options" role="listbox">
                        {#each [50, 100, 200, 500, 1000, 2000, 5000] as s}
                          <div
                            class="ce-opt"
                            role="option"
                            tabindex="0"
                            aria-selected={ce_formData.totalSlots === s}
                            on:click|stopPropagation={() =>
                              ce_selectCombo("totalSlots", s)}
                            on:keydown={(e) => {
                              if (e.key === "Enter") {
                                e.stopPropagation();
                                ce_selectCombo("totalSlots", s);
                              }
                            }}
                          >
                            {s} {currentLang === "th" ? "‡∏ó‡∏µ‡πà‡∏ô‡∏±‡πà‡∏á" : "Slots"}
                          </div>
                        {/each}
                      </div>
                    {/if}
                  </div>
                </div>

                <div class="ce-input-group">
                  <label for="ce_distanceKm">{lang.distanceLabel}</label>
                  <div class="ce-dd-wrap">
                    <div
                      class="ce-trigger-compact"
                      role="button"
                      tabindex="0"
                      on:click|stopPropagation={() => ce_toggleDD("distanceKm")}
                      on:keydown={(e) => {
                        if (e.key === "Enter" || e.key === " ") {
                          e.stopPropagation();
                          ce_toggleDD("distanceKm");
                        }
                      }}
                    >
                      <input
                        id="ce_distanceKm"
                        type="number"
                        min="0"
                        step="1"
                        bind:value={ce_formData.distanceKm}
                        placeholder="0"
                        class="ce-input-inline"
                        on:click|stopPropagation={() =>
                          ce_toggleDD("distanceKm")}
                      />
                      <span class="ce-unit-label">km</span>
                      <span class="ce-arrow">‚ñº</span>
                    </div>

                    {#if ce_activeDropdown === "distanceKm"}
                      <div class="ce-options" role="listbox">
                        {#each [1, 2, 3, 5, 10, 15, 21, 42] as d}
                          <div
                            class="ce-opt"
                            role="option"
                            tabindex="0"
                            aria-selected={ce_formData.distanceKm === d}
                            on:click|stopPropagation={() =>
                              ce_selectOpt("distanceKm", d)}
                            on:keydown={(e) => {
                              if (e.key === "Enter") {
                                e.stopPropagation();
                                ce_selectOpt("distanceKm", d);
                              }
                            }}
                          >
                            {d} km
                          </div>
                        {/each}
                      </div>
                    {/if}
                  </div>
                </div>
              </div>
            </div>

            <!-- Holidays & Exclusions -->
            <div
              class="ce-card ce-config-card"
              role="button"
              tabindex="0"
              on:click|stopPropagation
              on:keydown|stopPropagation
            >
              {#if !isDateRangeValid}
                <div class="ce-lock-overlay">
                  <svg
                    class="ce-lock-icon-svg"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                    ></path>
                  </svg>
                  <span>Set valid <b>Start & End Date</b> to unlock.</span>
                </div>
              {/if}

              <div class="ce-card-head">
                <svg
                  class="ce-icon-svg"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"
                  ></path>
                </svg>
                <span>{lang.holidaysAndExclusions}</span>
              </div>

              <div class="ce-holiday-control">
                <div class="ce-holiday-buttons">
                  <label
                    class="ce-check-row"
                    class:active={ce_holidayMode === "weekends"}
                  >
                    <input
                      type="checkbox"
                      checked={ce_holidayMode === "weekends"}
                      disabled={!isDateRangeValid}
                      on:change={() =>
                        ce_setHolidayMode(
                          ce_holidayMode === "weekends" ? null : "weekends"
                        )}
                    />
                    <div class="ce-check-content">
                      <span class="ce-check-title"
                        >{lang.excludeWeekendsOption}</span
                      >
                      <span class="ce-check-desc"
                        >{currentLang === "th"
                          ? "‡∏Ç‡πâ‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥"
                          : "Automatically skip Saturdays & Sundays."}</span
                      >
                    </div>
                  </label>

                  <label
                    class="ce-check-row"
                    class:active={ce_holidayMode === "none"}
                  >
                    <input
                      type="checkbox"
                      checked={ce_holidayMode === "none"}
                      disabled={!isDateRangeValid}
                      on:change={() =>
                        ce_setHolidayMode(
                          ce_holidayMode === "none" ? null : "none"
                        )}
                    />
                    <div class="ce-check-content">
                      <span class="ce-check-title">{lang.noHolidaysOption}</span
                      >
                      <span class="ce-check-desc"
                        >{currentLang === "th"
                          ? "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î"
                          : "Event runs every day without breaks."}</span
                      >
                    </div>
                  </label>
                </div>

                <hr class="ce-divider" />

                <div class="ce-input-group">
                  <div
                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;"
                  >
                    <span
                      style="font-weight: 500; font-size: 0.9rem; color: #374151;"
                    >
                      {currentLang === "th"
                        ? "‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏â‡∏û‡∏≤‡∏∞ (‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)"
                        : "Add Specific Holiday (Within Range)"}
                    </span>
                    {#if ce_formData.holidays.length > 0}
                      <button
                        class="ce-btn-reset"
                        on:click|stopPropagation={ce_resetHolidays}
                        type="button"
                      >
                        {currentLang === "th" ? "‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" : "Reset All"}
                      </button>
                    {/if}
                  </div>

                  <div class="ce-dd-wrap">
                    <button
                      type="button"
                      class="ce-trigger-compact"
                      on:click|stopPropagation={() => {
                        if (isDateRangeValid) {
                          ce_setHolidayMode("specific");
                          ce_toggleDD("holidayDate");
                        }
                      }}
                    >
                      <input
                        type="text"
                        value={ce_formData.holidays.length > 0
                          ? `${ce_formData.holidays.length} date(s) selected`
                          : ""}
                        placeholder="Select dates"
                        class="ce-input-inline"
                        readonly
                        disabled={!isDateRangeValid}
                        tabindex="-1"
                        style="pointer-events: none;"
                      />
                      <span class="ce-arrow">‚ñº</span>
                    </button>

                    {#if ce_activeDropdown === "holidayDate" && isDateRangeValid}
                      <div class="ce-options ce-options-calendar">
                        {#each Object.entries(groupedDates) as [monthYear, dates]}
                          <div class="ce-month-group">
                            <div class="ce-month-header">{monthYear}</div>
                            <div class="ce-date-grid">
                              {#each dates as date}
                                <button
                                  type="button"
                                  class="ce-date-item"
                                  class:selected={ce_formData.holidays.includes(
                                    date.value
                                  )}
                                  class:weekend={date.dayName === "Sat" ||
                                    date.dayName === "Sun"}
                                  on:click|stopPropagation={() =>
                                    ce_toggleHoliday(date.value)}
                                >
                                  <div class="ce-date-day">{date.day}</div>
                                  <div class="ce-date-name">{date.dayName}</div>
                                  {#if ce_formData.holidays.includes(date.value)}
                                    <div class="ce-check-mark">‚úì</div>
                                  {/if}
                                </button>
                              {/each}
                            </div>
                          </div>
                        {/each}
                      </div>
                    {/if}
                  </div>
                  <span class="ce-hint">
                    Click dates to select/deselect holidays. Dropdown stays open
                    for multiple selections.
                  </span>

                  {#if ce_formData.holidays.length > 0}
                    <div class="ce-tags">
                      {#each ce_formData.holidays as h}
                        <span class="ce-tag">
                          {availableDates.find((d) => d.value === h)
                            ?.fullDisplay || h}
                          <button
                            type="button"
                            class="ce-tag-remove"
                            on:click={() => ce_delHoliday(h)}
                            aria-label="Remove holiday">√ó</button
                          >
                        </span>
                      {/each}
                    </div>
                  {/if}
                </div>
              </div>
            </div>
            <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->
            <div
              class="ce-card ce-config-card"
              class:ce-locked-card={!ce_formData.totalSlots}
              class:error={ce_validationErrors.has("rewards")}
              role="group"
              aria-label="Rewards Distribution Configuration"
              on:click|stopPropagation
              on:keydown|stopPropagation
            >
              {#if !ce_formData.totalSlots}
                <div class="ce-lock-overlay">
                  <svg
                    class="ce-lock-icon-svg"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                    ></path>
                  </svg>
                  <span
                    >Enter <b>Total Capacity</b> first to unlock rewards.</span
                  >
                </div>
              {/if}

              <div class="ce-card-head">
                <svg
                  class="ce-icon-svg"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                <span>{lang.rewardsDistribution}</span>
              </div>

              <div class="ce-rewards-section">
                <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                <div class="ce-total-rewards-row">
                  <div class="ce-field-group" style="flex: 1;">
                    <label
                      for="ce_totalRewards"
                      style="display: flex; align-items: center; gap: 8px; color: #f59e0b; font-weight: 600;"
                    >
                      <svg
                        width="18"
                        height="18"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"
                        ></path>
                      </svg>
                      {currentLang === "th"
                        ? "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"
                        : "Total Reward Items"}
                    </label>
                    <div
                      style="display: flex; align-items: center; gap: 8px; margin-top: 8px;"
                    >
                      <input
                        id="ce_totalRewards"
                        type="number"
                        min="1"
                        bind:value={ce_formData.totalRewards}
                        on:input={ce_noNegative}
                        class="ce-input-compact"
                        placeholder={currentLang === "th"
                          ? "‡πÄ‡∏ä‡πà‡∏ô 100 ‡∏ä‡∏¥‡πâ‡∏ô"
                          : "e.g. 100 items"}
                        style="max-width: 200px;"
                      />
                      <span class="ce-unit-label"
                        >{currentLang === "th" ? "‡∏ä‡∏¥‡πâ‡∏ô" : "items"}</span
                      >
                    </div>
                  </div>
                </div>

                <!-- ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏∞‡∏ö‡∏ö Reward -->
                <div
                  class="ce-reward-info-box"
                  style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.05)); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 12px; padding: 16px; margin: 16px 0;"
                >
                  <div
                    style="display: flex; align-items: flex-start; gap: 12px;"
                  >
                    <div
                      style="width: 36px; height: 36px; background: rgba(59, 130, 246, 0.15); border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;"
                    >
                      <svg
                        width="20"
                        height="20"
                        fill="none"
                        stroke="#3b82f6"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                    </div>
                    <div style="flex: 1;">
                      <div
                        style="font-size: 14px; font-weight: 600; color: #60a5fa; margin-bottom: 6px;"
                      >
                        {currentLang === "th"
                          ? "‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡∏Å‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•"
                          : "How Rewards Work"}
                      </div>
                      <div
                        style="font-size: 13px; color: #93c5fd; line-height: 1.6;"
                      >
                        {currentLang === "th"
                          ? "‡∏ú‡∏π‡πâ‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ Tier ‡∏à‡∏∞‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ô‡∏±‡πâ‡∏ô (‡πÉ‡∏Ñ‡∏£‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏Å‡πà‡∏≠‡∏ô) ‡∏à‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏à‡∏∞‡∏´‡∏°‡∏î"
                          : "Participants who complete required rounds for each tier will receive that reward (first come first served) until items run out"}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Tier ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• -->
                <div class="ce-stack">
                  {#each ce_formData.rewards as reward, i}
                    <div
                      class="ce-tier-card"
                      style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.08), rgba(234, 88, 12, 0.04)); border-color: rgba(245, 158, 11, 0.3);"
                    >
                      <div class="ce-tier-header">
                        <span
                          class="ce-badge"
                          style="background: linear-gradient(135deg, #f59e0b, #d97706);"
                        >
                          <svg
                            width="14"
                            height="14"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                            stroke-width="2.5"
                            style="margin-right: 4px;"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"
                            ></path>
                          </svg>
                          Tier {i + 1}
                        </span>
                        {#if ce_formData.rewards.length > 1}
                          <button
                            type="button"
                            class="ce-btn-remove"
                            on:click={() => ce_removeTier(i)}
                            title={lang.removeTier}
                            aria-label="{lang.removeTier} {i + 1}">√ó</button
                          >
                        {/if}
                      </div>
                      <div
                        class="ce-tier-body"
                        style="grid-template-columns: 1fr 1fr;"
                      >
                        <!-- ‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• -->
                        <div class="ce-tier-field">
                          <label for="ce_name_{i}">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                              style="margin-right: 4px; vertical-align: middle;"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"
                              ></path>
                            </svg>
                            {currentLang === "th"
                              ? "‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•"
                              : "Reward Name"}
                          </label>
                          <input
                            id="ce_name_{i}"
                            type="text"
                            bind:value={reward.name}
                            placeholder={currentLang === "th"
                              ? "‡πÄ‡∏ä‡πà‡∏ô ü•á Premium Shoes"
                              : "e.g. ü•á Premium Shoes"}
                            class="ce-input-compact"
                          />
                        </div>
                        <!-- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ß‡∏¥‡πà‡∏á -->
                        <div class="ce-tier-field">
                          <label for="ce_req_{i}">
                            <svg
                              width="14"
                              height="14"
                              fill="none"
                              stroke="currentColor"
                              viewBox="0 0 24 24"
                              stroke-width="2"
                              style="margin-right: 4px; vertical-align: middle;"
                            >
                              <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                d="M13 10V3L4 14h7v7l9-11h-7z"
                              ></path>
                            </svg>
                            {currentLang === "th"
                              ? "‡∏ß‡∏¥‡πà‡∏á‡∏Ñ‡∏£‡∏ö‡∏Å‡∏µ‡πà‡∏£‡∏≠‡∏ö?"
                              : "Rounds Required"}
                          </label>
                          <div
                            style="display: flex; align-items: center; gap: 8px;"
                          >
                            <input
                              id="ce_req_{i}"
                              type="number"
                              min="1"
                              bind:value={reward.requirement}
                              on:input={ce_noNegative}
                              class="ce-input-compact"
                              placeholder={currentLang === "th"
                                ? "‡πÄ‡∏ä‡πà‡∏ô 30"
                                : "e.g. 30"}
                              style="flex: 1;"
                            />
                            <span class="ce-unit-label"
                              >{currentLang === "th" ? "‡∏£‡∏≠‡∏ö" : "rounds"}</span
                            >
                          </div>
                        </div>
                      </div>
                    </div>
                  {/each}
                </div>

                <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° Tier -->
                <button
                  type="button"
                  class="ce-btn-dashed"
                  on:click={ce_addTier}
                  style="margin-top: 12px;"
                >
                  {currentLang === "th" ? "+ ‡πÄ‡∏û‡∏¥‡πà‡∏° Tier" : "+ Add Tier"}
                </button>

                <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -->
                {#if ce_formData.rewards.filter((r) => r.name && r.requirement).length > 0}
                  <div
                    style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.25); border-radius: 10px; padding: 12px; margin-top: 16px;"
                  >
                    <div
                      style="font-size: 13px; font-weight: 600; color: #10b981; margin-bottom: 8px; display: flex; align-items: center; gap: 6px;"
                    >
                      <svg
                        width="16"
                        height="16"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                      {currentLang === "th"
                        ? "‡∏™‡∏£‡∏∏‡∏õ Reward Tiers"
                        : "Reward Tiers Summary"}
                    </div>
                    <div
                      style="font-size: 12px; color: #6ee7b7; line-height: 1.8;"
                    >
                      {#each ce_formData.rewards.filter((r) => r.name && r.requirement) as reward, idx}
                        <div
                          style="display: flex; align-items: center; gap: 8px; padding: 4px 0;"
                        >
                          <span
                            style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; padding: 2px 8px; border-radius: 4px; font-weight: 600;"
                          >
                            {reward.requirement} {currentLang === "th" ? "‡∏£‡∏≠‡∏ö" : "rounds"}
                          </span>
                          <span>‚Üí</span>
                          <span style="color: #f0fdf4;">{reward.name}</span>
                        </div>
                      {/each}
                      <div
                        style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(16, 185, 129, 0.2); color: #a7f3d0;"
                      >
                        {currentLang === "th"
                          ? "‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:"
                          : "Total reward items:"}
                        <strong style="color: #10b981;">
                          {ce_formData.totalRewards || 0}
                        </strong>
                        {currentLang === "th" ? "‡∏ä‡∏¥‡πâ‡∏ô (‡πÅ‡∏ä‡∏£‡πå‡∏ó‡∏∏‡∏Å Tier)" : "items (shared across all tiers)"}
                      </div>
                    </div>
                  </div>
                {/if}
              </div>
            </div>

            <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->
            <!-- ‚úÖ FIXED: ‡πÅ‡∏™‡∏î‡∏á Event Status ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏≠‡∏ô Edit ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô -->
            {#if editingEventId !== null}
              <div
                class="ce-card ce-config-card"
                role="group"
                aria-label="Event Status Configuration"
                on:click|stopPropagation
                on:keydown|stopPropagation
              >
                <div class="ce-card-head">
                  <svg
                    class="ce-icon-svg"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    ></path>
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    ></path>
                  </svg>
                  <span>{lang.eventStatusTitle}</span>
                </div>
                <div class="ce-status-row">
                  <div class="ce-switch-box">
                    <span>{lang.publicVisibility}</span>
                    <label class="ce-switch">
                      <input
                        type="checkbox"
                        bind:checked={ce_formData.isPublic}
                      />
                      <span class="ce-slider"></span>
                    </label>
                  </div>
                  <div class="ce-switch-box">
                    <span>{lang.activeOpen}</span>
                    <label class="ce-switch">
                      <input
                        type="checkbox"
                        bind:checked={ce_formData.isActive}
                      />
                      <span class="ce-slider"></span>
                    </label>
                  </div>
                </div>

                <div
                  class="ce-status-card"
                  class:status-live={ce_formData.isActive &&
                    ce_formData.isPublic}
                >
                  <div class="ce-status-icon-box">
                    {#if ce_formData.isActive && ce_formData.isPublic}
                      <svg
                        class="ce-status-icon"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                    {:else}
                      <svg
                        class="ce-status-icon"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"
                        ></path>
                      </svg>
                    {/if}
                  </div>
                  <div class="ce-status-text">
                    <strong
                      >{ce_formData.isActive && ce_formData.isPublic
                        ? lang.statusLive
                        : lang.statusDraftLabel}</strong
                    >
                    <p>
                      {ce_formData.isActive && ce_formData.isPublic
                        ? lang.statusLiveDesc
                        : lang.statusDraftDesc}
                    </p>
                  </div>
                </div>
              </div>
            {/if}
          </div>
        </div>
      </div>
    {/if}

    {#if showTimelineModal && logsData.selectedEvent}
      <!-- svelte-ignore a11y-click-events-have-key-events -->
      <!-- svelte-ignore a11y-no-static-element-interactions -->
      <div class="modal-overlay" on:click={closeTimelineModal}>
        <!-- svelte-ignore a11y-click-events-have-key-events -->
        <!-- svelte-ignore a11y-no-noninteractive-element-interactions -->
        <div
          class="timeline-modal-container"
          on:click|stopPropagation
          role="dialog"
          aria-modal="true"
          aria-labelledby="timeline-modal-title"
          tabindex="-1"
        >
          <div class="timeline-modal-header">
            <h3 id="timeline-modal-title">
              <svg
                width="20"
                height="20"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                stroke-width="2.5"
                style="display: inline; vertical-align: middle; margin-right: 8px;"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                ></path>
              </svg>
              Activity Timeline
            </h3>

            <button
              class="modal-close"
              on:click={closeTimelineModal}
              aria-label="Close modal"
            >
              <svg
                width="24"
                height="24"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>

          <div class="timeline-modal-body">
            <div class="timeline-event-title">
              <svg
                width="16"
                height="16"
                fill="none"
                stroke="#10b981"
                viewBox="0 0 24 24"
                stroke-width="2.5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                ></path>
              </svg>
              {logsData.selectedEvent.title}
            </div>

            <div class="timeline-container">
              {#each timelineItems as item, index}
                <div class="timeline-item">
                  <div
                    class="timeline-dot"
                    class:success={item.status === "success"}
                    class:failed={item.status === "failed"}
                    class:pending={item.status === "pending"}
                  ></div>

                  <div
                    class="timeline-line"
                    class:last={index === timelineItems.length - 1}
                  ></div>

                  <div class="timeline-content">
                    <div class="timeline-time">
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                        ></path>
                      </svg>
                      {new Date(item.timestamp).toLocaleString(
                        currentLang === "th" ? "th-TH" : "en-GB",
                        { timeZone: "Asia/Bangkok" }
                      )}
                    </div>

                    <div class="timeline-action">
                      <span
                        class="action-badge"
                        style="background: {getActionConfig(item.action)
                          .color}20; 
                           color: {getActionConfig(item.action).color};"
                      >
                        {getActionConfig(item.action).label}
                      </span>
                    </div>

                    <div class="timeline-user">
                      <svg
                        width="14"
                        height="14"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"
                        ></path>
                      </svg>
                      {item.userName}
                    </div>

                    <div class="timeline-details">{item.details}</div>
                  </div>
                </div>
              {/each}
            </div>

            {#if generateTimeline().length === 0}
              <div class="timeline-empty">
                <svg
                  width="48"
                  height="48"
                  fill="none"
                  stroke="#64748b"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
                  ></path>
                </svg>
                <p>No activities yet</p>
              </div>
            {/if}
          </div>
        </div>
      </div>
    {/if}
  </main>
  <footer class="app-footer">
    <div class="footer-divider"></div>
    <p class="copyright">¬© 2025 Cyber Geek. All rights reserved.</p>

    <p class="credits">
      Designed & Developed by <span class="dev-name"
        >Cyber Geek Development</span
      >
    </p>

    <p class="credits" style="margin-top: 5px;">
      Contact:
      <a
        href="/cdn-cgi/l/email-protection#b2d1cbd0d7c0d5d7d7d99cd6d7c4f2c2c0ddc6dddc9cdfd7"
        class="footer-email"
      >
        <span
          class="__cf_email__"
          data-cfemail="dfbca6bdbaadb8babab4f1bbbaa99fafadb0abb0b1f1b2ba"
          >[email&#160;protected]</span
        >
      </a>
    </p>
  </footer>
</div>

<style>
  :root {
    --bg-deep: #0f172a;
    --bar-dark: #1e293b;
    --emerald-pri: #10b981;
    --text-pure: #f8fafc;
    --text-muted: #94a3b8;
    --nav-height: 72px;
    --danger: #ef4444;
    --warning: #f59e0b;
  }

  /* ==========================================================================
     HIDE SCROLLBAR GLOBALLY (FORCE) & SWAL CUSTOMIZATION
     ========================================================================== */
  :global(html),
  :global(body) {
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
    overflow-y: auto;
    margin: 0;
  }
  :global(::-webkit-scrollbar) {
    display: none !important;
    width: 0 !important;
    height: 0 !important;
    background: transparent !important;
  }
  * {
    scrollbar-width: none !important;
    -ms-overflow-style: none !important;
    box-sizing: border-box;
  }

  :global(.swal-rounded-popup.glass-modal) {
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    overflow: hidden;
  }

  /* SWAL BACKDROP BLUR & INDEX */
  :global(.swal2-container) {
    backdrop-filter: blur(8px) !important;
    background: rgba(15, 23, 42, 0.7) !important; /* Dark blue tint */
    z-index: 9999 !important; /* Ensure it is top most */
  }
  :global(.glass-modal-popup) {
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 20px !important;
    padding: 0 !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏•‡∏ö‡∏Ç‡∏≠‡∏ö‡∏Ç‡∏≤‡∏ß */
    overflow: hidden !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
    display: grid !important; /* ‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å Layout */
  }

  :global(.modal-close-btn) {
    color: #fff !important;
  }
  /* ========================================================================== */

  :global(.swal2-close) {
    color: white !important;
    outline: none !important;
    box-shadow: none !important;
  }
  :global(.swal2-popup) {
    border-radius: 20px !important; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á */
  }
  /* GLOBAL */
  .app-container {
    min-height: 100vh;
    background-color: var(--bg-deep);
    color: var(--text-pure);
    font-family: "Inter", sans-serif;
    display: flex;
    flex-direction: column;
  }

  /* HEADER */
  .header-bar {
    width: 100%;
    height: var(--nav-height);
    background-color: var(--bar-dark);
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
  }
  .header-inner {
    height: 100%;
    display: flex;
    align-items: center;
    padding: 0 1.5rem;
    justify-content: space-between;
    gap: 1rem;
  }
  .brand {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-shrink: 0;
  }
  .logo-icon {
    width: 45px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏Å‡∏£‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ */
    height: 45px;

    /* üëá ‡∏ñ‡πâ‡∏≤‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÉ‡∏´‡πâ‡∏•‡∏ö‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î background ‡∏ô‡∏µ‡πâ‡∏ó‡∏¥‡πâ‡∏á‡∏Ñ‡∏£‡∏±‡∏ö */
    /* ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô PNG ‡∏û‡∏∑‡πâ‡∏ô‡πÉ‡∏™ ‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏£‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á ‡∏Å‡πá‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ */
    background: linear-gradient(135deg, var(--emerald-pri), var(--teal-sec));

    border-radius: 12px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏ô‡∏Ç‡∏≠‡∏á‡∏°‡∏∏‡∏° */
    overflow: hidden; /* ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡∏°‡∏ô‡πÜ */

    display: flex;
    align-items: center;
    justify-content: center;

    flex-shrink: 0;
    padding: 0; /* ‡∏•‡∏ö padding ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏£‡∏≠‡∏ö */
  }

  /* --- 2. ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û --- */
  .my-logo-img {
    width: 100%;
    height: 100%;

    /* ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏≤‡∏≠‡∏±‡∏ô‡πÉ‡∏î‡∏≠‡∏±‡∏ô‡∏´‡∏ô‡∏∂‡πà‡∏á: */
    object-fit: cover; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ä‡πà‡∏≠‡∏á (‡∏£‡∏π‡∏õ‡∏≠‡∏≤‡∏à‡πÇ‡∏î‡∏ô‡∏ï‡∏±‡∏î‡∏Ç‡∏≠‡∏ö‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢) */
    /* object-fit: contain; */ /* ‡∏¢‡πà‡∏≠‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏†‡∏≤‡∏û (‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠) */
  }
  .brand-name {
    font-weight: 800; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏´‡∏ô‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© */
    font-size: 1.8rem; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏™‡∏∞‡πÉ‡∏à (‡∏à‡∏≤‡∏Å‡πÄ‡∏î‡∏¥‡∏° 1rem) */
    text-transform: uppercase; /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏´‡∏ç‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏î‡∏π‡∏Ç‡∏•‡∏±‡∏á‡∏Å‡∏ß‡πà‡∏≤) */
    letter-spacing: 1px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏ü‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */

    /* üî• ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏•‡πà‡∏™‡∏µ (Gradient Text) */
    background: linear-gradient(
      to right,
      #6ee7b7,
      #10b981
    ); /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏¥‡πâ‡∏ô‡∏ï‡πå -> ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏£‡∏Å‡∏ï */
    -webkit-background-clip: text; /* ‡∏ï‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
    -webkit-text-fill-color: transparent; /* ‡∏ñ‡∏°‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡πÉ‡∏™ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    background-clip: text;

    /* ‚ú® ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á‡πÄ‡∏á‡∏≤‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á (Glow) */
    filter: drop-shadow(0 2px 10px rgba(16, 185, 129, 0.4));

    white-space: nowrap;
    cursor: default; /* ‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡πá‡∏ô‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏õ‡∏Å‡∏ï‡∏¥ */
  }
  /* NAV */
  .line-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    stroke-width: 2;
  }
  .fixed-size {
    width: 22px;
    height: 22px;
  }
  .nav-menu {
    display: flex;
    gap: 6px;
    flex: 1;
    justify-content: center;
    align-items: center;
    position: relative;
    z-index: 1050; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }
  .menu-btn {
    background: transparent;
    border: 1px solid transparent;
    padding: 8px 14px;
    border-radius: 12px;
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    transition: all 0.2s;
  }

  .menu-btn.active {
    color: var(--emerald-pri);
    background: #141d2b;
    border: 1px solid rgba(16, 185, 129, 0.2);
    box-shadow: inset 4px 4px 8px rgba(0, 0, 0, 0.5);
    transform: translateY(1px) scale(0.97);
  }
  .menu-btn:hover:not(.active) {
    color: var(--text-pure);
    background: rgba(255, 255, 255, 0.03);
  }
  .nav-divider {
    width: 1px;
    height: 24px;
    background-color: rgba(255, 255, 255, 0.1);
    margin: 0 8px;
  }
  .search-toggle {
    color: var(--emerald-pri);
    border: 1px solid rgba(16, 185, 129, 0.1);
  }
  .search-toggle:hover {
    background: rgba(16, 185, 129, 0.1);
  }
  .search-toggle.active {
    background: var(--emerald-pri);
    color: #fff;
  }

  .user-zone {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }
  .token-timer {
    padding: 6px 14px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    color: var(--emerald-pri);
    font-family: monospace;
    font-weight: bold;
    font-size: 0.85rem;
  }

  /* LOGOUT BUTTON */
  .logout-icon-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 8px;
    border-radius: 50%;
    transition: all 0.3s ease;
  }
  .logout-icon-btn:hover {
    background-color: rgba(239, 68, 68, 0.15);
    color: #ef4444;
    transform: scale(1.1);
    box-shadow: 0 0 10px rgba(239, 68, 68, 0.3);
  }

  /* MOBILE CONTROLS */
  .mobile-controls {
    display: none;
    gap: 8px;
    align-items: center;
  }

  .mobile-icon-btn {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.05);
    padding: 8px;
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .mobile-icon-btn.active {
    color: var(--emerald-pri);
    border-color: rgba(16, 185, 129, 0.3);
    background: rgba(16, 185, 129, 0.1);
  }
  .mobile-icon-btn:hover {
    background: rgba(255, 255, 255, 0.08);
    color: white;
  }

  /* DRAWER */
  .mobile-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: 2000;
    backdrop-filter: blur(5px);
  }
  .mobile-drawer {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 75vw;
    max-width: 280px;
    background: rgba(30, 41, 59, 0.98);
    backdrop-filter: blur(10px);
    z-index: 2001;
    padding: 1.25rem;
    box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    border-left: 1px solid rgba(255, 255, 255, 0.1);
  }
  .drawer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    padding-bottom: 0.75rem;
  }
  .close-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    font-size: 2rem;
    cursor: pointer;
  }
  .drawer-content {
    flex: 1;
    overflow-y: auto;
  }
  .drawer-item {
    width: 100%;
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    border-radius: 10px;
    color: var(--text-muted);
    margin-bottom: 6px;
    cursor: pointer;
    border: 1px solid transparent;
    background: transparent;
  }
  .drawer-item.active {
    color: var(--emerald-pri);
    background: #141d2b;
    border-color: rgba(16, 185, 129, 0.2);
  }
  .drawer-footer {
    margin-top: auto;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
    padding-top: 1rem;
  }
  .logout-special {
    color: var(--danger);
  }
  .logout-special:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
  }

  /* CONTENT */
  .page-content {
    margin-top: var(--nav-height);
    padding: 2.5rem 1.5rem;
    position: relative;
    z-index: 1;
    flex: 1;
  }
  .wrapper {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
  }
  .static-view-header {
    margin-bottom: 0;
    flex-shrink: 0;
  }

  .header-search-section {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header-search-box {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0.5rem 1rem;
    min-width: 200px;
  }
  .header-search-box svg {
    color: #64748b;
    flex-shrink: 0;
  }

  .header-filter-dropdown {
    position: relative;
    z-index: 1100;
  }

  .header-filter-trigger {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0.5rem 0.75rem;
    color: #94a3b8;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .header-filter-trigger:hover {
    border-color: rgba(16, 185, 129, 0.3);
    color: #10b981;
  }

  .header-filter-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0.5rem;
    min-width: 120px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1100; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  .header-filter-option {
    display: block;
    width: 100%;
    padding: 0.5rem 0.75rem;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #94a3b8;
    font-size: 0.85rem;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
  }

  .header-filter-option:hover {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }

  .header-filter-option.active {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }

  .showing-text {
    text-align: center;
    color: #64748b;
    font-size: 0.85rem;
    margin-top: 1rem;
  }

  .page-numbers {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .page-num {
    min-width: 40px;
    height: 40px;
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: #94a3b8;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .page-num:hover {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.3);
    color: #10b981;
  }

  .page-num.active {
    background: linear-gradient(135deg, #10b981, #059669);
    border-color: #10b981;
    color: white;
  }

  .page-dots {
    color: #64748b;
    padding: 0 0.5rem;
    user-select: none;
  }

  .page-number-btn {
    min-width: 40px;
    height: 40px;
    background: var(--bar-dark);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-muted);
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
  }

  .page-number-btn:hover {
    border-color: var(--emerald-pri);
    color: var(--emerald-pri);
    background: rgba(16, 185, 129, 0.1);
  }

  .page-number-btn.active {
    background: var(--emerald-pri);
    color: white;
    border-color: var(--emerald-pri);
  }

  .title-with-toggle {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    width: 100%;
    min-height: 50px;
    margin-bottom: 1rem;
  }
  .view-title h2 {
    font-size: 1.75rem;
    letter-spacing: -0.5px;
    margin: 0;
    margin-bottom: 0.5rem;
  }

  .view-title {
    margin-bottom: 1.5rem;
  }
  .divider {
    width: 40px;
    height: 3px;
    background: var(--emerald-pri);
    margin-top: 0.5rem;
    border-radius: 2px;
  }

  .title-line {
    height: 3px;
    width: 60px;
    background: linear-gradient(90deg, #10b981, #059669);
    border-radius: 2px;
    margin-top: 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏∂‡∏á‡πÄ‡∏™‡πâ‡∏ô */
  }

  /* ===== VERIFY CODE - NEW DESIGN ===== */
  .vc-container {
    max-width: 480px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .vc-main-card {
    background: linear-gradient(
      165deg,
      rgba(30, 41, 59, 0.9) 0%,
      rgba(15, 23, 42, 0.95) 100%
    );
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 24px;
    padding: 2rem;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
  }

  /* ===== ACTION SELECTOR (Check-in / Check-out) ===== */
  .vc-action-selector {
    display: flex;
    position: relative;
    background: rgba(15, 23, 42, 0.6);
    border-radius: 16px;
    padding: 6px;
    margin-bottom: 1.5rem;
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  .vc-action-tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px 16px;
    background: transparent;
    border: none;
    color: var(--text-muted);
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    position: relative;
    z-index: 1;
    transition: all 0.3s ease;
    border-radius: 12px;
  }

  .vc-action-tab:hover:not(.active) {
    color: #e2e8f0;
  }

  .vc-action-tab.active {
    color: #ffffff;
  }

  .vc-action-tab.checkout.active {
    color: #ffffff;
  }

  .vc-action-tab svg {
    width: 20px;
    height: 20px;
    transition: all 0.3s ease;
  }

  .vc-action-slider {
    position: absolute;
    top: 6px;
    left: 6px;
    width: calc(50% - 6px);
    height: calc(100% - 12px);
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-radius: 12px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .vc-action-slider.checkout {
    left: calc(50%);
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    box-shadow: 0 4px 12px rgba(6, 182, 212, 0.3);
  }

  /* ===== CHECK-OUT THEME VARIANTS (Cyan/Teal) ===== */
  .vc-icon-wrapper.checkout .vc-icon-bg {
    background: linear-gradient(
      135deg,
      rgba(6, 182, 212, 0.2),
      rgba(6, 182, 212, 0.05)
    );
    border: 1px solid rgba(6, 182, 212, 0.2);
    animation: vc-glow-cyan 3s ease-in-out infinite;
  }

  .vc-icon-wrapper.checkout {
    color: #06b6d4;
  }

  @keyframes vc-glow-cyan {
    0%,
    100% {
      box-shadow: 0 0 20px rgba(6, 182, 212, 0.15);
    }
    50% {
      box-shadow: 0 0 35px rgba(6, 182, 212, 0.25);
    }
  }

  .vc-pin-cell.checkout.filled {
    border-color: rgba(6, 182, 212, 0.5);
    background: rgba(6, 182, 212, 0.08);
    box-shadow: 0 0 12px rgba(6, 182, 212, 0.15);
  }

  .vc-switch.checkout.on {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    box-shadow: 0 2px 8px rgba(6, 182, 212, 0.3);
  }

  .vc-submit.checkout {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    box-shadow: 0 8px 20px rgba(6, 182, 212, 0.3);
  }

  .vc-submit.checkout:hover:not(:disabled) {
    box-shadow: 0 12px 28px rgba(6, 182, 212, 0.4);
    transform: translateY(-2px);
  }

  .vc-success.checkout {
    background: linear-gradient(
      135deg,
      rgba(6, 182, 212, 0.15),
      rgba(8, 145, 178, 0.08)
    );
    border: 1px solid rgba(6, 182, 212, 0.25);
  }

  .vc-success-check.checkout {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
  }

  .vc-success-label.checkout {
    color: #06b6d4;
  }

  .vc-submit-wrapper {
    min-height: 52px;
    transition: all 0.3s ease; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° transition ‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∏‡∏ö‡∏ï‡∏±‡∏ß‡∏™‡∏ß‡∏¢‡πÜ */
  }

  .vc-submit-wrapper.hidden .vc-submit {
    opacity: 0;
    pointer-events: none;
  }
  .vc-submit-wrapper.hidden {
    height: 0; /* ‡∏¢‡∏∏‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á */
    min-height: 0; /* ‡∏¢‡∏∏‡∏ö min-height */
    margin: 0; /* ‡πÄ‡∏≠‡∏≤ margin ‡∏≠‡∏≠‡∏Å */
    padding: 0; /* ‡πÄ‡∏≠‡∏≤ padding ‡∏≠‡∏≠‡∏Å */
    opacity: 0;
    overflow: hidden; /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô */
    pointer-events: none;
  }

  /* Card Header */
  .vc-card-header {
    text-align: center;
    margin-bottom: 1.75rem;
  }

  .vc-icon-wrapper {
    position: relative;
    width: 72px;
    height: 72px;
    margin: 0 auto 1.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--emerald-pri);
  }

  .vc-icon-bg {
    position: absolute;
    inset: 0;
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.2),
      rgba(16, 185, 129, 0.05)
    );
    border-radius: 20px;
    border: 1px solid rgba(16, 185, 129, 0.2);
    animation: vc-glow 3s ease-in-out infinite;
  }

  @keyframes vc-glow {
    0%,
    100% {
      box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
    }
    50% {
      box-shadow: 0 0 35px rgba(16, 185, 129, 0.25);
    }
  }

  .vc-icon-wrapper svg {
    position: relative;
    z-index: 1;
  }

  .vc-title {
    margin: 0 0 0.5rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: #f8fafc;
  }

  .vc-subtitle {
    margin: 0;
    font-size: 0.9rem;
    color: var(--text-muted);
  }

  /* Mode Selector */
  .vc-mode-selector {
    position: relative;
    display: flex;
    background: rgba(15, 23, 42, 0.6);
    border-radius: 16px;
    padding: 6px;
    margin-bottom: 1.75rem;
    border: 1px solid rgba(255, 255, 255, 0.06);
  }

  .vc-mode-tab {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 14px 20px;
    background: transparent;
    border: none;
    border-radius: 12px;
    color: var(--text-muted);
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    z-index: 1;
  }

  .vc-mode-tab:hover {
    color: #cbd5e1;
  }

  .vc-mode-tab.active {
    color: white;
  }

  .vc-mode-icon {
    display: flex; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á */
    align-items: center;
    justify-content: center;
    width: 24px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏Å‡∏±‡∏ö SVG */
    height: 24px;
    margin-right: 0.5rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ */
    flex-shrink: 0; /* ‡∏´‡πâ‡∏≤‡∏°‡∏´‡∏î‡∏ï‡∏±‡∏ß */
  }

  .vc-mode-icon svg {
    width: 100%;
    height: 100%;
    display: block;
    overflow: visible; /* ‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÑ‡∏°‡πà‡πÇ‡∏î‡∏ô‡∏ï‡∏±‡∏î */
  }

  .vc-mode-slider {
    position: absolute;
    top: 6px;
    left: 6px;
    width: calc(50% - 6px);
    height: calc(100% - 12px);
    background: linear-gradient(135deg, var(--emerald-pri), #059669);
    border-radius: 12px;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
  }

  .vc-mode-slider.qr {
    transform: translateX(100%);
  }

  /* Mode Selector - Checkout Theme (Cyan) */
  .vc-mode-selector.checkout {
    border-color: rgba(6, 182, 212, 0.15);
  }

  .vc-mode-tab.checkout.active {
    color: white;
  }

  .vc-mode-tab.checkout:hover:not(.active) {
    color: #67e8f9;
  }

  .vc-mode-slider.checkout {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
    box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
  }

  .vc-mode-slider.checkout.qr {
    transform: translateX(100%);
  }

  /* Success Message */
  .vc-success {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem 1.25rem;
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.15),
      rgba(16, 185, 129, 0.05)
    );
    border: 1px solid rgba(16, 185, 129, 0.25);
    border-radius: 16px;
    margin-bottom: 1.5rem;
  }

  .vc-success-check {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--emerald-pri), #059669);
    border-radius: 50%;
    color: white;
    flex-shrink: 0;
    animation: vc-check-pop 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes vc-check-pop {
    0% {
      transform: scale(0);
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
    }
  }

  .vc-success-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .vc-success-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--emerald-pri);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .vc-success-name {
    font-size: 1.15rem;
    font-weight: 700;
    color: #f8fafc;
  }

  /* Content Area */
  .vc-content {
    position: relative;
    height: auto; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡πÉ‡∏´‡πâ‡∏™‡∏π‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏π‡∏Å */
    min-height: 200px; /* ‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡πä‡∏Å‡∏ï‡∏≠‡∏ô‡∏™‡∏•‡∏±‡∏ö‡πÇ‡∏´‡∏°‡∏î */
    overflow: visible; /* ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏á‡∏≤‡πÑ‡∏°‡πà‡πÇ‡∏î‡∏ô‡∏ï‡∏±‡∏î */
    transition: height 0.3s ease; /* (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡∏´‡∏î‡∏ô‡∏∏‡πà‡∏°‡πÜ ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ JS ‡∏ä‡πà‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà‡πÉ‡∏™‡πà‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ) */
  }

  /* PIN Mode */
  .vc-pin-mode {
    position: relative; /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å absolute: ‡πÉ‡∏´‡πâ‡∏î‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏û‡πà‡∏≠ */
    width: 100%;

    display: none; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */

    flex-direction: column;
    gap: 0.5rem;

    /* Animation ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    opacity: 0;
    transform: translateX(-10px);
  }
  .vc-pin-mode.active {
    display: flex; /* ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
    animation: fadeInSlide 0.4s forwards; /* ‡πÄ‡∏•‡πà‡∏ô animation */
  }

  /* Auto Toggle */
  .vc-auto-toggle {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 14px;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .vc-auto-info {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #94a3b8;
    font-size: 0.95rem;
    font-weight: 500;
  }

  .vc-auto-info svg {
    color: #fbbf24;
  }

  .vc-switch {
    position: relative;
    width: 52px;
    height: 28px;
    background: #475569;
    border: none;
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
  }

  .vc-switch.on {
    background: linear-gradient(135deg, var(--emerald-pri), #059669);
  }

  .vc-switch-knob {
    position: absolute;
    top: 3px;
    left: 3px;
    width: 22px;
    height: 22px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  }

  .vc-switch.on .vc-switch-knob {
    transform: translateX(24px);
  }

  /* PIN Input Area */
  .vc-pin-area {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 14px;
    margin-top: 1.5rem; /* <--- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ! ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° (‡πÄ‡∏ä‡πà‡∏ô 20px, 1.5rem) */

    margin-bottom: 1.5rem;
  }

  .vc-pin-row {
    display: flex;
    gap: 10px;
  }

  .vc-pin-cell {
    position: relative;
    width: 56px;
    height: 68px;
    background: rgba(15, 23, 42, 0.7);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    transition: all 0.25s ease;
    overflow: hidden;
  }

  .vc-pin-cell::before {
    content: "";
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, var(--emerald-pri), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .vc-pin-cell.filled {
    border-color: var(--emerald-pri);
    background: rgba(16, 185, 129, 0.08);
  }

  .vc-pin-cell.filled::before {
    opacity: 0.1;
  }

  .vc-pin-cell.focus {
    border-color: var(--emerald-pri);
    box-shadow:
      0 0 0 4px rgba(16, 185, 129, 0.15),
      0 8px 20px rgba(16, 185, 129, 0.1);
    transform: translateY(-3px);
  }

  .vc-pin-cell.error {
    border-color: var(--danger) !important;
    background: rgba(239, 68, 68, 0.08) !important;
    animation: vc-shake 0.4s ease;
  }

  @keyframes vc-shake {
    0%,
    100% {
      transform: translateX(0);
    }
    20%,
    60% {
      transform: translateX(-4px);
    }
    40%,
    80% {
      transform: translateX(4px);
    }
  }

  .vc-pin-input {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    background: transparent;
    border: none;
    outline: none;
    text-align: center;
    font-size: 1.75rem;
    font-weight: 700;
    color: #f8fafc;
    caret-color: var(--emerald-pri);
  }

  .vc-pin-input:disabled {
    opacity: 0.5;
  }

  .vc-pin-dot {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 10px;
    height: 10px;
    background: #475569;
    border-radius: 50%;
    pointer-events: none;
  }

  .vc-clear {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    color: #f87171;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .vc-clear:hover:not(:disabled) {
    background: rgba(239, 68, 68, 0.2);
    transform: scale(1.05);
  }

  .vc-clear:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }

  /* Error Message */
  .vc-error-msg {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: 10px;
    padding: 12px 16px;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.2);
    border-radius: 12px;
    color: #f87171;
    font-size: 0.9rem;
    font-weight: 500;
  }

  .vc-error-msg svg {
    width: 18px !important;
    height: 18px !important;
    min-width: 18px !important;
    min-height: 18px !important;
    flex-shrink: 0 !important;
  }

  /* Submit Button */
  .vc-submit {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: 100%;
    padding: 16px;
    background: linear-gradient(135deg, var(--emerald-pri), #059669);
    border: none;
    border-radius: 14px;
    color: white;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .vc-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(16, 185, 129, 0.35);
  }

  .vc-submit:disabled {
    background: #475569;
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  /* Verifying State */
  .vc-verifying {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 1.5rem;
    color: var(--text-muted);
    font-weight: 500;
  }

  /* Loader */
  .vc-loader {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-top-color: currentColor;
    border-radius: 50%;
    animation: vc-spin 0.7s linear infinite;
  }

  .vc-loader.lg {
    width: 32px;
    height: 32px;
    border-width: 3px;
  }

  .vc-loader.sm {
    width: 16px;
    height: 16px;
  }

  @keyframes vc-spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Hint */
  .vc-hint {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.85rem;
    margin: 0;
    padding-top: 0.5rem;
  }

  /* QR Mode */
  .vc-qr-mode {
    position: relative; /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å absolute */
    width: 100%;

    display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏∑‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */

    /* Animation ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô */
    opacity: 0;
    transform: translateX(10px);
  }

  .vc-qr-mode.active {
    display: block; /* ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• */
    animation: fadeInSlide 0.4s forwards;
  }

  @keyframes fadeInSlide {
    from {
      opacity: 0;
      transform: translateX(10px); /* ‡∏´‡∏£‡∏∑‡∏≠ -10px ‡πÅ‡∏•‡πâ‡∏ß‡πÅ‡∏ï‡πà‡∏ó‡∏¥‡∏® */
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
  .vc-scanner {
    position: relative;
    width: 100%;
    height: 280px;
    border-radius: 20px;
    overflow: hidden;
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  .vc-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .vc-canvas {
    display: none;
  }

  /* Camera Error */
  .vc-camera-err {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 1.25rem;
    color: var(--text-muted);
    text-align: center;
    padding: 2rem;
    background: rgba(15, 23, 42, 0.9);
  }

  .vc-camera-err svg {
    color: #64748b;
  }

  .vc-camera-err p {
    margin: 0;
    font-size: 0.95rem;
  }

  .vc-retry {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: rgba(16, 185, 129, 0.15);
    border: 1px solid rgba(16, 185, 129, 0.3);
    border-radius: 12px;
    color: var(--emerald-pri);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .vc-retry:hover {
    background: rgba(16, 185, 129, 0.25);
    transform: translateY(-2px);
  }

  /* Scanner Overlay */
  .vc-scan-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.4);
  }

  .vc-scan-frame {
    position: relative;
    width: 70%;
    aspect-ratio: 1;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 24px;
    transition: all 0.3s ease;
  }

  .vc-scan-frame.active {
    border-color: var(--emerald-pri);
    box-shadow:
      0 0 40px rgba(16, 185, 129, 0.2),
      inset 0 0 40px rgba(16, 185, 129, 0.05);
  }

  .vc-scan-frame.active.checkout {
    border-color: #06b6d4;
    box-shadow:
      0 0 40px rgba(6, 182, 212, 0.2),
      inset 0 0 40px rgba(6, 182, 212, 0.05);
  }

  .vc-scan-frame.success {
    border-color: var(--emerald-pri);
    box-shadow:
      0 0 60px rgba(16, 185, 129, 0.4),
      inset 0 0 60px rgba(16, 185, 129, 0.1);
  }

  .vc-scan-frame.success.checkout {
    border-color: #06b6d4;
    box-shadow:
      0 0 60px rgba(6, 182, 212, 0.4),
      inset 0 0 60px rgba(6, 182, 212, 0.1);
  }

  .vc-frame-corner {
    position: absolute;
    width: 28px;
    height: 28px;
    border-color: var(--emerald-pri);
    border-style: solid;
  }

  .vc-scan-frame.checkout .vc-frame-corner {
    border-color: #06b6d4;
  }

  .vc-frame-corner.tl {
    top: -2px;
    left: -2px;
    border-width: 4px 0 0 4px;
    border-radius: 20px 0 0 0;
  }
  .vc-frame-corner.tr {
    top: -2px;
    right: -2px;
    border-width: 4px 4px 0 0;
    border-radius: 0 20px 0 0;
  }
  .vc-frame-corner.bl {
    bottom: -2px;
    left: -2px;
    border-width: 0 0 4px 4px;
    border-radius: 0 0 0 20px;
  }
  .vc-frame-corner.br {
    bottom: -2px;
    right: -2px;
    border-width: 0 4px 4px 0;
    border-radius: 0 0 20px 0;
  }

  .vc-scan-beam {
    position: absolute;
    left: 8%;
    right: 8%;
    height: 3px;
    background: linear-gradient(
      90deg,
      transparent,
      var(--emerald-pri),
      transparent
    );
    border-radius: 3px;
    box-shadow:
      0 0 20px var(--emerald-pri),
      0 0 40px var(--emerald-pri);
    animation: vc-beam 2s ease-in-out infinite;
  }

  .vc-scan-beam.checkout {
    background: linear-gradient(90deg, transparent, #06b6d4, transparent);
    box-shadow:
      0 0 20px #06b6d4,
      0 0 40px #06b6d4;
  }

  @keyframes vc-beam {
    0%,
    100% {
      top: 8%;
    }
    50% {
      top: 88%;
    }
  }

  /* QR Success Overlay */
  .vc-qr-success {
    position: absolute;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: rgba(16, 185, 129, 0.15);
    backdrop-filter: blur(8px);
    border-radius: 22px;
    animation: vc-success-pop 0.3s ease;
  }

  .vc-qr-success.checkout {
    background: rgba(6, 182, 212, 0.15);
  }

  @keyframes vc-success-pop {
    0% {
      transform: scale(0.8);
      opacity: 0;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  .vc-qr-success-icon {
    width: 64px;
    height: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border-radius: 50%;
    animation: vc-check-bounce 0.5s ease;
  }

  .vc-qr-success-icon.checkout {
    background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
  }

  @keyframes vc-check-bounce {
    0% {
      transform: scale(0);
    }
    50% {
      transform: scale(1.2);
    }
    100% {
      transform: scale(1);
    }
  }

  .vc-qr-success-icon svg {
    width: 32px;
    height: 32px;
    color: white;
  }

  .vc-qr-success-text {
    font-size: 1.2rem;
    font-weight: 700;
    color: white;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
  }

  .vc-qr-success-label {
    font-size: 0.9rem;
    font-weight: 600;
    color: #10b981;
    background: rgba(16, 185, 129, 0.2);
    padding: 6px 16px;
    border-radius: 20px;
  }

  .vc-qr-success-label.checkout {
    color: #06b6d4;
    background: rgba(6, 182, 212, 0.2);
  }

  /* Scan Status */
  .vc-scan-status {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px 20px;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: 600;
    backdrop-filter: blur(10px);
  }

  .vc-scan-status.active {
    background: rgba(16, 185, 129, 0.2);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: var(--emerald-pri);
  }

  .vc-scan-status.active.checkout {
    background: rgba(6, 182, 212, 0.2);
    border: 1px solid rgba(6, 182, 212, 0.3);
    color: #06b6d4;
  }

  .vc-scan-status.success {
    background: rgba(16, 185, 129, 0.3);
    border: 1px solid rgba(16, 185, 129, 0.5);
    color: #10b981;
  }

  .vc-scan-status.success.checkout {
    background: rgba(6, 182, 212, 0.3);
    border: 1px solid rgba(6, 182, 212, 0.5);
    color: #06b6d4;
  }

  .vc-scan-status.verifying {
    background: rgba(59, 130, 246, 0.2);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: #60a5fa;
  }

  .vc-pulse-dot {
    width: 10px;
    height: 10px;
    background: var(--emerald-pri);
    border-radius: 50%;
    animation: vc-pulse 1.5s ease-in-out infinite;
  }

  .vc-pulse-dot.checkout {
    background: #06b6d4;
  }

  @keyframes vc-pulse {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.8);
    }
  }

  /* Responsive */
  @media (max-width: 480px) {
    .vc-container {
      padding: 0 0.75rem;
    }

    .vc-main-card {
      padding: 1.5rem;
      border-radius: 20px;
    }

    .vc-action-selector {
      margin-bottom: 1.25rem;
      padding: 4px;
      border-radius: 14px;
    }

    .vc-action-tab {
      padding: 10px 12px;
      font-size: 0.85rem;
      gap: 6px;
    }

    .vc-action-tab svg {
      width: 18px;
      height: 18px;
    }

    .vc-action-slider {
      top: 4px;
      left: 4px;
      width: calc(50% - 4px);
      height: calc(100% - 8px);
      border-radius: 10px;
    }

    .vc-action-slider.checkout {
      left: calc(50%);
    }

    .vc-icon-wrapper {
      width: 60px;
      height: 60px;
    }

    .vc-icon-wrapper svg {
      width: 26px;
      height: 26px;
    }

    .vc-title {
      font-size: 1.25rem;
    }

    .vc-mode-tab {
      padding: 12px 16px;
      font-size: 0.9rem;
    }

    .vc-pin-cell {
      width: 48px;
      height: 60px;
    }

    .vc-pin-input {
      font-size: 1.5rem;
    }

    .vc-pin-row {
      gap: 8px;
    }

    .vc-clear {
      width: 42px;
      height: 42px;
    }
  }
  /* FILTER BAR */
  .filter-slide-wrapper {
    overflow: visible;
    margin-bottom: 2rem;
    position: relative;
    z-index: 500; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ - ‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å */
  }
  .filter-bar-container {
    width: 100%;
    display: flex;
    justify-content: center;
    position: relative;
    z-index: 500;
  }
  .filter-bar {
    display: flex;
    gap: 0.75rem;
    background: rgba(30, 41, 59, 0.6);
    padding: 0.8rem;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(12px);
    width: 100%;
    max-width: 850px;
    align-items: center;
    flex-wrap: nowrap;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    z-index: 500;
  }
  .search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: #0f172a;
    border-radius: 14px;
    padding: 0 1rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    flex-grow: 2;
    min-width: 200px;
  }
  .search-icon {
    width: 18px;
    height: 18px;
    color: var(--text-muted);
    margin-right: 0.75rem;
    flex-shrink: 0;
  }
  .search-input-wrapper input {
    background: transparent;
    border: none;
    color: white;
    padding: 12px 0;
    width: 100%;
    outline: none;
    font-size: 0.9rem;
  }

  .perf-monitor {
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 4px 6px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  .perf-monitor:hover {
    border-color: rgba(16, 185, 129, 0.3);
    background: rgba(0, 0, 0, 0.4);
  }
  .perf-graph {
    width: 35px;
    height: 24px;
    overflow: hidden;
  }
  .perf-graph svg {
    width: 100%;
    height: 100%;
  }
  .perf-stats {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .perf-latency {
    font-family: monospace;
    font-size: 0.75rem;
    font-weight: 600;
    min-width: 42px;
    text-align: right;
  }
  .perf-latency.good {
    color: #10b981;
  }
  .perf-latency.warning {
    color: #f59e0b;
  }
  .perf-latency.bad {
    color: #ef4444;
  }

  .perf-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }
  .perf-status-dot.connected {
    background: #10b981;
    box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
  }
  .perf-status-dot.slow {
    background: #f59e0b;
    box-shadow: 0 0 8px rgba(245, 158, 11, 0.5);
    animation: pulse-warning 1.5s infinite;
  }
  .perf-status-dot.disconnected {
    background: #ef4444;
    box-shadow: 0 0 8px rgba(239, 68, 68, 0.5);
    animation: pulse-danger 1s infinite;
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.7;
      transform: scale(0.9);
    }
  }
  @keyframes pulse-warning {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.5;
      transform: scale(0.85);
    }
  }
  @keyframes pulse-danger {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.3;
      transform: scale(0.8);
    }
  }

  .perf-tooltip {
    position: absolute;
    top: calc(100% + 10px);
    right: 0;
    width: 240px;
    padding: 12px;
    background: rgba(30, 41, 59, 0.98);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
    z-index: 1000;
    backdrop-filter: blur(10px);
  }
  .perf-tooltip-header {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    font-weight: 600;
    color: #f8fafc;
    margin-bottom: 12px;
    padding-bottom: 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }
  .perf-tooltip-header svg {
    color: #10b981;
  }
  .perf-tooltip-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.8rem;
    color: #94a3b8;
    margin-bottom: 6px;
  }
  .perf-tooltip-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 10px 0;
  }
  .perf-value {
    font-family: monospace;
    font-weight: 600;
    color: #f8fafc;
  }
  .perf-value.good {
    color: #10b981;
  }
  .perf-value.warning {
    color: #f59e0b;
  }
  .perf-value.bad {
    color: #ef4444;
  }

  .perf-status-text {
    font-weight: 600;
  }
  .perf-status-text.connected {
    color: #10b981;
  }
  .perf-status-text.slow {
    color: #f59e0b;
  }
  .perf-status-text.disconnected {
    color: #ef4444;
  }

  .perf-tooltip-chart {
    margin-top: 10px;
    height: 50px;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    overflow: hidden;
    padding: 4px;
  }
  .perf-tooltip-chart svg {
    width: 100%;
    height: 100%;
  }

  .search-toggle-btn {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    color: #10b981;
    padding: 8px 12px;
    border-radius: 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    transition: all 0.2s;
    flex-shrink: 0;
    position: relative;
    z-index: 1100; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .search-toggle-btn:hover {
    background: rgba(16, 185, 129, 0.15);
    border-color: rgba(16, 185, 129, 0.4);
    transform: scale(1.05);
  }

  .search-toggle-btn.active {
    background: #10b981;
    color: white;
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
  }

  .search-toggle-btn svg {
    flex-shrink: 0;
  }
  .filter-actions-wrapper {
    display: flex;
    gap: 0.75rem;
    flex-shrink: 0;
    align-items: center;
  }
  .filter-group-dropdowns {
    display: flex;
    gap: 0.75rem;
  }
  .custom-select-container {
    position: relative;
    min-width: 110px;
    z-index: 600;
  }
  .select-trigger {
    width: 100%;
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-pure);
    padding: 10px 14px;
    border-radius: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    font-size: 0.85rem;
    white-space: nowrap;
  }
  .select-trigger:hover {
    border-color: var(--emerald-pri);
  }
  .chevron-icon {
    transition: transform 0.3s;
    opacity: 0.6;
    flex-shrink: 0;
    margin-left: 6px;
  }
  .chevron-icon.rotated {
    transform: rotate(180deg);
  }
  .dropdown-wrapper {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    right: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 14px;
    z-index: 700;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
    overflow: hidden;
    min-width: 120px;
  }
  .dropdown-scroll-area {
    max-height: 250px;
    overflow-y: auto;
  }
  .option-btn {
    width: 100%;
    padding: 10px 14px;
    background: transparent;
    border: none;
    color: var(--text-muted);
    text-align: left;
    cursor: pointer;
    font-size: 0.85rem;
    display: block;
  }
  .option-btn:hover {
    background: rgba(16, 185, 129, 0.1);
    color: var(--emerald-pri);
  }
  .option-btn.selected {
    color: var(--emerald-pri);
    background: rgba(16, 185, 129, 0.05);
    font-weight: 600;
  }
  .search-apply-btn {
    background: var(--emerald-pri);
    color: var(--bg-deep);
    border: none;
    padding: 0 1.5rem;
    border-radius: 14px;
    font-weight: 700;
    font-size: 0.85rem;
    cursor: pointer;
    transition: 0.2s;
    white-space: nowrap;
    height: 100%;
    min-height: 42px;
  }
  .search-apply-btn:hover {
    opacity: 0.9;
    transform: translateY(-1px);
  }

  /* GRID */
  .grid-section {
    margin-top: 1rem;
  }

  .empty-state {
    text-align: center;
    padding: 4rem;
    color: var(--text-muted);
    opacity: 0.6;
  }

  .grid-section,
  .logs-container .events-selection,
  .grid-section .grid,
  .events-selection .grid {
    margin-top: 0;
  }

  .grid-section,
  .logs-container,
  .grid {
    margin-top: 1.5rem;
  }

  .empty-state-custom {
    text-align: center;
    padding: 5rem 2rem;
    color: var(--text-muted);
  }

  .empty-state-custom svg {
    margin: 0 auto 1.5rem;
    opacity: 0.3;
  }

  .logs-search-input {
    flex: 1;
    background: transparent !important;
    border: none !important;
    color: #f8fafc !important;
    padding: 0.75rem 0 !important;
    font-size: 0.9rem !important;
    outline: none !important;
    pointer-events: auto !important;
    cursor: text !important;
  }

  .logs-nisit-input {
    width: 100%;
    background: transparent !important;
    border: none !important;
    color: #f8fafc !important;
    padding: 0.625rem 0 !important;
    font-size: 0.85rem !important;
    outline: none !important;
    text-align: center;
    letter-spacing: 1px;
    pointer-events: auto !important;
    cursor: text !important;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö 4 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
    gap: 1.5rem;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .grid {
      grid-template-columns: repeat(3, 1fr); /* 3 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    }
  }

  @media (max-width: 900px) {
    .grid {
      grid-template-columns: repeat(2, 1fr); /* 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    }

    .mobile-only {
      display: flex;
    }
    .mobile-controls.mobile-only {
      display: flex !important;
    }
    .mobile-toggle {
      display: block;
    }
  }
  @media (max-width: 600px) {
    .grid {
      grid-template-columns: 1fr; /* 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
    }
  }
  .glass-card {
    background: var(--bar-dark);
    padding: 0;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: 0.3s;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    height: 100%; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
    min-height: auto !important;
  }

  .glass-card .card-body {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    flex: 1;
    min-height: 420px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ */
  }

  /* ‚úÖ Bottom section - ‡∏≠‡∏¢‡∏π‡πà‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠ */
  .card-bottom-section {
    margin-top: auto;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .card-header {
    min-height: 45px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á header ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà */
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .card-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.05rem;
    line-height: 1.4;
    color: #fff;
    font-weight: 600;
    display: -webkit-box;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    max-height: 2.8em; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á 2 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
  }

  .showing-text {
    text-align: center;
    color: #64748b;
    font-size: 0.85rem;
    margin-top: 1rem;
  }

  .event-simple-meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
    min-height: 80px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö meta */
  }

  .event-description-short {
    font-size: 0.8rem;
    color: #94a3b8;
    line-height: 1.5;
    margin: 0.75rem 0 0.75rem 0; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏û‡∏¥‡πà‡∏° margin-top */
    display: -webkit-box;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  .events-selection .event-description-short {
    margin-top: 0.88rem; /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å title */
  }

  .capacity-progress {
    margin-bottom: 0.35rem !important;
  }

  .capacity-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.35rem;
  }

  .capacity-text {
    font-size: 0.8rem;
    color: #94a3b8;
  }

  .capacity-percent {
    font-size: 0.8rem;
    font-weight: 600;
    color: #10b981;
  }

  .glass-card:hover {
    transform: translateY(-5px);
    border-color: rgba(16, 185, 129, 0.2);
  }

  .card-img-wrapper {
    position: relative;
    width: 100%;
    height: 200px; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡πÄ‡∏ä‡πà‡∏ô 150px, 200px, 220px */
    overflow: hidden;
  }
  .card-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: 0.3s;
  }
  .glass-card:hover .card-img {
    transform: scale(1.05);
  }

  /* ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ã‡∏π‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ‡∏Å‡∏≤‡∏£‡πå‡∏î */
  .glass-card:hover .card-img {
    transform: scale(1.05);
  }

  .card-body {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    flex: 1;
    gap: 0.5rem !important; /* ‚Üê ‡∏•‡∏î gap */
    min-height: auto !important;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .card-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.05rem;
    line-height: 1.4;
    color: #fff;
  }

  .status-group {
    display: flex;
    flex-direction: column;
    gap: 6px;
    align-items: flex-end;
    flex-shrink: 0;
  }

  /* Status Badge */
  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid;
    white-space: nowrap;
  }

  .status-badge.status-active {
    background: rgba(16, 185, 129, 0.15);
    border-color: rgba(16, 185, 129, 0.4);
    color: #10b981;
  }

  .status-badge.status-closed {
    background: rgba(239, 68, 68, 0.15);
    border-color: rgba(239, 68, 68, 0.4);
    color: #ef4444;
  }

  .status-badge.status-draft {
    background: rgba(245, 158, 11, 0.15);
    border-color: rgba(245, 158, 11, 0.4);
    color: #f59e0b;
  }

  .quick-msg-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 0.75rem;
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 8px;
    color: #94a3b8;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .quick-msg-btn:hover {
    background: rgba(100, 116, 139, 0.2);
    transform: translateY(-1px);
  }

  .quick-msg-btn svg {
    flex-shrink: 0;
  }

  /* Participants Badge */
  .participants-badge {
    /* ‡πÉ‡∏ä‡πâ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö status badge */
    display: inline-flex;
    padding: 4px 8px;
    border-radius: 10px;
    font-size: 0.7rem;
    font-weight: 600;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    color: #3b82f6;
  }

  .participants-badge svg {
    flex-shrink: 0;
  }
  .loc-text,
  .date-text {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  /* Reward Status Pills */
  .reward-status-pill {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.6rem;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: 600;
  }

  .reward-status-pill.completed {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
  }

  .reward-status-pill.in-progress {
    background: rgba(59, 130, 246, 0.15);
    color: #3b82f6;
  }

  .header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-shrink: 0;
  }

  .btn-icon-action {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 10px;
    color: #94a3b8;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-icon-action:hover {
    background: rgba(100, 116, 139, 0.2);
    color: #f8fafc;
  }

  .btn-send-all {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0 1rem;
    height: 36px;
    background: transparent;
    border: 1px solid #10b981;
    border-radius: 10px;
    color: #10b981;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .btn-send-all:hover {
    background: rgba(16, 185, 129, 0.1);
  }

  .btn-send-all:hover:not(:disabled) {
    background: rgba(16, 185, 129, 0.2);
    border-color: #10b981;
    transform: translateY(-2px);
  }

  .export-dropdown-wrapper {
    position: relative;
  }
  .reward-status-pill.no-tier {
    background: rgba(100, 116, 139, 0.15);
    color: #64748b;
  }

  /* Export menu z-index fix */
  .export-dropdown-wrapper {
    position: relative;
    z-index: 100;
  }

  .export-menu {
    z-index: 1000;
  }
  .action-btn {
    padding: 0.75rem 1rem;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    flex: 1;
  }
  .action-btn:hover {
    background: var(--emerald-pri);
    color: white;
  }

  .glass-card .action-btn,
  .grid .action-btn,
  .events-selection .action-btn {
    padding: 0.75rem 1rem !important;
    border-radius: 12px !important;
    font-size: 0.9rem !important;
    font-weight: 600 !important;
    gap: 0.5rem !important;
  }

  /* ========================================== */
  /* ‚úÖ Event Meta Grid (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°) */
  /* ========================================== */

  .event-meta-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 0.75rem;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 8px 10px;
    background: rgba(100, 116, 139, 0.08);
    border: 1px solid rgba(100, 116, 139, 0.15);
    border-radius: 8px;
    font-size: 0.8rem;
    color: #cbd5e1;
    transition: all 0.2s;
  }

  .meta-item:hover {
    background: rgba(100, 116, 139, 0.12);
    border-color: rgba(100, 116, 139, 0.25);
  }

  .meta-item svg {
    flex-shrink: 0;
    color: #94a3b8;
  }

  .meta-item span {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
  }

  /* Highlight Meta Item (Rewards) */
  .meta-item.meta-highlight {
    background: rgba(245, 158, 11, 0.08);
    border-color: rgba(245, 158, 11, 0.2);
    color: #f59e0b;
  }

  .meta-item.meta-highlight svg {
    color: #f59e0b;
  }

  .progress-bar {
    height: 6px;
    background: #334155;
    border-radius: 3px;
    overflow: hidden;
  }

  /* ========================================== */
  /* ‚úÖ Capacity Progress Bar */
  /* ========================================== */

  .action-buttons {
    display: flex;
    flex-direction: column;
    gap: 1rem; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‡∏•‡∏î‡∏à‡∏≤‡∏Å 0.85rem ‡πÄ‡∏õ‡πá‡∏ô 0.5rem */
    margin-top: auto;
  }

  .grid .action-buttons {
    gap: 1rem !important; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô */
  }

  /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô */
  .action-btn {
    padding: 0.5rem 0.875rem;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
    flex: 1;
  }

  /* ‡∏õ‡∏∏‡πà‡∏° View Details (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß Theme ‡∏´‡∏•‡∏±‡∏Å) */
  .btn-view {
    background: transparent;
    border: 1px solid rgba(16, 185, 129, 0.4);
    color: #10b981;
    box-shadow: none;
  }

  .btn-view:hover {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
  }

  /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏•‡∏∏‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡πá‡∏Å (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô) */
  .small-actions {
    display: flex;
    gap: 10px;
  }

  /* ‡∏õ‡∏∏‡πà‡∏° Edit (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á/‡∏™‡πâ‡∏°) */
  .btn-edit {
    background: rgba(251, 191, 36, 0.1);
    border: 1px solid rgba(251, 191, 36, 0.3);
    color: #fbbf24;
    gap: 0px;
  }

  .btn-edit:hover {
    background: rgba(251, 191, 36, 0.2);
    border-color: #fbbf24;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(251, 191, 36, 0.3);
  }

  /* ‡∏õ‡∏∏‡πà‡∏° Delete (‡∏™‡∏µ‡πÅ‡∏î‡∏á) */
  .btn-delete {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
  }

  .btn-delete:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: #ef4444;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
  }

  /* PAGINATION */
  .pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-top: 2rem;
    flex-wrap: wrap;
  }

  .page-indicator-box {
    background: var(--bar-dark);
    border: 1px solid rgba(255, 255, 255, 0.1);
    padding: 10px 20px;
    border-radius: 12px;
    color: var(--text-muted);
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
  }
  .page-indicator-box:hover {
    border-color: var(--emerald-pri);
  }
  .current-page {
    color: var(--text-pure);
    font-weight: bold;
  }
  .dropdown-arrow {
    transition: transform 0.2s;
  }
  .dropdown-arrow.flipped {
    transform: rotate(180deg);
  }
  .page-dropdown-list {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    max-height: 200px;
    overflow-y: auto;
    width: 120px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.5);

    z-index: 9999 !important; /* üî• ‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ click-outside) */
  }
  .page-option {
    width: 100%;
    padding: 8px;
    background: transparent;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.85rem;
  }
  .page-option:hover {
    background: rgba(255, 255, 255, 0.05);
    color: white;
  }
  .page-option.active {
    color: var(--emerald-pri);
    font-weight: bold;
    background: rgba(16, 185, 129, 0.1);
  }
  .click-outside {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: transparent; /* ‡∏™‡∏µ‡πÉ‡∏™ */
    cursor: default;
    z-index: 9998 !important; /* üî• ‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏∑‡∏≠‡∏ö‡∏™‡∏∏‡∏î */
  }
  .page-info {
    text-align: center;
    margin-top: 1rem;
    color: var(--text-muted);
    font-size: 0.8rem;
    width: 100%;
  }

  /* RESPONSIVE */
  .mobile-only {
    display: none;
  }
  .mobile-toggle {
    display: none;
  }

  .modal-content-wrapper {
    text-align: left;
  }
  /* 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏£‡∏π‡∏õ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏µ‡πâ‡∏¢‡∏•‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢ (‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πà‡∏î‡∏π‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏ó‡∏≠‡∏∞‡∏ó‡∏∞) */
  .modal-img-container {
    width: 100%;
    height: 160px; /* ‚úÖ ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏£‡∏π‡∏õ‡∏•‡∏á (‡∏à‡∏≤‡∏Å 220px -> 160px) */
    position: relative;
    margin: 0;
    padding: 0;
    display: block; /* ‡πÅ‡∏Å‡πâ‡∏ö‡∏±‡πä‡∏Å‡∏£‡∏π‡∏õ‡∏°‡∏µ‡∏Ç‡∏≠‡∏ö‡∏•‡πà‡∏≤‡∏á */
  }

  .modal-main-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
    /* ‚úÖ ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏°‡∏∏‡∏°‡πÇ‡∏Ñ‡πâ‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡∏î‡πâ‡∏ß‡∏¢ (‡∏Å‡∏±‡∏ô‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß) */
    border-top-left-radius: 19px;
    border-top-right-radius: 19px;
  }
  .modal-status-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: bold;
    color: white;
    text-transform: uppercase;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
  }
  .modal-status-badge.active {
    background: var(--emerald-pri);
  }
  .modal-status-badge.closed {
    background: var(--danger);
  }

  .modal-body-text {
    padding: 1.5rem;
  }
  .modal-title {
    margin: 0 0 0.8rem 0;
    font-size: 1.6rem;
    color: var(--emerald-pri);
    line-height: 1.3;
  }
  .modal-meta {
    display: flex;
    gap: 1rem;
    color: var(--text-muted);
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }
  .modal-divider {
    border: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 1rem 0;
  }
  .modal-desc {
    line-height: 1.6;
    color: #e2e8f0;
    font-size: 0.95rem;
    margin: 0;
  }

  .meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.03);
    padding: 8px 12px;
    border-radius: 8px;
  }

  .modal-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin-bottom: 1.5rem;
  }

  .modal-img-container {
    width: 100%;
    height: 160px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ */
    position: relative;
    margin: 0;
    padding: 0;
    display: block;
  }

  /* 2. ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏î‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏°‡∏∏‡∏° (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ ‡∏£‡∏π‡∏õ‡∏•‡πâ‡∏ô‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô) */
  .modal-main-img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ‡∏ï‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏ó‡∏¥‡πâ‡∏á */
    display: block;
    /* ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏ï‡∏±‡∏î‡∏°‡∏∏‡∏°‡∏ö‡∏ô‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡πâ‡∏á‡∏ï‡∏≤‡∏°‡∏Å‡∏£‡∏≠‡∏ö */
    border-top-left-radius: 19px;
    border-top-right-radius: 19px;
  }

  /* 3. ‡∏à‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° */
  .modal-body-text {
    padding: 1.25rem 1.5rem;
    text-align: left;
  }

  .modal-title {
    margin: 0 0 0.5rem 0;
    font-size: 1.3rem;
    color: var(--emerald-pri);
    line-height: 1.2;
  }

  .modal-meta {
    display: flex;
    gap: 0.8rem;
    color: var(--text-muted);
    font-size: 0.85rem;
    margin-bottom: 0.8rem;
  }

  .modal-divider {
    border: 0;
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 0.8rem 0;
  }

  .modal-desc-scroll {
    max-height: 100px;
    overflow-y: auto;
    padding-right: 5px;
  }

  .modal-desc {
    line-height: 1.5;
    color: #e2e8f0;
    font-size: 0.9rem;
    margin: 0;
  }

  /* ‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ö‡∏ô‡∏£‡∏π‡∏õ */
  .modal-status-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 0.7rem;
    font-weight: bold;
    color: white;
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
  }
  .modal-status-badge.active {
    background: var(--emerald-pri);
  }
  .modal-status-badge.closed {
    background: var(--danger);
  }

  .app-footer {
    margin-top: auto;
    padding-top: 4rem;
    padding-bottom: 2rem;
    text-align: center;
    width: 100%;
  }

  .footer-divider {
    height: 1px;
    width: 100%;
    max-width: 200px; /* ‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏Ñ‡∏±‡πà‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏¢‡∏≤‡∏ß‡∏°‡∏≤‡∏Å */
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      transparent
    );
    margin: 0 auto 1.5rem auto; /* ‡∏à‡∏±‡∏î‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ */
  }

  .copyright {
    color: var(--text-muted);
    font-size: 0.85rem;
    margin: 0 0 0.5rem 0;
  }

  .credits {
    color: #64748b; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
    font-size: 0.8rem;
    margin: 0;
  }

  .dev-name {
    color: var(--emerald-pri); /* ‡πÉ‡∏™‡πà‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  .footer-email {
    color: #94a3b8; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡∏≠‡πà‡∏≠‡∏ô */
    text-decoration: none; /* ‡πÄ‡∏≠‡∏≤‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ‡∏≠‡∏≠‡∏Å */
    font-weight: 500;
    transition: color 0.2s ease;
  }

  .footer-email:hover {
    color: var(--emerald-pri); /* ‡∏ä‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏Å */
    text-decoration: underline; /* ‡∏ä‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏°‡∏µ‡∏Ç‡∏µ‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÉ‡∏ï‡πâ */
  }

  .create-event-wrapper {
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
    padding-bottom: 4rem; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡∏î Footer ‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ */
  }

  /* ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß (Header) */
  .create-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
  }

  .section-title {
    font-size: 2rem;
    font-weight: 700;
    color: #fff;
    /* ‡πÑ‡∏•‡πà‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡∏û‡∏£‡∏µ‡πÄ‡∏°‡∏µ‡∏¢‡∏° */
    background: linear-gradient(to right, #fff, #94a3b8);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .btn-back {
    background: transparent;
    border: 1px solid #334155;
    color: #94a3b8;
    padding: 0.6rem 1.5rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
  }

  .btn-back:hover {
    border-color: #fff;
    color: #fff;
    background: rgba(255, 255, 255, 0.05);
  }

  /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏° (‡πÅ‡∏ö‡πà‡∏á‡∏Ñ‡∏£‡∏∂‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤) */
  .create-card {
    background: #1e293b; /* ‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏ó‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏° */
    border: 1px solid #334155;
    border-radius: 20px;
    overflow: hidden;
    display: grid;
    grid-template-columns: 400px 1fr; /* ‡∏ã‡πâ‡∏≤‡∏¢ 400px, ‡∏Ç‡∏ß‡∏≤‡∏Ñ‡∏∑‡∏≠‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ */
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4); /* ‡πÄ‡∏á‡∏≤‡∏•‡∏≠‡∏¢‡πÜ */
  }

  /* --- ‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢: ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û --- */
  .image-upload-section {
    background: #0f172a; /* ‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏°‡∏Å‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ô‡∏¥‡∏î‡∏ô‡∏∂‡∏á */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    position: relative;
    border-right: 1px solid #334155;
    transition: background 0.3s ease;
    min-height: 500px; /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥ */
  }

  .image-upload-section:hover {
    background: #152035; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≠‡∏ô‡πÄ‡∏≠‡∏≤‡πÄ‡∏°‡∏≤‡∏™‡πå‡∏ä‡∏µ‡πâ */
  }

  /* ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ */
  .upload-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.2rem;
    color: #64748b;
  }

  .icon-circle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: rgba(16, 185, 129, 0.1);
    color: var(--emerald-pri); /* ‡πÉ‡∏ä‡πâ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏Å */
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.1);
  }

  .upload-text {
    font-size: 1.1rem;
    font-weight: 600;
    color: #cbd5e1;
  }

  .upload-hint {
    font-size: 0.85rem;
    opacity: 0.7;
  }

  /* ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á */
  .preview-img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà */
    display: block;
  }

  /* Overlay ‡∏ï‡∏≠‡∏ô‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏î‡πâ) */
  .overlay-edit {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    opacity: 0;
    transition: opacity 0.2s ease;
    backdrop-filter: blur(2px);
  }

  .form-section {
    padding: 3rem;
    display: flex;
    flex-direction: column;
    gap: 1.8rem;
  }

  /* ‡∏à‡∏±‡∏î Layout ‡πÅ‡∏ñ‡∏ß‡∏Ñ‡∏π‡πà (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà-‡πÄ‡∏ß‡∏•‡∏≤) */
  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  /* ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á Input (Location) */
  .input-icon-wrapper {
    position: relative;
    display: flex;
    align-items: center;
  }

  .input-icon {
    position: absolute;
    right: 1rem;
    color: #64748b;
    pointer-events: none;
  }

  /* ‡∏õ‡∏∏‡πà‡∏° Save (Publish) */
  .btn-save {
    width: 100%;
    background: linear-gradient(135deg, var(--emerald-pri), var(--teal-sec));
    color: white;
    border: none;
    padding: 1rem;
    border-radius: 10px;
    font-weight: 700;
    font-size: 1.05rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.8rem;
    cursor: pointer;
    margin-top: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4); /* ‡πÄ‡∏á‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á */
  }

  .btn-save:active {
    transform: translateY(0);
  }

  /* --- Responsive Layout (‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠) --- */
  @media (max-width: 900px) {
    .create-card {
      grid-template-columns: 1fr; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤ */
    }

    .image-upload-section {
      height: 300px; /* ‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á‡∏£‡∏π‡∏õ‡∏•‡∏á */
      min-height: auto;
      border-right: none;
      border-bottom: 1px solid #334155;
    }

    .form-section {
      padding: 2rem 1.5rem;
    }
  }

  .event-simple-meta {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .meta-row {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: #94a3b8;
  }

  .meta-row svg {
    flex-shrink: 0;
    color: #64748b;
  }

  .meta-row span {
    line-height: 1.4;
  }
  /* Status Badge with Participants */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid;
    white-space: nowrap;
  }

  .status-badge svg {
    flex-shrink: 0;
  }

  .ce-options-calendar {
    max-height: 400px;
    padding: 12px;
  }
  .ce-month-group {
    margin-bottom: 20px;
  }
  .ce-month-group:last-child {
    margin-bottom: 0;
  }
  .ce-month-header {
    font-weight: 700;
    font-size: 0.95rem;
    color: #10b981;
    padding: 8px 12px;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 8px;
    margin-bottom: 12px;
    text-align: center;
    border: 1px solid rgba(16, 185, 129, 0.2);
  }
  .ce-date-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 6px;
  }
  .ce-date-item {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    padding: 4px;
    min-height: 50px;
  }
  .ce-date-item:hover {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
    transform: translateY(-2px);
  }
  .ce-date-item.selected {
    background: #10b981;
    border-color: #10b981;
    color: white;
  }
  .ce-date-item.weekend {
    background: rgba(239, 68, 68, 0.05);
    border-color: rgba(239, 68, 68, 0.2);
  }
  .ce-date-item.weekend.selected {
    background: #10b981;
    border-color: #10b981;
  }
  .ce-date-day {
    font-size: 1.1rem;
    font-weight: 700;
    line-height: 1;
  }

  .target-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.5rem 0.75rem;
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 8px;
    color: #94a3b8;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .target-btn:hover {
    background: rgba(100, 116, 139, 0.2);
  }

  .target-btn.active {
    background: rgba(16, 185, 129, 0.15);
    border-color: #10b981;
    color: #10b981;
  }
  .ce-date-name {
    font-size: 0.65rem;
    opacity: 0.7;
    margin-top: 2px;
    text-transform: uppercase;
  }
  .ce-check-mark {
    position: absolute;
    top: 2px;
    right: 2px;
    font-size: 0.7rem;
    background: white;
    color: #10b981;
    border-radius: 50%;
    width: 14px;
    height: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
  }

  .ce-wrapper {
    max-width: 1100px;
    margin: 0 auto;
    width: 100%;
    padding-bottom: 3rem;
    font-family:
      "Inter",
      system-ui,
      -apple-system,
      sans-serif;
    animation: ceFade 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }
  .ce-container {
    background: linear-gradient(145deg, #1e293b 0%, #0f172a 100%);
    border: 1px solid #334155;
    border-radius: 24px;
    padding: 2.5rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    position: relative;
    overflow: hidden;
  }
  .ce-container::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -20%;
    width: 500px;
    height: 500px;
    background: radial-gradient(
      circle,
      rgba(16, 185, 129, 0.08) 0%,
      transparent 70%
    );
    border-radius: 50%;
    pointer-events: none;
  }
  .ce-container::after {
    content: "";
    position: absolute;
    bottom: -30%;
    left: -15%;
    width: 400px;
    height: 400px;
    background: radial-gradient(
      circle,
      rgba(59, 130, 246, 0.06) 0%,
      transparent 70%
    );
    border-radius: 50%;
    pointer-events: none;
  }
  @keyframes ceFade {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  .ce-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2.5rem;
    position: relative;
    z-index: 10;
    gap: 15px;
    flex-wrap: wrap;
  }

  .ce-header-right {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }

  .ce-validation-alert {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(239, 68, 68, 0.15);
    border: 1px solid rgba(239, 68, 68, 0.4);
    color: #fca5a5;
    padding: 8px 14px;
    border-radius: 10px;
    font-size: 0.8rem;
    font-weight: 600;
    animation: ceSlideIn 0.3s ease;
    white-space: nowrap;
    box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2);
  }

  @keyframes ceSlideIn {
    from {
      opacity: 0;
      transform: translateX(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  .ce-alert-icon {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    color: #ef4444;
    stroke-width: 2;
  }

  .ce-alert-text {
    white-space: nowrap;
    line-height: 1.2;
  }

  .ce-header-actions {
    display: flex;
    gap: 10px;
  }
  .ce-title {
    font-size: 2rem;
    font-weight: 800;
    background: linear-gradient(135deg, #f8fafc 0%, #94a3b8 100%);
    background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
    letter-spacing: -0.5px;
  }
  .ce-header-actions {
    display: flex;
    gap: 12px;
  }
  .ce-btn-cancel {
    background: transparent;
    border: 1px solid #475569;
    color: #94a3b8;
    padding: 0.7rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.2s;
  }
  .ce-btn-cancel:hover {
    border-color: #e2e8f0;
    color: #e2e8f0;
  }
  .ce-btn-save {
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    color: white;
    padding: 0.7rem 2rem;
    border-radius: 12px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    transition: all 0.2s;
  }
  .ce-btn-save:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
  }
  /* --- 2. Grid System --- */
  .ce-grid-layout {
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 900px;
    margin: 0 auto;
    position: relative;
    z-index: 10;
  }
  .ce-card {
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 20px;
    padding: 24px;
    position: relative;
    box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.3);
    overflow: visible;
  }
  .ce-card-head {
    font-size: 1.1rem;
    font-weight: 700;
    color: #f1f5f9;
    display: flex;
    align-items: center;
    gap: 10px;
    border-bottom: 1px solid #334155;
    padding-bottom: 15px;
    margin-bottom: 20px;
  }
  .ce-icon-svg {
    width: 20px;
    height: 20px;
    flex-shrink: 0;
    color: #10b981;
  }
  .ce-card.error {
    border-color: #ef4444 !important;
    animation: cePulseError 2s ease-in-out infinite;
  }
  @keyframes cePulseError {
    0%,
    100% {
      box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
    }
  }
  /* --- 3. Image Upload --- */
  .ce-img-card {
    padding: 0;
    min-height: 280px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    border: 2px dashed #334155;
    background: #0f172a;
    transition: 0.2s;
    overflow: hidden;
  }
  .ce-img-card:hover {
    border-color: #10b981;
    background: #131c31;
  }
  .ce-img-card.has-img {
    border-style: solid;
    border-color: #334155;
  }
  .ce-preview-img {
    width: 100%;
    height: 280px;
    object-fit: cover;
  }
  .ce-upload-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    color: #64748b;
    font-weight: 500;
  }
  .ce-icon-upload {
    font-size: 2.5rem;
    color: #334155;
    margin-bottom: 5px;
  }
  .ce-overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    opacity: 0;
    transition: 0.2s;
    backdrop-filter: blur(4px);
  }
  .ce-img-card:hover .ce-overlay {
    opacity: 1;
  }
  /* --- 4. Inputs & Forms --- */
  .ce-input-group {
    margin-bottom: 1.2rem;
  }
  .ce-input-group:last-child {
    margin-bottom: 0;
  }
  .ce-input-group label {
    display: block;
    color: #94a3b8;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .ce-req {
    color: #ef4444;
    margin-left: 4px;
  }
  .ce-input,
  .ce-textarea,
  .ce-input-dis,
  .ce-input-sm {
    width: 100%;
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 0 14px;
    color: white;
    height: 48px;
    font-size: 0.95rem;
    transition: all 0.2s;
  }
  .ce-textarea {
    height: auto;
    min-height: 140px;
    padding: 14px;
    resize: vertical;
    line-height: 1.6;
  }
  .ce-input:focus,
  .ce-textarea:focus,
  .ce-input-sm:focus {
    border-color: #10b981;
    outline: none;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
  }

  .ce-input:focus,
  .ce-textarea:focus,
  .ce-input-sm:focus {
    border-color: #10b981;
    outline: none;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
  }
  /* Error states */
  .ce-input.error,
  .ce-textarea.error {
    border-color: #ef4444 !important;
    animation: ceShake 0.4s;
  }
  .ce-date-row.error .ce-trigger,
  .ce-dd-wrap.error .ce-trigger-compact {
    border-color: #ef4444 !important;
    animation: ceShake 0.4s;
  }
  @keyframes ceShake {
    0%,
    100% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(-5px);
    }
    75% {
      transform: translateX(5px);
    }
  }
  /* --- 5. Custom Dropdowns --- */
  .ce-dual-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 1.5rem;
  }
  .ce-time-capacity-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 15px;
    margin-top: 1.5rem;
  }
  .ce-date-row {
    display: flex;
    gap: 10px;
  }
  .ce-date-row.compact-gap {
    gap: 6px;
  }
  .ce-flex-row {
    display: flex;
    gap: 15px;
    align-items: flex-end;
  }
  .flex-1 {
    flex: 1;
  }
  .flex-2 {
    flex: 2;
  }
  .flex-3 {
    flex: 3;
  }
  .flex-1-5 {
    flex: 1.5;
  }
  .ce-dd-wrap {
    position: relative;
    width: 100%;
  }
  .ce-trigger {
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 12px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 14px;
    cursor: pointer;
    transition: 0.2s;
  }
  .ce-trigger:hover {
    border-color: #64748b;
    background: #131c31;
  }
  .ce-trigger-compact {
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 12px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 14px;
    cursor: pointer;
    transition: 0.2s;
    position: relative;
  }
  .ce-trigger-compact:hover {
    border-color: #64748b;
    background: #131c31;
  }
  .ce-arrow {
    font-size: 0.75rem;
    color: #64748b;
    margin-left: 10px;
    flex-shrink: 0;
    pointer-events: none;
  }
  .ce-trigger:hover .ce-arrow,
  .ce-trigger-compact:hover .ce-arrow {
    color: white;
  }
  .ce-input-dis {
    background: transparent !important;
    border: none !important;
    pointer-events: none;
    padding: 0 !important;
    height: 100%;
    box-shadow: none !important;
    width: 100%;
    color: white;
    font-size: 0.95rem;
  }
  .ce-input-inline {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
    padding: 0 !important;
    width: 100%;
    height: 100%;
    color: white;
    font-size: 0.95rem;
    cursor: pointer;
    outline: none;
  }
  .ce-input-inline::placeholder {
    color: #475569;
  }
  .ce-options {
    position: absolute;
    top: 110%;
    left: 0;
    right: 0;
    background: #1e293b;
    border: 1px solid #475569;
    border-radius: 12px;
    max-height: 240px;
    overflow-y: auto;
    z-index: 100;
    padding: 6px;
    box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5);
  }
  .ce-options::-webkit-scrollbar {
    width: 5px;
  }
  .ce-options::-webkit-scrollbar-thumb {
    background: #475569;
    border-radius: 5px;
  }
  .ce-opt {
    padding: 10px 12px;
    cursor: pointer;
    color: #cbd5e1;
    border-radius: 8px;
    font-size: 0.9rem;
    transition: 0.1s;
    display: flex;
    justify-content: space-between;
    align-items: center;
    /* Reset button styles */
    background: transparent;
    border: none;
    width: 100%;
    text-align: left;
  }
  .ce-opt:hover {
    background: #10b981;
    color: white;
  }
  .ce-opt[aria-selected="true"] {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
    font-weight: 600;
  }
  .ce-opt[aria-selected="true"]::after {
    content: "‚úì";
    margin-left: 8px;
  }
  button.ce-opt:focus {
    outline: 2px solid #10b981;
    outline-offset: -2px;
  }
  /* --- 6. Holidays Section --- */
  .ce-locked-card {
    opacity: 0.5;
    pointer-events: none;
    border-style: dashed;
    border-color: #475569;
    filter: grayscale(0.8);
  }
  .ce-lock-overlay {
    position: absolute;
    inset: 0;
    background: rgba(15, 23, 42, 0.85);
    z-index: 50;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 20px;
    color: #e2e8f0;
    font-weight: 500;
    backdrop-filter: blur(2px);
    gap: 10px;
  }
  .ce-lock-icon-svg {
    width: 48px;
    height: 48px;
    color: #64748b;
    margin-bottom: 10px;
  }
  .ce-status-icon {
    width: 24px;
    height: 24px;
    color: currentColor;
  }
  .ce-status-icon-box {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    flex-shrink: 0;
    color: #64748b;
  }
  .status-live .ce-status-icon-box {
    color: #10b981;
  }
  .ce-upload-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    color: #64748b;
    font-weight: 500;
  }
  .ce-icon-upload {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(16, 185, 129, 0.1);
    border-radius: 50%;
    margin-bottom: 5px;
  }
  .ce-icon-upload svg {
    width: 32px;
    height: 32px;
    color: #10b981;
  }
  .ce-check-row {
    display: flex;
    align-items: center;
    gap: 15px;
    cursor: pointer;
    padding: 14px;
    background: #0f172a;
    border-radius: 12px;
    border: 1px solid #334155;
    transition: 0.2s;
    user-select: none; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }
  .ce-check-row:hover {
    border-color: #64748b;
    background: #162032;
  }

  .ce-check-row.active {
    border-color: #10b981;
    background: rgba(16, 185, 129, 0.05);
  }
  .ce-check-row input {
    width: 20px;
    height: 20px;
    accent-color: #10b981;
    cursor: pointer;
    pointer-events: none;
  }
  .ce-check-row input:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .ce-holiday-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-bottom: 20px;
  }

  /* Style ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß */
  .ce-opt.disabled {
    opacity: 0.4;
    cursor: not-allowed;
    background: rgba(100, 116, 139, 0.1);
  }
  .ce-opt.disabled:hover {
    background: rgba(100, 116, 139, 0.1);
  }

  /* ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢ ‚úì */
  .already-added {
    margin-left: auto;
    font-size: 0.75rem;
    color: #10b981;
    font-weight: 600;
  }
  .ce-check-row input {
    width: 20px;
    height: 20px;
    accent-color: #10b981;
    cursor: pointer;
  }
  .ce-check-content {
    display: flex;
    flex-direction: column;
  }
  .ce-check-title {
    color: white;
    font-weight: 600;
    font-size: 0.95rem;
  }
  .ce-check-desc {
    color: #64748b;
    font-size: 0.8rem;
    margin-top: 2px;
  }
  .ce-divider {
    border: 0;
    border-top: 1px solid #334155;
    margin: 20px 0;
  }

  /* Event Type Styles */
  .ce-event-type-control {
    padding: 0;
  }

  .ce-event-type-buttons {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
  }

  .ce-event-type-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 20px 16px;
    background: #0f172a;
    border: 2px solid #334155;
    border-radius: 16px;
    cursor: pointer;
    transition: all 0.25s ease;
    position: relative;
    text-align: center;
  }

  .ce-event-type-btn:hover {
    border-color: #64748b;
    background: #162032;
    transform: translateY(-2px);
  }

  .ce-event-type-btn.active {
    border-color: #10b981;
    background: rgba(16, 185, 129, 0.08);
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.15);
  }

  .ce-event-type-icon {
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(100, 116, 139, 0.15);
    border-radius: 12px;
    transition: all 0.25s ease;
  }

  .ce-event-type-btn.active .ce-event-type-icon {
    background: rgba(16, 185, 129, 0.15);
  }

  .ce-event-type-icon svg {
    width: 24px;
    height: 24px;
    color: #94a3b8;
    transition: all 0.25s ease;
  }

  .ce-event-type-btn.active .ce-event-type-icon svg {
    color: #10b981;
  }

  .ce-event-type-content {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .ce-event-type-title {
    font-size: 1rem;
    font-weight: 700;
    color: #f1f5f9;
  }

  .ce-event-type-btn.active .ce-event-type-title {
    color: #10b981;
  }

  .ce-event-type-desc {
    font-size: 0.75rem;
    color: #64748b;
    line-height: 1.4;
  }

  .ce-event-type-check {
    position: absolute;
    top: 12px;
    right: 12px;
    width: 24px;
    height: 24px;
    background: #10b981;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: scaleIn 0.2s ease;
  }

  .ce-event-type-check svg {
    width: 14px;
    height: 14px;
    color: white;
  }

  @keyframes scaleIn {
    from {
      transform: scale(0);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }

  /* Checkin Config - Clean Design */
  .ce-checkin-section {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 16px;
    padding: 16px 20px;
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 12px;
  }

  .ce-checkin-label {
    font-size: 0.95rem;
    font-weight: 500;
    color: #e2e8f0;
  }

  .ce-checkin-stepper {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .ce-stepper-btn {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #1e293b;
    border: 1px solid #334155;
    border-radius: 10px;
    color: #94a3b8;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .ce-stepper-btn svg {
    width: 18px;
    height: 18px;
  }

  .ce-stepper-btn.minus:hover:not(:disabled) {
    background: rgba(239, 68, 68, 0.1);
    border-color: rgba(239, 68, 68, 0.4);
    color: #f87171;
  }

  .ce-stepper-btn.plus:hover:not(:disabled) {
    background: rgba(16, 185, 129, 0.1);
    border-color: rgba(16, 185, 129, 0.4);
    color: #34d399;
  }

  .ce-stepper-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  .ce-stepper-value {
    min-width: 48px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    font-weight: 700;
    color: #10b981;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.25);
    border-radius: 10px;
  }

  .ce-stepper-unit {
    color: #64748b;
    font-size: 0.85rem;
    margin-left: 4px;
  }

  @media (max-width: 640px) {
    .ce-event-type-buttons {
      grid-template-columns: 1fr;
    }

    .ce-event-type-btn {
      flex-direction: row;
      text-align: left;
      padding: 16px;
    }

    .ce-event-type-icon {
      width: 40px;
      height: 40px;
    }

    .ce-event-type-content {
      flex: 1;
    }

    .ce-checkin-section {
      flex-direction: column;
      align-items: flex-start;
      gap: 14px;
    }

    .ce-checkin-stepper {
      width: 100%;
      justify-content: space-between;
    }
  }
  .ce-hint {
    display: block;
    font-size: 0.8rem;
    color: #64748b;
    margin-top: 8px;
    font-style: italic;
  }
  .ce-btn-icon {
    width: 48px;
    height: 48px;
    background: #334155;
    color: white;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-size: 1.5rem;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: 0.2s;
  }
  .ce-btn-icon:hover {
    background: #10b981;
  }
  .ce-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 15px;
  }
  .ce-tag {
    background: rgba(239, 68, 68, 0.15);
    color: #fca5a5;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }
  .ce-tag button {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 1.1rem;
    line-height: 1;
  }
  /* --- 7. Rewards Section --- */
  .ce-rewards-section {
    margin-top: 1.5rem;
  }
  .ce-progress-info {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: #94a3b8;
    margin-bottom: 6px;
    font-weight: 500;
  }
  .ce-text-err {
    color: #ef4444;
    font-weight: 700;
    animation: cePulse 1.5s infinite;
  }
  @keyframes cePulse {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }
  .ce-progress-bar {
    height: 8px;
    background: #334155;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 20px;
  }
  .ce-bar-fill {
    height: 100%;
    transition:
      width 0.4s ease,
      background 0.3s ease;
  }
  .ce-stack {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .ce-tier-card {
    background: linear-gradient(135deg, #0f172a 0%, #1a2332 100%);
    border: 1px solid #334155;
    border-radius: 14px;
    padding: 0;
    overflow: hidden;
    transition: all 0.2s ease;
  }
  .ce-tier-card:hover {
    border-color: #10b981;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
  }
  .ce-tier-header {
    background: rgba(51, 65, 85, 0.3);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 1px solid #334155;
  }
  .ce-badge {
    background: linear-gradient(135deg, #334155, #475569);
    color: white;
    padding: 5px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  }
  .ce-tier-range-badge {
    font-size: 0.85rem;
    color: #10b981;
    font-weight: 600;
    background: rgba(16, 185, 129, 0.1);
    padding: 5px 12px;
    border-radius: 8px;
    border: 1px solid rgba(16, 185, 129, 0.2);
    flex-grow: 1;
  }
  .ce-btn-remove {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    width: 28px;
    height: 28px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 1.3rem;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    margin-left: auto;
  }
  .ce-btn-remove:hover {
    background: #ef4444;
    color: white;
    transform: scale(1.05);
  }
  .ce-tier-body {
    padding: 16px;
    display: grid;
    grid-template-columns: 100px 120px 1fr;
    gap: 12px;
    align-items: end;
  }

  .ce-tier-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  @media (max-width: 768px) {
    .ce-tier-body {
      grid-template-columns: 1fr;
    }

    .ce-tier-field-wide {
      grid-column: 1 / 2;
    }
    .search-toggle-btn {
      padding: 8px;
      min-width: 40px;
      justify-content: center;
    }
  }
  .ce-tier-field label {
    font-size: 0.75rem;
    color: #94a3b8;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin: 0;
    white-space: nowrap;
  }
  .ce-tier-field-wide {
    grid-column: 2 / 3;
  }
  .ce-input-compact {
    background: #0f172a;
    border: 1px solid #334155;
    border-radius: 10px;
    padding: 0 12px;
    height: 42px;
    color: white;
    font-size: 0.9rem;
    transition: all 0.2s;
    width: 100%;
  }
  .ce-input-compact:focus {
    border-color: #10b981;
    outline: none;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }

  .ce-input-compact::placeholder {
    color: #475569;
    font-size: 0.85rem;
  }

  .ce-input-compact:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .ce-btn-dashed {
    width: 100%;
    border: 1px dashed #475569;
    background: transparent;
    color: #94a3b8;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    margin-top: 15px;
    transition: 0.2s;
    font-weight: 500;
  }
  .ce-btn-dashed:hover {
    border-color: #10b981;
    color: #10b981;
    background: rgba(16, 185, 129, 0.05);
  }
  /* --- 8. Status Section --- */
  .ce-status-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
  }
  .ce-switch-box {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #0f172a;
    padding: 14px;
    border-radius: 12px;
    border: 1px solid #334155;
  }
  .ce-switch-box label {
    margin: 0;
    color: #e2e8f0;
    font-weight: 600;
    cursor: pointer;
  }
  .ce-switch {
    position: relative;
    width: 48px;
    height: 26px;
  }
  .ce-switch input {
    opacity: 0;
    width: 0;
    height: 0;
  }
  .ce-slider {
    position: absolute;
    inset: 0;
    background: #334155;
    border-radius: 30px;
    transition: 0.3s;
    cursor: pointer;
  }
  .ce-slider:before {
    position: absolute;
    content: "";
    height: 20px;
    width: 20px;
    left: 3px;
    bottom: 3px;
    background: white;
    border-radius: 50%;
    transition: 0.3s;
  }
  input:checked + .ce-slider {
    background: #10b981;
  }
  input:checked + .ce-slider:before {
    transform: translateX(22px);
  }
  .ce-status-card {
    background: linear-gradient(145deg, #1e293b, #0f172a);
    border: 1px solid #334155;
    border-radius: 12px;
    padding: 16px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: 0.3s all;
  }
  .ce-status-card.status-live {
    background: linear-gradient(
      145deg,
      rgba(16, 185, 129, 0.1),
      rgba(6, 95, 70, 0.2)
    );
    border-color: #10b981;
  }

  .status-badge.status-draft {
    background: rgba(245, 158, 11, 0.15);
    border-color: rgba(245, 158, 11, 0.4);
    color: #f59e0b;
  }
  .ce-status-icon-box {
    width: 44px;
    height: 44px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    flex-shrink: 0;
  }
  .ce-status-text strong {
    display: block;
    color: #f1f5f9;
    font-size: 1rem;
    margin-bottom: 4px;
  }
  .ce-status-text p {
    margin: 0;
    color: #94a3b8;
    font-size: 0.85rem;
    line-height: 1.4;
  }
  .status-live .ce-status-text strong {
    color: #34d399;
  }
  /* --- 9. Error Message --- */
  .ce-error-msg {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #fca5a5;
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 0.85rem;
    margin-top: 15px; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 10px ‡πÄ‡∏õ‡πá‡∏ô 15px */
    display: flex;
    align-items: center;
    gap: 8px;
  }
  /* --- 10. Utility & Fixes --- */
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  input[type="number"] {
    -moz-appearance: textfield;
    appearance: textfield;
  }
  /* --- 11. Responsive --- */
  @media (max-width: 1024px) {
    .ce-grid-layout {
      grid-template-columns: 1fr;
      gap: 20px;
    }
    .ce-dual-row {
      grid-template-columns: 1fr;
    }
    .ce-time-capacity-row {
      grid-template-columns: 1fr;
    }
    .ce-tier-body {
      grid-template-columns: 1fr;
    }
    .ce-tier-field-wide {
      grid-column: 1 / 2;
    }
  }
  @media (max-width: 600px) {
    .ce-header {
      flex-direction: column;
      align-items: stretch;
      gap: 12px;
    }

    .ce-header-right {
      width: 100%;
      flex-direction: column;
      align-items: stretch;
      gap: 10px;
    }

    .ce-validation-alert {
      width: 100%;
      justify-content: center;
      font-size: 0.75rem;
      padding: 8px 12px;
    }

    .ce-alert-icon {
      width: 18px;
      height: 18px;
    }

    .ce-header-actions {
      width: 100%;
      gap: 8px;
    }

    .ce-btn-cancel,
    .ce-btn-save {
      flex: 1;
      text-align: center;
      padding: 0.6rem 1rem;
      font-size: 0.85rem;
    }

    @keyframes ceSlideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    .ce-alert-icon {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: #ef4444;
    }
    .ce-alert-text {
      white-space: nowrap;
    }

    /* Card Head with SVG Icons */
    .ce-card-head {
      font-size: 1.1rem;
      font-weight: 700;
      color: #f1f5f9;
      display: flex;
      align-items: center;
      gap: 10px;
      border-bottom: 1px solid #334155;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }
    .ce-icon-svg {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      color: #10b981;
    }

    /* Error State */
    .ce-card.error {
      border-color: #ef4444 !important;
      animation: cePulseError 2s ease-in-out infinite;
    }
    @keyframes cePulseError {
      0%,
      100% {
        box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
      }
      50% {
        box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
      }
    }

    /* Lock Icons */
    .ce-lock-icon-svg {
      width: 48px;
      height: 48px;
      color: #64748b;
      margin-bottom: 10px;
    }

    /* Status Icons */
    .ce-status-icon {
      width: 24px;
      height: 24px;
      color: currentColor;
    }
    .ce-status-icon-box {
      width: 44px;
      height: 44px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      flex-shrink: 0;
      color: #64748b;
    }
    .status-live .ce-status-icon-box {
      color: #10b981;
    }

    /* Upload Icon */
    .ce-upload-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      color: #64748b;
      font-weight: 500;
    }
    .ce-icon-upload {
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(16, 185, 129, 0.1);
      border-radius: 50%;
      margin-bottom: 5px;
    }
    .ce-icon-upload svg {
      width: 32px;
      height: 32px;
      color: #10b981;
    }

    /* Responsive */
    @media (max-width: 600px) {
      .ce-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      .ce-header-right {
        width: 100%;
        flex-direction: column;
        align-items: stretch;
      }
      .ce-validation-alert {
        width: 100%;
        justify-content: center;
      }
      .ce-header-actions {
        width: 100%;
        justify-content: stretch;
      }
      .ce-btn-cancel,
      .ce-btn-save {
        flex: 1;
        text-align: center;
      }
      .ce-date-row {
        flex-direction: column;
      }
      .ce-flex-row {
        flex-direction: column;
      }
      .ce-status-row {
        flex-direction: column;
        gap: 10px;
      }
      .ce-dual-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      .ce-time-capacity-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }
    .ce-header-actions {
      width: 100%;
      justify-content: stretch;
    }
    .ce-btn-cancel,
    .ce-btn-save {
      flex: 1;
      text-align: center;
    }
    .ce-date-row {
      flex-direction: column;
    }
    .ce-flex-row {
      flex-direction: column;
    }
    .ce-status-row {
      flex-direction: column;
      gap: 10px;
    }
    .ce-dual-row {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    .ce-time-capacity-row {
      grid-template-columns: 1fr;
      gap: 12px;
    }
  }

  .ce-btn-reset {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    padding: 6px 14px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.8rem;
    font-weight: 600;
    transition: all 0.2s;
  }
  .ce-btn-reset:hover {
    background: #ef4444;
    color: white;
    transform: scale(1.02);
  }

  /* ========================================== */
  /* ‚úÖ Logs Intro Header - ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List */
  /* ========================================== */

  .logs-action-buttons {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }
  .glass-card .card-body .action-buttons {
    gap: 0.85rem !important; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  }

  .events-selection .glass-card .card-body .action-buttons {
    gap: 0.85rem !important; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  }

  .realtime-controls {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .btn-new-logs {
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.85rem;
    font-weight: 600;
    transition: all 0.3s;
    animation: pulse 2s infinite;
  }

  .btn-new-logs:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
  }

  @keyframes pulse {
    0%,
    100% {
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4);
    }
    50% {
      box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
    }
  }

  .btn-auto-refresh {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    padding: 0;
    background: transparent;
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 10px;
    color: #94a3b8;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
  }

  .btn-auto-refresh:hover {
    background: rgba(100, 116, 139, 0.1);
    border-color: rgba(100, 116, 139, 0.5);
  }

  .btn-auto-refresh.active {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
    color: #10b981;
  }

  .btn-auto-refresh.active:hover {
    background: rgba(16, 185, 129, 0.2);
  }

  .live-dot {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 8px;
    height: 8px;
    background: #10b981;
    border-radius: 50%;
    animation: blink 1.5s infinite;
  }

  @keyframes blink {
    0%,
    100% {
      opacity: 1;
    }
    50% {
      opacity: 0.3;
    }
  }

  .btn-timeline,
  .btn-export {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0 1rem;
    height: 36px;
    background: transparent;
    border: 1px solid #10b981;
    border-radius: 10px;
    color: #10b981;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
  }

  .btn-export:hover {
    background: rgba(16, 185, 129, 0.1);
  }

  .btn-export:hover:not(:disabled) {
    background: rgba(16, 185, 129, 0.2);
    border-color: #10b981;
    transform: translateY(-2px);
  }

  .btn-timeline:hover:not(:disabled) {
    background: rgba(16, 185, 129, 0.2);
    border-color: #10b981;
    transform: translateY(-2px);
  }

  .btn-export:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .spinner-icon {
    animation: spin 1s linear infinite;
  }

  @keyframes spin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  /* Export Dropdown */
  .export-dropdown-wrapper {
    position: relative;
    z-index: 100; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .export-menu {
    position: absolute;
    top: 100%;
    right: 0;
    min-width: 160px;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.4rem;
    margin-top: 0.5rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    z-index: 1000;
  }

  .export-option {
    width: 100%;
    background: transparent;
    border: none;
    color: #f8fafc;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.75rem;
    font-weight: 500;
    transition: all 0.2s;
    text-align: left;
    white-space: nowrap;
  }

  .export-option svg {
    width: 14px;
    height: 14px;
    flex-shrink: 0;
  }

  .export-option:hover {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }

  /* ========================================== */
  /* ‚ú® Timeline Modal */
  /* ========================================== */

  .timeline-modal-container {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    width: 90%;
    max-width: 700px;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
    position: relative;
    z-index: 100000 !important;
  }

  .timeline-modal-header {
    padding: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .timeline-modal-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0;
    display: flex;
    align-items: center;
  }

  .timeline-modal-body {
    padding: 1.5rem;
    overflow-y: auto;
    flex: 1;
  }

  .timeline-event-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    color: #10b981;
    margin-bottom: 1.5rem;
    padding: 0.75rem 1rem;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: 12px;
  }

  .timeline-container {
    position: relative;
  }

  .timeline-item {
    position: relative;
    padding-left: 2.5rem;
    padding-bottom: 2rem;
  }

  .timeline-dot {
    position: absolute;
    left: 0;
    top: 4px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #1e293b;
    z-index: 2;
  }

  .timeline-dot.success {
    background: #10b981;
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.2);
  }

  .timeline-dot.failed {
    background: #ef4444;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
  }

  .timeline-dot.pending {
    background: #f59e0b;
    box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.2);
  }

  .timeline-line {
    position: absolute;
    left: 5px;
    top: 16px;
    bottom: 0;
    width: 2px;
    background: linear-gradient(
      180deg,
      rgba(16, 185, 129, 0.3),
      rgba(16, 185, 129, 0.05)
    );
  }

  .timeline-line.last {
    display: none;
  }

  .timeline-content {
    background: linear-gradient(
      135deg,
      rgba(0, 0, 0, 0.15),
      rgba(0, 0, 0, 0.05)
    ); /* ‡πÑ‡∏•‡πà‡πÄ‡∏â‡∏î‡∏™‡∏ß‡∏¢‡πÜ */
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 12px;
    padding: 1rem;
    transition: all 0.3s ease;
  }

  .timeline-item:hover .timeline-content {
    background: rgba(
      16,
      185,
      129,
      0.05
    ); /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠ Hover */
    border-color: rgba(16, 185, 129, 0.2);
    transform: translateX(4px);
  }

  /* ‚úÖ Action Badge - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
  .action-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1px solid currentColor; /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° border ‡∏ï‡∏≤‡∏°‡∏™‡∏µ */
    opacity: 0.95;
    transition: all 0.2s;
  }

  .timeline-item:hover .action-badge {
    opacity: 1;
    transform: scale(1.05);
  }

  /* ‚úÖ Timeline Time - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
  .timeline-time {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* ‚úÖ Timeline User - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πà‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô */
  .timeline-user {
    font-size: 0.9rem;
    font-weight: 600;
    color: #f8fafc;
    margin-bottom: 0.375rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  /* ‚úÖ Timeline Details - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
  .timeline-details {
    font-size: 0.85rem;
    color: #cbd5e1;
    line-height: 1.6;
    padding: 0.5rem;
    background: rgba(0, 0, 0, 0.1); /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≠‡∏ô‡πÜ */
    border-radius: 6px;
    border-left: 3px solid rgba(16, 185, 129, 0.3); /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏µ‡∏î‡∏î‡πâ‡∏≤‡∏ô‡∏ã‡πâ‡∏≤‡∏¢ */
  }

  /* ‚úÖ Timeline Dot - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
  .timeline-dot {
    position: absolute;
    left: 0;
    top: 4px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 3px solid #1e293b; /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤ */
    z-index: 2;
    transition: all 0.3s;
  }

  .timeline-item:hover .timeline-dot {
    transform: scale(1.3); /* ‚úÖ ‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏°‡∏∑‡πà‡∏≠ Hover */
  }

  .timeline-dot.success {
    background: #10b981;
    box-shadow:
      0 0 0 4px rgba(16, 185, 129, 0.2),
      0 0 10px rgba(16, 185, 129, 0.4); /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏≤ */
  }

  .timeline-dot.failed {
    background: #ef4444;
    box-shadow:
      0 0 0 4px rgba(239, 68, 68, 0.2),
      0 0 10px rgba(239, 68, 68, 0.4);
  }

  .timeline-dot.pending {
    background: #f59e0b;
    box-shadow:
      0 0 0 4px rgba(245, 158, 11, 0.2),
      0 0 10px rgba(245, 158, 11, 0.4);
    animation: pulse 2s infinite; /* ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° animation */
  }

  @keyframes pulse {
    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }
    50% {
      opacity: 0.7;
      transform: scale(1.1);
    }
  }

  /* ‚úÖ Timeline Line - ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏ß‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô */
  .timeline-line {
    position: absolute;
    left: 5px;
    top: 20px; /* ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á */
    bottom: 0;
    width: 2px;
    background: linear-gradient(
      180deg,
      rgba(16, 185, 129, 0.4) 0%,
      rgba(16, 185, 129, 0.2) 50%,
      rgba(16, 185, 129, 0.05) 100%
    );
  }

  .timeline-line.last {
    display: none;
  }

  .timeline-time {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-bottom: 0.5rem;
  }

  .timeline-action {
    margin-bottom: 0.5rem;
  }

  .timeline-user {
    font-size: 0.9rem;
    font-weight: 600;
    color: #f8fafc;
    margin-bottom: 0.25rem;
  }

  .timeline-details {
    font-size: 0.85rem;
    color: #cbd5e1;
    line-height: 1.5;
  }

  .timeline-empty {
    text-align: center;
    padding: 3rem 1rem;
    color: #64748b;
  }

  .timeline-empty svg {
    margin: 0 auto 1rem;
    opacity: 0.5;
  }

  .timeline-empty p {
    margin: 0;
    font-size: 0.95rem;
  }

  .logs-intro-header {
    margin-bottom: 3rem;
    text-align: left;
  }

  .logs-page-title {
    font-size: 2rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0 0 0.5rem 0;
    letter-spacing: -0.02em;
  }

  .logs-page-divider {
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, #10b981, #059669);
    border-radius: 2px;
    margin: 1rem 0 1.5rem 0;
  }

  .logs-page-subtitle {
    font-size: 1.25rem;
    font-weight: 600;
    color: #cbd5e1;
    margin: 0 0 0.5rem 0;
  }

  .logs-page-description {
    font-size: 0.95rem;
    color: #94a3b8;
    margin: 0;
    line-height: 1.6;
  }

  /* ========================================== */
  /* üìã LOGS VIEW STYLES */
  /* ========================================== */

  .logs-container {
    width: 100%;
  }

  .events-selection {
    width: 100%;
  }

  /* Events Selection Grid - ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô Event List */

  .section-header {
    margin-bottom: 2rem;
  }

  .section-title {
    font-size: 1.75rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0 0 0.5rem 0;
  }

  .section-subtitle {
    color: #94a3b8;
    font-size: 0.95rem;
    margin: 0;
  }

  /* Glass Cards ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Events - Clickable */

  /* Logs Detail Header - ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Status Badge */
  .logs-detail {
    animation: fadeIn 0.3s ease;
    margin-top: 0.5rem;
  }

  .logs-header {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .btn-back-logs {
    background: rgba(100, 116, 139, 0.2);
    border: 1px solid rgba(100, 116, 139, 0.3);
    color: #94a3b8;
    padding: 0.625rem 1rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .btn-back-logs:hover {
    background: rgba(100, 116, 139, 0.3);
    border-color: #64748b;
    color: #f8fafc;
    transform: translateX(-2px);
  }

  .selected-event-info {
    flex: 1;
    min-width: 250px;
  }

  .selected-event-info h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0 0 0.5rem 0;
  }

  .event-meta-small {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.85rem;
    color: #94a3b8;
    align-items: center;
  }

  .event-meta-small > span {
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .event-meta-small svg {
    flex-shrink: 0;
  }
  /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Status Badge ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö */
  .status-badge-inline {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    background: rgba(239, 68, 68, 0.15);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    text-transform: uppercase;
  }

  .status-badge-inline.active {
    background: rgba(16, 185, 129, 0.15);
    border-color: rgba(16, 185, 129, 0.3);
    color: #10b981;
  }

  .icon-outline {
    stroke-width: 2;
    fill: none;
  }

  .action-icon-svg {
    stroke-width: 2;
    fill: none;
  }

  /* ========================================== */
  /* ‚úÖ EMPTY STATE ICONS */
  /* ========================================== */

  .empty-state svg,
  .empty-state-custom svg,
  .loading-state svg,
  .error-state svg {
    stroke-width: 1.5;
  }

  .loc-text svg,
  .date-text svg {
    flex-shrink: 0;
    margin-right: 4px;
  }

  .action-btn svg {
    flex-shrink: 0;
  }

  /* Card Header Spacing */
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .card-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.05rem;
    line-height: 1.4;
    color: #fff;
  }
  /* Statistics Dashboard - ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡∏ï‡∏±‡∏ß */
  .stats-dashboard {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card-compact {
    display: flex !important;
    flex-direction: row !important;
    align-items: center !important;
    gap: 12px;
    padding: 16px 20px;
    background: #1f2937;
    border: 1px solid #374151;
    border-radius: 8px;
  }

  .stat-icon-compact {
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: 40px;
    height: 40px;
    border-radius: 8px;
    flex-shrink: 0;
  }

  /* Pending variant */
  .stat-card-compact.pending .stat-icon-compact {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
  }

  .stat-card-compact.pending .stat-label-compact {
    color: #f59e0b;
  }

  .stat-info-compact {
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
    gap: 2px;
    line-height: 1;
  }

  .stat-value-compact {
    font-size: 1.75rem;
    font-weight: 700;
    color: #ffffff;
    line-height: 1 !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  .stat-label-compact {
    font-size: 0.875rem;
    font-weight: 500;
    line-height: 1 !important;
    margin: 0 !important;
    padding: 0 !important;
  }
  .stat-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s;
  }
  .stat-card.clickable {
    cursor: pointer;
  }

  .stat-card.clickable:hover {
    border-color: rgba(16, 185, 129, 0.5);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
  }

  .stat-card.active {
    border-color: #10b981;
    background: rgba(16, 185, 129, 0.05);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }
  /* Statistics Dashboard - ‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 4 ‡∏ï‡∏±‡∏ß */
  .stats-dashboard-single-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.75rem;
    align-items: center;
    margin-bottom: 2rem;
    position: relative;
    z-index: 1; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .stat-card-compact {
    display: flex;
    align-items: center; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
    gap: 12px;
    padding: 16px 20px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏° padding ‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ */
    background: #1f2937;
    border: 1px solid #374151;
    border-radius: 8px;
  }

  .stat-card-compact.clickable:hover {
    border-color: rgba(16, 185, 129, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .stat-card-compact.active {
    border-color: #10b981;
    background: rgba(16, 185, 129, 0.05);
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
  }

  /* ========================================== */
  /* ‚úÖ FIX: Force Grid Layout for Events Selection */
  /* ========================================== */

  .events-selection .grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)) !important;
    gap: 1.5rem !important;
    margin-bottom: 2.5rem !important;
    grid-auto-rows: 1fr !important;
    flex-direction: unset !important; /* ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å flex-direction ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ */
    flex-wrap: unset !important; /* ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å flex-wrap ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ */
  }

  .events-selection .glass-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    height: 100%;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    min-height: auto !important; /* ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .events-selection .glass-card:hover {
    transform: translateY(-8px) scale(1.02);
    border-color: rgba(16, 185, 129, 0.4);
    box-shadow:
      0 20px 40px rgba(0, 0, 0, 0.4),
      0 0 0 1px rgba(16, 185, 129, 0.2);
  }

  .events-selection .card-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .events-selection .glass-card:hover .card-img {
    transform: scale(1.1);
  }

  .events-selection .card-img-wrapper {
    position: relative;
    width: 100%;
    height: 200px;
    overflow: hidden;
    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
  }
  .events-selection .card-body {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    flex: 1;
    gap: 0.5rem; /* ‚Üê ‡∏•‡∏î‡∏à‡∏≤‡∏Å 0.75rem */
    min-height: auto !important; /* ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .events-selection .card-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.05rem;
    line-height: 1.4;
    color: #fff;
    font-weight: 600;
  }

  .events-selection .action-buttons {
    margin-top: 0.25rem; /* ‚Üê ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å auto */
    padding-top: 0; /* ‚Üê ‡πÄ‡∏≠‡∏≤ padding ‡∏≠‡∏≠‡∏Å‡πÄ‡∏•‡∏¢ */
    display: flex;
    gap: 0.625rem;
  }

  .events-selection .glass-card .card-body .action-buttons {
    margin-top: 0.25rem !important;
    padding-top: 0 !important;
  }
  .events-selection .action-btn {
    flex: 1;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    border: none;
  }

  .events-selection .btn-view {
    background: transparent;
    border: 1px solid rgba(16, 185, 129, 0.4);
    color: #10b981;
    box-shadow: none;
  }

  .events-selection .btn-view:hover {
    background: rgba(16, 185, 129, 0.1);
    border-color: #10b981;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.15);
  }

  /* Empty State */
  .empty-state-custom {
    text-align: center;
    padding: 4rem 2rem;
    background: #1e293b;
    border: 2px dashed rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    animation: fadeIn 0.5s ease;
  }

  .empty-state-custom svg {
    margin: 0 auto 1.5rem;
    opacity: 0.5;
  }

  .events-selection .card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .events-selection .action-buttons {
    margin-top: auto !important;
  }

  .stat-icon-compact {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .stat-info-compact {
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* ‡∏à‡∏±‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
    justify-content: center; /* ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
  }

  .stat-value-compact {
    font-size: 1.5rem;
    font-weight: 700;
    color: #f8fafc;
    line-height: 1;
  }

  .stat-label-compact {
    font-size: 0.75rem;
    color: #94a3b8;
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Filter Section - ‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà */
  .filter-section-logs {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    margin-bottom: 2rem;
    position: relative;
    z-index: 10; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .filter-row-logs {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 0.75rem;
  }

  .filter-row-logs:last-child {
    margin-bottom: 0;
  }

  .search-box-logs {
    flex: 1;
    min-width: 200px;
    display: flex;
    align-items: center;
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0 1rem;
    gap: 0.75rem;
  }

  .search-box-logs:focus-within {
    border-color: #10b981;
  }

  .search-box-logs input {
    flex: 1;
    background: transparent;
    border: none;
    color: #f8fafc;
    padding: 0.75rem 0;
    font-size: 0.9rem;
    outline: none;
  }

  .search-box-logs input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: rgba(15, 23, 42, 0.5);
  }
  .search-box-logs input::placeholder {
    color: #64748b;
  }

  .nisit-filter-box {
    display: flex;
    align-items: center;
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 0 0.75rem;
    width: 90px;
    flex-shrink: 0;
  }

  .nisit-filter-box:focus-within {
    border-color: #10b981;
  }

  .nisit-filter-box input {
    width: 100%;
    background: transparent;
    border: none;
    position: relative;
    z-index: 10;
    color: #f8fafc;
    padding: 0.625rem 0;
    font-size: 0.85rem;
    outline: none;
    text-align: center;
    letter-spacing: 1px;
  }

  .nisit-filter-box input::placeholder {
    color: #64748b;
    font-size: 0.75rem;
  }

  .filter-dropdown-logs {
    position: relative;
    z-index: 150; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .filter-trigger-logs {
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f8fafc;
    padding: 0.625rem 1rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
    white-space: nowrap;
    min-width: 160px;
    justify-content: space-between; /* ‚Üê ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .filter-trigger-logs svg:first-child {
    flex-shrink: 0; /* ‚Üê icon ‡πÅ‡∏£‡∏Å‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠ */
  }

  .filter-trigger-logs span {
    flex: 1; /* ‚Üê ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏¢‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà */
    text-align: left; /* ‚Üê ‡∏à‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏¥‡∏î‡∏ã‡πâ‡∏≤‡∏¢ */
  }

  .filter-trigger-logs .chevron {
    flex-shrink: 0; /* ‚Üê ‡∏•‡∏π‡∏Å‡∏®‡∏£‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠ */
    margin-left: auto; /* ‚Üê ‡∏ú‡∏•‡∏±‡∏Å‡πÑ‡∏õ‡∏ó‡πâ‡∏≤‡∏¢ */
  }

  .filter-trigger-logs:hover {
    border-color: #10b981;
  }

  .filter-menu-logs {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.5rem;
    min-width: 200px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 200; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å 100 ‡πÄ‡∏õ‡πá‡∏ô 200 */
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .filter-option-logs {
    width: 100%;
    background: transparent;
    border: none;
    color: #94a3b8;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-option-logs:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #f8fafc;
  }

  .filter-option-logs.selected {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    font-weight: 500;
  }

  .date-input-group-logs {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex: 0 0 auto;
  }

  .date-input-group-logs label {
    color: #94a3b8;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .custom-date-dropdown-logs {
    position: relative;
    z-index: 150;
  }

  .custom-date-trigger-logs {
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f8fafc;
    padding: 0.625rem 0.875rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    white-space: nowrap;
    min-width: 140px;
    max-width: 180px;
    justify-content: space-between;
    position: relative;
    z-index: 150;
  }

  .custom-date-trigger-logs svg:first-child {
    flex-shrink: 0;
  }

  .custom-date-trigger-logs span {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    text-align: left;
  }

  .custom-date-trigger-logs .chevron {
    flex-shrink: 0;
    margin-left: auto;
  }

  .custom-date-trigger-logs:hover {
    border-color: #10b981;
  }

  .custom-date-menu-logs {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.5rem;
    min-width: 220px;
    max-height: 250px;
    overflow-y: auto;
    z-index: 999;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .date-option-logs {
    width: 100%;
    background: transparent;
    border: none;
    color: #94a3b8;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .date-option-logs:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #f8fafc;
  }

  .date-option-logs.selected {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    font-weight: 500;
  }

  .btn-apply-logs,
  .btn-reset-logs {
    padding: 0.625rem 1.25rem;
    border-radius: 10px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border: none;
    white-space: nowrap;
  }

  .btn-apply-logs {
    background: #10b981;
    color: white;
  }

  .btn-apply-logs:hover {
    background: #059669;
  }

  .btn-reset-logs {
    background: transparent;
    border: 1px solid rgba(239, 68, 68, 0.4);
    color: #ef4444;
  }

  .btn-reset-logs:hover {
    background: rgba(239, 68, 68, 0.1);
    border-color: #ef4444;
  }

  .chevron {
    transition: transform 0.2s;
  }

  .chevron.rotated {
    transform: rotate(180deg);
  }

  .dropdown-menu-logs {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.5rem;
    min-width: 200px;
    max-height: 300px;
    overflow-y: auto;
    z-index: 100;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
  }

  .dropdown-item-logs {
    width: 100%;
    background: transparent;
    border: none;
    color: #94a3b8;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .dropdown-item-logs:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #f8fafc;
  }

  .dropdown-item-logs.selected {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    font-weight: 500;
  }

  /* Date Range - ‡∏ò‡∏µ‡∏°‡πÉ‡∏´‡∏°‡πà */
  .date-range-row-logs {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
  }

  .date-input-group-logs {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .date-input-group-logs label {
    color: #94a3b8;
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
  }

  .custom-date-trigger-logs {
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f8fafc;
    padding: 0.625rem 0.875rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.2s;
    white-space: nowrap;
    min-width: 180px;
  }

  .custom-date-trigger-logs:hover {
    border-color: #10b981;
  }

  .date-option-logs {
    width: 100%;
    background: transparent;
    border: none;
    color: #94a3b8;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .date-option-logs:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #f8fafc;
  }

  .date-option-logs.selected {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    font-weight: 500;
  }

  .btn-apply-logs {
    background: #10b981;
    border: none;
    color: white;
    padding: 0.625rem 1.125rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .btn-apply-logs:hover {
    background: #059669;
    transform: scale(1.02);
  }

  .btn-reset-logs {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    padding: 0.625rem 1.125rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.875rem;
    font-weight: 600;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .btn-reset-logs:hover {
    background: #ef4444;
    color: white;
  }

  /* Logs Grid Cards */
  .logs-grid-container {
    margin-top: 1.5rem;
  }

  .log-grid-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    cursor: pointer;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    gap: 0.875rem;
  }

  .log-grid-card:hover {
    border-color: rgba(16, 185, 129, 0.3);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  .log-grid-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 0.75rem;
  }

  .log-action-badge {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 0.875rem;
    border-radius: 10px;
    border: 1px solid;
    font-size: 0.85rem;
    font-weight: 600;
    flex: 1;
  }

  .log-status-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    white-space: nowrap;
  }

  .log-grid-user {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 10px;
  }

  .log-user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid rgba(16, 185, 129, 0.2);
    flex-shrink: 0;
  }

  .log-user-details {
    flex: 1;
    min-width: 0;
  }

  .log-user-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: #f8fafc;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .log-user-email {
    font-size: 0.8rem;
    color: #94a3b8;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .log-grid-timestamp {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: #94a3b8;
  }

  .log-grid-details {
    background: rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 0.75rem;
    font-size: 0.85rem;
    color: #cbd5e1;
    line-height: 1.5;
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .stats-dashboard-single-row {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 768px) {
    .stats-dashboard-single-row {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.625rem;
    }

    .stat-card-compact {
      padding: 0.875rem;
      flex-direction: column;
      text-align: center;
    }

    .stat-icon-compact {
      width: 36px;
      height: 36px;
    }

    .stat-value-compact {
      font-size: 1.25rem;
    }

    .stat-label-compact {
      font-size: 0.7rem;
    }

    .logs-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .ce-tier-body {
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .logs-action-buttons {
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr; /* 2 columns */
      gap: 0.5rem;
    }

    .realtime-controls {
      grid-column: 1 / 2;
      display: flex;
      gap: 0.5rem;
      justify-content: flex-start;
    }

    .btn-timeline,
    .btn-export {
      grid-column: 2 / 3;
      grid-row: 1;
      width: 100%;
    }

    .timeline-modal-container {
      width: 95%;
      max-height: 90vh;
    }

    .timeline-modal-body {
      padding: 1rem;
    }

    .timeline-item {
      padding-left: 2rem;
      padding-bottom: 1.5rem;
    }

    /* ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏∏‡πà‡∏° */
    .btn-new-logs,
    .btn-auto-refresh,
    .btn-timeline,
    .btn-export {
      padding: 0.5rem 0.75rem;
      font-size: 0.8rem;
    }

    /* ‚úÖ Fix Timeline Modal z-index */
    .modal-overlay {
      z-index: 99999 !important;
    }

    .timeline-modal-container {
      width: 95%;
      max-height: 90vh;
    }
  }

  @media (max-width: 480px) {
    .stats-dashboard-single-row {
      grid-template-columns: repeat(2, 1fr);
    }

    .stat-value-compact {
      font-size: 1.125rem;
    }

    .stat-label-compact {
      font-size: 0.65rem;
    }

    .logs-action-buttons {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .realtime-controls,
    .btn-timeline,
    .export-dropdown-wrapper {
      grid-column: 1 / 2;
      width: 100%;
    }

    .realtime-controls {
      justify-content: space-between;
    }

    .btn-new-logs {
      flex: 1;
    }
  }

  /* Logs Detail Header */

  .logs-header {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
  }

  .btn-back-logs {
    background: rgba(100, 116, 139, 0.2);
    border: 1px solid rgba(100, 116, 139, 0.3);
    color: #94a3b8;
    padding: 0.625rem 1rem;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
    flex-shrink: 0;
  }

  .btn-back-logs:hover {
    background: rgba(100, 116, 139, 0.3);
    border-color: #64748b;
    color: #f8fafc;
    transform: translateX(-2px);
  }

  .selected-event-info {
    flex: 1;
  }

  .selected-event-info h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0 0 0.5rem 0;
  }

  .event-meta-small {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.85rem;
    color: #94a3b8;
    align-items: center;
  }

  .status-dot {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
    text-transform: uppercase;
  }

  .status-dot.active {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
  }

  .btn-create-first {
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    color: white;
    padding: 0.875rem 1.75rem;
    border-radius: 12px;
    display: inline-flex;
    align-items: center;
    gap: 0.625rem;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 600;
    margin-top: 1.5rem;
    transition: all 0.3s;
    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
  }

  .btn-create-first:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  @keyframes bounceIn {
    0% {
      opacity: 0;
      transform: translateY(30px) scale(0.95);
    }
    50% {
      transform: translateY(-5px) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  /* ‡πÉ‡∏™‡πà animation ‡πÉ‡∏´‡πâ grid ‡∏ó‡∏±‡πâ‡∏á‡∏Å‡πâ‡∏≠‡∏ô */
  .grid,
  .events-selection .grid {
    animation: bounceIn 0.5s ease-out;
  }

  /* ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•‡∏Å‡∏ß‡πà‡∏≤ */
  @keyframes smoothBounce {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    70% {
      transform: translateY(-3px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .grid,
  .events-selection .grid {
    animation: smoothBounce 0.4s ease-out;
  }

  /* Statistics Dashboard */
  .stats-dashboard {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    transition: all 0.3s;
  }

  .stat-card:hover {
    border-color: rgba(16, 185, 129, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .stat-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .stat-info {
    flex: 1;
  }

  .stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: #f8fafc;
    line-height: 1;
    margin-bottom: 0.25rem;
  }

  .stat-label {
    font-size: 0.85rem;
    color: #94a3b8;
  }

  /* Filter Section */
  .filter-section {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    margin-bottom: 2rem;
  }

  .filter-row {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  .search-box {
    position: relative;
    flex: 1;
    min-width: 250px;
    display: flex;
    align-items: center;
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0 1rem;
  }

  .search-box:focus-within {
    border-color: #10b981;
  }

  .search-icon {
    width: 18px;
    height: 18px;
    color: #94a3b8;
    margin-right: 0.75rem;
  }

  .filter-dropdown {
    position: relative;
  }

  .filter-trigger {
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f8fafc;
    padding: 0.75rem 1rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .filter-trigger:hover {
    border-color: #10b981;
  }

  .chevron {
    transition: transform 0.2s;
  }

  .chevron.rotated {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    width: 100%;
    max-height: 240px;
    overflow-y: auto;
    background: rgba(31, 41, 55, 0.98);
    border: 2px solid #374151;
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    /* z-index: 100;  <-- ‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏≤‡∏à‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ */
    z-index: 9999; /* <-- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î */
    backdrop-filter: blur(10px);
  }

  .dropdown-item {
    width: 100%;
    background: transparent;
    border: none;
    color: #94a3b8;
    padding: 0.625rem 0.75rem;
    border-radius: 8px;
    text-align: left;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .dropdown-item:hover {
    background: rgba(255, 255, 255, 0.05);
    color: #f8fafc;
  }

  .dropdown-item.selected {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
    font-weight: 500;
  }

  .btn-apply {
    background: #10b981;
    border: none;
    color: white;
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
  }

  .btn-apply:hover {
    background: #059669;
    transform: scale(1.02);
  }

  .btn-reset {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
    padding: 0.75rem 1.25rem;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-size: 0.9rem;
    font-weight: 600;
    transition: all 0.2s;
  }

  .btn-reset:hover {
    background: #ef4444;
    color: white;
  }

  .date-range-row {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .date-input-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .date-input-group :global(label) {
    color: #94a3b8;
    font-size: 0.875rem;
    font-weight: 500;
  }

  .date-input-group :global(input) {
    background: #0f172a;
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: #f8fafc;
    padding: 0.5rem 0.75rem;
    border-radius: 8px;
    font-size: 0.875rem;
    outline: none;
  }

  .date-input-group :global(input:focus) {
    border-color: #3b82f6;
    box-shadow: 0 0 0 1px #3b82f6;
  }

  /* Loading & Error States */
  .loading-state,
  .error-state {
    text-align: center;
    padding: 3rem;
    color: #94a3b8;
  }

  .spinner {
    width: 48px;
    height: 48px;
    border: 4px solid rgba(16, 185, 129, 0.1);
    border-top-color: #10b981;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  .error-state svg {
    margin: 0 auto 1rem;
  }

  .btn-retry {
    background: #10b981;
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    cursor: pointer;
    font-weight: 600;
    margin-top: 1rem;
    transition: all 0.2s;
  }

  .btn-retry:hover {
    background: #059669;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    color: #64748b;
  }

  .empty-state svg {
    margin: 0 auto 1rem;
  }

  .empty-state p {
    font-size: 1.25rem;
    font-weight: 600;
    color: #94a3b8;
    margin-bottom: 0.5rem;
  }

  .empty-state span {
    font-size: 0.9rem;
    color: #64748b;
  }

  /* Logs List */
  .logs-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .log-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
  }

  .log-card:hover {
    border-color: rgba(16, 185, 129, 0.3);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  }

  .log-card:hover :global(.log-arrow) {
    opacity: 1;
    transform: translateX(0);
  }

  .log-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
  }

  .log-action {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .logs-list-container {
    margin-top: 1.5rem;
    position: relative;
    z-index: 1; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }
  .logs-grid-2col {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1rem;
    position: relative;
    z-index: 1; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .log-list-card {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.25rem;
    display: flex;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    z-index: 1; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ô‡∏µ‡πâ */
  }

  .log-list-card:hover {
    border-color: rgba(16, 185, 129, 0.3);
    transform: translateY(-3px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  /* Avatar Circle */
  .log-avatar-circle {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.125rem;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  /* Content */
  .log-list-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    min-width: 0;
  }

  /* Header */
  .log-list-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 0.75rem;
  }

  .log-user-info {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
    min-width: 0;
  }

  .log-user-name {
    font-size: 1rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .log-user-id {
    font-size: 0.75rem;
    color: #64748b;
    font-weight: 500;
  }

  .log-user-details {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 4px;
    font-size: 0.75rem;
    color: #64748b;
    font-weight: 500;
  }

  .log-user-nisit {
    display: inline-flex;
    align-items: center;
    color: #22d3ee;
    font-weight: 600;
    background: rgba(34, 211, 238, 0.1);
    padding: 2px 8px;
    border-radius: 6px;
  }

  .log-separator {
    color: #475569;
    margin: 0 4px;
  }

  .log-user-email {
    color: #94a3b8;
  }

  .log-status-badge-compact {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.375rem 0.75rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1.5px solid;
    white-space: nowrap;
    transition: all 0.2s;
  }

  .clickable-badge {
    cursor: pointer;
    user-select: none;
  }

  .clickable-badge:hover {
    transform: scale(1.05) translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    filter: brightness(1.2);
  }

  .clickable-badge:active {
    transform: scale(0.98);
  }
  .log-details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.625rem;
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.2);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .log-detail-item {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .log-detail-label {
    font-size: 0.7rem;
    color: #64748b;
    font-weight: 500;
  }

  .log-detail-value {
    font-size: 0.8rem;
    color: #f8fafc;
    font-weight: 500;
  }

  .log-code {
    color: #06b6d4;
    font-weight: 700;
    font-family: "Courier New", monospace;
  }

  /* Proof Link Button */
  .log-proof-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #06b6d4;
    font-size: 0.8rem;
    font-weight: 600;
    padding: 0.5rem 0.75rem;
    background: rgba(6, 182, 212, 0.1);
    border: 1px solid rgba(6, 182, 212, 0.3);
    border-radius: 8px;
    width: fit-content;
    cursor: pointer;
    transition: all 0.2s;
  }

  .log-proof-link:hover {
    background: rgba(6, 182, 212, 0.2);
    transform: translateX(2px);
  }

  .log-proof-link svg {
    flex-shrink: 0;
  }

  /* Cancellation Reason */
  .log-cancellation-reason {
    padding: 0.625rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
  }

  .log-cancellation-reason strong {
    display: block;
    color: #ef4444;
    font-size: 0.75rem;
    margin-bottom: 0.375rem;
  }

  .log-cancellation-reason p {
    margin: 0;
    color: #fca5a5;
    font-size: 0.8rem;
  }

  /* Footer */
  .log-list-footer {
    padding-top: 0.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.05);
  }

  .log-last-updated {
    font-size: 0.7rem;
    color: #64748b;
  }

  /* ========================================== */
  /* ‚úÖ RESPONSIVE */
  /* ========================================== */

  @media (max-width: 1200px) {
    .stats-dashboard-single-row {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (max-width: 768px) {
    .stats-dashboard-single-row {
      grid-template-columns: repeat(2, 1fr);
    }

    .logs-grid-2col {
      grid-template-columns: 1fr;
    }

    .log-details-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .stat-value-compact {
      font-size: 1.125rem;
    }

    .stat-label-compact {
      font-size: 0.65rem;
    }

    .log-list-card {
      padding: 1rem;
    }

    .log-avatar-circle {
      width: 44px;
      height: 44px;
      font-size: 1rem;
    }
  }

  @media (max-width: 480px) {
    .log-list-card {
      padding: 1rem;
    }

    .log-avatar-circle {
      width: 44px;
      height: 44px;
      font-size: 1rem;
    }

    .log-user-name {
      font-size: 1rem;
    }

    .log-detail-label {
      font-size: 0.7rem;
    }

    .log-detail-value {
      font-size: 0.8rem;
    }
  }

  .action-icon {
    font-size: 1.25rem;
  }

  .action-label {
    font-size: 0.95rem;
    font-weight: 600;
    color: #f8fafc;
  }

  .log-status {
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.375rem;
  }

  .log-body {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.75rem;
  }

  .user-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid rgba(16, 185, 129, 0.2);
  }

  .user-details {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .user-name {
    font-size: 0.9rem;
    font-weight: 600;
    color: #f8fafc;
  }

  .user-email {
    font-size: 0.8rem;
    color: #94a3b8;
  }

  .log-timestamp {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    font-size: 0.8rem;
    color: #94a3b8;
  }

  .log-timestamp svg {
    flex-shrink: 0;
  }

  .log-details {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 0.75rem;
    font-size: 0.85rem;
    color: #94a3b8;
    line-height: 1.5;
  }

  .log-arrow {
    position: absolute;
    right: 1.25rem;
    top: 50%;
    transform: translate(10px, -50%);
    opacity: 0;
    transition: all 0.3s;
    color: #10b981;
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1.5rem;
    margin-top: 2rem;
  }

  .page-info {
    font-size: 0.9rem;
    color: #94a3b8;
  }

  .page-current,
  .page-total {
    font-weight: 700;
    color: #10b981;
  }

  .page-divider {
    margin: 0 0.5rem;
    color: #475569;
  }

  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.85);
    backdrop-filter: blur(10px);
    z-index: 99999 !important;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1rem;
  }

  .modal-container {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .modal-header h3 {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .modal-close {
    background: transparent;
    border: none;
    color: #94a3b8;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 8px;
    transition: all 0.2s;
  }

  .modal-close:hover {
    background: rgba(239, 68, 68, 0.1);
    color: #ef4444;
  }

  .modal-body {
    padding: 1.5rem;
  }

  .detail-section {
    margin-bottom: 1.5rem;
  }

  .detail-section:last-child {
    margin-bottom: 0;
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border: 1px solid;
    white-space: nowrap;
  }

  .status-badge.status-active {
    background: rgba(16, 185, 129, 0.15);
    border-color: rgba(16, 185, 129, 0.4);
    color: #10b981;
  }

  .status-badge.status-closed {
    background: rgba(239, 68, 68, 0.15);
    border-color: rgba(239, 68, 68, 0.4);
    color: #ef4444;
  }

  .section-title {
    font-size: 0.95rem;
    font-weight: 600;
    color: #f8fafc;
    margin-bottom: 1rem;
  }

  .detail-grid {
    display: grid;
    gap: 0.75rem;
  }

  .detail-item {
    display: grid;
    grid-template-columns: 140px 1fr;
    gap: 1rem;
    padding: 0.75rem;
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 8px;
  }

  .detail-label {
    font-size: 0.85rem;
    color: #94a3b8;
    font-weight: 500;
  }

  .detail-value {
    font-size: 0.85rem;
    color: #f8fafc;
    word-break: break-word;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .stats-dashboard {
      grid-template-columns: repeat(2, 1fr);
    }

    .filter-row {
      flex-direction: column;
    }

    .search-box {
      width: 100%;
      min-width: 100%;
    }

    .filter-dropdown,
    .btn-apply,
    .btn-reset {
      width: 100%;
    }

    .filter-trigger {
      width: 100%;
      justify-content: space-between;
    }

    .log-card {
      padding: 1rem;
    }

    .log-body {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.75rem;
    }

    .pagination {
      flex-direction: column;
      gap: 1rem;
    }

    .page-btn {
      width: 100%;
      justify-content: center;
    }

    .detail-item {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }
    .events-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö .grid */
    }

    .view-title + * {
      margin-top: 0 !important;
    }

    /* ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏à‡∏≤‡∏∞‡∏à‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞ class */
    .events-grid {
      margin-top: 0;
    }

    .view-title ~ :global(.grid),
    .view-title ~ :global(.events-grid),
    .view-title ~ :global(.events-selection .grid) {
      margin-top: 1.5rem !important;
    }

    /* ‡∏•‡∏ö margin-top ‡∏Ç‡∏≠‡∏á element ‡πÅ‡∏£‡∏Å‡∏´‡∏•‡∏±‡∏á view-title */
    .view-title + *:not(.filter-slide-wrapper) {
      margin-top: 1.5rem;
    }

    .grid {
      margin-top: 0;
    }

    .events-selection {
      margin-top: 0;
    }

    .logs-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 1rem;
    }

    .btn-back-logs {
      width: 100%;
      justify-content: center;
    }

    .stats-dashboard {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .stats-dashboard {
      grid-template-columns: 1fr;
    }

    .stat-value {
      font-size: 1.5rem;
    }

    .modal-container {
      max-height: 95vh;
    }
  }

  /* ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î (‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó) */
  :global(.modal-close-btn) {
    color: #fff !important;
    background: rgba(0, 0, 0, 0.3) !important;
    border-radius: 50%;
    width: 30px !important;
    height: 30px !important;
    display: flex !important;
    align-items: center;
    justify-content: center;
    top: 10px !important;
    right: auto !important;
    left: 10px !important;
  }

  @media (max-width: 1024px) {
    .desktop-only {
      display: none !important;
    }
    .mobile-only {
      display: flex;
    }
    .mobile-controls.mobile-only {
      display: flex !important;
    }
    .mobile-toggle {
      display: block;
    }
    .header-inner {
      padding: 0 1rem;
    }
    .page-content {
      padding: 2rem 1rem;
    }
  }

  @media (max-width: 768px) {
    /* MOBILE FILTER */
    .filter-bar {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 16px;
    }
    .search-input-wrapper {
      width: 100%;
    }
    .filter-actions-wrapper {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      width: 100%;
    }
    .filter-group-dropdowns {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .search-apply-btn {
      width: 100%;
    }

    .token-timer {
      font-size: 0.75rem;
      padding: 4px 10px;
    }

    /* MOBILE SWAL ADJUST */
    :global(div:where(.swal2-container) div:where(.swal2-popup)) {
      width: 85% !important;
      font-size: 0.9rem !important;
      padding: 1.5rem !important;
    }

    /* 1. ‡∏à‡∏±‡∏î‡∏õ‡∏∏‡πà‡∏° Holidays ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏á‡∏°‡∏≤‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏µ‡∏¢‡∏î‡∏Å‡∏±‡∏ô) */
    .ce-holiday-buttons {
      grid-template-columns: 1fr; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å 1fr 1fr ‡πÄ‡∏õ‡πá‡∏ô 1fr */
      gap: 10px;
    }

    /* 2. ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡∏∞ padding */
    .ce-check-row {
      padding: 12px; /* ‡∏•‡∏î‡∏à‡∏≤‡∏Å 14px */
      gap: 12px;
    }

    /* 3. ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î checkbox ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
    .ce-check-row input {
      width: 18px;
      height: 18px;
    }

    /* 4. ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
    .ce-check-title {
      font-size: 0.9rem; /* ‡∏•‡∏î‡∏à‡∏≤‡∏Å 0.95rem */
      line-height: 1.3;
    }

    .ce-check-desc {
      font-size: 0.75rem; /* ‡∏•‡∏î‡∏à‡∏≤‡∏Å 0.8rem */
      line-height: 1.4;
      margin-top: 3px;
    }

    /* 5. ‡∏õ‡∏£‡∏±‡∏ö Lock Overlay */
    .ce-lock-overlay {
      padding: 0 20px;
      text-align: center;
    }

    .ce-lock-overlay span {
      font-size: 0.85rem;
    }

    .ce-lock-icon-svg {
      width: 40px;
      height: 40px;
    }
  }

  /* ==========================================
   üéÅ REWARD PAGE STYLES
   ========================================== */

  .reward-events-section,
  .reward-users-section {
    width: 100%;
  }

  .reward-search-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .search-box-reward {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.75rem 1rem;
    flex: 1;
    min-width: 250px;
  }

  .search-box-reward :global(input) {
    background: transparent;
    border: none;
    outline: none;
    color: #f8fafc;
    font-size: 0.9rem;
    width: 100%;
  }

  .search-box-reward :global(input::placeholder) {
    color: #64748b;
  }

  .search-box-reward svg {
    color: #64748b;
    flex-shrink: 0;
  }

  .filter-dropdown-reward {
    position: relative;
  }

  .filter-trigger-reward {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.75rem 1rem;
    color: #94a3b8;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    min-width: 120px;
  }

  .filter-trigger-reward:hover {
    border-color: rgba(16, 185, 129, 0.3);
    color: #10b981;
  }

  .filter-menu-reward {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    padding: 0.5rem;
    min-width: 150px;
    max-height: 250px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  }

  .filter-option-reward {
    display: block;
    width: 100%;
    padding: 0.6rem 0.75rem;
    background: transparent;
    border: none;
    border-radius: 8px;
    color: #94a3b8;
    font-size: 0.85rem;
    text-align: left;
    cursor: pointer;
    transition: all 0.2s;
  }

  .filter-option-reward:hover,
  .filter-option-reward.active {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }

  /* Reward Header */
  .reward-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .btn-back-reward {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(100, 116, 139, 0.1);
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 10px;
    padding: 0.6rem 1rem;
    color: #94a3b8;
    font-size: 0.85rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-back-reward:hover {
    background: rgba(100, 116, 139, 0.2);
    color: #f8fafc;
  }

  .reward-event-info :global(h3) {
    font-size: 1.25rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0 0 0.5rem 0;
  }

  .reward-event-meta {
    display: flex;
    gap: 1rem;
    color: #64748b;
    font-size: 0.85rem;
  }

  .reward-event-meta span {
    display: flex;
    align-items: center;
    gap: 0.35rem;
  }

  /* Tier Summary Cards */
  .tier-summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .tier-summary-card {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(30, 41, 59, 0.5);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: left;
  }

  .tier-summary-card:hover {
    transform: translateY(-2px);
  }

  .tier-summary-card.active {
    border-width: 2px;
  }

  .tier-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    font-weight: 700;
    color: #1e293b;
    flex-shrink: 0;
  }

  .tier-info {
    flex: 1;
  }

  .tier-name {
    font-size: 0.95rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .tier-progress {
    font-size: 0.8rem;
    color: #64748b;
  }

  .tier-requirement {
    font-size: 0.75rem;
    color: #64748b;
  }

  .tier-all {
    background: rgba(100, 116, 139, 0.1);
    border-color: rgba(100, 116, 139, 0.3);
  }

  /* Filter Section */
  .reward-filter-section {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .btn-apply-reward,
  .btn-reset-reward {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-apply-reward {
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    color: white;
  }

  .btn-apply-reward:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .btn-reset-reward {
    background: transparent;
    border: 1px solid rgba(239, 68, 68, 0.5);
    color: #ef4444;
  }

  .btn-reset-reward:hover {
    background: rgba(239, 68, 68, 0.1);
  }

  /* Reward Users Grid */
  .reward-users-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 1.5rem;
  }

  .reward-user-card {
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 16px;
    padding: 1.5rem;
    position: relative;
    transition: all 0.3s;
  }

  .reward-user-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border-color: rgba(16, 185, 129, 0.3);
  }

  .reward-rank-badge {
    position: absolute;
    top: -10px;
    left: 20px;
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
    color: #1e293b;
  }

  .reward-user-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.25rem;
    padding-top: 0.5rem;
  }

  .reward-user-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid rgba(255, 255, 255, 0.1);
  }

  .reward-user-avatar :global(img) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .reward-user-info {
    flex: 1;
  }

  .reward-user-info :global(h4) {
    font-size: 1rem;
    font-weight: 600;
    color: #f8fafc;
    margin: 0 0 0.25rem 0;
  }

  .reward-user-id {
    font-size: 0.8rem;
    color: #64748b;
  }

  .reward-tier-badge {
    padding: 0.35rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    border: 1px solid;
  }

  /* Progress */
  .reward-progress-section {
    margin-bottom: 1.25rem;
  }

  .reward-progress-label {
    display: flex;
    justify-content: space-between;
    font-size: 0.8rem;
    color: #94a3b8;
    margin-bottom: 0.5rem;
  }

  .reward-progress-bar {
    height: 8px;
    background: rgba(100, 116, 139, 0.2);
    border-radius: 10px;
    overflow: hidden;
  }

  .reward-progress-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 0.5s ease;
  }

  /* Details */
  .reward-details-grid {
    display: grid;
    gap: 0.75rem;
    margin-bottom: 1.25rem;
  }

  .reward-detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.6rem 0.75rem;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 8px;
  }

  .reward-detail-label {
    font-size: 0.8rem;
    color: #64748b;
  }

  .reward-detail-value {
    font-size: 0.85rem;
    color: #f8fafc;
    font-weight: 500;
  }

  .reward-status-badge {
    padding: 0.25rem 0.6rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .reward-status-badge.completed {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
  }

  .reward-status-badge.in-progress {
    background: rgba(245, 158, 11, 0.15);
    color: #f59e0b;
  }

  .reward-status-badge.not-started {
    background: rgba(100, 116, 139, 0.15);
    color: #64748b;
  }

  /* Actions */
  .reward-actions {
    display: flex;
    gap: 0.75rem;
  }

  .btn-message {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.7rem 1rem;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: 10px;
    color: #3b82f6;
    font-size: 0.85rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-message:hover {
    background: rgba(59, 130, 246, 0.2);
    transform: translateY(-2px);
  }

  .btn-view-reward {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    padding: 0.75rem;
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 1rem;
  }

  .btn-view-reward:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  /* Message Modal */
  .message-modal-container {
    background: #1e293b;
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 20px;
    max-width: 500px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
  }

  .message-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .message-modal-header :global(h3) {
    font-size: 1.1rem;
    font-weight: 700;
    color: #f8fafc;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .message-modal-body {
    padding: 1.5rem;
  }

  .message-recipient {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    background: rgba(15, 23, 42, 0.5);
    border-radius: 12px;
    margin-bottom: 1.5rem;
  }

  .message-recipient :global(img) {
    width: 50px;
    height: 50px;
    border-radius: 50%;
  }

  .message-recipient :global(h4) {
    font-size: 1rem;
    font-weight: 600;
    color: #f8fafc;
    margin: 0 0 0.25rem 0;
  }

  .message-recipient span {
    font-size: 0.85rem;
    color: #64748b;
  }

  .message-input-group {
    margin-bottom: 1rem;
  }

  .message-input-group :global(label) {
    display: block;
    font-size: 0.9rem;
    font-weight: 500;
    color: #94a3b8;
    margin-bottom: 0.5rem;
  }

  .message-input-group :global(textarea) {
    width: 100%;
    padding: 1rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: #f8fafc;
    font-size: 0.9rem;
    resize: vertical;
    min-height: 120px;
  }

  .message-input-group :global(textarea:focus) {
    outline: none;
    border-color: rgba(16, 185, 129, 0.5);
  }

  .message-input-group :global(textarea::placeholder) {
    color: #64748b;
  }

  .message-modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 1rem;
    padding: 1.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
  }

  .btn-cancel {
    padding: 0.7rem 1.5rem;
    background: transparent;
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 10px;
    color: #94a3b8;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-cancel:hover {
    background: rgba(100, 116, 139, 0.1);
  }

  .btn-send {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.7rem 1.5rem;
    background: linear-gradient(135deg, #10b981, #059669);
    border: none;
    border-radius: 10px;
    color: white;
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-send:hover:not(:disabled) {
    background: rgba(16, 185, 129, 0.2);
    border-color: #10b981;
    transform: translateY(-2px);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .reward-search-bar {
      flex-direction: column;
    }

    .filter-dropdown-reward {
      width: 100%;
    }

    .filter-trigger-reward {
      width: 100%;
      justify-content: space-between;
    }

    .tier-summary-grid {
      grid-template-columns: 1fr;
    }

    .reward-users-grid {
      grid-template-columns: 1fr;
    }

    .reward-header {
      flex-direction: column;
      align-items: flex-start;
    }

    .reward-filter-section {
      flex-direction: column;
    }

    .btn-apply-reward,
    .btn-reset-reward {
      width: 100%;
      justify-content: center;
    }

    .perf-monitor {
      display: none;
    }
    .perf-graph {
      width: 40px;
      height: 20px;
    }
    .perf-stats {
      gap: 4px;
    }
    .perf-latency {
      font-size: 0.7rem;
      min-width: 36px;
    }
    .perf-status-dot {
      width: 6px;
      height: 6px;
    }
    .perf-tooltip {
      width: 200px;
      right: -20px;
    }
  }

  /* ===== VERIFY PROOF STYLES ===== */

  /* Pending Badge on Event Card */
  .pending-badge-overlay {
    position: absolute;
    top: 12px;
    right: 12px;
    background: #f59e0b;
    color: #000;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    z-index: 5;
  }

  .verify-proof-submissions-section {
    margin-top: 1.5rem;
  }

  /* ===== FILTER STYLES ===== */

  .nisit-filter-box.std-id-box {
    width: 100px;
  }

  /* Date Filter Dropdown */
  .date-filter-dropdown {
    position: relative;
    min-width: 140px;
  }

  .date-filter-trigger {
    width: 100%;
    padding: 0.65rem 1rem;
    background: rgba(15, 23, 42, 0.8);
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 8px;
    color: #f8fafc;
    font-size: 0.85rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
    transition: all 0.2s;
  }

  .date-filter-trigger:hover {
    border-color: rgba(71, 85, 105, 0.8);
  }

  .date-filter-trigger:focus {
    outline: none;
    border-color: #22d3ee;
  }

  .date-filter-menu {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: #1e293b;
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 8px;
    padding: 4px;
    z-index: 100;
    max-height: 200px;
    overflow-y: auto;
  }

  .date-filter-option {
    width: 100%;
    padding: 8px 12px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #94a3b8;
    font-size: 0.85rem;
    text-align: left;
    cursor: pointer;
    transition: all 0.15s;
  }

  .date-filter-option:hover {
    background: rgba(71, 85, 105, 0.3);
    color: #f8fafc;
  }

  .date-filter-option.active {
    background: rgba(34, 211, 238, 0.1);
    color: #22d3ee;
  }

  /* Reset Button */
  .btn-reset-filter {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.65rem 1rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    color: #ef4444;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .btn-reset-filter:hover {
    background: rgba(239, 68, 68, 0.2);
  }

  /* ===== PROOF CARD GRID ===== */
  .submissions-grid-new {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
    gap: 24px;
    margin-top: 20px;
  }

  /* ===== PROOF CARD ===== */
  .proof-card {
    background: #1e293b !important;
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 20px;
    overflow: hidden;
    transition: all 0.3s ease;
    padding: 24px;
    position: relative;
  }

  .proof-card:hover {
    border-color: rgba(71, 85, 105, 0.6);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
  }

  /* Rank Circle - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
  .rank-circle {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    font-weight: 700;
    color: white;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    position: absolute;
    top: 24px;
    left: 24px;
  }

  /* User Details */
  .user-details {
    width: 100%;
    padding-top: 60px;
  }

  .user-details .user-name {
    font-size: 18px;
    font-weight: 600;
    color: #f8fafc;
    margin: 0 0 8px 0;
  }

  .user-details .user-meta {
    display: flex;
    align-items: center;
    gap: 8px;
    margin: 0 0 8px 0;
    font-size: 14px;
    flex-wrap: wrap;
  }

  .user-meta .nisit-id {
    color: #10b981;
    font-family: "SF Mono", "Monaco", "Consolas", monospace;
    font-weight: 500;
  }

  .user-meta .separator {
    color: #475569;
  }

  .user-meta .user-email {
    color: #94a3b8;
  }

  .user-details .status-text {
    font-size: 14px;
    color: #64748b;
    margin: 0;
  }

  /* Proof Image Box */
  .proof-image-box {
    width: 100%;
    height: 220px;
    background: #0f172a;
    position: relative;
    cursor: pointer;
    overflow: hidden;
    border-radius: 12px;
    margin: 20px 0;
  }

  .proof-image-box img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .proof-card:hover .proof-image-box img {
    transform: scale(1.05);
  }

  .image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 8px;
    opacity: 0;
    transition: opacity 0.3s ease;
    color: white;
    font-size: 14px;
    border-radius: 12px;
  }

  .proof-image-box:hover .image-overlay {
    opacity: 1;
  }

  .no-image-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: #475569;
    background: #0f172a;
    border-radius: 12px;
  }

  .no-image-placeholder span {
    font-size: 14px;
  }

  /* Action Buttons */
  .proof-card-actions {
    display: flex;
    gap: 12px;
    padding: 0;
  }

  .btn-reject,
  .btn-approve {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 14px 20px;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .btn-reject {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.4);
    color: #f87171;
  }

  .btn-reject:hover {
    background: rgba(239, 68, 68, 0.2);
    border-color: #ef4444;
    transform: translateY(-2px);
  }

  .btn-approve {
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    color: white;
  }

  .btn-approve:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(16, 185, 129, 0.4);
  }

  /* ===== PAGINATION ===== */
  .pagination-wrapper {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    margin-top: 24px;
    padding-top: 24px;
  }

  .page-indicator-box {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: rgba(30, 41, 59, 0.8);
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 10px;
    color: #f8fafc;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .page-indicator-box:hover {
    border-color: rgba(71, 85, 105, 0.8);
  }

  .page-indicator-box .current-page {
    font-weight: 600;
    color: #22d3ee;
  }

  .page-indicator-box .sep {
    color: #475569;
  }

  .page-indicator-box .total-page {
    color: #94a3b8;
  }

  .page-indicator-box .dropdown-arrow {
    color: #64748b;
    transition: transform 0.2s;
  }

  .page-indicator-box .dropdown-arrow.flipped {
    transform: rotate(180deg);
  }

  .page-dropdown-list {
    position: absolute;
    bottom: calc(100% + 8px);
    left: 50%;
    transform: translateX(-50%);
    background: #1e293b;
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 10px;
    padding: 6px;
    min-width: 120px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 100;
  }

  .page-dropdown-item {
    width: 100%;
    padding: 8px 12px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #94a3b8;
    font-size: 13px;
    text-align: center;
    cursor: pointer;
    transition: all 0.15s;
  }

  .page-dropdown-item:hover {
    background: rgba(71, 85, 105, 0.3);
    color: #f8fafc;
  }

  .page-dropdown-item.active {
    background: rgba(34, 211, 238, 0.1);
    color: #22d3ee;
  }

  .pagination-info {
    font-size: 13px;
    color: #64748b;
  }

  .click-outside {
    position: fixed;
    inset: 0;
    z-index: 99;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .submissions-grid-new {
      grid-template-columns: 1fr;
    }

    .proof-card {
      padding: 20px;
    }

    .rank-circle {
      width: 42px;
      height: 42px;
      font-size: 14px;
      top: 20px;
      left: 20px;
    }

    .user-details {
      padding-top: 54px;
    }

    .user-details .user-name {
      font-size: 16px;
    }

    .proof-image-box {
      height: 180px;
    }

    .btn-reject,
    .btn-approve {
      padding: 12px 16px;
      font-size: 14px;
    }
  }

  @media (max-width: 480px) {
    .proof-card {
      padding: 16px;
    }

    .rank-circle {
      width: 36px;
      height: 36px;
      font-size: 12px;
      top: 16px;
      left: 16px;
    }

    .user-details {
      padding-top: 48px;
    }

    .proof-image-box {
      height: 160px;
    }

    .proof-card-actions {
      flex-direction: column;
      gap: 8px;
    }

    .btn-reject,
    .btn-approve {
      width: 100%;
    }
  }
  /* ===== NEW VERIFY FILTER SECTION ===== */ /* ===== NEW VERIFY FILTER SECTION ===== */
  .verify-filter-section-new {
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 16px 20px;
    background: rgba(30, 41, 59, 0.5);
    border: 1px solid rgba(71, 85, 105, 0.3);
    border-radius: 12px;
    margin-bottom: 20px;
  }

  .verify-filter-row-new {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
  }

  /* Search Box */
  .verify-search-box-new {
    flex: 1;
    min-width: 280px;
    max-width: 600px;
    position: relative;
    display: flex;
    align-items: center;
  }

  .verify-search-box-new :global(.search-icon) {
    position: absolute;
    left: 14px;
    color: #64748b;
    pointer-events: none;
  }

  .verify-search-box-new :global(input) {
    width: 100%;
    padding: 10px 14px 10px 44px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 8px;
    color: #f8fafc;
    font-size: 14px;
    transition: all 0.2s;
  }

  .verify-search-box-new :global(input:focus) {
    outline: none;
    border-color: #22d3ee;
    background: rgba(15, 23, 42, 0.8);
  }

  .verify-search-box-new :global(input::placeholder) {
    color: #64748b;
  }

  /* Filter Buttons (Batch, Std ID) */
  .verify-filter-btn {
    padding: 10px 16px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 8px;
    color: #94a3b8;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .verify-filter-btn:hover {
    border-color: rgba(71, 85, 105, 0.6);
    color: #f8fafc;
  }

  .verify-filter-btn.active {
    background: rgba(34, 211, 238, 0.1);
    border-color: #22d3ee;
    color: #22d3ee;
  }

  /* Dropdown */
  .verify-dropdown-new {
    position: relative;
    min-width: 90px;
  }

  .verify-dropdown-new.date-select {
    min-width: 130px;
  }

  .verify-dropdown-trigger-new {
    width: 100%;
    padding: 10px 12px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 8px;
    color: #f8fafc;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
  }

  .verify-dropdown-trigger-new:hover {
    border-color: rgba(71, 85, 105, 0.6);
  }

  .verify-dropdown-trigger-new:focus {
    outline: none;
    border-color: #22d3ee;
  }

  .verify-dropdown-trigger-new svg {
    color: #64748b;
    flex-shrink: 0;
  }

  .verify-dropdown-trigger-new span {
    flex: 1;
    text-align: left;
  }

  .verify-dropdown-trigger-new :global(.chevron) {
    transition: transform 0.2s;
  }

  .verify-dropdown-menu-new {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: #1e293b;
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 8px;
    padding: 4px;
    z-index: 100;
    max-height: 200px;
    overflow-y: auto;
  }

  .verify-dropdown-option-new {
    width: 100%;
    padding: 10px 12px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #94a3b8;
    font-size: 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.15s;
  }

  .verify-dropdown-option-new:hover {
    background: rgba(71, 85, 105, 0.3);
    color: #f8fafc;
  }

  .verify-dropdown-option-new.active {
    background: rgba(34, 211, 238, 0.1);
    color: #22d3ee;
  }

  /* Filter Label */
  .filter-label-new {
    color: #94a3b8;
    font-size: 14px;
    white-space: nowrap;
  }

  /* Apply Button */
  .verify-btn-apply-new {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .verify-btn-apply-new:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  /* Reset Button */
  .verify-btn-reset-new {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    color: #ef4444;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .verify-btn-reset-new:hover {
    background: rgba(239, 68, 68, 0.2);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .verify-filter-row-new {
      flex-direction: column;
      align-items: stretch;
    }

    .verify-search-box-new {
      min-width: 100%;
      max-width: 100%;
    }

    .verify-dropdown-new,
    .verify-dropdown-new.date-select {
      width: 100%;
    }

    .verify-filter-btn {
      width: 100%;
      justify-content: center;
    }

    .filter-label-new {
      display: none;
    }
  }

  .verify-input-box :global(input) {
    width: 100%;
    padding: 12px 10px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 8px;
    color: #f8fafc;
    font-size: 14px;
    text-align: center;
    font-family: "Monaco", "Consolas", monospace;
    transition: all 0.2s;
  }

  .verify-input-box :global(input:focus) {
    outline: none;
    border-color: #22d3ee;
    background: rgba(15, 23, 42, 0.8);
  }

  .verify-input-box :global(input::placeholder) {
    color: #64748b;
    font-family: inherit;
  }

  /* Dropdown */
  .verify-dropdown {
    position: relative;
    min-width: 100px;
  }

  .verify-dropdown.date-select {
    min-width: 140px;
  }

  .verify-dropdown-trigger {
    width: 100%;
    padding: 10px 12px;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(71, 85, 105, 0.4);
    border-radius: 8px;
    color: #f8fafc;
    font-size: 14px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
  }

  .verify-dropdown-trigger:hover {
    border-color: rgba(71, 85, 105, 0.6);
  }

  .verify-dropdown-trigger:focus {
    outline: none;
    border-color: #22d3ee;
  }

  .verify-dropdown-trigger svg {
    color: #64748b;
    flex-shrink: 0;
  }

  .verify-dropdown-trigger span {
    flex: 1;
    text-align: left;
  }

  .verify-dropdown-trigger :global(.chevron) {
    transition: transform 0.2s;
  }

  .verify-dropdown-menu {
    position: absolute;
    top: calc(100% + 4px);
    left: 0;
    right: 0;
    background: #1e293b;
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 8px;
    padding: 4px;
    z-index: 100;
    max-height: 200px;
    overflow-y: auto;
  }

  .verify-dropdown-option {
    width: 100%;
    padding: 10px 12px;
    background: transparent;
    border: none;
    border-radius: 6px;
    color: #94a3b8;
    font-size: 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.15s;
  }

  .verify-dropdown-option:hover {
    background: rgba(71, 85, 105, 0.3);
    color: #f8fafc;
  }

  .verify-dropdown-option.active {
    background: rgba(34, 211, 238, 0.1);
    color: #22d3ee;
  }

  /* Filter Label */
  .filter-label {
    color: #94a3b8;
    font-size: 14px;
    white-space: nowrap;
  }

  /* Buttons */
  .verify-btn-apply {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .verify-btn-apply:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
  }

  .verify-btn-reset {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 10px 16px;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 8px;
    color: #ef4444;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
  }

  .verify-btn-reset:hover {
    background: rgba(239, 68, 68, 0.2);
  }

  /* Click outside overlay */
  .click-outside {
    position: fixed;
    inset: 0;
    z-index: 99;
  }

  /* ===== RESPONSIVE ===== */
  @media (max-width: 768px) {
    .verify-filter-row {
      flex-direction: column;
      align-items: stretch;
    }

    .verify-search-box {
      min-width: 100%;
    }

    .verify-input-box,
    .verify-input-box.std-id,
    .verify-dropdown,
    .verify-dropdown.date-select {
      width: 100%;
    }

    .filter-label {
      display: none;
    }

    .verify-btn-apply,
    .verify-btn-reset {
      flex: 1;
      justify-content: center;
    }
  }

  /* ===== RESPONSIVE FOR VERIFY PROOF FILTER ===== */
  @media (max-width: 768px) {
    .verify-proof-filter :global(.filter-row-logs) {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    /* ‡πÅ‡∏ñ‡∏ß 1: Search Box (100%) */
    .verify-proof-filter
      :global(.filter-row-logs:first-child .search-box-logs) {
      flex: 1 1 100%;
    }

    /* ‡πÅ‡∏ñ‡∏ß 1: Batch + Std ID (‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô 50% + 50%) */
    .verify-proof-filter
      :global(.filter-row-logs:first-child .nisit-filter-box) {
      flex: 1 1 calc(50% - 0.25rem);
    }

    /* ‡πÅ‡∏ñ‡∏ß 2: Filter (100%) */
    .verify-proof-filter
      :global(.filter-row-logs:last-child .filter-dropdown-logs) {
      flex: 1 1 100%;
      position: relative;
      z-index: 10;
    }

    .verify-proof-filter
      :global(.filter-row-logs:last-child .filter-dropdown-logs.dropdown-open) {
      z-index: 150;
    }

    /* ‡πÅ‡∏ñ‡∏ß 2: Date From + To (‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô 50% + 50%) */
    .verify-proof-filter
      :global(.filter-row-logs:last-child .date-input-group-logs) {
      flex: 1 1 calc(50% - 0.25rem);
      position: relative;
      z-index: 10;
    }

    .verify-proof-filter
      :global(
        .filter-row-logs:last-child .date-input-group-logs.dropdown-open
      ) {
      z-index: 150;
    }

    .verify-proof-filter
      :global(.filter-row-logs:last-child .custom-date-trigger-logs) {
      width: 100%;
      min-width: unset;
    }

    .verify-proof-filter
      :global(.filter-row-logs:last-child .custom-date-trigger-logs span) {
      font-size: 0.8rem;
    }

    /* ‡πÅ‡∏ñ‡∏ß 2: Buttons Apply + Reset (‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô 50% + 50%) */
    .verify-proof-filter :global(.filter-row-logs:last-child .btn-apply-logs),
    .verify-proof-filter :global(.filter-row-logs:last-child .btn-reset-logs) {
      flex: 1 1 calc(50% - 0.25rem);
      justify-content: center;
    }

    /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô dropdown ‡∏ñ‡∏π‡∏Å‡∏ã‡πâ‡∏≠‡∏ô‡∏ó‡∏±‡∏ö */
    .verify-proof-filter :global(.filter-menu-logs),
    .verify-proof-filter :global(.custom-date-menu-logs) {
      z-index: 200 !important;
      min-width: 175px;
      max-width: 250px;
    }
  }

  @media (max-width: 768px) {
    .filter-section-logs .filter-row-logs {
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 1 */
    .filter-section-logs .filter-row-logs:first-child .search-box-logs {
      flex: 1 1 100%;
    }

    .filter-section-logs .filter-row-logs:first-child .nisit-filter-box {
      flex: 1 1 calc(50% - 0.25rem);
    }

    /* ‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà 2 */
    .filter-section-logs .filter-row-logs:last-child {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .filter-section-logs .filter-row-logs:last-child .filter-dropdown-logs {
      flex: 1 1 100%;
      position: relative;
      z-index: 10;
    }

    .filter-section-logs
      .filter-row-logs:last-child
      .filter-dropdown-logs.dropdown-open {
      z-index: 150;
    }

    /* Date Inputs - ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
    .filter-section-logs .filter-row-logs:last-child .date-input-group-logs {
      flex: 1 1 calc(50% - 0.25rem);
      position: relative;
      z-index: 10;
    }

    .filter-section-logs
      .filter-row-logs:last-child
      .date-input-group-logs.dropdown-open {
      z-index: 150;
    }

    .filter-section-logs .filter-row-logs:last-child .custom-date-trigger-logs {
      width: 100%;
    }

    /* Buttons - ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô */
    .filter-section-logs .filter-row-logs:last-child .btn-apply-logs,
    .filter-section-logs .filter-row-logs:last-child .btn-reset-logs {
      flex: 1 1 calc(50% - 0.25rem);
      justify-content: center;
    }

    /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô dropdown ‡∏ó‡∏±‡∏ö‡∏Å‡∏±‡∏ô */
    .filter-section-logs .filter-menu-logs,
    .filter-section-logs .custom-date-menu-logs {
      z-index: 200 !important;
    }
  }

  /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏π‡∏Å‡∏®‡∏£‡∏ã‡πâ‡∏≤‡∏¢‡∏Ç‡∏ß‡∏≤ (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏°) */
  .page-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 8px;
    border: 1px solid #374151;
    background-color: #1f2937;
    color: #10b981;
    cursor: pointer;
    transition: all 0.2s;
  }

  /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
  .page-btn svg {
    display: block;
    width: 20px;
    height: 20px;
    color: inherit; /* ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏™‡∏µ‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏° */
  }

  .page-btn:hover:not(:disabled) {
    background-color: #374151;
  }

  .page-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    color: #333; /* ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ */
  }

  /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á */
  .page-select-wrapper {
    position: relative;
  }

  .page-indicator-box {
    display: flex;
    align-items: center;
    justify-content: space-between;
    min-width: 80px;
    height: 36px;
    padding: 0 12px;
    border-radius: 8px;
    border: 1px solid #374151;
    background-color: #1f2937; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏µ‡πÄ‡∏Ç‡πâ‡∏° */
    color: #9ca3af; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏ó‡∏≤) */
    font-size: 0.875rem;
    cursor: pointer;
  }

  /* ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πâ‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô -> ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
  .current-page {
    color: #10b981 !important; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    font-weight: 600;
  }

  .sep {
    margin: 0 4px;
    color: #4b5563;
  }

  .dropdown-arrow {
    margin-left: 6px;
    color: #6b7280;
    transition: transform 0.2s;
  }
  .dropdown-arrow.flipped {
    transform: rotate(180deg);
  }

  /* Dropdown List (‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏°) */
  .page-dropdown-list {
    position: absolute;
    bottom: 100%; /* ‡πÉ‡∏´‡πâ‡πÄ‡∏î‡πâ‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    width: 100%;
    min-width: 100px;
    background-color: #1f2937;
    border: 1px solid #374151;
    border-radius: 8px;
    padding: 4px;
    z-index: 50;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
  }

  .page-dropdown-item {
    width: 100%;
    padding: 6px 0;
    text-align: center;
    color: #d1d5db; /* ‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ô dropdown */
    background: transparent;
    border: none;
    cursor: pointer;
    border-radius: 4px;
    font-size: 0.875rem;
  }

  .page-dropdown-item:hover {
    background-color: #374151;
  }

  /* ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏¢‡∏π‡πà -> ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
  .page-dropdown-item.active {
    color: #10b981; /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
    font-weight: bold;
    background-color: rgba(16, 185, 129, 0.1); /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏à‡∏≤‡∏á‡πÜ */
  }

  .click-outside {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    z-index: 40;
  }

  /* Wrapper ‡πÄ‡∏û‡∏∑‡πà‡∏≠ scope ‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á */
  .unlock-user-component {
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
  }

  .unlock-card {
    background: #1e293b;
    border: 1px solid rgba(71, 85, 105, 0.5);
    border-radius: 20px;
    padding: 40px 32px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
  }

  .unlock-card-header {
    text-align: center;
    margin-bottom: 36px;
  }

  .unlock-icon-circle {
    width: 80px;
    height: 80px;
    margin: 0 auto 24px;
    background: rgba(16, 185, 129, 0.1);
    border: 2px solid #10b981;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #10b981;
    position: relative;
  }

  /* ‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ß‡∏á‡∏Ç‡∏¢‡∏±‡∏ö‡πÜ */
  .unlock-icon-circle::before {
    content: "";
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 2px solid #10b981;
    opacity: 0.3;
    animation: unlock-ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
  }

  @keyframes unlock-ping {
    75%,
    100% {
      transform: scale(1.3);
      opacity: 0;
    }
  }

  .unlock-main-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #ffffff;
    margin: 0 0 12px 0;
    letter-spacing: -0.02em;
  }

  .unlock-sub-title {
    font-size: 0.9rem;
    color: #94a3b8;
    line-height: 1.5;
    max-width: 340px;
    margin: 0 auto;
  }

  .unlock-form-section {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .unlock-form-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .unlock-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #cbd5e1;
    text-align: left;
  }

  .unlock-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    background: rgba(15, 23, 42, 0.5);
    border: 1px solid rgba(71, 85, 105, 0.6);
    border-radius: 10px;
    transition: all 0.2s;
    height: 50px;
    overflow: hidden;
  }

  .unlock-input-wrapper:focus-within {
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
    background: rgba(15, 23, 42, 0.8);
  }

  .unlock-input-wrapper.unlock-error {
    border-color: #ef4444 !important;
    box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
  }

  .unlock-input-wrapper input {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    color: #e2e8f0;
    font-size: 14px;
    padding: 0 16px;
    outline: none;
  }

  .unlock-input-wrapper input::placeholder {
    color: #64748b;
  }

  .unlock-input-wrapper input:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .unlock-notification {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    padding: 14px 16px;
    border-radius: 10px;
    font-size: 14px;
    text-align: center;
    line-height: 1.4;
    font-weight: 500;
  }

  .unlock-notification.unlock-error {
    background: rgba(239, 68, 68, 0.15);
    color: #fca5a5;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .unlock-notification.unlock-success {
    background: rgba(16, 185, 129, 0.15);
    color: #6ee7b7;
    border: 1px solid rgba(16, 185, 129, 0.3);
  }

  .unlock-notif-icon {
    flex-shrink: 0;
    margin-top: 1px;
  }

  .unlock-submit-btn {
    width: 100%;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
    background: #10b981;
    color: #ffffff;
    font-weight: 600;
    font-size: 15px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3);
    margin-top: 4px;
  }

  .unlock-submit-btn:hover:not(:disabled) {
    background: #059669;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
  }

  .unlock-submit-btn:active:not(:disabled) {
    transform: translateY(0);
  }

  .unlock-submit-btn:disabled {
    background: #475569;
    color: #94a3b8;
    cursor: not-allowed;
    box-shadow: none;
  }

  .unlock-spinner {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid #fff;
    border-radius: 50%;
    animation: unlock-spin 0.8s linear infinite;
  }

  @keyframes unlock-spin {
    0% {
      transform: rotate(0deg);
    }
    100% {
      transform: rotate(360deg);
    }
  }

  /* SweetAlert Dark Theme */
  :global(.unlock-swal-popup) {
    background: #1e293b !important;
    border: 1px solid rgba(71, 85, 105, 0.5) !important;
    border-radius: 20px !important;
    color: #ffffff !important;
  }

  :global(.unlock-swal-popup .swal2-title) {
    color: #ffffff !important;
  }

  :global(.unlock-swal-popup .swal2-html-container) {
    color: #cbd5e1 !important;
  }

  :global(.my-swal-popup) {
    background: #1e293b !important;
    border: 1px solid rgba(71, 85, 105, 0.5) !important;
    color: #ffffff !important;
  }

  :global(.my-swal-popup .swal2-title) {
    color: #ffffff !important;
  }

  :global(.my-swal-popup .swal2-html-container) {
    color: #cbd5e1 !important;
  }

  :global(.swal2-icon.swal2-success) {
    border-color: #10b981 !important;
  }

  :global(.swal2-icon.swal2-success [class^="swal2-success-line"]) {
    background-color: #10b981 !important;
  }

  :global(.swal2-icon.swal2-success .swal2-success-ring) {
    border: 0.25em solid rgba(16, 185, 129, 0.3) !important;
  }

  * {
    font-family: "Inter", sans-serif;
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  .settings-container {
    width: 100%;
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
  }

  /* Loading State */
  .loading-state {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px;
    gap: 20px;
    color: #9ca3af;
  }

  .loader {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(16, 185, 129, 0.2);
    border-top-color: #10b981;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Settings Content */
  .settings-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
  }

  /* Header Section */
  .header-section {
    display: flex;
    align-items: center;
    gap: 16px;
    padding-bottom: 24px;
    border-bottom: 2px solid rgba(16, 185, 129, 0.2);
  }

  .icon-wrapper {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
  }

  .header-text h1 {
    font-size: 28px;
    font-weight: 700;
    color: #f3f4f6;
    margin: 0;
  }

  .header-text p {
    font-size: 14px;
    color: #9ca3af;
    margin: 4px 0 0 0;
  }

  /* Info Card */
  .info-card {
    background: rgba(31, 41, 55, 0.5);
    border: 1px solid rgba(55, 65, 81, 0.8);
    border-radius: 16px;

    backdrop-filter: blur(10px);
  }

  .card-headerr {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 12px;
    padding: 20px 24px;
    background: rgba(16, 185, 129, 0.05);
    border-bottom: 1px solid rgba(55, 65, 81, 0.5);
  }

  .card-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: rgba(16, 185, 129, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    color: #10b981;
  }

  .card-header :global(h2) {
    font-size: 18px;
    font-weight: 600;
    color: #f3f4f6;
    margin: 0;
  }

  .card-content {
    padding: 24px;
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Form Fields */
  .field-row {
    display: flex;
    gap: 12px;
  }

  .form-field {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .form-field label {
    font-size: 13px;
    font-weight: 600;
    color: #d1d5db;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .input-wrapper {
    height: 48px;
    padding: 0 16px;
    background: rgba(17, 24, 39, 0.8);
    border: 2px solid #374151;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
  }

  .input-wrapper:focus-within {
    border-color: #10b981;
    background: rgba(17, 24, 39, 0.95);
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
  }

  .input-wrapper.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.15);
    animation: shake 0.4s ease;
  }

  @keyframes shake {
    0%,
    100% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(-5px);
    }
    75% {
      transform: translateX(5px);
    }
  }

  .input-wrapper input {
    flex: 1;
    border: none;
    background: transparent;
    color: #f3f4f6;
    font-size: 15px;
    outline: none;
  }

  .input-wrapper input::placeholder {
    color: #6b7280;
  }

  .input-wrapper.locked {
    background: rgba(17, 24, 39, 0.4);
    border-color: #2d3748;
    opacity: 0.6;
    cursor: not-allowed;
  }

  .input-wrapper.locked input {
    color: #9ca3af;
    cursor: not-allowed;
  }

  .input-wrapper svg {
    flex-shrink: 0;
    opacity: 0.5;
  }

  /* Custom Select */
  .custom-select {
    position: relative;
    width: 100%;
  }

  .custom-select.disabled {
    opacity: 0.5;
    pointer-events: none;
  }

  .select-btn {
    width: 100%;
    height: 48px;
    padding: 0 16px;
    background: rgba(17, 24, 39, 0.8);
    border: 2px solid #374151;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    color: #f3f4f6;
    font-size: 15px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .select-btn:disabled {
    cursor: not-allowed;
    opacity: 0.5;
  }

  .select-btn.active {
    border-color: #10b981;
    background: rgba(17, 24, 39, 0.95);
    box-shadow: 0 0 0 4px rgba(16, 185, 129, 0.1);
  }

  .select-btn.error {
    border-color: #ef4444;
    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.15);
    animation: shake 0.4s ease;
  }

  .select-btn span.placeholder {
    color: #6b7280;
  }

  .select-btn .arrow {
    color: #9ca3af;
    transition: all 0.2s ease;
    flex-shrink: 0;
  }

  .select-btn .arrow.rotate {
    transform: rotate(180deg);
    color: #10b981;
  }

  .dropdown-menu {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    width: 100%;
    max-height: 240px;
    overflow-y: auto;
    background: rgba(31, 41, 55, 0.98);
    border: 2px solid #374151;
    border-radius: 12px;
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
    z-index: 100;
    backdrop-filter: blur(10px);
  }

  .dropdown-menu::-webkit-scrollbar {
    width: 6px;
  }

  .dropdown-menu::-webkit-scrollbar-track {
    background: transparent;
  }

  .dropdown-menu::-webkit-scrollbar-thumb {
    background: #4b5563;
    border-radius: 3px;
  }

  .dropdown-item {
    width: 100%;
    padding: 12px 16px;
    background: transparent;
    border: none;
    border-bottom: 1px solid rgba(55, 65, 81, 0.3);
    color: #f3f4f6;
    font-size: 14px;
    text-align: left;
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .dropdown-item:last-child {
    border-bottom: none;
  }

  .dropdown-item:hover {
    background: rgba(16, 185, 129, 0.1);
    color: #10b981;
  }

  /* Password Row */
  .password-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .change-link {
    font-size: 12px;
    font-weight: 700;
    color: #10b981;
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    transition: all 0.2s ease;
  }

  .change-link:hover {
    color: #059669;
    text-decoration: underline;
  }

  /* Feedback Toast */
  .feedback-toast {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px 20px;
    border-radius: 12px;
    font-size: 14px;
    font-weight: 500;
  }

  .feedback-toast.error {
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    color: #ef4444;
  }

  .feedback-toast.success {
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.3);
    color: #10b981;
  }

  .toast-icon {
    flex-shrink: 0;
  }

  /* Action Section */
  .action-section {
    position: sticky;
    bottom: 0;
    padding: 20px 0 0 0;
    background: linear-gradient(to top, rgba(15, 23, 42, 1) 70%, transparent);
  }

  .save-btn {
    width: 100%;
    height: 56px;
    padding: 0 24px;
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    border: none;
    border-radius: 14px;
    color: white;
    font-size: 16px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s ease;
    box-shadow: 0 8px 16px rgba(16, 185, 129, 0.3);
  }

  .save-btn:hover:not(.disabled) {
    transform: translateY(-2px);
    box-shadow: 0 12px 24px rgba(16, 185, 129, 0.4);
  }

  .save-btn:active:not(.disabled) {
    transform: translateY(0);
  }

  .save-btn.disabled {
    background: #374151;
    color: #6b7280;
    cursor: not-allowed;
    box-shadow: none;
  }

  .btn-loader {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .settings-container {
      padding: 16px;
    }

    .header-section {
      flex-direction: column;
    }
    .header-text h1 {
      font-size: 24px;
    }

    .card-content {
      padding: 20px 16px;
    }

    .field-row {
      flex-direction: column;
    }

    .form-field {
      width: 100%;
    }
  }

  .ce-unit-label {
    font-size: 0.85rem;
    color: #10b981;
    font-weight: 600;
    margin-left: 4px;
    margin-right: 8px;
    pointer-events: none;
  }

  /* Language Toggle Button - Simple TH/EN */
  .lang-toggle-btn {
    display: flex;
    align-items: center;
    gap: 2px;
    padding: 8px 14px;
    background: linear-gradient(
      135deg,
      rgba(30, 41, 59, 0.95),
      rgba(15, 23, 42, 0.95)
    );
    border: 1px solid rgba(100, 116, 139, 0.3);
    border-radius: 10px;
    cursor: pointer;
    margin-right: 12px;
    transition: all 0.3s ease;
  }

  .lang-toggle-btn:hover {
    border-color: #10b981;
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.1),
      rgba(15, 23, 42, 0.95)
    );
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.2);
  }

  .lang-option {
    font-size: 13px;
    font-weight: 700;
    color: #64748b;
    transition: all 0.3s ease;
    padding: 2px 6px;
    border-radius: 4px;
  }

  .lang-option.active {
    color: #10b981;
    background: rgba(16, 185, 129, 0.15);
  }

  .lang-divider {
    color: #475569;
    font-weight: 400;
    font-size: 13px;
  }

  /* Mobile Language Toggle */
  .lang-drawer-item {
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.1),
      rgba(6, 95, 70, 0.05)
    ) !important;
    border: 1px solid rgba(16, 185, 129, 0.2) !important;
    margin-bottom: 8px;
    border-radius: 12px !important;
  }

  .lang-drawer-item:hover {
    background: linear-gradient(
      135deg,
      rgba(16, 185, 129, 0.2),
      rgba(6, 95, 70, 0.1)
    ) !important;
    border-color: #10b981 !important;
  }

  .lang-icon-mobile {
    color: #10b981;
    flex-shrink: 0;
  }

  .mobile-lang-option {
    font-weight: 700;
    color: #64748b;
    transition: all 0.3s ease;
  }

  .mobile-lang-option.active {
    color: #10b981;
  }

  .mobile-lang-divider {
    color: #475569;
    margin: 0 2px;
  }

  .drawer-divider {
    height: 1px;
    background: rgba(255, 255, 255, 0.1);
    margin: 8px 0 16px 0;
  }

  @media (max-width: 768px) {
    .lang-toggle-btn {
      margin-right: 8px;
    }

    .lang-toggle-inner {
      padding: 6px 10px;
      gap: 4px;
    }

    .lang-flag {
      font-size: 16px;
    }

    .lang-text {
      font-size: 11px;
    }

    .lang-arrow {
      width: 10px;
      height: 10px;
    }
  }
  
  /* ===== OPTIMIZATION: Skeleton Loading Styles ===== */
  @keyframes shimmer {
    0% {
      background-position: -200px 0;
    }
    100% {
      background-position: calc(200px + 100%) 0;
    }
  }
  
  .skeleton-card {
    pointer-events: none;
    overflow: hidden;
  }
  
  .skeleton-img {
    height: 160px;
    background: linear-gradient(
      90deg,
      rgba(30, 41, 59, 0.8) 0px,
      rgba(51, 65, 85, 0.8) 40px,
      rgba(30, 41, 59, 0.8) 80px
    );
    background-size: 200px 100%;
    animation: shimmer 1.2s ease-in-out infinite;
  }
  
  .skeleton-line {
    height: 16px;
    border-radius: 8px;
    background: linear-gradient(
      90deg,
      rgba(30, 41, 59, 0.8) 0px,
      rgba(51, 65, 85, 0.8) 40px,
      rgba(30, 41, 59, 0.8) 80px
    );
    background-size: 200px 100%;
    animation: shimmer 1.2s ease-in-out infinite;
    margin-bottom: 12px;
  }
  
  .skeleton-title {
    width: 70%;
    height: 20px;
  }
  
  .skeleton-desc {
    width: 100%;
  }
  
  .skeleton-desc.short {
    width: 50%;
  }
  
  .skeleton-meta {
    display: flex;
    gap: 8px;
    margin-top: 16px;
  }
  
  .skeleton-badge {
    width: 60px;
    height: 24px;
    border-radius: 12px;
    background: linear-gradient(
      90deg,
      rgba(30, 41, 59, 0.8) 0px,
      rgba(51, 65, 85, 0.8) 40px,
      rgba(30, 41, 59, 0.8) 80px
    );
    background-size: 200px 100%;
    animation: shimmer 1.2s ease-in-out infinite;
  }
  
  /* Loading spinner improvements */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(15, 23, 42, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    backdrop-filter: blur(4px);
  }
  
  .loading-content {
    text-align: center;
    color: #e2e8f0;
  }
  
  .loading-spinner-lg {
    width: 48px;
    height: 48px;
    border: 3px solid rgba(100, 116, 139, 0.3);
    border-top-color: #10b981;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 0 auto 16px;
  }
  
  .loading-text {
    font-size: 14px;
    color: #94a3b8;
    margin-top: 8px;
  }
</style>
