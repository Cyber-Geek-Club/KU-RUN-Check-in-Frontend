import{w as c}from"./iepnBnC-.js";function u(){let r=null,s=null;{r=localStorage.getItem("access_token");const e=localStorage.getItem("user_info");if(e)try{s=JSON.parse(e)}catch(t){console.error("Error parsing user info",t)}}const{subscribe:l,set:n}=c({token:r,isAuthenticated:!!r,user:s});return{subscribe:l,login:e=>{const t=e.access_token;let o;e.user&&typeof e.user=="object"?o={id:e.user.id||e.user.user_id,email:e.user.email,name:e.user.name,role:e.user.role}:o={id:e.user_id??0,email:e.email??"",name:e.name??"",role:e.role??""};const i=Date.now()+(e.expires_in?e.expires_in*1e3:864e5);localStorage.setItem("access_token",t),localStorage.setItem("user_info",JSON.stringify(o)),localStorage.setItem("token_expiry",i.toString()),n({token:t,isAuthenticated:!0,user:o})},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("user_info"),localStorage.removeItem("token_expiry"),sessionStorage.clear(),n({token:null,isAuthenticated:!1,user:null})},checkTokenValidity:()=>{const e=localStorage.getItem("access_token"),t=localStorage.getItem("token_expiry");if(!e||!t)return!1;const o=parseInt(t);return!(Date.now()>=o-6e4)}}}const m=u();export{m as a};
