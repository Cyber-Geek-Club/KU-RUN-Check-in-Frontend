import{e as d,u as A,r as g,x as T,ar as E}from"./hnvWcoZH.js";import{i as I,a as k,c as C}from"./BeVKdWBa.js";function H(n,s,c){d(()=>{var r=A(()=>s(n,c?.())||{});if(c&&r?.update){var e=!1,a={};g(()=>{var u=c();T(u),e&&E(a,u)&&(a=u,r.update(u))}),e=!0}if(r?.destroy)return()=>r.destroy()})}function N(n){const s=D(n),c=new ArrayBuffer(s.length),r=new DataView(c);for(let e=0;e<c.byteLength;e++)r.setUint8(e,s.charCodeAt(e));return c}const S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function D(n){n.length%4===0&&(n=n.replace(/==?$/,""));let s="",c=0,r=0;for(let e=0;e<n.length;e++)c<<=6,c|=S.indexOf(n[e]),r+=6,r===24&&(s+=String.fromCharCode((c&16711680)>>16),s+=String.fromCharCode((c&65280)>>8),s+=String.fromCharCode(c&255),c=r=0);return r===12?(c>>=4,s+=String.fromCharCode(c)):r===18&&(c>>=2,s+=String.fromCharCode((c&65280)>>8),s+=String.fromCharCode(c&255)),s}const L=-1,U=-2,O=-3,P=-4,R=-5,j=-6;function F(n,s){return M(JSON.parse(n),s)}function M(n,s){if(typeof n=="number")return e(n,!0);if(!Array.isArray(n)||n.length===0)throw new Error("Invalid input");const c=n,r=Array(c.length);function e(a,u=!1){if(a===L)return;if(a===O)return NaN;if(a===P)return 1/0;if(a===R)return-1/0;if(a===j)return-0;if(u||typeof a!="number")throw new Error("Invalid input");if(a in r)return r[a];const t=c[a];if(!t||typeof t!="object")r[a]=t;else if(Array.isArray(t))if(typeof t[0]=="string"){const i=t[0],l=s&&Object.hasOwn(s,i)?s[i]:void 0;if(l){let f=t[1];return typeof f!="number"&&(f=c.push(t[1])-1),r[a]=l(e(f))}switch(i){case"Date":r[a]=new Date(t[1]);break;case"Set":const f=new Set;r[a]=f;for(let o=1;o<t.length;o+=1)f.add(e(t[o]));break;case"Map":const m=new Map;r[a]=m;for(let o=1;o<t.length;o+=2)m.set(e(t[o]),e(t[o+1]));break;case"RegExp":r[a]=new RegExp(t[1],t[2]);break;case"Object":r[a]=Object(t[1]);break;case"BigInt":r[a]=BigInt(t[1]);break;case"null":const y=Object.create(null);r[a]=y;for(let o=1;o<t.length;o+=2)y[t[o]]=e(t[o+1]);break;case"Int8Array":case"Uint8Array":case"Uint8ClampedArray":case"Int16Array":case"Uint16Array":case"Int32Array":case"Uint32Array":case"Float32Array":case"Float64Array":case"BigInt64Array":case"BigUint64Array":{const o=globalThis[i],p=new o(e(t[1]));r[a]=t[2]!==void 0?p.subarray(t[2],t[3]):p;break}case"ArrayBuffer":{const o=t[1],p=N(o);r[a]=p;break}case"Temporal.Duration":case"Temporal.Instant":case"Temporal.PlainDate":case"Temporal.PlainTime":case"Temporal.PlainDateTime":case"Temporal.PlainMonthDay":case"Temporal.PlainYearMonth":case"Temporal.ZonedDateTime":{const o=i.slice(9);r[a]=Temporal[o].from(t[1]);break}case"URL":{const o=new URL(t[1]);r[a]=o;break}case"URLSearchParams":{const o=new URLSearchParams(t[1]);r[a]=o;break}default:throw new Error(`Unknown type ${i}`)}}else{const i=new Array(t.length);r[a]=i;for(let l=0;l<t.length;l+=1){const f=t[l];f!==U&&(i[l]=e(f))}}else{const i={};r[a]=i;for(const l in t){if(l==="__proto__")throw new Error("Cannot parse an object with a `__proto__` property");const f=t[l];i[l]=e(f)}}return r[a]}return e(0)}function _(n){const s=JSON.parse(n);return s.data&&(s.data=F(s.data,C.decoders)),s}function b(n){return HTMLElement.prototype.cloneNode.call(n)}function V(n,s=()=>{}){const c=async({action:e,result:a,reset:u=!0,invalidateAll:t=!0})=>{a.type==="success"&&(u&&HTMLFormElement.prototype.reset.call(n),t&&await I()),(location.origin+location.pathname===e.origin+e.pathname||a.type==="redirect"||a.type==="error")&&await k(a)};async function r(e){if((e.submitter?.hasAttribute("formmethod")?e.submitter.formMethod:b(n).method)!=="post")return;e.preventDefault();const u=new URL(e.submitter?.hasAttribute("formaction")?e.submitter.formAction:b(n).action),t=e.submitter?.hasAttribute("formenctype")?e.submitter.formEnctype:b(n).enctype,i=new FormData(n,e.submitter),l=new AbortController;let f=!1;const y=await s({action:u,cancel:()=>f=!0,controller:l,formData:i,formElement:n,submitter:e.submitter})??c;if(f)return;let o;try{const p=new Headers({accept:"application/json","x-sveltekit-action":"true"});t!=="multipart/form-data"&&p.set("Content-Type",/^(:?application\/x-www-form-urlencoded|text\/plain)$/.test(t)?t:"application/x-www-form-urlencoded");const w=t==="multipart/form-data"?i:new URLSearchParams(i),h=await fetch(u,{method:"POST",headers:p,cache:"no-store",body:w,signal:l.signal});o=_(await h.text()),o.type==="error"&&(o.status=h.status)}catch(p){if(p?.name==="AbortError")return;o={type:"error",error:p}}await y({action:u,formData:i,formElement:n,update:p=>c({action:u,result:o,reset:p?.reset,invalidateAll:p?.invalidateAll}),result:o})}return HTMLFormElement.prototype.addEventListener.call(n,"submit",r),{destroy(){HTMLFormElement.prototype.removeEventListener.call(n,"submit",r)}}}export{H as a,V as e};
