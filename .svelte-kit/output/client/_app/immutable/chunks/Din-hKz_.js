import{a as t}from"./CfzA4fdq.js";import"./CfPb4ERz.js";const d=!0,f=d,g="http://158.108.102.14:8001";async function R(n,h={}){const{skipAuth:l,skipRefresh:u,...s}=h,o=new Headers(s.headers||{});if(!l&&f){const e=localStorage.getItem("access_token");e&&o.set("Authorization",`Bearer ${e}`)}o.has("Content-Type")||o.set("Content-Type","application/json"),s.headers=o;const a=n.startsWith("http")?n:`${g}${n}`;let r;try{r=await fetch(a,s)}catch(e){throw console.error("❌ API Request failed:",e),e}if(!r.ok){const e=r.status;if(e===401&&!u&&f)if(localStorage.getItem("refresh_token"))if(console.log("Got 401, attempting token refresh..."),await t.refreshAccessToken()){const c=localStorage.getItem("access_token");if(c){o.set("Authorization",`Bearer ${c}`),s.headers=o;try{return r=await fetch(a,s),r.ok||(console.error(`❌ Error ${r.status} after token refresh`),t.forceLogoutAndRedirect()),r}catch(i){throw console.error("❌ Retry request failed:",i),t.forceLogoutAndRedirect(),i}}}else throw console.error("❌ Token refresh failed"),t.forceLogoutAndRedirect(),new Error("Session expired. Please login again.");else throw console.error("❌ No refresh token available"),t.forceLogoutAndRedirect(),new Error("Session expired. Please login again.");else{if(e===403)throw console.error("❌ API Error 403: Forbidden"),t.forceLogoutAndRedirect(),new Error("Access denied. Please login again.");e>=400&&console.warn(`⚠️ API Error ${e}: ${r.statusText}`)}}return r}export{R as a};
