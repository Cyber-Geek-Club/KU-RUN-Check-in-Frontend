import"../chunks/DsnmJJEf.js";import{$ as A,l as d,i as l,a0 as p,a1 as _,a2 as u,a3 as G,a4 as O,f as T,a5 as D,a6 as N}from"../chunks/BzFeUjkD.js";import{i as R}from"../chunks/yr0HFLoq.js";import{s as U,a as W}from"../chunks/Bgcq_F7-.js";import{b as $,g as s}from"../chunks/8b7-bA6A.js";import{p as H}from"../chunks/CSU9-5P9.js";var C=N('<div style="width: 100vw; height: 100vh; background-color: #111827;"></div>');function j(S,g){A(g,!0);const v=()=>U(H,"$page",k),[k,w]=W(),f={student:"/student/event-list",officer:"/officer/event-list",organizer:"/organizer/create-event"},I=["/","/auth/login","/auth/register","/auth/verify-email","/auth/forgot-password","/auth/reset-password"],z=["/auth/reset-password","/auth/verify-email","/auth/forgot-password"];let r=O(!1);function L(){const e=localStorage.getItem("access_token");let t=null;try{const o=localStorage.getItem("user_info");o&&(t=JSON.parse(o).role?.toLowerCase())}catch{}return{token:e,role:t}}d(()=>{const e=t=>{t.key==="access_token"&&t.newValue===null&&(console.log("ðŸ”„ Logout detected."),window.location.href="/auth/login")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),$(({to:e})=>{e&&sessionStorage.setItem("authorized_ticket",e.url.pathname)}),d(()=>{const e=v().url.pathname,{token:t,role:o}=L(),i=z.some(m=>e.startsWith(m));if(!t){if(!I.some(b=>e.startsWith(b))){s("/auth/login",{replaceState:!0});return}const c=sessionStorage.getItem("authorized_ticket");if(!c||i)sessionStorage.setItem("authorized_ticket",e);else if(c!==e){console.log("â›” STOP! Guest typed URL manually."),s(c,{replaceState:!0}),l(r,!1);return}l(r,!0);return}const a=o&&f[o]?f[o]:"/auth/login";if(a==="/auth/login"){localStorage.clear(),sessionStorage.clear(),s("/auth/login",{replaceState:!0});return}if(e==="/"||e.startsWith("/auth")&&!i){sessionStorage.setItem("authorized_ticket",a),s(a,{replaceState:!0});return}const n=sessionStorage.getItem("authorized_ticket");if(n){if(e!==n)if(i)sessionStorage.setItem("authorized_ticket",e);else{console.log(`â›” URL TAMPERED! Go back to ${n}`),s(n,{replaceState:!0}),l(r,!1);return}}else{if(e!==a&&!i){console.log("â›” No Ticket. Force Home."),sessionStorage.setItem("authorized_ticket",a),s(a,{replaceState:!0});return}sessionStorage.setItem("authorized_ticket",e)}l(r,!0)});var h=p(),E=_(h);{var y=e=>{var t=p(),o=_(t);D(o,()=>g.children),u(e,t)},P=e=>{var t=C();u(e,t)};R(E,e=>{T(r)?e(y):e(P,!1)})}u(S,h),G(),w()}export{j as component};
