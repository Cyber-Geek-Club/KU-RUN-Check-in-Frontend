import"../chunks/DsnmJJEf.js";import"../chunks/dQoSI2p6.js";import{$ as ce,a6 as J,aa as D,f as t,ab as b,a2 as y,a3 as pe,ad as a,af as l,ae as i,m as d,ak as ve,ag as $,i as o,am as q}from"../chunks/BzFeUjkD.js";import{i as F}from"../chunks/yr0HFLoq.js";import{b as U,r as V,s as de}from"../chunks/DMKKEYkG.js";import{s as W}from"../chunks/Dx5pcVVY.js";import{t as ue,s as me}from"../chunks/C9WUvhPB.js";import{p as fe}from"../chunks/CdEA5IGF.js";import{i as ge}from"../chunks/B4hL2_NH.js";import{g as he}from"../chunks/8b7-bA6A.js";import{a as H}from"../chunks/CfzA4fdq.js";var _e=q('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),we=q('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),be=J('<div class="message-container error svelte-1i2smtp"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> <span> </span></div>'),ye=J(`<div class="app-screen svelte-1i2smtp"><div class="scroll-container svelte-1i2smtp"><div class="content-wrapper svelte-1i2smtp"><div class="login-card svelte-1i2smtp"><div class="title-section svelte-1i2smtp"><h1 class="main-title svelte-1i2smtp">NISIT<br/>LOGIN TO ACCOUNT</h1> <p class="sub-title svelte-1i2smtp">Welcome back! Please enter your details.</p></div> <form class="form-section svelte-1i2smtp"><div class="form-group svelte-1i2smtp"><label class="label svelte-1i2smtp" for="email">Email</label> <div><input id="email" type="email" placeholder="Enter your email" class="svelte-1i2smtp"/></div></div> <div class="form-group svelte-1i2smtp"><div class="password-header svelte-1i2smtp"><label class="label svelte-1i2smtp" for="password">Password</label> <a href="/auth/forgot-password" class="forgot-link svelte-1i2smtp">Forgot ?</a></div> <div><input id="password" placeholder="Enter your password" class="svelte-1i2smtp"/> <button type="button" class="toggle-password svelte-1i2smtp" aria-label="Toggle Password Visibility"><!></button></div></div> <!> <button class="login-button svelte-1i2smtp" type="submit"> </button> <div class="signup-section svelte-1i2smtp"><span class="signup-text svelte-1i2smtp">Don't have an account?</span> <a href="/auth/register" class="signup-link svelte-1i2smtp">Sign up</a></div></form></div></div></div></div>`);function Ne(K,Q){ce(Q,!1);let n=d(""),_=d(""),w=d(!1),u=d(!1),p=d(""),m=null,c=d(null);function X(){o(w,!t(w))}function Y(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function k(){o(c,null),t(p)&&(o(p,""),m&&clearTimeout(m))}function v(e,r){m&&clearTimeout(m),o(p,e),o(c,r),m=setTimeout(()=>{o(p,""),o(c,null)},3e3)}function Z(e){if(!e)return"";const r=String(e).trim().toLowerCase();return["student","officer","organizer"].includes(r)?r:""}function C(e){switch(e){case"officer":return"/officer/event-list";case"student":return"/student/event-list";case"organizer":return"/organizer/create-event";default:return"/student/event-list"}}async function ee(){if(k(),!t(u)){if(!t(n))return v("Please enter your email.","email");if(!Y(t(n)))return v("Invalid email format.","email");if(!t(_))return v("Please enter your password.","password");try{o(u,!0);const r=`${"http://158.108.102.14:8001".replace(/\/$/,"")}/api/users/login`,g=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t(n),password:t(_)})}),s=await g.json().catch(()=>({}));if(!g.ok)return H.logout(),v(s?.detail??"Login failed. Please check your credentials.","both");const z=s.access_token,oe=s.refresh_token,A=s.role||s.user?.role,h=Z(A);if(console.log("ROLE FROM SERVER:",A,"=>",h),!z||!h)return console.error("Login Error: Missing token or role",s),v("System Error: Invalid response from server.","both");const le={access_token:z,refresh_token:oe||void 0,token_type:s.token_type||"Bearer",expires_in:s.expires_in||3600,user_id:s.user_id||s.id||s.user?.id,email:s.email||s.user?.email||t(n),name:s.name||s.user?.name||s.username||s.user?.username||t(n).split("@")[0],role:h};H.login(le);try{localStorage.setItem("strict_allowed_path",C(h)),localStorage.setItem("strict_allowed_path_ts",Date.now().toString())}catch(ne){console.warn("localStorage write failed:",ne)}const B=C(h);console.log("REDIRECTING TO:",B),await he(B,{replaceState:!0})}catch(e){console.error("Login Error:",e),v("Cannot connect to server. Please try again later.","both")}finally{o(u,!1)}}}ge();var x=ye(),N=a(x),G=a(N),M=a(G),E=l(a(M),2),T=a(E),I=l(a(T),2),S=a(I);V(S),i(I),i(T);var R=l(T,2),O=l(a(R),2),f=a(O);V(f);var P=l(f,2),te=a(P);{var se=e=>{var r=_e();y(e,r)},re=e=>{var r=we();y(e,r)};F(te,e=>{t(w)?e(se):e(re,!1)})}i(P),i(O),i(R);var j=l(R,2);{var ae=e=>{var r=be(),g=l(a(r),2),s=a(g,!0);i(g),i(r),D(()=>$(s,t(p))),ue(3,r,()=>me,()=>({duration:200})),y(e,r)};F(j,e=>{t(p)&&e(ae)})}var L=l(j,2),ie=a(L,!0);i(L),ve(2),i(E),i(M),i(G),i(N),i(x),D(()=>{W(I,1,`input-field ${t(c)==="email"||t(c)==="both"?"error":""}`,"svelte-1i2smtp"),W(O,1,`input-field password-field ${t(c)==="password"||t(c)==="both"?"error":""}`,"svelte-1i2smtp"),de(f,"type",t(w)?"text":"password"),L.disabled=t(u),$(ie,t(u)?"LOGGING INâ€¦":"LOGIN NOW")}),U(S,()=>t(n),e=>o(n,e)),b("input",S,k),U(f,()=>t(_),e=>o(_,e)),b("input",f,k),b("click",P,X),b("submit",E,fe(ee)),y(K,x),pe()}export{Ne as component};
