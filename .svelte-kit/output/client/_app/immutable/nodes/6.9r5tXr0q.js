import"../chunks/DsnmJJEf.js";import"../chunks/dQoSI2p6.js";import{$ as je,a7 as De,aj as Ee,a6 as E,aa as V,a2 as n,a3 as Be,i,m as p,ad as t,f as r,ae as a,a1 as X,af as v,ab as P,am as b,ag as Ie,al as ee,ak as re}from"../chunks/BzFeUjkD.js";import{i as _}from"../chunks/yr0HFLoq.js";import{r as se,s as te,b as ae}from"../chunks/DMKKEYkG.js";import{s as j,c as Oe}from"../chunks/Dx5pcVVY.js";import{t as S,s as D,a as Re}from"../chunks/C9WUvhPB.js";import{p as ze}from"../chunks/CdEA5IGF.js";import{i as Ne}from"../chunks/B4hL2_NH.js";import{a as We,s as Fe}from"../chunks/Bgcq_F7-.js";import"../chunks/CfPb4ERz.js";import{p as Le}from"../chunks/CSU9-5P9.js";var Ue=b('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),Ye=b('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),Ze=b('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),$e=b('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),Ge=b('<circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line>',1),Je=b('<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline>',1),Ve=E('<div><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><!></svg> <span> </span></div>'),qe=E('<div class="title-section svelte-654myr"><h1 class="main-title svelte-654myr">SET NEW PASSWORD</h1> <p class="sub-title svelte-654myr">Create a new password. Ensure it differs from previous ones.</p></div> <div class="form-section svelte-654myr"><form><div class="form-group svelte-654myr"><label class="label svelte-654myr" for="new-password">New Password</label> <div><input id="new-password" placeholder="Enter new password" class="svelte-654myr"/> <button type="button" class="toggle-password svelte-654myr" tabindex="-1"><!></button></div></div> <div class="form-group svelte-654myr"><label class="label svelte-654myr" for="confirm-password">Confirm Password</label> <div><input id="confirm-password" placeholder="Confirm new password" class="svelte-654myr"/> <button type="button" class="toggle-password svelte-654myr" tabindex="-1"><!></button></div></div> <!> <button class="primary-btn svelte-654myr" type="submit"><!></button></form></div>',1),He=E('<div class="icon-wrapper svelte-654myr"><div class="success-circle svelte-654myr"><svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg></div></div> <div class="title-section svelte-654myr" style="text-align: center;"><h1 class="main-title success-text svelte-654myr">PASSWORD UPDATED</h1> <p class="sub-title svelte-654myr">Your password has been reset successfully.<br/> <span style="color: #9ca3af; font-weight: 500; display: block; margin-top: 12px;">You can close this window now.</span></p></div>',1),Ke=E('<div class="app-screen svelte-654myr"><div class="scroll-container svelte-654myr"><div class="content-wrapper svelte-654myr"><div><!></div></div></div></div>');function vr(oe,ie){je(ie,!1);const ne=()=>Fe(Le,"$page",le),[le,de]=We(),ve="http://158.108.102.14:8001";let B=p(1),u=p(!1),A=null,f=p(""),I=p("error"),k,x=p(""),w=p(""),C=p(""),T=p(!1),M=p(!1);De(()=>{A=ne().url.searchParams.get("token"),A||m("Invalid link. Token is missing.","error")}),Ee(()=>{k&&clearTimeout(k)});function m(o,l="error",d=""){k&&clearTimeout(k),i(f,o),i(I,l),i(x,d),k=setTimeout(()=>{i(f,""),i(x,"")},l==="error"?5e3:3e3)}function O(){r(f)&&(i(f,""),i(x,""))}function ce(o){return/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/.test(o)}async function pe(){if(O(),!r(u)){if(!A)return m("Invalid link.","error");if(!r(w))return m("Enter password.","error","password");if(!ce(r(w)))return m("Password must be 8+ chars & include a number.","error","password");if(!r(C))return m("Confirm password.","error","confirmPassword");if(r(w)!==r(C))return m("Passwords do not match.","error","confirmPassword");i(u,!0);try{const o=await fetch(`${ve}/api/users/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:A,new_password:r(w)})}),l=await o.json().catch(()=>({}));if(o.ok)i(B,2),localStorage.setItem("password_reset_done",Date.now().toString());else{const d=l.detail||"Failed to reset password.";let c="";d.toLowerCase().includes("password")&&(c="password"),m(d,"error",c)}}catch{m("Cannot connect to server.","error")}finally{i(u,!1)}}}Ne();var R=Ke(),q=t(R),H=t(q),z=t(H),me=t(z);{var ue=o=>{var l=qe(),d=X(l),c=v(d,2),N=t(c),W=t(N),F=v(t(W),2),h=t(F);se(h);var L=v(h,2),we=t(L);{var he=e=>{var s=Ue();n(e,s)},ge=e=>{var s=Ye();n(e,s)};_(we,e=>{r(T)?e(he):e(ge,!1)})}a(L),a(F),a(W);var U=v(W,2),Y=v(t(U),2),g=t(Y);se(g);var Z=v(g,2),ye=t(Z);{var _e=e=>{var s=Ze();n(e,s)},be=e=>{var s=$e();n(e,s)};_(ye,e=>{r(M)?e(_e):e(be,!1)})}a(Z),a(Y),a(U);var K=v(U,2);{var ke=e=>{var s=Ve(),G=t(s),Ae=t(G);{var Ce=y=>{var J=Ge();re(2),n(y,J)},Te=y=>{var J=Je();re(),n(y,J)};_(Ae,y=>{r(I)==="error"?y(Ce):y(Te,!1)})}a(G);var Q=v(G,2),Me=t(Q,!0);a(Q),a(s),V(()=>{j(s,1,`message-container ${r(I)??""}`,"svelte-654myr"),Ie(Me,r(f))}),S(3,s,()=>D,()=>({duration:200})),n(e,s)};_(K,e=>{r(f)&&e(ke)})}var $=v(K,2),xe=t($);{var Pe=e=>{var s=ee("UPDATING...");n(e,s)},Se=e=>{var s=ee("RESET PASSWORD");n(e,s)};_(xe,e=>{r(u)?e(Pe):e(Se,!1)})}a($),a(N),a(c),V(()=>{j(F,1,`input-field ${r(x)==="password"?"error-border":""}`,"svelte-654myr"),te(h,"type",r(T)?"text":"password"),h.disabled=r(u),j(Y,1,`input-field ${r(x)==="confirmPassword"?"error-border":""}`,"svelte-654myr"),te(g,"type",r(M)?"text":"password"),g.disabled=r(u),$.disabled=r(u)}),S(1,d,()=>D),ae(h,()=>r(w),e=>i(w,e)),P("input",h,O),P("click",L,()=>i(T,!r(T))),ae(g,()=>r(C),e=>i(C,e)),P("input",g,O),P("click",Z,()=>i(M,!r(M))),P("submit",N,ze(pe)),S(1,c,()=>D),n(o,l)},fe=o=>{var l=He(),d=X(l),c=v(d,2);S(1,d,()=>Re,()=>({duration:400,start:.5})),S(1,c,()=>D),n(o,l)};_(me,o=>{r(B)===1?o(ue):o(fe,!1)})}a(z),a(H),a(q),a(R),V(()=>j(z,1,Oe(r(B)===2?"success-card":"form-card"),"svelte-654myr")),n(oe,R),Be(),de()}export{vr as component};
