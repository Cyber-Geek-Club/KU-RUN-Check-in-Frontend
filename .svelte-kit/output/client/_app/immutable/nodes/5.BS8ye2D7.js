import"../chunks/DsnmJJEf.js";import"../chunks/BcIedFuQ.js";import{aa as re,af as $,ag as B,g as t,a as b,ad as oe,ah as r,aj as n,ai as o,m as g,n as ae,s as i,ak as V}from"../chunks/hnvWcoZH.js";import{e as y,s as ie}from"../chunks/BUWzuOGr.js";import{i as F}from"../chunks/DMWe2FX4.js";import{t as le,s as ne}from"../chunks/C0Voc4CA.js";import{r as G,s as ce}from"../chunks/DR3WUKjK.js";import{s as J}from"../chunks/d_EmPeYN.js";import{b as U}from"../chunks/DGYhdjUt.js";import{p as pe}from"../chunks/CdEA5IGF.js";import{i as ve}from"../chunks/DXkH34Fe.js";import{g as de}from"../chunks/BeVKdWBa.js";import{a as me}from"../chunks/DAQEOcle.js";var ue=V('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>'),fe=V('<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"></path><line x1="1" y1="1" x2="23" y2="23"></line></svg>'),ge=$('<div class="message-container error svelte-1i2smtp"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg> <span> </span></div>'),he=$(`<div class="app-screen svelte-1i2smtp"><div class="scroll-container svelte-1i2smtp"><div class="content-wrapper svelte-1i2smtp"><div class="login-card svelte-1i2smtp"><div class="title-section svelte-1i2smtp"><h1 class="main-title svelte-1i2smtp">NISIT<br/>LOGIN TO ACCOUNT</h1> <p class="sub-title svelte-1i2smtp">Welcome back! Please enter your details.</p></div> <form class="form-section svelte-1i2smtp"><div class="form-group svelte-1i2smtp"><label class="label svelte-1i2smtp" for="email">Email</label> <div><input id="email" type="email" placeholder="Enter your email" class="svelte-1i2smtp"/></div></div> <div class="form-group svelte-1i2smtp"><div class="password-header svelte-1i2smtp"><label class="label svelte-1i2smtp" for="password">Password</label> <a href="/auth/forgot-password" class="forgot-link svelte-1i2smtp">Forgot ?</a></div> <div><input id="password" placeholder="Enter your password" class="svelte-1i2smtp"/> <button type="button" class="toggle-password svelte-1i2smtp" aria-label="Toggle Password Visibility"><!></button></div></div> <!> <button class="login-button svelte-1i2smtp" type="submit">LOGIN NOW</button> <div class="signup-section svelte-1i2smtp"><span class="signup-text svelte-1i2smtp">Don't have an account?</span> <a href="/auth/register" class="signup-link svelte-1i2smtp">Sign up</a></div></form></div></div></div></div>`);function Ce(W,H){re(H,!1);let v=g(""),h=g(""),w=g(!1),c=g(""),d=null,l=g(null);function q(){i(w,!t(w))}function K(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function k(){i(l,null),t(c)&&(i(c,""),d&&clearTimeout(d))}function p(e,s){d&&clearTimeout(d),i(c,e),i(l,s),d=setTimeout(()=>{i(c,""),i(l,null)},3e3)}function Q(e){if(!e)return"";const s=String(e).trim().toLowerCase();return["student","officer","organizer","organizer"].includes(s)?s:""}function N(e){switch(e){case"officer":return"/officer/event-list";case"student":return"/student/event-list";case"organizer":case"organizer":return"/organizer/create-event";default:return"/student/event-list"}}async function X(){if(k(),!t(v))return p("Please enter your email.","email");if(!K(t(v)))return p("Invalid email format.","email");if(!t(h))return p("Please enter your password.","password");try{const s=`${"http://158.108.102.14:8001".replace(/\/$/,"")}/api/users/login`,u=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t(v),password:t(h)})}),a=await u.json().catch(()=>({}));if(!u.ok)return p(a?.detail??"Login failed. Please check your credentials.","both");const _=a.access_token,A=a.role||a.user?.role,f=Q(A);if(console.log("ROLE FROM SERVER:",A,"=>",f),!_||!f)return console.error("Login Error: Missing token or role",a),p("System Error: Invalid response from server.","both");const C={...a.user??a,role:f};try{localStorage.setItem("access_token",_),localStorage.setItem("user_info",JSON.stringify(C)),localStorage.setItem("strict_allowed_path",N(f)),localStorage.setItem("strict_allowed_path_ts",Date.now().toString())}catch(L){console.warn("localStorage write failed:",L)}try{sessionStorage.setItem("access_token",_),sessionStorage.setItem("user_info",JSON.stringify(C))}catch(L){console.warn("sessionStorage write failed:",L)}me.login({...a,access_token:_,user:C});const D=N(f);console.log("REDIRECTING TO:",D),await de(D,{replaceState:!0})}catch(e){console.error("Login Error:",e),p("Cannot connect to server. Please try again later.","both")}}ve();var S=he(),z=r(S),j=r(z),M=r(j),x=n(r(M),2),I=r(x),E=n(r(I),2),T=r(E);G(T),o(E),o(I);var O=n(I,2),P=n(r(O),2),m=r(P);G(m);var R=n(m,2),Y=r(R);{var Z=e=>{var s=ue();b(e,s)},ee=e=>{var s=fe();b(e,s)};F(Y,e=>{t(w)?e(Z):e(ee,!1)})}o(R),o(P),o(O);var te=n(O,2);{var se=e=>{var s=ge(),u=n(r(s),2),a=r(u,!0);o(u),o(s),B(()=>ie(a,t(c))),le(3,s,()=>ne,()=>({duration:200})),b(e,s)};F(te,e=>{t(c)&&e(se)})}ae(4),o(x),o(M),o(j),o(z),o(S),B(()=>{J(E,1,`input-field ${t(l)==="email"||t(l)==="both"?"error":""}`,"svelte-1i2smtp"),J(P,1,`input-field password-field ${t(l)==="password"||t(l)==="both"?"error":""}`,"svelte-1i2smtp"),ce(m,"type",t(w)?"text":"password")}),U(T,()=>t(v),e=>i(v,e)),y("input",T,k),U(m,()=>t(h),e=>i(h,e)),y("input",m,k),y("click",R,q),y("submit",x,pe(X)),b(W,S),oe()}export{Ce as component};
