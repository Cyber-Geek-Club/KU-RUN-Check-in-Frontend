import"../chunks/DsnmJJEf.js";import{aa as L,o as h,s as c,ab as m,ac as p,a as l,ad as b,ae as P,g as G,af as T}from"../chunks/hnvWcoZH.js";import{s as $}from"../chunks/CjsIklVn.js";import{i as O}from"../chunks/DMWe2FX4.js";import{s as R,a as U}from"../chunks/Kg6iL7tW.js";import{b as x,g as r}from"../chunks/BeVKdWBa.js";import{p as A}from"../chunks/BnnbauKR.js";var H=T('<div style="width: 100vw; height: 100vh; background-color: #111827; display: flex; align-items: center; justify-content: center;"></div>');function V(d,u){L(u,!0);const S=()=>R(A,"$page",_),[_,v]=U(),g={student:"/student/event-list",officer:"/officer/event-list",organizer:"/organizer/create-event",organize:"/organizer/create-event"},k=["/","/auth/login","/auth/register","/auth/verify-email","/auth/forgot-password","/auth/reset-password"];let s=P(!1);function w(){const e=localStorage.getItem("access_token");let t=null;try{const o=localStorage.getItem("user_info");o&&(t=JSON.parse(o).role?.toLowerCase())}catch{}return{token:e,role:t}}h(()=>{const e=t=>{t.key==="access_token"&&t.newValue===null&&(console.log("ðŸ”„ Logout detected from another tab."),window.location.href="/auth/login")};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)}),x(({to:e})=>{if(!e)return;const t=e.url.pathname;sessionStorage.setItem("authorized_ticket",t)}),h(()=>{const e=S().url.pathname,{token:t,role:o}=w();if(!t){if(!k.some(E=>e.startsWith(E))){r("/auth/login",{replaceState:!0});return}const i=sessionStorage.getItem("authorized_ticket");if(!i)sessionStorage.setItem("authorized_ticket",e);else if(i!==e){console.log(`â›” STOP! You typed URL manually. Go back to ${i}`),r(i,{replaceState:!0}),c(s,!1);return}c(s,!0);return}const a=o&&g[o]?g[o]:"/auth/login";if(a==="/auth/login"){localStorage.clear(),sessionStorage.clear(),r("/auth/login",{replaceState:!0});return}if(e.startsWith("/auth")||e==="/"){sessionStorage.setItem("authorized_ticket",a),r(a,{replaceState:!0});return}const n=sessionStorage.getItem("authorized_ticket");if(n){if(e!==n){console.log(`â›” URL TAMPERED! Expected: ${n}, Got: ${e}`),r(n,{replaceState:!0}),c(s,!1);return}}else{if(e!==a){console.log("â›” No Ticket (Deep Link). Force Home."),sessionStorage.setItem("authorized_ticket",a),r(a,{replaceState:!0});return}sessionStorage.setItem("authorized_ticket",e)}c(s,!0)});var f=m(),z=p(f);{var I=e=>{var t=m(),o=p(t);$(o,()=>u.children),l(e,t)},y=e=>{var t=H();l(e,t)};O(z,e=>{G(s)?e(I):e(y,!1)})}l(d,f),b(),v()}export{V as component};
